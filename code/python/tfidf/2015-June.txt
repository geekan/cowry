From phoracek at redhat.com  Mon Jun  1 00:40:08 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Mon, 1 Jun 2015 03:40:08 -0400 (EDT)
Subject: [ovs-discuss] Adding bond with one nic
In-Reply-To: <20150529172201.GB22762@nicira.com>
References: <78218819.9173372.1432901646802.JavaMail.zimbra@redhat.com>
 <481791919.9175943.1432901948005.JavaMail.zimbra@redhat.com>
 <20150529172201.GB22762@nicira.com>
Message-ID: <2095536281.10165703.1433144408914.JavaMail.zimbra@redhat.com>

Thanks, Ben

----- Original Message -----
> From: "Ben Pfaff" <blp at nicira.com>
> To: "Petr Horacek" <phoracek at redhat.com>
> Cc: discuss at openvswitch.org
> Sent: Friday, May 29, 2015 7:22:01 PM
> Subject: Re: [ovs-discuss] Adding bond with one nic
> 
> On Fri, May 29, 2015 at 08:19:08AM -0400, Petr Horacek wrote:
> > how could I create a bond with just one nic?
> > It's not possible via `ovs-vsctl add-bond`,
> > but I guess we can do it with some database
> > commands (?).
> 
> It's not possible, because in OVS the definition of a bond is a Port
> with more than one Interface.
> 

From ovs_na at yahoo.com  Mon Jun  1 04:45:07 2015
From: ovs_na at yahoo.com (OVS)
Date: Mon, 1 Jun 2015 17:15:07 +0530
Subject: [ovs-discuss] Question on userspace ovs
In-Reply-To: <20150601053301.GB4188@nicira.com>
References: <2C4BE3F8-36F8-4E33-BABA-7141777ADAF3@yahoo.com>
 <20150601053301.GB4188@nicira.com>
Message-ID: <7A68AA4F-2824-4892-BDEC-D6C24454ECB0@yahoo.com>

Thanks Ben,

Digging further into code, i could find out that if bridge type is given as netdev, it creates br0 (say bridge name) and ovs-net (backer if) as TAP interfaces. And rest of nics (eth0 etc) will be opening PF_PACKET socket for receiving the packet.
I could see code for internal devices that you mentioned in last reply and that explains initial questions set. (Thanks for prompt reply).

I have one more query where need help, why ovs-net and br0, 2 TAP interfaces are created and where are they used for? I am looking right now for netdev type of bridge. My initial understanding was, any local PUNT of packet (e.g. L4 packet need to be sent to local applications) will go through local interface of bridge which is TAP interface. And by virtue of that, it will follow kernel stack for further processing. But i could not understand ovs-net role? Can you please brief on this?

For netdev type of bridge, i guess netlink is not used, because i donâ€™t see any kernel configuration needed for this case. Is my understanding correct?

Thanks..
Wanted to keep name as OVS user, looks like user is missing :)



> On Jun 1, 2015, at 11:03 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> Wow, what a coincidence, someone named OVS using OVS.  Who would have
> thought!!1!
> 
> On Mon, Jun 01, 2015 at 09:54:55AM +0530, OVS wrote:
>> I am new to OVS and was going through code to understand the flow.  I
>> was looking at userspace ovs handling where no kernel module specific
>> to OVS is needed.  I understand that Bridge functionality is handled
>> using TAP interface in this scenario.
> 
> TAP interfaces are used to implement "internal" devices.
> 
>> 1. First question, will other interfaces like eth0, eth1 etc will have
>> corresponding link through TAP devices?
> 
> No.
> 
>> Ideally i think it should be TAP as we want to process the packet in
>> userspace.
> 
> I don't follow.
> 
>> 2. Second question, if everything is handled in user space, what would
>> netlink used for?
> 
> It's only used internally within the OVS process.  Also a lot of Linux
> networking (not just OVS) works through Netlink in any case, so Netlink
> is used to talk to the network stack in those cases.
> 
> You might find some enlightenment in this FAQ entry, especially in the
> last few paragraphs.
> 
> ### Q: I created a tap device tap0, configured an IP address on it, and
>    added it to a bridge, like this:
> 
>        tunctl -t tap0
> 	ifconfig tap0 192.168.0.123
> 	ovs-vsctl add-br br0
> 	ovs-vsctl add-port br0 tap0
> 
>    I expected that I could then use this IP address to contact other
>    hosts on the network, but it doesn't work.  Why not?
> 
> A: The short answer is that this is a misuse of a "tap" device.  Use
>   an "internal" device implemented by Open vSwitch, which works
>   differently and is designed for this use.  To solve this problem
>   with an internal device, instead run:
> 
>       ovs-vsctl add-br br0
>       ovs-vsctl add-port br0 int0 -- set Interface int0 type=internal
>       ifconfig int0 192.168.0.123
> 
>   Even more simply, you can take advantage of the internal port that
>   every bridge has under the name of the bridge:
> 
>       ovs-vsctl add-br br0
>       ifconfig br0 192.168.0.123
> 
>   In more detail, a "tap" device is an interface between the Linux
>   (or *BSD) network stack and a user program that opens it as a
>   socket.  When the "tap" device transmits a packet, it appears in
>   the socket opened by the userspace program.  Conversely, when the
>   userspace program writes to the "tap" socket, the kernel TCP/IP
>   stack processes the packet as if it had been received by the "tap"
>   device.
> 
>   Consider the configuration above.  Given this configuration, if you
>   "ping" an IP address in the 192.168.0.x subnet, the Linux kernel
>   routing stack will transmit an ARP on the tap0 device.  Open
>   vSwitch userspace treats "tap" devices just like any other network
>   device; that is, it doesn't open them as "tap" sockets.  That means
>   that the ARP packet will simply get dropped.
> 
>   You might wonder why the Open vSwitch kernel module doesn't
>   intercept the ARP packet and bridge it.  After all, Open vSwitch
>   intercepts packets on other devices.  The answer is that Open
>   vSwitch only intercepts *received* packets, but this is a packet
>   being transmitted.  The same thing happens for all other types of
>   network devices, except for Open vSwitch "internal" ports.  If you,
>   for example, add a physical Ethernet port to an OVS bridge,
>   configure an IP address on a physical Ethernet port, and then issue
>   a "ping" to an address in that subnet, the same thing happens: an
>   ARP gets transmitted on the physical Ethernet port and Open vSwitch
>   never sees it.  (You should not do that, as documented at the
>   beginning of this section.)
> 
>   It can make sense to add a "tap" device to an Open vSwitch bridge,
>   if some userspace program (other than Open vSwitch) has opened the
>   tap socket.  This is the case, for example, if the "tap" device was
>   created by KVM (or QEMU) to simulate a virtual NIC.  In such a
>   case, when OVS bridges a packet to the "tap" device, the kernel
>   forwards that packet to KVM in userspace, which passes it along to
>   the VM, and in the other direction, when the VM sends a packet, KVM
>   writes it to the "tap" socket, which causes OVS to receive it and
>   bridge it to the other OVS ports.  Please note that in such a case
>   no IP address is configured on the "tap" device (there is normally
>   an IP address configured in the virtual NIC inside the VM, but this
>   is not visible to the host Linux kernel or to Open vSwitch).
> 
>   There is one special case in which Open vSwitch does directly read
>   and write "tap" sockets.  This is an implementation detail of the
>   Open vSwitch userspace switch, which implements its "internal"
>   ports as Linux (or *BSD) "tap" sockets.  In such a userspace
>   switch, OVS receives packets sent on the "tap" device used to
>   implement an "internal" port by reading the associated "tap"
>   socket, and bridges them to the rest of the switch.  In the other
>   direction, OVS transmits packets bridged to the "internal" port by
>   writing them to the "tap" socket, causing them to be processed by
>   the kernel TCP/IP stack as if they had been received on the "tap"
>   device.  Users should not need to be concerned with this
>   implementation detail.
> 
>   Open vSwitch has a network device type called "tap".  This is
>   intended only for implementing "internal" ports in the OVS
>   userspace switch and should not be used otherwise.  In particular,
>   users should not configure KVM "tap" devices as type "tap" (use
>   type "system", the default, instead).


From blp at nicira.com  Mon Jun  1 08:35:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 1 Jun 2015 08:35:08 -0700
Subject: [ovs-discuss] kernel BUG at
 /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode) (#81)
Message-ID: <20150601153508.GC4188@nicira.com>

This was reported on github.  I'm forwarding it here to make sure it
gets noticed.

There is some additional information in a followup on github.

----- Forwarded message from George Shuklin <notifications at github.com> -----

Date: Mon, 01 Jun 2015 00:12:51 -0700
From: George Shuklin <notifications at github.com>
To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
Subject: [ovs-issues] kernel BUG at
	/build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode)
	(#81)

One of our nodes starts to trace aperiodically. We're gathing logs via remote syslog, here trace (it is a bit unordered because of UDP in syslog).

Configuration:
openvswitch-switch                  2.3.1
Linux: 3.13.0-52-generic

We using: neutron with vlans, sFlow (inside OVS) on 'external' bridge.

Trace:

[12803.874856] ------------[ cut here ]------------
[12803.876861]  [<ffffffffa0158c98>] ? key_extract+0x6f8/0xa20 [openvswitch]
[12803.877797]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
[12803.877589]  [<ffffffffa02dedb1>] vhost_worker+0x101/0x1f0 [vhost]
[12803.875980]  ffff8800720fa100 ffff881fff403ac0 ffff8800720fa100 ffff881fb6e58200
[12803.877383]  [<ffffffff816263b8>] netif_rx_ni+0x28/0x30
[12803.877504]  [<ffffffffa02ecd99>] handle_tx+0x1b9/0x4d0 [vhost_net]
[12803.875673] RBP: ffff881fff403ac8 R08: 00000000e0400000 R09: ffff881fff403bd0
[12803.874889] invalid opcode: 0000 [#1] SMP
[12803.876661]  [<ffffffffa015d01a>] ? flow_lookup.isra.4+0x4a/0xc0 [openvswitch]
[12803.876973]  [<ffffffffa015e4da>] ovs_vport_receive+0x2a/0x30 [openvswitch]
[12803.874870] kernel BUG at /build/buildd/linux-3.13.0/net/core/skbuff.c:1043!
[12803.874916] Modules linked in: ip6table_nat nf_conntrack_ipv6 nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_raw iptable_raw 8021q garp mrp vhost_net vhost macvtap macvlan dm_multipath scsi_dh nbd kvm_intel ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT xt_CHECKSUM iptable_mangle xt_tcpudp bridge stp llc xfs ip6table_filter ip6_tables iptable_filter ip_tables x_tables openvswitch(OX) gre vxlan ip_tunnel libcrc32c ipmi_devintf gpio_ich dcdbas x86_pkg_temp_thermal intel_powerclamp coretemp kvm crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd lpc_ich ipmi_si mei_me mei wmi shpchp acpi_power_meter mac_hid squashfs aufs igb i2c_algo_bit ixgbe e1000e tg3 dca ptp ahci pps_core libahci megaraid_sas mdio [last unloaded: kvm_intel]
[12803.877546]  [<ffffffffa02ed0e5>] handle_tx_kick+0x15/0x20 [vhost_net]
[12803.876251]  <IRQ>
[12803.877676]  [<ffffffff8108b6b2>] kthread+0xd2/0xf0
[12803.877714]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
[12803.877226]  [<ffffffff8106cc6c>] __do_softirq+0xec/0x2c0
[12803.875907] CR2: 00007eff8c072400 CR3: 0000001f86331000 CR4: 00000000001427f0
[12803.876727]  [<ffffffffa0155077>] ovs_execute_actions+0x67/0x100 [openvswitch]
[12803.876551]  [<ffffffffa015fe0b>] ? netdev_send+0x4b/0xc0 [openvswitch]
[12803.877314]  [<ffffffff8106cee5>] do_softirq+0x55/0x60
[12803.877268]  [<ffffffff8173531c>] do_softirq_own_stack+0x1c/0x30
[12803.875548] RSP: 0018:ffff881fff403a90  EFLAGS: 00010202
[12803.877017]  [<ffffffffa01600e1>] netdev_frame_hook+0xc1/0x120 [openvswitch]
[12803.878203] RIP  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
[12803.876219] Call Trace:
[12803.875802] FS:  0000000000000000(0000) GS:ffff881fff400000(0000) knlGS:0000000000000000
[12803.876060]  00000000000005b4 ffff881f5c0e6cfc 00000000ffffffff ffff881fff403b10
[12803.877061]  [<ffffffff81626892>] __netif_receive_skb_core+0x262/0x840
[12803.875715] R10: 0000000000000010 R11: ffff881f31d29d40 R12: 0000000000000000
[12803.875868] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[12803.877632]  [<ffffffffa02decb0>] ? vhost_dev_reset_owner+0x30/0x30 [vhost]
[12803.876904]  [<ffffffffa015812b>] ovs_dp_process_received_packet+0x4b/0x80 [openvswitch]
[12803.877307]  <EOI>
[12803.876594]  [<ffffffffa01547cc>] do_execute_actions+0x3ac/0xbf0 [openvswitch]
[12803.876331]  [<ffffffff816252d3>] skb_checksum_help+0x123/0x190
[12803.875451] Hardware name: Dell Inc. PowerEdge R530/03XKDV, BIOS 1.1.10 03/10/2015
[12803.875587] RAX: 0000000000000002 RBX: ffff8800720fa100 RCX: 0000000000000020
[12803.877185]  [<ffffffff81627272>] net_rx_action+0x152/0x250
[12803.877757]  [<ffffffff81733868>] ret_from_fork+0x58/0x90
[12803.876374]  [<ffffffffa0156a2e>] queue_userspace_packet+0x3ae/0x400 [openvswitch]
[12803.875950] Stack:
[12803.876793]  [<ffffffffa015806f>] ovs_dp_process_packet_with_key+0x7f/0xf0 [openvswitch]
[12803.877145]  [<ffffffff81627a1e>] process_backlog+0xae/0x1a0
[12803.877838] Code: ff ff ff 48 89 d7 48 89 55 c8 e8 ae 4f b4 ff 84 c0 48 8b 55 c8 75 a1 eb 9b 0f 1f 40 00 0f 0b 41 81 cf 00 20 00 00 e9 43 fe ff ff <0f> 0b 44 89 fe 4c 89 ef e8 e5 f4 ff ff 85 c0 74 12 48 89 df e8
[12803.875430] CPU: 0 PID: 17654 Comm: vhost-17644 Tainted: G           OX 3.13.0-53-generic #89-Ubuntu
[12803.875495] RIP: 0010:[<ffffffff8161853e>]  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
[12803.875630] RDX: 00000000000006aa RSI: 0000000000000000 RDI: ffff8800720fa100
[12803.876441]  [<ffffffffa0157fe5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
[12803.877464]  [<ffffffff8152825a>] tun_sendmsg+0x5a/0x80
[12803.878247]  RSP <ffff881fff403a90>
[12803.877103]  [<ffffffff81626e88>] __netif_receive_skb+0x18/0x60
[12803.877425]  [<ffffffff81527dc3>] tun_get_user+0x403/0x840
[12803.876258]  [<ffffffff81618ef0>] __pskb_pull_tail+0x50/0x360
[12803.876484]  [<ffffffffa0154796>] do_execute_actions+0x376/0xbf0 [openvswitch]
[12803.878792] ---[ end trace 4e8d5a14aaae59db ]---
[12803.875758] R13: ffff8800720fa100 R14: ffff881f5c0e6cfc R15: 00000000ffffffff
[12803.875473] task: ffff88301f389800 ti: ffff88300fcce000 task.ti: ffff88300fcce000
[12803.876140]  ffffffff81618ef0 ffffffffa01a41c0 000005b4cd428000 ffff8800720fa100

---
Reply to this email directly or view it on GitHub:
https://github.com/openvswitch/ovs-issues/issues/81

----- End forwarded message -----

From george.shuklin at gmail.com  Mon Jun  1 09:04:31 2015
From: george.shuklin at gmail.com (George Shuklin)
Date: Mon, 01 Jun 2015 19:04:31 +0300
Subject: [ovs-discuss] kernel BUG at
 /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode) (#81)
In-Reply-To: <20150601153508.GC4188@nicira.com>
References: <20150601153508.GC4188@nicira.com>
Message-ID: <556C828F.7060000@gmail.com>


Oh, that was my bug. I thought github is a proper place for reports.

I've done enclosing problem:

It happens when we adding sflow entry on Bridge br-int in openstack 
installation (on VLANs). We have two patch ports outside (to br-ex1 and 
br-ex2), and bunch of tap interfaces plugged to br-int with tags (by 
neutron-plugin-openvswitch-agent). Bug happens every time within 1-2 
minutes after configuration.

On 06/01/2015 06:35 PM, Ben Pfaff wrote:
> This was reported on github.  I'm forwarding it here to make sure it
> gets noticed.
>
> There is some additional information in a followup on github.
>
> ----- Forwarded message from George Shuklin <notifications at github.com> -----
>
> Date: Mon, 01 Jun 2015 00:12:51 -0700
> From: George Shuklin <notifications at github.com>
> To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
> Subject: [ovs-issues] kernel BUG at
> 	/build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode)
> 	(#81)
>
> One of our nodes starts to trace aperiodically. We're gathing logs via remote syslog, here trace (it is a bit unordered because of UDP in syslog).
>
> Configuration:
> openvswitch-switch                  2.3.1
> Linux: 3.13.0-52-generic
>
> We using: neutron with vlans, sFlow (inside OVS) on 'external' bridge.
>
> Trace:
>
> [12803.874856] ------------[ cut here ]------------
> [12803.876861]  [<ffffffffa0158c98>] ? key_extract+0x6f8/0xa20 [openvswitch]
> [12803.877797]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
> [12803.877589]  [<ffffffffa02dedb1>] vhost_worker+0x101/0x1f0 [vhost]
> [12803.875980]  ffff8800720fa100 ffff881fff403ac0 ffff8800720fa100 ffff881fb6e58200
> [12803.877383]  [<ffffffff816263b8>] netif_rx_ni+0x28/0x30
> [12803.877504]  [<ffffffffa02ecd99>] handle_tx+0x1b9/0x4d0 [vhost_net]
> [12803.875673] RBP: ffff881fff403ac8 R08: 00000000e0400000 R09: ffff881fff403bd0
> [12803.874889] invalid opcode: 0000 [#1] SMP
> [12803.876661]  [<ffffffffa015d01a>] ? flow_lookup.isra.4+0x4a/0xc0 [openvswitch]
> [12803.876973]  [<ffffffffa015e4da>] ovs_vport_receive+0x2a/0x30 [openvswitch]
> [12803.874870] kernel BUG at /build/buildd/linux-3.13.0/net/core/skbuff.c:1043!
> [12803.874916] Modules linked in: ip6table_nat nf_conntrack_ipv6 nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_raw iptable_raw 8021q garp mrp vhost_net vhost macvtap macvlan dm_multipath scsi_dh nbd kvm_intel ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT xt_CHECKSUM iptable_mangle xt_tcpudp bridge stp llc xfs ip6table_filter ip6_tables iptable_filter ip_tables x_tables openvswitch(OX) gre vxlan ip_tunnel libcrc32c ipmi_devintf gpio_ich dcdbas x86_pkg_temp_thermal intel_powerclamp coretemp kvm crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd lpc_ich ipmi_si mei_me mei wmi shpchp acpi_power_meter mac_hid squashfs aufs igb i2c_algo_bit ixgbe e1000e tg3 dca ptp ahci pps_core libahci megaraid_sas mdio [last unloaded: kvm_intel]
> [12803.877546]  [<ffffffffa02ed0e5>] handle_tx_kick+0x15/0x20 [vhost_net]
> [12803.876251]  <IRQ>
> [12803.877676]  [<ffffffff8108b6b2>] kthread+0xd2/0xf0
> [12803.877714]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
> [12803.877226]  [<ffffffff8106cc6c>] __do_softirq+0xec/0x2c0
> [12803.875907] CR2: 00007eff8c072400 CR3: 0000001f86331000 CR4: 00000000001427f0
> [12803.876727]  [<ffffffffa0155077>] ovs_execute_actions+0x67/0x100 [openvswitch]
> [12803.876551]  [<ffffffffa015fe0b>] ? netdev_send+0x4b/0xc0 [openvswitch]
> [12803.877314]  [<ffffffff8106cee5>] do_softirq+0x55/0x60
> [12803.877268]  [<ffffffff8173531c>] do_softirq_own_stack+0x1c/0x30
> [12803.875548] RSP: 0018:ffff881fff403a90  EFLAGS: 00010202
> [12803.877017]  [<ffffffffa01600e1>] netdev_frame_hook+0xc1/0x120 [openvswitch]
> [12803.878203] RIP  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
> [12803.876219] Call Trace:
> [12803.875802] FS:  0000000000000000(0000) GS:ffff881fff400000(0000) knlGS:0000000000000000
> [12803.876060]  00000000000005b4 ffff881f5c0e6cfc 00000000ffffffff ffff881fff403b10
> [12803.877061]  [<ffffffff81626892>] __netif_receive_skb_core+0x262/0x840
> [12803.875715] R10: 0000000000000010 R11: ffff881f31d29d40 R12: 0000000000000000
> [12803.875868] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [12803.877632]  [<ffffffffa02decb0>] ? vhost_dev_reset_owner+0x30/0x30 [vhost]
> [12803.876904]  [<ffffffffa015812b>] ovs_dp_process_received_packet+0x4b/0x80 [openvswitch]
> [12803.877307]  <EOI>
> [12803.876594]  [<ffffffffa01547cc>] do_execute_actions+0x3ac/0xbf0 [openvswitch]
> [12803.876331]  [<ffffffff816252d3>] skb_checksum_help+0x123/0x190
> [12803.875451] Hardware name: Dell Inc. PowerEdge R530/03XKDV, BIOS 1.1.10 03/10/2015
> [12803.875587] RAX: 0000000000000002 RBX: ffff8800720fa100 RCX: 0000000000000020
> [12803.877185]  [<ffffffff81627272>] net_rx_action+0x152/0x250
> [12803.877757]  [<ffffffff81733868>] ret_from_fork+0x58/0x90
> [12803.876374]  [<ffffffffa0156a2e>] queue_userspace_packet+0x3ae/0x400 [openvswitch]
> [12803.875950] Stack:
> [12803.876793]  [<ffffffffa015806f>] ovs_dp_process_packet_with_key+0x7f/0xf0 [openvswitch]
> [12803.877145]  [<ffffffff81627a1e>] process_backlog+0xae/0x1a0
> [12803.877838] Code: ff ff ff 48 89 d7 48 89 55 c8 e8 ae 4f b4 ff 84 c0 48 8b 55 c8 75 a1 eb 9b 0f 1f 40 00 0f 0b 41 81 cf 00 20 00 00 e9 43 fe ff ff <0f> 0b 44 89 fe 4c 89 ef e8 e5 f4 ff ff 85 c0 74 12 48 89 df e8
> [12803.875430] CPU: 0 PID: 17654 Comm: vhost-17644 Tainted: G           OX 3.13.0-53-generic #89-Ubuntu
> [12803.875495] RIP: 0010:[<ffffffff8161853e>]  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
> [12803.875630] RDX: 00000000000006aa RSI: 0000000000000000 RDI: ffff8800720fa100
> [12803.876441]  [<ffffffffa0157fe5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
> [12803.877464]  [<ffffffff8152825a>] tun_sendmsg+0x5a/0x80
> [12803.878247]  RSP <ffff881fff403a90>
> [12803.877103]  [<ffffffff81626e88>] __netif_receive_skb+0x18/0x60
> [12803.877425]  [<ffffffff81527dc3>] tun_get_user+0x403/0x840
> [12803.876258]  [<ffffffff81618ef0>] __pskb_pull_tail+0x50/0x360
> [12803.876484]  [<ffffffffa0154796>] do_execute_actions+0x376/0xbf0 [openvswitch]
> [12803.878792] ---[ end trace 4e8d5a14aaae59db ]---
> [12803.875758] R13: ffff8800720fa100 R14: ffff881f5c0e6cfc R15: 00000000ffffffff
> [12803.875473] task: ffff88301f389800 ti: ffff88300fcce000 task.ti: ffff88300fcce000
> [12803.876140]  ffffffff81618ef0 ffffffffa01a41c0 000005b4cd428000 ffff8800720fa100
>
> ---
> Reply to this email directly or view it on GitHub:
> https://github.com/openvswitch/ovs-issues/issues/81
>
> ----- End forwarded message -----
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Mon Jun  1 09:16:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 1 Jun 2015 09:16:43 -0700
Subject: [ovs-discuss] kernel BUG at
 /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode) (#81)
In-Reply-To: <556C828F.7060000@gmail.com>
References: <20150601153508.GC4188@nicira.com>
 <556C828F.7060000@gmail.com>
Message-ID: <20150601161643.GA4822@nicira.com>

github is an OK place to report issues, but I don't think any of the OVS
kernel developers follow the issues there, so I forwarded it to the
mailing list to make sure that they see it.

On Mon, Jun 01, 2015 at 07:04:31PM +0300, George Shuklin wrote:
> Oh, that was my bug. I thought github is a proper place for reports.
> 
> I've done enclosing problem:
> 
> It happens when we adding sflow entry on Bridge br-int in openstack
> installation (on VLANs). We have two patch ports outside (to br-ex1 and
> br-ex2), and bunch of tap interfaces plugged to br-int with tags (by
> neutron-plugin-openvswitch-agent). Bug happens every time within 1-2 minutes
> after configuration.
> 
> On 06/01/2015 06:35 PM, Ben Pfaff wrote:
> >This was reported on github.  I'm forwarding it here to make sure it
> >gets noticed.
> >
> >There is some additional information in a followup on github.
> >
> >----- Forwarded message from George Shuklin <notifications at github.com> -----
> >
> >Date: Mon, 01 Jun 2015 00:12:51 -0700
> >From: George Shuklin <notifications at github.com>
> >To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
> >Subject: [ovs-issues] kernel BUG at
> >	/build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode)
> >	(#81)
> >
> >One of our nodes starts to trace aperiodically. We're gathing logs via remote syslog, here trace (it is a bit unordered because of UDP in syslog).
> >
> >Configuration:
> >openvswitch-switch                  2.3.1
> >Linux: 3.13.0-52-generic
> >
> >We using: neutron with vlans, sFlow (inside OVS) on 'external' bridge.
> >
> >Trace:
> >
> >[12803.874856] ------------[ cut here ]------------
> >[12803.876861]  [<ffffffffa0158c98>] ? key_extract+0x6f8/0xa20 [openvswitch]
> >[12803.877797]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
> >[12803.877589]  [<ffffffffa02dedb1>] vhost_worker+0x101/0x1f0 [vhost]
> >[12803.875980]  ffff8800720fa100 ffff881fff403ac0 ffff8800720fa100 ffff881fb6e58200
> >[12803.877383]  [<ffffffff816263b8>] netif_rx_ni+0x28/0x30
> >[12803.877504]  [<ffffffffa02ecd99>] handle_tx+0x1b9/0x4d0 [vhost_net]
> >[12803.875673] RBP: ffff881fff403ac8 R08: 00000000e0400000 R09: ffff881fff403bd0
> >[12803.874889] invalid opcode: 0000 [#1] SMP
> >[12803.876661]  [<ffffffffa015d01a>] ? flow_lookup.isra.4+0x4a/0xc0 [openvswitch]
> >[12803.876973]  [<ffffffffa015e4da>] ovs_vport_receive+0x2a/0x30 [openvswitch]
> >[12803.874870] kernel BUG at /build/buildd/linux-3.13.0/net/core/skbuff.c:1043!
> >[12803.874916] Modules linked in: ip6table_nat nf_conntrack_ipv6 nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_raw iptable_raw 8021q garp mrp vhost_net vhost macvtap macvlan dm_multipath scsi_dh nbd kvm_intel ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT xt_CHECKSUM iptable_mangle xt_tcpudp bridge stp llc xfs ip6table_filter ip6_tables iptable_filter ip_tables x_tables openvswitch(OX) gre vxlan ip_tunnel libcrc32c ipmi_devintf gpio_ich dcdbas x86_pkg_temp_thermal intel_powerclamp coretemp kvm crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd lpc_ich ipmi_si mei_me mei wmi shpchp acpi_power_meter mac_hid squashfs aufs igb i2c_algo_bit ixgbe e1000e tg3 dca ptp ahci pps_core libahci megaraid_sas mdio [last unloaded: kvm_intel]
> >[12803.877546]  [<ffffffffa02ed0e5>] handle_tx_kick+0x15/0x20 [vhost_net]
> >[12803.876251]  <IRQ>
> >[12803.877676]  [<ffffffff8108b6b2>] kthread+0xd2/0xf0
> >[12803.877714]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
> >[12803.877226]  [<ffffffff8106cc6c>] __do_softirq+0xec/0x2c0
> >[12803.875907] CR2: 00007eff8c072400 CR3: 0000001f86331000 CR4: 00000000001427f0
> >[12803.876727]  [<ffffffffa0155077>] ovs_execute_actions+0x67/0x100 [openvswitch]
> >[12803.876551]  [<ffffffffa015fe0b>] ? netdev_send+0x4b/0xc0 [openvswitch]
> >[12803.877314]  [<ffffffff8106cee5>] do_softirq+0x55/0x60
> >[12803.877268]  [<ffffffff8173531c>] do_softirq_own_stack+0x1c/0x30
> >[12803.875548] RSP: 0018:ffff881fff403a90  EFLAGS: 00010202
> >[12803.877017]  [<ffffffffa01600e1>] netdev_frame_hook+0xc1/0x120 [openvswitch]
> >[12803.878203] RIP  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
> >[12803.876219] Call Trace:
> >[12803.875802] FS:  0000000000000000(0000) GS:ffff881fff400000(0000) knlGS:0000000000000000
> >[12803.876060]  00000000000005b4 ffff881f5c0e6cfc 00000000ffffffff ffff881fff403b10
> >[12803.877061]  [<ffffffff81626892>] __netif_receive_skb_core+0x262/0x840
> >[12803.875715] R10: 0000000000000010 R11: ffff881f31d29d40 R12: 0000000000000000
> >[12803.875868] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> >[12803.877632]  [<ffffffffa02decb0>] ? vhost_dev_reset_owner+0x30/0x30 [vhost]
> >[12803.876904]  [<ffffffffa015812b>] ovs_dp_process_received_packet+0x4b/0x80 [openvswitch]
> >[12803.877307]  <EOI>
> >[12803.876594]  [<ffffffffa01547cc>] do_execute_actions+0x3ac/0xbf0 [openvswitch]
> >[12803.876331]  [<ffffffff816252d3>] skb_checksum_help+0x123/0x190
> >[12803.875451] Hardware name: Dell Inc. PowerEdge R530/03XKDV, BIOS 1.1.10 03/10/2015
> >[12803.875587] RAX: 0000000000000002 RBX: ffff8800720fa100 RCX: 0000000000000020
> >[12803.877185]  [<ffffffff81627272>] net_rx_action+0x152/0x250
> >[12803.877757]  [<ffffffff81733868>] ret_from_fork+0x58/0x90
> >[12803.876374]  [<ffffffffa0156a2e>] queue_userspace_packet+0x3ae/0x400 [openvswitch]
> >[12803.875950] Stack:
> >[12803.876793]  [<ffffffffa015806f>] ovs_dp_process_packet_with_key+0x7f/0xf0 [openvswitch]
> >[12803.877145]  [<ffffffff81627a1e>] process_backlog+0xae/0x1a0
> >[12803.877838] Code: ff ff ff 48 89 d7 48 89 55 c8 e8 ae 4f b4 ff 84 c0 48 8b 55 c8 75 a1 eb 9b 0f 1f 40 00 0f 0b 41 81 cf 00 20 00 00 e9 43 fe ff ff <0f> 0b 44 89 fe 4c 89 ef e8 e5 f4 ff ff 85 c0 74 12 48 89 df e8
> >[12803.875430] CPU: 0 PID: 17654 Comm: vhost-17644 Tainted: G           OX 3.13.0-53-generic #89-Ubuntu
> >[12803.875495] RIP: 0010:[<ffffffff8161853e>]  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
> >[12803.875630] RDX: 00000000000006aa RSI: 0000000000000000 RDI: ffff8800720fa100
> >[12803.876441]  [<ffffffffa0157fe5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
> >[12803.877464]  [<ffffffff8152825a>] tun_sendmsg+0x5a/0x80
> >[12803.878247]  RSP <ffff881fff403a90>
> >[12803.877103]  [<ffffffff81626e88>] __netif_receive_skb+0x18/0x60
> >[12803.877425]  [<ffffffff81527dc3>] tun_get_user+0x403/0x840
> >[12803.876258]  [<ffffffff81618ef0>] __pskb_pull_tail+0x50/0x360
> >[12803.876484]  [<ffffffffa0154796>] do_execute_actions+0x376/0xbf0 [openvswitch]
> >[12803.878792] ---[ end trace 4e8d5a14aaae59db ]---
> >[12803.875758] R13: ffff8800720fa100 R14: ffff881f5c0e6cfc R15: 00000000ffffffff
> >[12803.875473] task: ffff88301f389800 ti: ffff88300fcce000 task.ti: ffff88300fcce000
> >[12803.876140]  ffffffff81618ef0 ffffffffa01a41c0 000005b4cd428000 ffff8800720fa100
> >
> >---
> >Reply to this email directly or view it on GitHub:
> >https://github.com/openvswitch/ovs-issues/issues/81
> >
> >----- End forwarded message -----
> >_______________________________________________
> >discuss mailing list
> >discuss at openvswitch.org
> >http://openvswitch.org/mailman/listinfo/discuss
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From jesse at nicira.com  Mon Jun  1 17:41:58 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 1 Jun 2015 17:41:58 -0700
Subject: [ovs-discuss] kernel BUG at
 /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode) (#81)
In-Reply-To: <20150601153508.GC4188@nicira.com>
References: <20150601153508.GC4188@nicira.com>
Message-ID: <CAEP_g=8rjRZpE=xKZeORCAQ+eSnDLAJoF+5L-4qjLhQsBqexmg@mail.gmail.com>

On Mon, Jun 1, 2015 at 8:35 AM, Ben Pfaff <blp at nicira.com> wrote:
> This was reported on github.  I'm forwarding it here to make sure it
> gets noticed.
>
> There is some additional information in a followup on github.
>
> ----- Forwarded message from George Shuklin <notifications at github.com> -----
>
> Date: Mon, 01 Jun 2015 00:12:51 -0700
> From: George Shuklin <notifications at github.com>
> To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
> Subject: [ovs-issues] kernel BUG at
>         /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode)
>         (#81)
>
> One of our nodes starts to trace aperiodically. We're gathing logs via remote syslog, here trace (it is a bit unordered because of UDP in syslog).
>
> Configuration:
> openvswitch-switch                  2.3.1
> Linux: 3.13.0-52-generic
>
> We using: neutron with vlans, sFlow (inside OVS) on 'external' bridge.

Here is the trace reordered by timestamp (I haven't done any further
analysis on it):

[12803.874856] ------------[ cut here ]------------
[12803.874870] kernel BUG at /build/buildd/linux-3.13.0/net/core/skbuff.c:1043!
[12803.874889] invalid opcode: 0000 [#1] SMP
[12803.874916] Modules linked in: ip6table_nat nf_conntrack_ipv6
nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_raw iptable_raw
8021q garp mrp vhost_net vhost macvtap macvlan dm_multipath scsi_dh
nbd kvm_intel ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat
nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT
xt_CHECKSUM iptable_mangle xt_tcpudp bridge stp llc xfs
ip6table_filter ip6_tables iptable_filter ip_tables x_tables
openvswitch(OX) gre vxlan ip_tunnel libcrc32c ipmi_devintf gpio_ich
dcdbas x86_pkg_temp_thermal intel_powerclamp coretemp kvm
crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel
aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd lpc_ich ipmi_si
mei_me mei wmi shpchp acpi_power_meter mac_hid squashfs aufs igb
i2c_algo_bit ixgbe e1000e tg3 dca ptp ahci pps_core libahci
megaraid_sas mdio [last unloaded: kvm_intel]
[12803.875430] CPU: 0 PID: 17654 Comm: vhost-17644 Tainted: G
 OX 3.13.0-53-generic #89-Ubuntu
[12803.875451] Hardware name: Dell Inc. PowerEdge R530/03XKDV, BIOS
1.1.10 03/10/2015
[12803.875473] task: ffff88301f389800 ti: ffff88300fcce000 task.ti:
ffff88300fcce000
[12803.875495] RIP: 0010:[<ffffffff8161853e>]  [<ffffffff8161853e>]
pskb_expand_head+0x20e/0x250
[12803.875548] RSP: 0018:ffff881fff403a90  EFLAGS: 00010202
[12803.875587] RAX: 0000000000000002 RBX: ffff8800720fa100 RCX: 0000000000000020
[12803.875630] RDX: 00000000000006aa RSI: 0000000000000000 RDI: ffff8800720fa100
[12803.875673] RBP: ffff881fff403ac8 R08: 00000000e0400000 R09: ffff881fff403bd0
[12803.875715] R10: 0000000000000010 R11: ffff881f31d29d40 R12: 0000000000000000
[12803.875758] R13: ffff8800720fa100 R14: ffff881f5c0e6cfc R15: 00000000ffffffff
[12803.875802] FS:  0000000000000000(0000) GS:ffff881fff400000(0000)
knlGS:0000000000000000
[12803.875868] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[12803.875907] CR2: 00007eff8c072400 CR3: 0000001f86331000 CR4: 00000000001427f0
[12803.875950] Stack:
[12803.875980]  ffff8800720fa100 ffff881fff403ac0 ffff8800720fa100
ffff881fb6e58200
[12803.876060]  00000000000005b4 ffff881f5c0e6cfc 00000000ffffffff
ffff881fff403b10
[12803.876140]  ffffffff81618ef0 ffffffffa01a41c0 000005b4cd428000
ffff8800720fa100
[12803.876219] Call Trace:
[12803.876251]  <IRQ>
[12803.876258]  [<ffffffff81618ef0>] __pskb_pull_tail+0x50/0x360
[12803.876331]  [<ffffffff816252d3>] skb_checksum_help+0x123/0x190
[12803.876374]  [<ffffffffa0156a2e>]
queue_userspace_packet+0x3ae/0x400 [openvswitch]
[12803.876441]  [<ffffffffa0157fe5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
[12803.876484]  [<ffffffffa0154796>] do_execute_actions+0x376/0xbf0
[openvswitch]
[12803.876551]  [<ffffffffa015fe0b>] ? netdev_send+0x4b/0xc0 [openvswitch]
[12803.876594]  [<ffffffffa01547cc>] do_execute_actions+0x3ac/0xbf0
[openvswitch]
[12803.876661]  [<ffffffffa015d01a>] ? flow_lookup.isra.4+0x4a/0xc0
[openvswitch]
[12803.876727]  [<ffffffffa0155077>] ovs_execute_actions+0x67/0x100
[openvswitch]
[12803.876793]  [<ffffffffa015806f>]
ovs_dp_process_packet_with_key+0x7f/0xf0 [openvswitch]
[12803.876861]  [<ffffffffa0158c98>] ? key_extract+0x6f8/0xa20 [openvswitch]
[12803.876904]  [<ffffffffa015812b>]
ovs_dp_process_received_packet+0x4b/0x80 [openvswitch]
[12803.876973]  [<ffffffffa015e4da>] ovs_vport_receive+0x2a/0x30 [openvswitch]
[12803.877017]  [<ffffffffa01600e1>] netdev_frame_hook+0xc1/0x120 [openvswitch]
[12803.877061]  [<ffffffff81626892>] __netif_receive_skb_core+0x262/0x840
[12803.877103]  [<ffffffff81626e88>] __netif_receive_skb+0x18/0x60
[12803.877145]  [<ffffffff81627a1e>] process_backlog+0xae/0x1a0
[12803.877185]  [<ffffffff81627272>] net_rx_action+0x152/0x250
[12803.877226]  [<ffffffff8106cc6c>] __do_softirq+0xec/0x2c0
[12803.877268]  [<ffffffff8173531c>] do_softirq_own_stack+0x1c/0x30
[12803.877307]  <EOI>
[12803.877314]  [<ffffffff8106cee5>] do_softirq+0x55/0x60
[12803.877383]  [<ffffffff816263b8>] netif_rx_ni+0x28/0x30
[12803.877425]  [<ffffffff81527dc3>] tun_get_user+0x403/0x840
[12803.877464]  [<ffffffff8152825a>] tun_sendmsg+0x5a/0x80
[12803.877504]  [<ffffffffa02ecd99>] handle_tx+0x1b9/0x4d0 [vhost_net]
[12803.877546]  [<ffffffffa02ed0e5>] handle_tx_kick+0x15/0x20 [vhost_net]
[12803.877589]  [<ffffffffa02dedb1>] vhost_worker+0x101/0x1f0 [vhost]
[12803.877632]  [<ffffffffa02decb0>] ? vhost_dev_reset_owner+0x30/0x30 [vhost]
[12803.877676]  [<ffffffff8108b6b2>] kthread+0xd2/0xf0
[12803.877714]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
[12803.877757]  [<ffffffff81733868>] ret_from_fork+0x58/0x90
[12803.877797]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
[12803.877838] Code: ff ff ff 48 89 d7 48 89 55 c8 e8 ae 4f b4 ff 84
c0 48 8b 55 c8 75 a1 eb 9b 0f 1f 40 00 0f 0b 41 81 cf 00 20 00 00 e9
43 fe ff ff <0f> 0b 44 89 fe 4c 89 ef e8 e5 f4 ff ff 85 c0 74 12 48 89
df e8
[12803.878203] RIP  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
[12803.878247]  RSP <ffff881fff403a90>
[12803.878792] ---[ end trace 4e8d5a14aaae59db ]---

From gowrishankar.m at linux.vnet.ibm.com  Tue Jun  2 08:53:08 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Tue, 02 Jun 2015 21:23:08 +0530
Subject: [ovs-discuss] [dpdk-ovs] dpdkvhost port not handling arp response
	from kvm guest
Message-ID: <556DD164.1020609@linux.vnet.ibm.com>

Hi,

I would like to bring up my kvm guest with dpdk vhost interface. Before 
I run qemu, I have added
dpdkvhost interface in ovs bridge, so as to attach with qemu later (wrt 
INSTALL.DPDK.md).

Once I created dpdkvhost interface, I noticed that dpdkvhost0 was in 
LINK_DOWN (I think it is
expected as the device does not exist yet).

ovs-master# ovs-vsctl add-port br0 dpdkvhost0 -- set Interface 
dpdkvhost0 type=dpdkvhost

ovs-master# ovs-ofctl show br0

OFPT_FEATURES_REPLY (xid=0x2): dpid:000090e2ba1524ac
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src 
mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
  1(dpdk0): addr:90:e2:ba:15:24:ac
      config:     0
      state:      0
      current:    10GB-FD
      supported:  10MB-HD 100MB-HD 1GB-HD COPPER AUTO_NEG AUTO_PAUSE
      speed: 10000 Mbps now, 1000 Mbps max
  2(dpdkvhost0): addr:00:00:00:00:00:00
      config:     PORT_DOWN
      state:      LINK_DOWN                 <<<<<<
      speed: 0 Mbps now, 0 Mbps max
  LOCAL(br0): addr:90:e2:ba:15:24:ac
      config:     0
      state:      0
      current:    10MB-FD COPPER
      speed: 10 Mbps now, 0 Mbps max

 From ovs-vswitchd.log (with debug info):

2015-06-02T14:49:38.149Z|00464|bridge|INFO|bridge br0: added interface 
dpdkvhost0 on port 2
2015-06-02T14:49:38.149Z|00465|netlink_socket|DBG|nl_sock_transact_multiple__ 
(Success): nl(len:52, type=37(family-defined), flags=1[REQUEST], seq=1a, 
pid=4294962434
2015-06-02T14:49:38.149Z|00466|netlink_socket|DBG|nl_sock_recv__ 
(Success): nl(len:72, type=2(error), flags=0, seq=1a, pid=4294962434 
error(-2(No such file or directory), in-reply-to(nl(len:52, 
type=37(family-defined), flags=1[REQUEST], seq=1a, pid=4294962434))
2015-06-02T14:49:38.149Z|00467|netlink_socket|DBG|received NAK error=0 
(No such file or directory)

Then I brought up qemu kvm, but still the state of dpdkvhost0 remains 
same. Networking params I used in qemu are:

      -netdev 
tap,id=hostnet2,script=no,downscript=no,ifname=dpdkvhost0,vhost=on
      -device 
virtio-net-pci,netdev=hostnet2,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off,id=net2,mac=52:54:00:a3:a3:5d,ioeventfd=on 

      -object 
memory-backend-file,id=mem,size=4096M,mem-path=/dev/hugepages,share=on 
-numa node,memdev=mem -mem-prealloc

Am I missing something here ?

dpdk0 port is Intel 82599 10Gbps NIC bound on igb_uio driver. VM could 
recieve arp req from remote system (on dpdk0 port), but VM's arp 
response does not seem to cross ovs.
I did not see any arp response reportedly logged by vswitchd even with 
debug info turned on, or may be that ovs is dropping them internally ?.
Or, Should dpdkvhost0 be internal port (tap) here for ovs to handle arp 
response from VM ?

from ovs-ofctl dump-flows:
NXST_FLOW reply (xid=0x4):
  cookie=0x0, duration=47.090s, table=0, n_packets=59, n_bytes=3741, 
idle_age=1, in_port=1 actions=output:2
  cookie=0x0, duration=42.129s, table=0, n_packets=0, n_bytes=0, 
idle_age=42, in_port=2 actions=output:1

This is blocking the connection to get established with VM (from remote 
system talking through dpdk0).

My env info:
Ubuntu 14.10
ovs-vsctl (Open vSwitch) 2.3.90
Compiled May 19 2015 04:27:58
DB Schema 7.12.1
dpdk-2.0.0

Any help/pointer to further diagnose is greatly appreciated.

-- 
Regards,
Gowrishankar M


From cvinllen at gmail.com  Tue Jun  2 21:52:47 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 3 Jun 2015 12:52:47 +0800
Subject: [ovs-discuss] OFPGMFC_CHAINING_UNSUPPORTED received when send group
	to ovs
Message-ID: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>

Hi, Dear all:

    I send some group table to ovs, like l3 unicast, l2 interface, l3
unicast table goto l2 interface table. But it
return OFPGMFC_CHAINING_UNSUPPORTED when i send the group to ovs.

    Doesn't ovs support group chaining which is defined in openflow1.3.

    Greate appreciate for anyone's reply.

Best Regards,
Vinllen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/d6d9a118/attachment.html>

From sauravdas at alumni.stanford.edu  Tue Jun  2 22:36:22 2015
From: sauravdas at alumni.stanford.edu (Saurav Das)
Date: Tue, 2 Jun 2015 22:36:22 -0700
Subject: [ovs-discuss] OFPGMFC_CHAINING_UNSUPPORTED received when send
 group to ovs
In-Reply-To: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>
References: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>
Message-ID: <CAJzs=6fMGAV=hN_nmRniH-y5osE=x=Wg8SLxtyRpSRfD_O-wRQ@mail.gmail.com>

Group chaining is optional in OF1.3. As far as I know OVS does not support
it, which is why I use CPqD switch for chaining.

Thanks
Saurav

On Tue, Jun 2, 2015 at 9:52 PM, Vinllen Chen <cvinllen at gmail.com> wrote:

> Hi, Dear all:
>
>     I send some group table to ovs, like l3 unicast, l2 interface, l3
> unicast table goto l2 interface table. But it
> return OFPGMFC_CHAINING_UNSUPPORTED when i send the group to ovs.
>
>     Doesn't ovs support group chaining which is defined in openflow1.3.
>
>     Greate appreciate for anyone's reply.
>
> Best Regards,
> Vinllen
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150602/e9df5e68/attachment.html>

From blp at nicira.com  Tue Jun  2 23:21:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 2 Jun 2015 23:21:25 -0700
Subject: [ovs-discuss] OFPGMFC_CHAINING_UNSUPPORTED received when send
 group to ovs
In-Reply-To: <CAJzs=6fMGAV=hN_nmRniH-y5osE=x=Wg8SLxtyRpSRfD_O-wRQ@mail.gmail.com>
References: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>
 <CAJzs=6fMGAV=hN_nmRniH-y5osE=x=Wg8SLxtyRpSRfD_O-wRQ@mail.gmail.com>
Message-ID: <20150603062125.GA3402@nicira.com>

OVS doesn't support group chaining, but we didn't know that anyone
cared, so it's interesting to hear from two (potential) users.

On Tue, Jun 02, 2015 at 10:36:22PM -0700, Saurav Das wrote:
> Group chaining is optional in OF1.3. As far as I know OVS does not support
> it, which is why I use CPqD switch for chaining.
> 
> Thanks
> Saurav
> 
> On Tue, Jun 2, 2015 at 9:52 PM, Vinllen Chen <cvinllen at gmail.com> wrote:
> 
> > Hi, Dear all:
> >
> >     I send some group table to ovs, like l3 unicast, l2 interface, l3
> > unicast table goto l2 interface table. But it
> > return OFPGMFC_CHAINING_UNSUPPORTED when i send the group to ovs.
> >
> >     Doesn't ovs support group chaining which is defined in openflow1.3.
> >
> >     Greate appreciate for anyone's reply.
> >
> > Best Regards,
> > Vinllen
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From sauravdas at alumni.stanford.edu  Tue Jun  2 23:49:17 2015
From: sauravdas at alumni.stanford.edu (Saurav Das)
Date: Tue, 2 Jun 2015 23:49:17 -0700
Subject: [ovs-discuss] OFPGMFC_CHAINING_UNSUPPORTED received when send
 group to ovs
In-Reply-To: <20150603062125.GA3402@nicira.com>
References: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>
 <CAJzs=6fMGAV=hN_nmRniH-y5osE=x=Wg8SLxtyRpSRfD_O-wRQ@mail.gmail.com>
 <20150603062125.GA3402@nicira.com>
Message-ID: <CAJzs=6cDpMCScho5MyHiFgB9eDW1J_LLn8+v4N2aU1Z59cDuBQ@mail.gmail.com>

Ben, I believe  the reference is to this:

https://github.com/Broadcom-Switch/of-dpa/tree/master/OF-DPA-2.0

During controller/app development, it is easier to work with a software
switch, that emulates a hardware switch pipeline.
To emulate OFDPA, group chaining support is necessary.

It was also needed for some earlier related work, which pushed multiple
MPLS labels in ECMP groups.
https://wiki.onosproject.org/display/ONOS/Installation+Guide#InstallationGuide-CPqDSoftwareSwitch

Group chaining would be really nice to have

Thanks
Saurav



On Tue, Jun 2, 2015 at 11:21 PM, Ben Pfaff <blp at nicira.com> wrote:

> OVS doesn't support group chaining, but we didn't know that anyone
> cared, so it's interesting to hear from two (potential) users.
>
> On Tue, Jun 02, 2015 at 10:36:22PM -0700, Saurav Das wrote:
> > Group chaining is optional in OF1.3. As far as I know OVS does not
> support
> > it, which is why I use CPqD switch for chaining.
> >
> > Thanks
> > Saurav
> >
> > On Tue, Jun 2, 2015 at 9:52 PM, Vinllen Chen <cvinllen at gmail.com> wrote:
> >
> > > Hi, Dear all:
> > >
> > >     I send some group table to ovs, like l3 unicast, l2 interface, l3
> > > unicast table goto l2 interface table. But it
> > > return OFPGMFC_CHAINING_UNSUPPORTED when i send the group to ovs.
> > >
> > >     Doesn't ovs support group chaining which is defined in openflow1.3.
> > >
> > >     Greate appreciate for anyone's reply.
> > >
> > > Best Regards,
> > > Vinllen
> > >
> > > _______________________________________________
> > > discuss mailing list
> > > discuss at openvswitch.org
> > > http://openvswitch.org/mailman/listinfo/discuss
> > >
> > >
>
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150602/f641b451/attachment.html>

From cvinllen at gmail.com  Tue Jun  2 23:53:04 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 3 Jun 2015 14:53:04 +0800
Subject: [ovs-discuss] OFPGMFC_CHAINING_UNSUPPORTED received when send
 group to ovs
In-Reply-To: <20150603062125.GA3402@nicira.com>
References: <CAN2Qyza0BZwr=PFAXtE7+3THUKpG4Vk_SB+bzPkSnqn7rR10fQ@mail.gmail.com>
 <CAJzs=6fMGAV=hN_nmRniH-y5osE=x=Wg8SLxtyRpSRfD_O-wRQ@mail.gmail.com>
 <20150603062125.GA3402@nicira.com>
Message-ID: <CAN2Qyzbx=CMkbb0w7uDQdj77R0n78ykGcGb3QdyU_ACqaCmifA@mail.gmail.com>

Aha, thankyou Saurav and Ben. I also use the of-dpa just as Saurav said.

As i kown, Broadcom switch product named of-dpa support all of the
openflow1.3 including the group chaining. When i testing the experiments in
ovs, i found their is some difference between the ovs and of-dpa.

I think it maybe necessary to support the group chaining in the ovs because
the softeware switch should get close to the hardware switch
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/107d288c/attachment-0001.html>

From ranker72 at gmail.com  Wed Jun  3 06:55:47 2015
From: ranker72 at gmail.com (ferran)
Date: Wed, 03 Jun 2015 15:55:47 +0200
Subject: [ovs-discuss] "Too many open files" leads to "Segmentation fault"
Message-ID: <556F0763.1090407@gmail.com>

Hello there,

I'm working on a minor fork of ovs 2.1.2 in a raspberry pi running a
raspbian. There's a controller out there, as well as other openflow
agents, also rpi. All together configure an SDN which I can manage from
the controller. However, this scenario lasts only about 20 minutes, as
ovs instances break in a terrible segfault.

Reading the log from ovs-vswitchd, I see that there's a problem with the
maximum number of open files in the system, causing it to reject
connections to Unix socket "ovs-vswitchd.<pid>.ctl"

After the initial operations, the log stays 20 minutes in silence and then:

2015-06-03T12:21:38.421Z|00027|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:21:38.421Z|00028|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:21:38.421Z|00029|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:21:38.422Z|00030|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:21:38.422Z|00031|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:21:38.435Z|00032|connmgr|WARN|accept failed (Too many open
files)
2015-06-03T12:21:38.436Z|00033|connmgr|WARN|accept failed (Too many open
files)
2015-06-03T12:21:38.436Z|00034|connmgr|WARN|accept failed (Too many open
files)
2015-06-03T12:21:38.436Z|00035|connmgr|WARN|accept failed (Too many open
files)
2015-06-03T12:21:38.538Z|00036|connmgr|WARN|accept failed (Too many open
files)
2015-06-03T12:21:50.451Z|00037|unixctl|WARN|Dropped 1545 log messages in
last 12 seconds (most recently, 0 seconds ago) due to excessive rate
2015-06-03T12:21:50.451Z|00038|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:22:02.456Z|00039|unixctl|WARN|Dropped 1479 log messages in
last 12 seconds (most recently, 0 seconds ago) due to excessive rate
2015-06-03T12:22:02.456Z|00040|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:22:14.458Z|00041|unixctl|WARN|Dropped 1529 log messages in
last 12 seconds (most recently, 0 seconds ago) due to excessive rate
2015-06-03T12:22:14.458Z|00042|unixctl|WARN|punix:/usr/local/var/run/openvswitch/ovs-vswitchd.5393.ctl:
accept failed: Too many open files
2015-06-03T12:22:23.623Z|00002|daemon(monitor)|ERR|1 crashes: pid 5393
died, killed (Segmentation fault), restarting


The only traffic that is holding is composed by custom openflow
statistics messages bound to the controller. The custom messages are
about twice long as original ones, and are sent about each 10 seconds.
That is, there is little traffic going on.

It is relevant to say that the rpi's are dedicated to this function,
therefore there cannot be any other processes triggering this error.

Well then, do you think that it's normal to reach the limit of open
files under these conditions?
Is there any way to limit this so it doesn't crash?
And who is openning this file, here?

Thank you very much
Ferran


From zhunatuzi at gmail.com  Wed Jun  3 06:01:34 2015
From: zhunatuzi at gmail.com (na zhu)
Date: Wed, 3 Jun 2015 21:01:34 +0800
Subject: [ovs-discuss] DPDK vhost vm configuration failed
Message-ID: <CABDe9Tzh9z6KvkiODVhZ_1q1Oh8Cn5gN0ePGcZsT7k-cxwgO+w@mail.gmail.com>

Dear experts,

I try to use dpdk ovs to improve the NFV performance. I follow all the
instructions of INSTALL.DPDK.md, when i do dpdk vhost vm configuration with
libvirt, the vm can not created. the error is:
root at juno:~/vm# virsh define dpdk0.xml
Domain dpdk0 defined from dpdk0.xml

root at juno:~/vm#
root at juno:~/vm# virsh start dpdk0
error: Failed to start domain dpdk0
error: internal error: process exited while connecting to monitor: **
ERROR:/build/buildd/qemu-2.0.0+dfsg/qom/object.c:437:object_new_with_type:
assertion failed: (type != NULL)

My dpdk0.xml file is:
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  <name>dpdk0</name>
  <memory unit='KiB'>512000</memory>
  <currentMemory unit='KiB'>512000</currentMemory>
  <vcpu placement='static' cpuset='0-1'>1</vcpu>
  <os>
    <type arch='x86_64' machine='pc'>hvm</type>
    <boot dev='hd'/>
  </os>
  <features>
    <acpi/>
    <apic/>
  </features>
  <cpu>
    <topology sockets='1' cores='1' threads='1'/>
  </cpu>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>destroy</on_crash>
  <devices>
    <emulator>/usr/bin/qemu-system-x86_64-spice</emulator>
    <disk type='file' device='disk'>
      <driver name='qemu' type='qcow2' cache='none'/>
      <source file='/root/os/cirros.qcow2'/>
      <target dev='vda' bus='virtio'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x04'
function='0x0'/>
    </disk>
    <serial type='pty'>
      <target port='0'/>
    </serial>
    <console type='pty'>
      <target type='serial' port='0'/>
    </console>
    <input type='tablet' bus='usb'/>
    <input type='mouse' bus='ps2'/>
    <input type='keyboard' bus='ps2'/>
    <graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'
keymap='en-us'>
      <listen type='address' address='0.0.0.0'/>
    </graphics>
  </devices>
  <qemu:commandline>
  <qemu:arg value='-object'/>
 <qemu:arg
value='memory-backend-file,id=mem,size=512M,mem-path=/mnt/huge,share=on'/>
 <qemu:arg value='-numa'/>
 <qemu:arg value='node,memdev=mem'/>
 <qemu:arg value='-mem-prealloc'/>
</qemu:commandline>
<qemu:commandline>
<qemu:arg value='-netdev'/>
 <qemu:arg
value='type=tap,id=net0,script=no,downscript=no,ifname=dpdkvhost0,vhost=on'/>
 <qemu:arg value='-device'/>
 <qemu:arg value='virtio-net-pci,netdev=net1,mac=00:00:00:00:00:01'/>
</qemu:commandline>
</domain>

I create a ovs bridge:
root at juno:~/vm# ovs-vsctl show
199fdc65-a790-4edc-bf4a-baf8dedf2d32
    Bridge "br0"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "dpdkvhost0"
            Interface "dpdkvhost0"
                type: dpdkvhost
        Port "br0"
            Interface "br0"
                type: internal
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
root at juno:~/vm#

Does anyone know how to fix the error?


Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/c8f52edd/attachment.html>

From amer7777 at hotmail.com  Wed Jun  3 13:12:30 2015
From: amer7777 at hotmail.com (AMER)
Date: Wed, 3 Jun 2015 20:12:30 +0000
Subject: [ovs-discuss] switch as a sniffer
Message-ID: <DUB113-W94E85A67AD44A6556DED30D4B40@phx.gbl>

Hello

Dear all

I have the following question:

I want the openvswitch reads the exchanged packets and deal with them as they are sent to it.

To do so, I did the following:

I
 installed a flow-entry in the switch that matches the packet address, 
then rewrite it to the local bridge address of the switch. 

To test this:
1. I connected two hosts with a switch in between
2. the first host ping the second host, however
3.
 the controller inserts two flow entries one in the switch to catch the 
packet and rewrite it with the switch address and another in the host to
 rewrite the source address of incoming packet with the address of the 
second host, to let it think the respond is coming from the second host 
"intended one" not from the switch.
4. I run their interfaces in promisc mode.
5. working with IP addresses

However, it is not working with me

Is there something wrong with this procedure.

Any help will be appreciated

Best regards, 

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/812217cc/attachment.html>

From woniu1753 at gmail.com  Wed Jun  3 20:16:51 2015
From: woniu1753 at gmail.com (=?UTF-8?B?5p6X5riF56Wl?=)
Date: Thu, 4 Jun 2015 11:16:51 +0800
Subject: [ovs-discuss] about sizeof(struct) in c
Message-ID: <CAEmpd3nwFTDtdMuJyGdb0RK-CW15cN_=-cNDQZ6s6O1B5hPoKg@mail.gmail.com>

I am reading openflow-spec-v1.3.0, and in page 37 there are a few codes as
follow:

/* Full description for a queue. */
> struct ofp_packet_queue {
> uint32_t queue_id;
> /* id for the specific queue. */
> uint32_t port;
> /* Port this queue is attached to. */
> uint16_t len;
> /* Length in bytes of this queue desc. */
> uint8_t pad[6];
> /* 64-bit alignment. */
> struct ofp_queue_prop_header properties[0]; /* List of properties. */
> };
> OFP_ASSERT(sizeof(struct ofp_packet_queue) == 16);


 In my opinion, sizeof(struct ofp_packet_queue) = sizeof(queue_id) +
sizeof(port) + sizeof(len) + sizeof(pad[]) + sizeof(properties) = 4 + 4 + 2
+ 6 + 4 = 20

But the ASSERT is sizeof(struct ofp_packet_queue) == 16.

Is there anyone can point out my misunderstanding?

Thanks!

-- 


Thanks.

Best Regards,

Qingxiang Lin(æž—æ¸…ç¥¥)
------
Graduate
College of Mathematics and Computer Science, FZU
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/b90f1f0d/attachment.html>

From jpettit at nicira.com  Wed Jun  3 20:27:32 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 3 Jun 2015 20:27:32 -0700
Subject: [ovs-discuss] about sizeof(struct) in c
In-Reply-To: <CAEmpd3nwFTDtdMuJyGdb0RK-CW15cN_=-cNDQZ6s6O1B5hPoKg@mail.gmail.com>
References: <CAEmpd3nwFTDtdMuJyGdb0RK-CW15cN_=-cNDQZ6s6O1B5hPoKg@mail.gmail.com>
Message-ID: <BD5CB84F-32D7-43A0-8866-48342BB0D2AF@nicira.com>


> On Jun 3, 2015, at 8:16 PM, æž—æ¸…ç¥¥ <woniu1753 at gmail.com> wrote:
> 
> I am reading openflow-spec-v1.3.0, and in page 37 there are a few codes as follow:
> 
>> /* Full description for a queue. */
>> struct ofp_packet_queue {
>> uint32_t queue_id;
>> /* id for the specific queue. */
>> uint32_t port;
>> /* Port this queue is attached to. */
>> uint16_t len;
>> /* Length in bytes of this queue desc. */
>> uint8_t pad[6];
>> /* 64-bit alignment. */
>> struct ofp_queue_prop_header properties[0]; /* List of properties. */
>> };
>> OFP_ASSERT(sizeof(struct ofp_packet_queue) == 16);
> 
>  In my opinion, sizeof(struct ofp_packet_queue) = sizeof(queue_id) + sizeof(port) + sizeof(len) + sizeof(pad[]) + sizeof(properties) = 4 + 4 + 2 + 6 + 4 = 20
> 
> But the ASSERT is sizeof(struct ofp_packet_queue) == 16.
> 
> Is there anyone can point out my misunderstanding?

The "properties" element has zero elements, which has no length. 

--Justin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/8b56167e/attachment.html>

From jpettit at nicira.com  Wed Jun  3 20:36:00 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 3 Jun 2015 20:36:00 -0700
Subject: [ovs-discuss] about sizeof(struct) in c
In-Reply-To: <CAEmpd3mqiJiB8j3SmUTAwwQBaiCjJr6SYEehdM2nWgi0nNC7=Q@mail.gmail.com>
References: <CAEmpd3nwFTDtdMuJyGdb0RK-CW15cN_=-cNDQZ6s6O1B5hPoKg@mail.gmail.com>
 <BD5CB84F-32D7-43A0-8866-48342BB0D2AF@nicira.com>
 <CAEmpd3mqiJiB8j3SmUTAwwQBaiCjJr6SYEehdM2nWgi0nNC7=Q@mail.gmail.com>
Message-ID: <26D5728D-C787-4086-99C3-7AFBEAA645F6@nicira.com>

Yeah, it's just to indicate that there are a variable number of "struct ofp_queue_prop_header" elements that follow. 

--Justin


> On Jun 3, 2015, at 8:30 PM, æž—æ¸…ç¥¥ <woniu1753 at gmail.com> wrote:
> 
> I thought "struct ofp_queue_prop_header properties[0];" is to define a pointer of struct ofp_queue_prop_header.
> 
> Thanks!
> 
> 2015-06-04 11:27 GMT+08:00 Justin Pettit <jpettit at nicira.com>:
>> 
>>> On Jun 3, 2015, at 8:16 PM, æž—æ¸…ç¥¥ <woniu1753 at gmail.com> wrote:
>>> 
>>> I am reading openflow-spec-v1.3.0, and in page 37 there are a few codes as follow:
>>> 
>>>> /* Full description for a queue. */
>>>> struct ofp_packet_queue {
>>>> uint32_t queue_id;
>>>> /* id for the specific queue. */
>>>> uint32_t port;
>>>> /* Port this queue is attached to. */
>>>> uint16_t len;
>>>> /* Length in bytes of this queue desc. */
>>>> uint8_t pad[6];
>>>> /* 64-bit alignment. */
>>>> struct ofp_queue_prop_header properties[0]; /* List of properties. */
>>>> };
>>>> OFP_ASSERT(sizeof(struct ofp_packet_queue) == 16);
>>> 
>>>  In my opinion, sizeof(struct ofp_packet_queue) = sizeof(queue_id) + sizeof(port) + sizeof(len) + sizeof(pad[]) + sizeof(properties) = 4 + 4 + 2 + 6 + 4 = 20
>>> 
>>> But the ASSERT is sizeof(struct ofp_packet_queue) == 16.
>>> 
>>> Is there anyone can point out my misunderstanding?
>> 
>> The "properties" element has zero elements, which has no length. 
>> 
>> --Justin
> 
> 
> 
> -- 
>> 
>> Thanks.
>> 
>> Best Regards,
>> 
>> Qingxiang Lin(æž—æ¸…ç¥¥)
>> ------
>> Graduate
>> College of Mathematics and Computer Science, FZU
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/965ef90c/attachment-0001.html>

From ppnaik at cse.iitb.ac.in  Wed Jun  3 21:13:07 2015
From: ppnaik at cse.iitb.ac.in (Priyanka)
Date: Thu, 04 Jun 2015 09:43:07 +0530
Subject: [ovs-discuss] issue regarding port mirroring
Message-ID: <556FD053.4030600@cse.iitb.ac.in>

Hi,

I have an Openstack setup with OVS version 2.1.3. I want implementing 
packet capture for the VM's traffic. I notice that a mirror on br-int 
only captures outgoing traffic. I read in one post that we can add a 
rule to create a port and modify the existing rules to have this out 
port as additional action. How can I implement the same.

Thanks,

Priyanka

From tony.vanderpeet at gmail.com  Wed Jun  3 22:37:37 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Thu, 4 Jun 2015 17:37:37 +1200
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
Message-ID: <CAKL=qh_CqYEn+PuUvzAA94J1TYB=h8tOSS6pLrQj9Vvpka+18A@mail.gmail.com>

I use OpenVSwitch and occasionally upgrade from the tip of master. My
previous upgrade was in Sep/2014, and I have just upgraded to last Friday's
tip. A number of previously running test cases (using oftest) now fail for
me, and I am investigating.

The v1.3 test basic.OutputExact creates a flow outputting to port 1, then
sends packets in ports 2, 3 and 4. The flow is then changed to output to
port 2 instead. Since everything else about the flow is the same, this
actually represents a change in the same flow (in my opinion) and therefore
the dpif flows created when packets were received should now be invalid.
However, when a packet is sent on port 3, instead of being output to port
2, it is output to port 1, causing the test to fail.

I think what's happening is that the dpif flows are not being deleted when
the flow changes. I am almost certain that this is not how the code used to
behave. I have also tweaked the test to explicitly remove the flow before
changing the output port, and this test passes.

The questions I have are: Can anyone point me to the code change that might
have introduced this behaviour? Is it a deliberate change or a by-product?
While I could happily proceed by changing our regression test, I would
rather see if this behaviour can be altered to behave the way it used to,
which seems to me to be more conformant to the specification.

Any advice gratefully accepted.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/0afcc15e/attachment.html>

From alexw at nicira.com  Wed Jun  3 23:05:29 2015
From: alexw at nicira.com (Alex Wang)
Date: Wed, 3 Jun 2015 23:05:29 -0700
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
In-Reply-To: <CAKL=qh_CqYEn+PuUvzAA94J1TYB=h8tOSS6pLrQj9Vvpka+18A@mail.gmail.com>
References: <CAKL=qh_CqYEn+PuUvzAA94J1TYB=h8tOSS6pLrQj9Vvpka+18A@mail.gmail.com>
Message-ID: <CAArS4XXJHN713ZfSzQieCihSbAOQECCcF_M_4JdUxEA2idqh+A@mail.gmail.com>

Hey,

Few questions,

1. how do you change the flow to output to port 2?  using
ovs-ofctl mod-flows?  Could you show the exact commands?

2. There was a commit (b2a4692 ofproto: Increase default datapath
max_idle time.) that increased the max_idle time of dpif flows.  That may
be related.

Thanks,
Alex Wang,

On Wed, Jun 3, 2015 at 10:37 PM, Tony van der Peet <
tony.vanderpeet at gmail.com> wrote:

> I use OpenVSwitch and occasionally upgrade from the tip of master. My
> previous upgrade was in Sep/2014, and I have just upgraded to last Friday's
> tip. A number of previously running test cases (using oftest) now fail for
> me, and I am investigating.
>
> The v1.3 test basic.OutputExact creates a flow outputting to port 1, then
> sends packets in ports 2, 3 and 4. The flow is then changed to output to
> port 2 instead. Since everything else about the flow is the same, this
> actually represents a change in the same flow (in my opinion) and therefore
> the dpif flows created when packets were received should now be invalid.
> However, when a packet is sent on port 3, instead of being output to port
> 2, it is output to port 1, causing the test to fail.
>
> I think what's happening is that the dpif flows are not being deleted when
> the flow changes. I am almost certain that this is not how the code used to
> behave. I have also tweaked the test to explicitly remove the flow before
> changing the output port, and this test passes.
>
> The questions I have are: Can anyone point me to the code change that
> might have introduced this behaviour? Is it a deliberate change or a
> by-product? While I could happily proceed by changing our regression test,
> I would rather see if this behaviour can be altered to behave the way it
> used to, which seems to me to be more conformant to the specification.
>
> Any advice gratefully accepted.
>
> Tony
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/9e2fd79d/attachment.html>

From contact at progbau.de  Wed Jun  3 23:16:44 2015
From: contact at progbau.de (Chris)
Date: Thu, 4 Jun 2015 13:16:44 +0700
Subject: [ovs-discuss] Openvswitch network disconnect
Message-ID: <000001d09e8e$09921e60$1cb65b20$@progbau.de>

Hello,

We are using Openvswitch in our Openstack setup.

ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.0
Compiled Oct 28 2014 17:48:05
OpenFlow versions 0x1:0x1

We experience openvswitch failures from time to time. It seems to happen
random, no network traffic spikes for example.
The VM ports and the openvswitch port for the host management just stop
working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
still running

For debug purpose the following commands has been executed:

- "ovs-vsctl show" the interfaces are still listed
The ones below didn't show any result and just hang after the execution:
- ovs-appctl bond/show bond0
- ovs-appctl vlog/list
- ovs-ofctl dump-flows br-bond0

A "service openvswitch restart" fix it, the connection from the VMs and the
host are back immediately.

Any help appreciated!

Cheers,
Chris




From alexw at nicira.com  Wed Jun  3 23:28:37 2015
From: alexw at nicira.com (Alex Wang)
Date: Wed, 3 Jun 2015 23:28:37 -0700
Subject: [ovs-discuss] Openvswitch network disconnect
In-Reply-To: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
References: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
Message-ID: <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>

On Wed, Jun 3, 2015 at 11:16 PM, Chris <contact at progbau.de> wrote:

> Hello,
>
> We are using Openvswitch in our Openstack setup.
>
> ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.0
> Compiled Oct 28 2014 17:48:05
> OpenFlow versions 0x1:0x1
>
> We experience openvswitch failures from time to time. It seems to happen
> random, no network traffic spikes for example.
> The VM ports and the openvswitch port for the host management just stop
> working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
> still running
>
> For debug purpose the following commands has been executed:
>
> - "ovs-vsctl show" the interfaces are still listed
> The ones below didn't show any result and just hang after the execution:
> - ovs-appctl bond/show bond0
> - ovs-appctl vlog/list
> - ovs-ofctl dump-flows br-bond0
>
>

This seems to indicate that the ovs-vswitchd process is dead locked...
I could not find comment in branch-2.3 that relates to dead lock.  It would
be
helpful if you can gdb into the running ovs-vswitchd process and provide
the backtraces when there is a failure.

Or could I know what your setup looks like (ovs-vsctl show output)?

Thanks,
Alex Wang,




> A "service openvswitch restart" fix it, the connection from the VMs and the
> host are back immediately.
>
> Any help appreciated!
>
> Cheers,
> Chris
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/c7b881e3/attachment-0001.html>

From contact at progbau.de  Wed Jun  3 23:52:53 2015
From: contact at progbau.de (Chris)
Date: Thu, 4 Jun 2015 13:52:53 +0700
Subject: [ovs-discuss] Openvswitch network disconnect
In-Reply-To: <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>
References: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
 <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>
Message-ID: <062201d09e93$16df04c0$449d0e40$@progbau.de>

Hello Alex,

 

I will do the gdb debug when it happens again. 

 

Here the output, in this case there are 4 VMs running on the host. The physical interfaces eth2 & eth3 are in active-passive mode bonded to bond0. mgmt0 is used for the management of the host system. Anything else is created by OpenStack.

The failure happens independent from the number of VMs running on the host: 

 

ovs-vsctl show

fbbaf640-ed82-4735-99d2-fbe09f4041f1

    Bridge "br-bond0"

        Port "mgmt0"

            Interface "mgmt0"

                type: internal

        Port "br-bond0"

            Interface "br-bond0"

                type: internal

        Port "phy-br-bond0"

            Interface "phy-br-bond0"

        Port "bond0"

            Interface "eth2"

            Interface "eth3"

    Bridge br-int

        fail_mode: secure

        Port br-int

            Interface br-int

                type: internal

        Port "qvo4166dc0a-69"

            tag: 1

            Interface "qvo4166dc0a-69"

        Port "qvo6d8b70de-9c"

            tag: 1

            Interface "qvo6d8b70de-9c"

        Port "qvoe75237cc-7f"

            tag: 1

            Interface "qvoe75237cc-7f"

        Port "qvoe3b9e1fc-a5"

            tag: 1

            Interface "qvoe3b9e1fc-a5"

        Port "int-br-bond0"

            Interface "int-br-bond0"

    ovs_version: "2.3.0"

 

ip a

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN

    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00

    inet 127.0.0.1/8 scope host lo

2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000

    link/ether 9c:b6:54:b3:67:34 brd ff:ff:ff:ff:ff:ff

3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000

    link/ether 9c:b6:54:b3:67:35 brd ff:ff:ff:ff:ff:ff

4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000

    link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff

5: eth3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000

    link/ether 64:51:06:f0:85:9c brd ff:ff:ff:ff:ff:ff

6: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether de:76:ca:6d:57:48 brd ff:ff:ff:ff:ff:ff

7: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether ee:f8:2f:ef:94:42 brd ff:ff:ff:ff:ff:ff

8: br-bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff

15: mgmt0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether fa:e1:51:33:5d:dc brd ff:ff:ff:ff:ff:ff

    inet 10.201.195.75/24 brd 10.201.195.255 scope global mgmt0

16: qbr4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff

17: qvo4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether ae:27:12:55:09:0c brd ff:ff:ff:ff:ff:ff

18: qvb4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff

19: tap4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:d6:34:82 brd ff:ff:ff:ff:ff:ff

20: qbre75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff

21: qvoe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 1e:7f:f4:57:aa:82 brd ff:ff:ff:ff:ff:ff

22: qvbe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff

23: tape75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:02:a4:d7 brd ff:ff:ff:ff:ff:ff

24: qbre3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff

25: qvoe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c6:5f:19:25:7c:be brd ff:ff:ff:ff:ff:ff

26: qvbe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff

27: tape3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:bb:a7:19 brd ff:ff:ff:ff:ff:ff

28: qbr6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff

29: qvo6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 46:23:9e:4b:2a:fd brd ff:ff:ff:ff:ff:ff

30: qvb6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff

31: tap6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:40:9e:44 brd ff:ff:ff:ff:ff:ff

32: bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether f6:83:30:bc:4c:7c brd ff:ff:ff:ff:ff:ff

35: phy-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 76:51:9d:bd:24:83 brd ff:ff:ff:ff:ff:ff

36: int-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 5e:fa:05:2a:1a:ef brd ff:ff:ff:ff:ff:ff

 

 

Cheers,

Chris

 

 

From: Alex Wang [mailto:alexw at nicira.com] 
Sent: Thursday, June 04, 2015 13:29
To: Chris
Cc: discuss at openvswitch.org; openstack at lists.openstack.org; Soputhi Sea
Subject: Re: [ovs-discuss] Openvswitch network disconnect

 

 

 

On Wed, Jun 3, 2015 at 11:16 PM, Chris <contact at progbau.de <mailto:contact at progbau.de> > wrote:

Hello,

We are using Openvswitch in our Openstack setup.

ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.0
Compiled Oct 28 2014 17:48:05
OpenFlow versions 0x1:0x1

We experience openvswitch failures from time to time. It seems to happen
random, no network traffic spikes for example.
The VM ports and the openvswitch port for the host management just stop
working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
still running

For debug purpose the following commands has been executed:

- "ovs-vsctl show" the interfaces are still listed
The ones below didn't show any result and just hang after the execution:
- ovs-appctl bond/show bond0
- ovs-appctl vlog/list
- ovs-ofctl dump-flows br-bond0

 

 

This seems to indicate that the ovs-vswitchd process is dead locked...

I could not find comment in branch-2.3 that relates to dead lock.  It would be

helpful if you can gdb into the running ovs-vswitchd process and provide

the backtraces when there is a failure.

 

Or could I know what your setup looks like (ovs-vsctl show output)?

 

Thanks,

Alex Wang,

 

 

 

A "service openvswitch restart" fix it, the connection from the VMs and the
host are back immediately.

Any help appreciated!

Cheers,
Chris



_______________________________________________
discuss mailing list
discuss at openvswitch.org <mailto:discuss at openvswitch.org> 
http://openvswitch.org/mailman/listinfo/discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/f39c389e/attachment-0001.html>

From alexw at nicira.com  Wed Jun  3 23:59:42 2015
From: alexw at nicira.com (Alex Wang)
Date: Wed, 3 Jun 2015 23:59:42 -0700
Subject: [ovs-discuss] Openvswitch network disconnect
In-Reply-To: <062201d09e93$16df04c0$449d0e40$@progbau.de>
References: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
 <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>
 <062201d09e93$16df04c0$449d0e40$@progbau.de>
Message-ID: <CAArS4XXLwUMJdipDCxzYnyozu3Hn+5YSEcPCsTJ6WQATzfuhrA@mail.gmail.com>

Thx for the info, I'll try reproduce it on my local setup using
active-backup
bond.  And use it as managment interface,

Will update if I run into the same issue~

Thanks,
Alex Wang,

On Wed, Jun 3, 2015 at 11:52 PM, Chris <contact at progbau.de> wrote:

> Hello Alex,
>
>
>
> I will do the gdb debug when it happens again.
>
>
>
> Here the output, in this case there are 4 VMs running on the host. The
> physical interfaces eth2 & eth3 are in active-passive mode bonded to bond0.
> mgmt0 is used for the management of the host system. Anything else is
> created by OpenStack.
>
> The failure happens independent from the number of VMs running on the
> host:
>
>
>
> *ovs-vsctl show*
>
> fbbaf640-ed82-4735-99d2-fbe09f4041f1
>
>     Bridge "br-bond0"
>
>         Port "mgmt0"
>
>             Interface "mgmt0"
>
>                 type: internal
>
>         Port "br-bond0"
>
>             Interface "br-bond0"
>
>                 type: internal
>
>         Port "phy-br-bond0"
>
>             Interface "phy-br-bond0"
>
>         Port "bond0"
>
>             Interface "eth2"
>
>             Interface "eth3"
>
>     Bridge br-int
>
>         fail_mode: secure
>
>         Port br-int
>
>             Interface br-int
>
>                 type: internal
>
>         Port "qvo4166dc0a-69"
>
>             tag: 1
>
>             Interface "qvo4166dc0a-69"
>
>         Port "qvo6d8b70de-9c"
>
>             tag: 1
>
>             Interface "qvo6d8b70de-9c"
>
>         Port "qvoe75237cc-7f"
>
>             tag: 1
>
>             Interface "qvoe75237cc-7f"
>
>         Port "qvoe3b9e1fc-a5"
>
>             tag: 1
>
>             Interface "qvoe3b9e1fc-a5"
>
>         Port "int-br-bond0"
>
>             Interface "int-br-bond0"
>
>     ovs_version: "2.3.0"
>
>
>
> *ip a*
>
> 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
>
>     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
>
>     inet 127.0.0.1/8 scope host lo
>
> 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000
>
>     link/ether 9c:b6:54:b3:67:34 brd ff:ff:ff:ff:ff:ff
>
> 3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000
>
>     link/ether 9c:b6:54:b3:67:35 brd ff:ff:ff:ff:ff:ff
>
> 4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen
> 1000
>
>     link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff
>
> 5: eth3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen
> 1000
>
>     link/ether 64:51:06:f0:85:9c brd ff:ff:ff:ff:ff:ff
>
> 6: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether de:76:ca:6d:57:48 brd ff:ff:ff:ff:ff:ff
>
> 7: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether ee:f8:2f:ef:94:42 brd ff:ff:ff:ff:ff:ff
>
> 8: br-bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff
>
> 15: mgmt0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state
> UNKNOWN
>
>     link/ether fa:e1:51:33:5d:dc brd ff:ff:ff:ff:ff:ff
>
>     inet 10.201.195.75/24 brd 10.201.195.255 scope global mgmt0
>
> 16: qbr4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff
>
> 17: qvo4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether ae:27:12:55:09:0c brd ff:ff:ff:ff:ff:ff
>
> 18: qvb4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff
>
> 19: tap4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:d6:34:82 brd ff:ff:ff:ff:ff:ff
>
> 20: qbre75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff
>
> 21: qvoe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether 1e:7f:f4:57:aa:82 brd ff:ff:ff:ff:ff:ff
>
> 22: qvbe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff
>
> 23: tape75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:02:a4:d7 brd ff:ff:ff:ff:ff:ff
>
> 24: qbre3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff
>
> 25: qvoe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c6:5f:19:25:7c:be brd ff:ff:ff:ff:ff:ff
>
> 26: qvbe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff
>
> 27: tape3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:bb:a7:19 brd ff:ff:ff:ff:ff:ff
>
> 28: qbr6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff
>
> 29: qvo6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether 46:23:9e:4b:2a:fd brd ff:ff:ff:ff:ff:ff
>
> 30: qvb6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff
>
> 31: tap6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:40:9e:44 brd ff:ff:ff:ff:ff:ff
>
> 32: bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether f6:83:30:bc:4c:7c brd ff:ff:ff:ff:ff:ff
>
> 35: phy-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UP qlen 1000
>
>     link/ether 76:51:9d:bd:24:83 brd ff:ff:ff:ff:ff:ff
>
> 36: int-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UP qlen 1000
>
>     link/ether 5e:fa:05:2a:1a:ef brd ff:ff:ff:ff:ff:ff
>
>
>
>
>
> Cheers,
>
> Chris
>
>
>
>
>
> *From:* Alex Wang [mailto:alexw at nicira.com]
> *Sent:* Thursday, June 04, 2015 13:29
> *To:* Chris
> *Cc:* discuss at openvswitch.org; openstack at lists.openstack.org; Soputhi Sea
> *Subject:* Re: [ovs-discuss] Openvswitch network disconnect
>
>
>
>
>
>
>
> On Wed, Jun 3, 2015 at 11:16 PM, Chris <contact at progbau.de> wrote:
>
> Hello,
>
> We are using Openvswitch in our Openstack setup.
>
> ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.0
> Compiled Oct 28 2014 17:48:05
> OpenFlow versions 0x1:0x1
>
> We experience openvswitch failures from time to time. It seems to happen
> random, no network traffic spikes for example.
> The VM ports and the openvswitch port for the host management just stop
> working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
> still running
>
> For debug purpose the following commands has been executed:
>
> - "ovs-vsctl show" the interfaces are still listed
> The ones below didn't show any result and just hang after the execution:
> - ovs-appctl bond/show bond0
> - ovs-appctl vlog/list
> - ovs-ofctl dump-flows br-bond0
>
>
>
>
>
> This seems to indicate that the ovs-vswitchd process is dead locked...
>
> I could not find comment in branch-2.3 that relates to dead lock.  It
> would be
>
> helpful if you can gdb into the running ovs-vswitchd process and provide
>
> the backtraces when there is a failure.
>
>
>
> Or could I know what your setup looks like (ovs-vsctl show output)?
>
>
>
> Thanks,
>
> Alex Wang,
>
>
>
>
>
>
>
> A "service openvswitch restart" fix it, the connection from the VMs and the
> host are back immediately.
>
> Any help appreciated!
>
> Cheers,
> Chris
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150603/8c66c06b/attachment-0001.html>

From amer7777 at hotmail.com  Thu Jun  4 00:51:33 2015
From: amer7777 at hotmail.com (AMER)
Date: Thu, 4 Jun 2015 07:51:33 +0000
Subject: [ovs-discuss] FW:  switch as a sniffer Thanks Done
In-Reply-To: <DUB113-W94E85A67AD44A6556DED30D4B40@phx.gbl>
References: <DUB113-W94E85A67AD44A6556DED30D4B40@phx.gbl>
Message-ID: <DUB113-W83DA8B2E2A7A7B1D10F94AD4B30@phx.gbl>

Done like a charm
I have separated the actions into two tables

Thanks

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


From: amer7777 at hotmail.com
To: discuss at openvswitch.org
Date: Wed, 3 Jun 2015 20:12:30 +0000
Subject: [ovs-discuss] switch as a sniffer




Hello

Dear all

I have the following question:

I want the openvswitch reads the exchanged packets and deal with them as they are sent to it.

To do so, I did the following:

I
 installed a flow-entry in the switch that matches the packet address, 
then rewrite it to the local bridge address of the switch. 

To test this:
1. I connected two hosts with a switch in between
2. the first host ping the second host, however
3.
 the controller inserts two flow entries one in the switch to catch the 
packet and rewrite it with the switch address and another in the host to
 rewrite the source address of incoming packet with the address of the 
second host, to let it think the respond is coming from the second host 
"intended one" not from the switch.
4. I run their interfaces in promisc mode.
5. working with IP addresses

However, it is not working with me

Is there something wrong with this procedure.

Any help will be appreciated

Best regards, 

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA
 		 	   		  

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/03bc7fb6/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT00001
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/03bc7fb6/attachment.ksh>

From amal.kammoun at supcom.tn  Thu Jun  4 01:47:53 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Thu, 4 Jun 2015 08:47:53 +0000
Subject: [ovs-discuss] can't get flow entries
Message-ID: <AM2PR04MB091446283CDD50A841DC8D4388B30@AM2PR04MB0914.eurprd04.prod.outlook.com>

Hello,


I'm installing openvswitch 2.3.1 in ubuntu 14.04. the OpenFlow version is 1.0.

I'm using in my architecture Flowvisor and Floodlight.

My problem is that I don't get any flow entry in my switch!

How can I configure the switch so that it can get flow entries in its table?


Thank you,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/7be7217b/attachment.html>

From maniksidana019 at gmail.com  Thu Jun  4 02:40:25 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Thu, 4 Jun 2015 15:10:25 +0530
Subject: [ovs-discuss] issue regarding port mirroring
In-Reply-To: <556FD053.4030600@cse.iitb.ac.in>
References: <556FD053.4030600@cse.iitb.ac.in>
Message-ID: <CAG-CZ9cUiPuuLEK+40hNfC07FN7pgY+WwQKMhdLJhubuq0dK+g@mail.gmail.com>

Did you use both 'select_src_port' and 'select_dst_port' options for your
mirror? Using both these options on a port would capture incoming as well
as outgoing traffic

Refer this link for more details
http://backreference.org/2014/06/17/port-mirroring-with-linux-bridges/
On 4 Jun 2015 09:48, "Priyanka" <ppnaik at cse.iitb.ac.in> wrote:

> Hi,
>
> I have an Openstack setup with OVS version 2.1.3. I want implementing
> packet capture for the VM's traffic. I notice that a mirror on br-int only
> captures outgoing traffic. I read in one post that we can add a rule to
> create a port and modify the existing rules to have this out port as
> additional action. How can I implement the same.
>
> Thanks,
>
> Priyanka
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/0509d3ad/attachment.html>

From ciara.loftus at intel.com  Thu Jun  4 08:33:49 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Thu, 4 Jun 2015 15:33:49 +0000
Subject: [ovs-discuss] DPDK vhost vm configuration failed
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC22056745A@IRSMSX106.ger.corp.intel.com>
References: <74F120C019F4A64C9B78E802F6AD4CC22056745A@IRSMSX106.ger.corp.intel.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC220567472@IRSMSX106.ger.corp.intel.com>


> I try to use dpdk ovs to improve the NFV performance. I follow all the
> instructions of INSTALL.DPDK.md, when i do dpdk vhost vm configuration
> with
> libvirt, the vm can not created. the error is:
> root at juno:~/vm# virsh define dpdk0.xml
> Domain dpdk0 defined from dpdk0.xml
> 
> root at juno:~/vm#
> root at juno:~/vm# virsh start dpdk0
> error: Failed to start domain dpdk0
> error: internal error: process exited while connecting to monitor: **
> ERROR:/build/buildd/qemu-
> 2.0.0+dfsg/qom/object.c:437:object_new_with_type:
> assertion failed: (type != NULL)
> 
>

[...]
 
> Does anyone know how to fix the error?

Hi, from your snip, it looks like you're using QEMU 2.0.0 which is incompatible with vhost-cuse. To work with the parameters you are using above, you need to use QEMU v2.1.0 or later. The error you are seeing is consistent with the use of an incompatible QEMU version.

Ciara

From denis.kobernik at gmail.com  Wed Jun  3 23:53:23 2015
From: denis.kobernik at gmail.com (Denis Kobernik)
Date: Thu, 4 Jun 2015 09:53:23 +0300
Subject: [ovs-discuss] How to configure?
Message-ID: <CAD09+wHX86F9x+v22aArUF9xPf0W-7Xtx4rrr6W7UyN5yaob2w@mail.gmail.com>

I have a remote server with QEMU/KVM and only SSH connection is available
to me. Host OS is RHEL 7. Guests must be connected to OVS and don't have
access outside network. Host must be available to ping guests. How it can
be done? I can't use physical interface and with dhclient to give addresses
to OVS ports. Please, help. How to configure host to guest network using
OVS? I followed this instruction
https://github.com/openvswitch/ovs/blob/master/INSTALL.Libvirt.md but how
to implement addressing?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150604/9487efdc/attachment-0001.html>

From tony.vanderpeet at gmail.com  Thu Jun  4 22:50:23 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Fri, 5 Jun 2015 17:50:23 +1200
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
Message-ID: <CAKL=qh8ErjCeZXGGzkfuTm4spqwhPa9G9AGYZ7bUtcJ+mzY_wg@mail.gmail.com>

Alex and group

This is a repeat of my earlier reply, sent also to the list (sorry about
dropping the list). Plus some information about my day's debugging.

Tony

On Thu, Jun 4, 2015 at 6:05 PM, Alex Wang <alexw at nicira.com> wrote:

> Hey,
>
> Few questions,
>
> 1. how do you change the flow to output to port 2?  using
> ovs-ofctl mod-flows?  Could you show the exact commands?
>

I'm running an oftest test case, in the v1.3 tests, called
basic.OutputExact. The code is:

class OutputExact(base_tests.SimpleDataPlane):
    """
    Test output function for an exact-match flow

    For each port A, adds a flow directing matching packets to that port.
    Then, for all other ports B != A, verifies that sending a matching
packet
    to B results in an output to A.
    """
    def runTest(self):
        ports = sorted(config["port_map"].keys())

        delete_all_flows(self.controller)

        parsed_pkt = simple_tcp_packet()
        pkt = str(parsed_pkt)
        match = packet_to_flow_match(self, parsed_pkt)

        for out_port in ports:
            request = ofp.message.flow_add(
                    table_id=test_param_get("table", 0),
                    cookie=42,
                    match=match,
                    instructions=[
                        ofp.instruction.apply_actions(
                            actions=[
                                ofp.action.output(
                                    port=out_port,
                                    max_len=ofp.OFPCML_NO_BUFFER)])],
                    buffer_id=ofp.OFP_NO_BUFFER,
                    priority=1000)

            logging.info("Inserting flow sending matching packets to port
%d", out_port)
            self.controller.message_send(request)
            do_barrier(self.controller)

            for in_port in ports:
                if in_port == out_port:
                    continue
                logging.info("OutputExact test, ports %d to %d", in_port,
out_port)
                self.dataplane.send(in_port, pkt)
                verify_packets(self, pkt, [out_port])


> 2. There was a commit (b2a4692 ofproto: Increase default datapath
> max_idle time.) that increased the max_idle time of dpif flows.  That may
> be related.
>

Not related, our code had already increased the timeout to 6s.

My day's debugging: I am in a version of our build based on my previous
upgrade last year, and it passes the test. I'm in revalidate() and seeing
that flows are being deleted due to the return from revalidate_ukey(),
which sort of makes sense to me. The fact that udpif->need_revalidate is no
longer being set seems a bit suspicious to me. I will continue to work on
this and will update next week (since it's my Friday!).

Tony


> Thanks,
> Alex Wang,
>
> On Wed, Jun 3, 2015 at 10:37 PM, Tony van der Peet <
> tony.vanderpeet at gmail.com> wrote:
>
>> I use OpenVSwitch and occasionally upgrade from the tip of master. My
>> previous upgrade was in Sep/2014, and I have just upgraded to last Friday's
>> tip. A number of previously running test cases (using oftest) now fail for
>> me, and I am investigating.
>>
>> The v1.3 test basic.OutputExact creates a flow outputting to port 1, then
>> sends packets in ports 2, 3 and 4. The flow is then changed to output to
>> port 2 instead. Since everything else about the flow is the same, this
>> actually represents a change in the same flow (in my opinion) and therefore
>> the dpif flows created when packets were received should now be invalid.
>> However, when a packet is sent on port 3, instead of being output to port
>> 2, it is output to port 1, causing the test to fail.
>>
>> I think what's happening is that the dpif flows are not being deleted
>> when the flow changes. I am almost certain that this is not how the code
>> used to behave. I have also tweaked the test to explicitly remove the flow
>> before changing the output port, and this test passes.
>>
>> The questions I have are: Can anyone point me to the code change that
>> might have introduced this behaviour? Is it a deliberate change or a
>> by-product? While I could happily proceed by changing our regression test,
>> I would rather see if this behaviour can be altered to behave the way it
>> used to, which seems to me to be more conformant to the specification.
>>
>> Any advice gratefully accepted.
>>
>> Tony
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/85437042/attachment.html>

From tony.vanderpeet at gmail.com  Thu Jun  4 23:05:27 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Fri, 5 Jun 2015 18:05:27 +1200
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
In-Reply-To: <CAKL=qh8ErjCeZXGGzkfuTm4spqwhPa9G9AGYZ7bUtcJ+mzY_wg@mail.gmail.com>
References: <CAKL=qh8ErjCeZXGGzkfuTm4spqwhPa9G9AGYZ7bUtcJ+mzY_wg@mail.gmail.com>
Message-ID: <CAKL=qh-ObSMENP6LYYhv2QzdFdA1Q-U1jfPYG7EVh1DR3vTz6Q@mail.gmail.com>

More on my day's debugging: my previous comment was a bit premature, and a
bit confusing. To clarify:

- dpif flows are not being deleted in time when the basic.OutputExact test
runs on our most recent code
- dpif flows are being deleted in time on last year's code (based on my
previous upgrade from tip of master)
- the reason they are being deleted at all is based on the return from
revalidate_ukey(), which works in last year's code
- the latest code also appears to be making the decision to delete the flow
based on revalidate_ukey()
- so, I need to keep looking and stop talking to the list!

Tony

On Fri, Jun 5, 2015 at 5:50 PM, Tony van der Peet <tony.vanderpeet at gmail.com
> wrote:

> Alex and group
>
> This is a repeat of my earlier reply, sent also to the list (sorry about
> dropping the list). Plus some information about my day's debugging.
>
> Tony
>
> On Thu, Jun 4, 2015 at 6:05 PM, Alex Wang <alexw at nicira.com> wrote:
>
>> Hey,
>>
>> Few questions,
>>
>> 1. how do you change the flow to output to port 2?  using
>> ovs-ofctl mod-flows?  Could you show the exact commands?
>>
>
> I'm running an oftest test case, in the v1.3 tests, called
> basic.OutputExact. The code is:
>
> class OutputExact(base_tests.SimpleDataPlane):
>     """
>     Test output function for an exact-match flow
>
>     For each port A, adds a flow directing matching packets to that port.
>     Then, for all other ports B != A, verifies that sending a matching
> packet
>     to B results in an output to A.
>     """
>     def runTest(self):
>         ports = sorted(config["port_map"].keys())
>
>         delete_all_flows(self.controller)
>
>         parsed_pkt = simple_tcp_packet()
>         pkt = str(parsed_pkt)
>         match = packet_to_flow_match(self, parsed_pkt)
>
>         for out_port in ports:
>             request = ofp.message.flow_add(
>                     table_id=test_param_get("table", 0),
>                     cookie=42,
>                     match=match,
>                     instructions=[
>                         ofp.instruction.apply_actions(
>                             actions=[
>                                 ofp.action.output(
>                                     port=out_port,
>                                     max_len=ofp.OFPCML_NO_BUFFER)])],
>                     buffer_id=ofp.OFP_NO_BUFFER,
>                     priority=1000)
>
>             logging.info("Inserting flow sending matching packets to port
> %d", out_port)
>             self.controller.message_send(request)
>             do_barrier(self.controller)
>
>             for in_port in ports:
>                 if in_port == out_port:
>                     continue
>                 logging.info("OutputExact test, ports %d to %d", in_port,
> out_port)
>                 self.dataplane.send(in_port, pkt)
>                 verify_packets(self, pkt, [out_port])
>
>
>> 2. There was a commit (b2a4692 ofproto: Increase default datapath
>> max_idle time.) that increased the max_idle time of dpif flows.  That may
>> be related.
>>
>
> Not related, our code had already increased the timeout to 6s.
>
> My day's debugging: I am in a version of our build based on my previous
> upgrade last year, and it passes the test. I'm in revalidate() and seeing
> that flows are being deleted due to the return from revalidate_ukey(),
> which sort of makes sense to me. The fact that udpif->need_revalidate is no
> longer being set seems a bit suspicious to me. I will continue to work on
> this and will update next week (since it's my Friday!).
>
> Tony
>
>
>> Thanks,
>> Alex Wang,
>>
>> On Wed, Jun 3, 2015 at 10:37 PM, Tony van der Peet <
>> tony.vanderpeet at gmail.com> wrote:
>>
>>> I use OpenVSwitch and occasionally upgrade from the tip of master. My
>>> previous upgrade was in Sep/2014, and I have just upgraded to last Friday's
>>> tip. A number of previously running test cases (using oftest) now fail for
>>> me, and I am investigating.
>>>
>>> The v1.3 test basic.OutputExact creates a flow outputting to port 1,
>>> then sends packets in ports 2, 3 and 4. The flow is then changed to output
>>> to port 2 instead. Since everything else about the flow is the same, this
>>> actually represents a change in the same flow (in my opinion) and therefore
>>> the dpif flows created when packets were received should now be invalid.
>>> However, when a packet is sent on port 3, instead of being output to port
>>> 2, it is output to port 1, causing the test to fail.
>>>
>>> I think what's happening is that the dpif flows are not being deleted
>>> when the flow changes. I am almost certain that this is not how the code
>>> used to behave. I have also tweaked the test to explicitly remove the flow
>>> before changing the output port, and this test passes.
>>>
>>> The questions I have are: Can anyone point me to the code change that
>>> might have introduced this behaviour? Is it a deliberate change or a
>>> by-product? While I could happily proceed by changing our regression test,
>>> I would rather see if this behaviour can be altered to behave the way it
>>> used to, which seems to me to be more conformant to the specification.
>>>
>>> Any advice gratefully accepted.
>>>
>>> Tony
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/a4035ab5/attachment-0001.html>

From tony.vanderpeet at gmail.com  Fri Jun  5 00:02:13 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Fri, 5 Jun 2015 19:02:13 +1200
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
Message-ID: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>

Alex

Turns out that the only behaviour change is a slight timing change. If I
put a 0.2s sleep into the outer loop of the test I can make is pass
reliably. In other words, the flows are still being deleted correctly, it's
just that the test is so quick in changing the flows and expecting to be
able to test the new flow that it's seeing a failure.

In the real world, there would of course be much less chance of this sort
of coordination between data and flow changes, so I am satisfied that
OpenVSwitch continues to operate in the same high quality way that I have
always experienced.

Just have to update my tests a bit (sigh).

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/2d5fb21e/attachment.html>

From alexw at nicira.com  Fri Jun  5 00:31:36 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 5 Jun 2015 00:31:36 -0700
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
In-Reply-To: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>
References: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>
Message-ID: <CAArS4XXHh04diP_RuT69qPG-d+GCc7wQpCPORPODoQs4GruhsA@mail.gmail.com>

Glad to hear you figured it out,

Curious about:
1. Do you need to do flow remove in the loop after the "for in_port..." loop
in you test?

2. Where in the outer loop do you add the sleep.?

Thanks,
Alex Wang,

On Fri, Jun 5, 2015 at 12:02 AM, Tony van der Peet <
tony.vanderpeet at gmail.com> wrote:

> Alex
>
> Turns out that the only behaviour change is a slight timing change. If I
> put a 0.2s sleep into the outer loop of the test I can make is pass
> reliably. In other words, the flows are still being deleted correctly, it's
> just that the test is so quick in changing the flows and expecting to be
> able to test the new flow that it's seeing a failure.
>
> In the real world, there would of course be much less chance of this sort
> of coordination between data and flow changes, so I am satisfied that
> OpenVSwitch continues to operate in the same high quality way that I have
> always experienced.
>
> Just have to update my tests a bit (sigh).
>
> Tony
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/4801b182/attachment.html>

From amal.kammoun at supcom.tn  Fri Jun  5 01:50:29 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Fri, 5 Jun 2015 08:50:29 +0000
Subject: [ovs-discuss] Issue: can't get flow entries
In-Reply-To: <AM2PR04MB091446283CDD50A841DC8D4388B30@AM2PR04MB0914.eurprd04.prod.outlook.com>
References: <AM2PR04MB091446283CDD50A841DC8D4388B30@AM2PR04MB0914.eurprd04.prod.outlook.com>
Message-ID: <AM2PR04MB0914521CB9964F93B739F3B188B20@AM2PR04MB0914.eurprd04.prod.outlook.com>

Hello,

when I use: ovs-ofctl dump-flows br0, I get:NXST_FLOW reply (xid=0x4)

when I use: ovs-ofctl dump-table-features br0   I get   dump-table-features need OpenFlow 1.3 or later


Is that an issue with openvswitch and OpenFlow 1.0?

________________________________
From: Amal KAMMOUN
Sent: Thursday, June 4, 2015 8:47 AM
To: discuss at openvswitch.org
Subject: can't get flow entries


Hello,


I'm installing openvswitch 2.3.1 in ubuntu 14.04. the OpenFlow version is 1.0.

I'm using in my architecture Flowvisor and Floodlight.

My problem is that I don't get any flow entry in my switch!

How can I configure the switch so that it can get flow entries in its table?


Thank you,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/635dbaf3/attachment.html>

From hardik.soni at inria.fr  Fri Jun  5 02:05:45 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Fri, 5 Jun 2015 11:05:45 +0200 (CEST)
Subject: [ovs-discuss] "Could not connect to controller (or switch failed
 controller's post-connection admission control policy) for 15 seconds,
 failing open"
In-Reply-To: <1854544431.11902792.1433494972405.JavaMail.zimbra@inria.fr>
Message-ID: <2031050551.11905655.1433495145365.JavaMail.zimbra@inria.fr>

Hi All, 

OVS is not able to connect to any controllers(opendaylight n floodlight). 
I am seeing following messages in ovs-vswitchd.log. 

I have checked all baisc settings of iptables, firewalld etc etc. 
On controller machine netstate -an shows the "tcp 0.0.0.0:6633" in listen mode. 

Anyone has faced this before? 

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
2015-06-05T08:24:07.575Z|00001|vlog|INFO|opened log file /root/ovs230build/ovs-vswitchd.log 
2015-06-05T08:24:07.577Z|00002|reconnect|INFO|unix:/root/ovs230build/var/run/openvswitch/db.sock: connecting... 
2015-06-05T08:24:07.577Z|00003|reconnect|INFO|unix:/root/ovs230build/var/run/openvswitch/db.sock: connected 
2015-06-05T08:24:07.578Z|00004|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.0 
2015-06-05T08:24:07.597Z|00005|ofproto_dpif|INFO|system at ovs-system: Datapath supports recirculation 
2015-06-05T08:24:07.597Z|00006|dpif|WARN|system at ovs-system: execute userspace(pid=0,userdata(00000000)) failed (Invalid argument) on packet metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x1234 
2015-06-05T08:24:07.597Z|00007|ofproto_dpif|WARN|system at ovs-system: variable-length userdata feature probe failed (Invalid argument) 
2015-06-05T08:24:07.617Z|00008|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00),eth_type(0x8847),mpls(label=0,tc=0,ttl=0,bos=1) 
2015-06-05T08:24:07.617Z|00009|ofproto_dpif|INFO|system at ovs-system: MPLS label stack length probed as 0 
2015-06-05T08:24:07.636Z|00010|bridge|INFO|bridge switch1: added interface switch1 on port 65534 
2015-06-05T08:24:07.636Z|00011|bridge|INFO|bridge switch1: using datapath ID 0000927a4306964b 
2015-06-05T08:24:07.636Z|00012|connmgr|INFO|switch1: added service controller "punix:/root/ovs230build/var/run/openvswitch/switch1.mgmt" 
2015-06-05T08:24:07.641Z|00013|connmgr|INFO|switch1: re-added service controller "punix:/root/ovs230build/var/run/openvswitch/switch1.mgmt" 
2015-06-05T08:24:07.647Z|00014|bridge|INFO|bridge switch1: using datapath ID 0000000000000001 
2015-06-05T08:24:07.650Z|00015|connmgr|INFO|switch1: added primary controller "tcp:172.16.51.1::6633" 
2015-06-05T08:24:07.651Z|00016|rconn|INFO|switch1<->tcp:172.16.51.1::6633: connecting... 
2015-06-05T08:24:07.651Z|00017|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
2015-06-05T08:24:07.665Z|00018|bridge|INFO|bridge switch1: added interface tap1 on port 1 
2015-06-05T08:24:08.173Z|00019|rconn|INFO|switch1<->tcp:172.16.51.1::6633: connecting... 
2015-06-05T08:24:08.173Z|00020|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
2015-06-05T08:24:08.173Z|00021|rconn|INFO|switch1<->tcp:172.16.51.1::6633: waiting 2 seconds before reconnect 
2015-06-05T08:24:09.675Z|00022|bridge|INFO|bridge switch1: added interface tun1 on port 2 
2015-06-05T08:24:10.174Z|00023|rconn|INFO|switch1<->tcp:172.16.51.1::6633: connecting... 
2015-06-05T08:24:10.174Z|00024|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
2015-06-05T08:24:10.174Z|00025|rconn|INFO|switch1<->tcp:172.16.51.1::6633: waiting 4 seconds before reconnect 
2015-06-05T08:24:11.676Z|00026|bridge|INFO|bridge switch1: added interface tun2 on port 3 
2015-06-05T08:24:13.686Z|00027|bridge|INFO|bridge switch1: added interface tun3 on port 4 
2015-06-05T08:24:14.173Z|00028|rconn|INFO|switch1<->tcp:172.16.51.1::6633: connecting... 
2015-06-05T08:24:14.173Z|00029|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
2015-06-05T08:24:14.173Z|00030|rconn|INFO|switch1<->tcp:172.16.51.1::6633: continuing to retry connections in the background but suppressing further logging 
2015-06-05T08:24:17.580Z|00031|memory|INFO|3744 kB peak resident set size after 10.0 seconds 
2015-06-05T08:24:17.580Z|00032|memory|INFO|handlers:8 ofconns:1 ports:5 revalidators:4 rules:5 
2015-06-05T08:24:22.173Z|00033|fail_open|WARN|Could not connect to controller (or switch failed controller's post-connection admission control policy) for 15 seconds, failing open 
2015-06-05T08:24:22.173Z|00034|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
2015-06-05T08:24:30.173Z|00035|rconn|WARN|switch1<->tcp:172.16.51.1::6633: connection dropped (Connection refused) 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/30d9967c/attachment-0001.html>

From amal.kammoun at supcom.tn  Fri Jun  5 03:08:30 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Fri, 5 Jun 2015 10:08:30 +0000
Subject: [ovs-discuss] Buffer size
Message-ID: <AM2PR04MB0914C5331B0792A9C009ACC888B20@AM2PR04MB0914.eurprd04.prod.outlook.com>

Hello,


I want to know the size of an openvswitch buffer? Can we change this value ( have a buffer that can contains 1000 packets) ?


Regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/360dd4d3/attachment.html>

From prask9 at gmail.com  Fri Jun  5 04:51:29 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Fri, 5 Jun 2015 17:21:29 +0530
Subject: [ovs-discuss] Query about active-backup mode in lacp
Message-ID: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>

Hi,
 I have question regarding how active port is selected when bond port
in configured in active-backup. port priority seem to have no effect
on active port selection.

I configured bond port as follows

"ovs-vsctl add-bond br0 bond0 poct0 poct1 bond_mod=active-backup lacp=active
other_config:lacp-time=fast"

and i can see its up

~ # ovs-appctl bond/show bond0
---- bond0 ----
bond_mode: active-backup
bond may use recirculation: no, Recirc-ID : -1
bond-hash-basis: 0
updelay: 0 ms
downdelay: 0 ms
lacp_status: negotiated

slave poct0: enabled
    may_enable: true

slave poct1: enabled
    active slave
    may_enable: true



Now the question, here poct1 is selected as the interface to forward
traffic. But how is this selection made.

i tried to configure the port priority, but port priority is not taken
into consideration.
If i change the port priority of the current active interface, active
interface gets switched. Is this expected behaviour? shouldn't
selection be always based on priority


Here is the behaviour

I change poct1 priority, active interface switches to poct0

~ # ovs-vsctl set interface poct1 other_config:lacp-port-priority=5
~ #
~ # ovs-appctl bond/show bond0
---- bond0 ----
bond_mode: active-backup
bond may use recirculation: no, Recirc-ID : -1
bond-hash-basis: 0
updelay: 0 ms
downdelay: 0 ms
lacp_status: negotiated

slave poct0: enabled
    active slave
    may_enable: true

slave poct1: enabled
    may_enable: true


Now i change priority of poct0, active interface switches to poct1


~ # ovs-vsctl set interface poct0 other_config:lacp-port-priority=4
~ #
~ #
~ # ovs-appctl bond/show bond0
---- bond0 ----
bond_mode: active-backup
bond may use recirculation: no, Recirc-ID : -1
bond-hash-basis: 0
updelay: 0 ms
downdelay: 0 ms
lacp_status: negotiated

slave poct0: enabled
    may_enable: true

slave poct1: enabled
    active slave
    may_enable: true



Please clarify

Thanks,
Prashanth

From ciara.loftus at intel.com  Fri Jun  5 06:50:40 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Fri, 5 Jun 2015 13:50:40 +0000
Subject: [ovs-discuss] [dpdk-ovs] dpdkvhost port not handling arp
 response from kvm guest
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC220567C3F@IRSMSX106.ger.corp.intel.com>
References: <74F120C019F4A64C9B78E802F6AD4CC220567C3F@IRSMSX106.ger.corp.intel.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC220567C6E@IRSMSX106.ger.corp.intel.com>


> Hi,
> 
> I would like to bring up my kvm guest with dpdk vhost interface. Before
> I run qemu, I have added
> dpdkvhost interface in ovs bridge, so as to attach with qemu later (wrt
> INSTALL.DPDK.md).
> 
> Once I created dpdkvhost interface, I noticed that dpdkvhost0 was in
> LINK_DOWN (I think it is
> expected as the device does not exist yet).
Correct.

> 
> ovs-master# ovs-vsctl add-port br0 dpdkvhost0 -- set Interface
> dpdkvhost0 type=dpdkvhost
> 
> ovs-master# ovs-ofctl show br0
> 
> OFPT_FEATURES_REPLY (xid=0x2): dpid:000090e2ba1524ac
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
> ARP_MATCH_IP
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src
> mod_tp_dst
>   1(dpdk0): addr:90:e2:ba:15:24:ac
>       config:     0
>       state:      0
>       current:    10GB-FD
>       supported:  10MB-HD 100MB-HD 1GB-HD COPPER AUTO_NEG
> AUTO_PAUSE
>       speed: 10000 Mbps now, 1000 Mbps max
>   2(dpdkvhost0): addr:00:00:00:00:00:00
>       config:     PORT_DOWN
>       state:      LINK_DOWN                 <<<<<<
>       speed: 0 Mbps now, 0 Mbps max
>   LOCAL(br0): addr:90:e2:ba:15:24:ac
>       config:     0
>       state:      0
>       current:    10MB-FD COPPER
>       speed: 10 Mbps now, 0 Mbps max
> 
>  From ovs-vswitchd.log (with debug info):
> 
> 2015-06-02T14:49:38.149Z|00464|bridge|INFO|bridge br0: added interface
> dpdkvhost0 on port 2
> 2015-06-
> 02T14:49:38.149Z|00465|netlink_socket|DBG|nl_sock_transact_multiple__
> (Success): nl(len:52, type=37(family-defined), flags=1[REQUEST], seq=1a,
> pid=4294962434
> 2015-06-02T14:49:38.149Z|00466|netlink_socket|DBG|nl_sock_recv__
> (Success): nl(len:72, type=2(error), flags=0, seq=1a, pid=4294962434
> error(-2(No such file or directory), in-reply-to(nl(len:52,
> type=37(family-defined), flags=1[REQUEST], seq=1a, pid=4294962434))
> 2015-06-02T14:49:38.149Z|00467|netlink_socket|DBG|received NAK error=0
> (No such file or directory)
> 
> Then I brought up qemu kvm, but still the state of dpdkvhost0 remains
> same. Networking params I used in qemu are:
LINK_DOWN here is still normal behaviour. Since you can see the ARP request on the port, it is safe to assume the port is up.

> 
>       -netdev
> tap,id=hostnet2,script=no,downscript=no,ifname=dpdkvhost0,vhost=on
>       -device
> virtio-net-
> pci,netdev=hostnet2,csum=off,gso=off,guest_tso4=off,guest_tso6=off,gues
> t_ecn=off,id=net2,mac=52:54:00:a3:a3:5d,ioeventfd=on
> 
>       -object
> memory-backend-file,id=mem,size=4096M,mem-
> path=/dev/hugepages,share=on
> -numa node,memdev=mem -mem-prealloc
> 
> Am I missing something here ?
These parameters look ok, although I'm not sure if the ioeventfd=on parameter is needed.

> 
> dpdk0 port is Intel 82599 10Gbps NIC bound on igb_uio driver. VM could
> recieve arp req from remote system (on dpdk0 port), but VM's arp
> response does not seem to cross ovs.
> I did not see any arp response reportedly logged by vswitchd even with
> debug info turned on, or may be that ovs is dropping them internally ?.
> Or, Should dpdkvhost0 be internal port (tap) here for ovs to handle arp
> response from VM ?
This shouldn't be necessary.

> 
> from ovs-ofctl dump-flows:
> NXST_FLOW reply (xid=0x4):
>   cookie=0x0, duration=47.090s, table=0, n_packets=59, n_bytes=3741,
> idle_age=1, in_port=1 actions=output:2
>   cookie=0x0, duration=42.129s, table=0, n_packets=0, n_bytes=0,
> idle_age=42, in_port=2 actions=output:1
> 
> This is blocking the connection to get established with VM (from remote
> system talking through dpdk0).
> 
> My env info:
> Ubuntu 14.10
> ovs-vsctl (Open vSwitch) 2.3.90
> Compiled May 19 2015 04:27:58
> DB Schema 7.12.1
> dpdk-2.0.0
> 
> Any help/pointer to further diagnose is greatly appreciated.

I've created a similar setup on a Fedora system and I unfortunately I cannot reproduce. I have one bridge, with 1 x dpdkport and 1 x dpdkvhost port, and the same flows; in_port=1,output:2 & in_port=2,output:1
I'm using a traffic generator to simulate the ARP request.
On my guest, I bring up the dpdkvhost Ethernet device, assign it an IP address, and "arp -s <IP of sender of ARP req> <MAC of sender of ARP req>"
When I send the ARP req, I see the response going through the switch and back to the traffic generator.

Potentially there is an issue with your OS, I had a quick look and found a post in the discuss archive about a potential problem with Debian/Ubuntu systems and how they handle ARP packets with OVS: http://openvswitch.org/pipermail/discuss/2012-May/007348.html
It is quite old however so I'm not sure if the issue still exists, or if this is relevant to your set up.

> 
> --
> Regards,
> Gowrishankar M

From mark.d.gray at intel.com  Fri Jun  5 07:33:10 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Fri, 5 Jun 2015 14:33:10 +0000
Subject: [ovs-discuss] Open vSwitch Job Opportunities
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E27306A@IRSMSX108.ger.corp.intel.com>

Hi,

We currently have a number of Software Engineering positions at Intel in Ireland. The work is focused on Open vSwitch and Openstack.

The link to the job description is below:

https://intel.taleo.net/careersection/10000/jobdetail.ftl?job=752595

Regards,

Mark

From blp at nicira.com  Fri Jun  5 08:13:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 08:13:58 -0700
Subject: [ovs-discuss] Buffer size
In-Reply-To: <AM2PR04MB0914C5331B0792A9C009ACC888B20@AM2PR04MB0914.eurprd04.prod.outlook.com>
References: <AM2PR04MB0914C5331B0792A9C009ACC888B20@AM2PR04MB0914.eurprd04.prod.outlook.com>
Message-ID: <20150605151358.GB24908@nicira.com>

On Fri, Jun 05, 2015 at 10:08:30AM +0000, Amal KAMMOUN wrote:
> I want to know the size of an openvswitch buffer? Can we change this
> value ( have a buffer that can contains 1000 packets) ?

Which buffer do you mean?

From blp at nicira.com  Fri Jun  5 08:18:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 08:18:58 -0700
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
In-Reply-To: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>
References: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>
Message-ID: <20150605151858.GD24908@nicira.com>

On Fri, Jun 05, 2015 at 07:02:13PM +1200, Tony van der Peet wrote:
> Turns out that the only behaviour change is a slight timing change. If I
> put a 0.2s sleep into the outer loop of the test I can make is pass
> reliably. In other words, the flows are still being deleted correctly, it's
> just that the test is so quick in changing the flows and expecting to be
> able to test the new flow that it's seeing a failure.
> 
> In the real world, there would of course be much less chance of this sort
> of coordination between data and flow changes, so I am satisfied that
> OpenVSwitch continues to operate in the same high quality way that I have
> always experienced.

Does the test have an OpenFlow barrier between the flow table change and
the packet?  I'm considering a change to OVS that would make OVS wait
until datapath flows are up-to-date before replying to a barrier
request.

From blp at nicira.com  Fri Jun  5 08:36:12 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 08:36:12 -0700
Subject: [ovs-discuss] "Could not connect to controller (or switch
 failed controller's post-connection admission control policy) for 15
 seconds, failing open"
In-Reply-To: <2031050551.11905655.1433495145365.JavaMail.zimbra@inria.fr>
References: <1854544431.11902792.1433494972405.JavaMail.zimbra@inria.fr>
 <2031050551.11905655.1433495145365.JavaMail.zimbra@inria.fr>
Message-ID: <20150605153612.GG24908@nicira.com>

On Fri, Jun 05, 2015 at 11:05:45AM +0200, Hardik Soni wrote:
> Hi All, 
> 
> OVS is not able to connect to any controllers(opendaylight n floodlight). 
> I am seeing following messages in ovs-vswitchd.log. 
> 
> I have checked all baisc settings of iptables, firewalld etc etc. 
> On controller machine netstate -an shows the "tcp 0.0.0.0:6633" in listen mode. 
> 
> Anyone has faced this before? 

It looks like you misspelled the controller connection name.  Change the
doubled :: to a single : in tcp:172.16.51.1::6633.

From hardik.soni at inria.fr  Fri Jun  5 08:42:32 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Fri, 5 Jun 2015 17:42:32 +0200 (CEST)
Subject: [ovs-discuss] "Could not connect to controller (or switch
 failed controller's post-connection admission control policy) for 15
 seconds, failing open"
In-Reply-To: <20150605153612.GG24908@nicira.com>
References: <1854544431.11902792.1433494972405.JavaMail.zimbra@inria.fr>
 <2031050551.11905655.1433495145365.JavaMail.zimbra@inria.fr>
 <20150605153612.GG24908@nicira.com>
Message-ID: <960478169.12064495.1433518952106.JavaMail.zimbra@inria.fr>

Indeed.. thanks..

-Hardik Soni

----- Original Message -----
> From: "Ben Pfaff" <blp at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: discuss at openvswitch.org
> Sent: Friday, 5 June, 2015 5:36:12 PM
> Subject: Re: [ovs-discuss] "Could not connect to controller (or switch failed controller's post-connection admission
> control policy) for 15 seconds, failing open"
> 
> On Fri, Jun 05, 2015 at 11:05:45AM +0200, Hardik Soni wrote:
> > Hi All,
> > 
> > OVS is not able to connect to any controllers(opendaylight n floodlight).
> > I am seeing following messages in ovs-vswitchd.log.
> > 
> > I have checked all baisc settings of iptables, firewalld etc etc.
> > On controller machine netstate -an shows the "tcp 0.0.0.0:6633" in listen
> > mode.
> > 
> > Anyone has faced this before?
> 
> It looks like you misspelled the controller connection name.  Change the
> doubled :: to a single : in tcp:172.16.51.1::6633.
> 

From shenwei3 at huawei.com  Thu Jun  4 22:57:31 2015
From: shenwei3 at huawei.com (shenwei (G))
Date: Fri, 5 Jun 2015 05:57:31 +0000
Subject: [ovs-discuss] =?gb2312?b?ob5zZWVraW5nIGhlbHChv3BvcnQtYWRkZWQgZXJy?=
 =?gb2312?b?b3IgJiYgb3BlbmZsb3ctcG9ydCBOdW1iZXIgZXJyb3I=?=
Message-ID: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>

Hi all,
Process &&Question discriptions:
1\ I created tens of devices first (using 'ip' tools)
           Using command: ip link add dev group11_0 type veth peer name group11_1
                  etc
2\add port to bridges that I cteated and set the openflow port number menully
     Using command: ovs-vsctl add-br bridge_1
ovs-vsctl add-port bridge_1 group11_0  -- set Interface group11_0 ofport_request=22
etc
3\when repeated step 2 for half the number of the devices have created,error occurred
     Like: ovs-vsctl: Error detected while setting up 'group71_0'.  See ovs-vswitchd log for details.
           seeinglog(/var/run/openvswitch/ovs-vswitchd.log): 2015-06-04T01:28:22Z|57448|netlink_socket|INFO|netlink dump request error (No such file or directory)
4\at the same time ,when used command â€œovs-ofctl -O OpenFlow13 show bridge_1â€to see the openflow port status,find that there is also no openflow port number created corresponding to the port error occurred.

How could I fix the error?

Ps:
Ovs version&linux kernel version
ovs-vsctl (Open vSwitch) 2.3.1
Linux 2.6.32-431.el6.x86_64
Following is my OVS installation steps:
cd /usr/src/kernels/ovscode_setup_shenli/openvswitch-2.3.1
<1> chmod +x ./configure
<2>./configure --with-linux=/lib/modules/`uname -r`/build
<3> make
<4> make install
<5> rmmod openvswitch.ko
<6>modprobe libcrc32c
<7> insmod datapath/linux/openvswitch.ko
<8> mkdir -p /usr/local/etc/openvswitch
<9> ovsdb-tool create /usr/local/etc/openvswitch/conf.db /usr/local/share/openvswitch/vswitch.ovsschema
<10> ovsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock --remote=db:Open_vSwitch,Open_vSwitch,manager_options --pidfile --detach
<11> ovs-vsctl --no-wait init
<12> ovs-vswitchd --pidfile --detach


Best regards,
Wei shen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/60d5706d/attachment-0001.html>

From abhadra at broadcom.com  Fri Jun  5 01:29:33 2015
From: abhadra at broadcom.com (Abhijit Bhadra)
Date: Fri, 5 Jun 2015 08:29:33 +0000
Subject: [ovs-discuss] Ovs-ofctl interoperability
Message-ID: <7E446A6128134441B5FE3C3D368FE101350F3EAC@SJEXCHMB10.corp.ad.broadcom.com>

Hi,
I'd like to know, can I use old ovs-ofctl(wdp codebase) with new OVS(ovs 2.3.0)? And do I need to advertise the OF variant(1.0 or 1.3) to OVS? If yes then how?

Regards,
Abhijit

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/3a78be34/attachment-0001.html>

From smatov at mirantis.com  Fri Jun  5 01:49:40 2015
From: smatov at mirantis.com (Sergey Matov)
Date: Fri, 5 Jun 2015 11:49:40 +0300
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST usage.
Message-ID: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>

Hello.
I am trying to build VM to VM scheme using Open vSwitch 2.3.9 and DPDK
2.0.0.
After building and installing OVS+DPDK I'm running single bridge with extra
port dpdkvhost type.
I'm using user-defined vhost device called vhost-net1.


#ovs-vswitchd --dpdk --cuse_dev_name vhost-net1 -c 0x01 -n 4 --socket-mem
1024,0 -- unix:/usr/local/var/run/openvswitch/db.sock --pidfile --detach

014d4a3f-0a8a-4d8f-8fc3-222775266ebf
    Bridge "br10"
        Port "dpdkvhost0"
            Interface "dpdkvhost0"
                type: dpdkvhost
        Port "br10"
            Interface "br10"
                type: internal

Then I'm trying to run single KVM VM using qemu 2.0 (pretty old with
-mem-prealloc option)

#/usr/bin/qemu-system-x86_64
 -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none
-mem-path /mnt/huge -numa node,memdev=mem -mem-prealloc -netdev
type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,vhostfd=3
-device
virtio-net-pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off

It runs VM, but raises CPU usage up to 100%
 PID USER      PR  NI    VIRT      RES    SHR S  %CPU %MEM     TIME+
COMMAND

 5895 root        20   0   4296120   9412   2144 S    100.1    0.1
0:52.50   ovs-vswitchd

And dpdkvhost port stays down
#ovs-ofctl show
OFPT_FEATURES_REPLY (xid=0x2): dpid:00003acf36cb6443
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(dpdkvhost0): addr:00:00:00:00:00:00
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(br10): addr:3a:cf:36:cb:64:43
     config:     PORT_DOWN
     state:      LINK_DOWN
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

Reserved 6G of hugepages.
Running on Ubuntu 14.04 3.13.0-53-generic
CPU i5 with 16gb RAM

Does this usage of CPU expected?

And, btw, does I need any extra guest VM configuration to run ping/iperf?
-- 

*Sergey Matov*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/13ca8c5a/attachment.html>

From andrey at xdel.ru  Fri Jun  5 10:02:02 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Fri, 5 Jun 2015 20:02:02 +0300
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
	usage.
In-Reply-To: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
Message-ID: <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>

On Fri, Jun 5, 2015 at 11:49 AM, Sergey Matov <smatov at mirantis.com> wrote:
> Hello.
> I am trying to build VM to VM scheme using Open vSwitch 2.3.9 and DPDK
> 2.0.0.
> After building and installing OVS+DPDK I'm running single bridge with extra
> port dpdkvhost type.
> I'm using user-defined vhost device called vhost-net1.
>
>
> #ovs-vswitchd --dpdk --cuse_dev_name vhost-net1 -c 0x01 -n 4 --socket-mem
> 1024,0 -- unix:/usr/local/var/run/openvswitch/db.sock --pidfile --detach
>
> 014d4a3f-0a8a-4d8f-8fc3-222775266ebf
>     Bridge "br10"
>         Port "dpdkvhost0"
>             Interface "dpdkvhost0"
>                 type: dpdkvhost
>         Port "br10"
>             Interface "br10"
>                 type: internal
>
> Then I'm trying to run single KVM VM using qemu 2.0 (pretty old with
> -mem-prealloc option)
>
> #/usr/bin/qemu-system-x86_64
>  -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
> file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none
> -mem-path /mnt/huge -numa node,memdev=mem -mem-prealloc -netdev
> type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,vhostfd=3
> -device
> virtio-net-pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off
>
> It runs VM, but raises CPU usage up to 100%
>  PID USER      PR  NI    VIRT      RES    SHR S  %CPU %MEM     TIME+
> COMMAND
>  5895 root        20   0   4296120   9412   2144 S    100.1    0.1
> 0:52.50   ovs-vswitchd
>
> And dpdkvhost port stays down
> #ovs-ofctl show
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00003acf36cb6443
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
>  1(dpdkvhost0): addr:00:00:00:00:00:00
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
>  LOCAL(br10): addr:3a:cf:36:cb:64:43
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>
> Reserved 6G of hugepages.
> Running on Ubuntu 14.04 3.13.0-53-generic
> CPU i5 with 16gb RAM
>
> Does this usage of CPU expected?
>
> And, btw, does I need any extra guest VM configuration to run ping/iperf?
> --
>
> Sergey Matov
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


Yes, this is expected behavior. If you followed INSTALL.DPDK, none of
additional steps are required if the switch itself performing in a
standalone mode.

From blp at nicira.com  Fri Jun  5 10:08:27 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 10:08:27 -0700
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
 usage.
In-Reply-To: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
Message-ID: <20150605170827.GL24908@nicira.com>

My understanding is that DPDK always uses 100% CPU, to allow for high
performance.

From blp at nicira.com  Fri Jun  5 21:02:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 21:02:33 -0700
Subject: [ovs-discuss]
 =?utf-8?b?44CQc2Vla2luZyBoZWxw44CRcG9ydC1hZGRlZCBl?=
 =?utf-8?q?rror_=26=26_openflow-port_Number_error?=
In-Reply-To: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
Message-ID: <20150606040233.GC8799@nicira.com>

On Fri, Jun 05, 2015 at 05:57:31AM +0000, shenwei (G) wrote:
>            seeinglog(/var/run/openvswitch/ovs-vswitchd.log): 2015-06-04T01:28:22Z|57448|netlink_socket|INFO|netlink dump request error (No such file or directory)

That is a very strange error.  It indicates something pretty seriously
wrong.  I don't have a good guess as to what, though, because this is
the first time I've seen this error reported.  It makes me wonder
whether you did something really odd, such as running two ovs-vswitchd
processes at once, or removing and reinserting the OVS kernel module
while ovs-vswitchd is running.

From blp at nicira.com  Fri Jun  5 21:11:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 21:11:43 -0700
Subject: [ovs-discuss] Ovs-ofctl interoperability
In-Reply-To: <7E446A6128134441B5FE3C3D368FE101350F3EAC@SJEXCHMB10.corp.ad.broadcom.com>
References: <7E446A6128134441B5FE3C3D368FE101350F3EAC@SJEXCHMB10.corp.ad.broadcom.com>
Message-ID: <20150606041143.GD8799@nicira.com>

On Fri, Jun 05, 2015 at 08:29:33AM +0000, Abhijit Bhadra wrote:
> I'd like to know, can I use old ovs-ofctl(wdp codebase) with new
> OVS(ovs 2.3.0)? 

I don't recommend using anything from wdp for anything.  It is a dead
branch.  The last commit was over 4 years ago.  It lacks 8,320 commits
found on master.  Don't use it.

Still, ovs-ofctl from wdp should interoperate.

> And do I need to advertise the OF variant(1.0 or 1.3) to OVS? If yes
> then how?

wdp only supports OpenFlow 1.0.

From blp at nicira.com  Fri Jun  5 21:12:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 21:12:24 -0700
Subject: [ovs-discuss] can't get flow entries
In-Reply-To: <AM2PR04MB091446283CDD50A841DC8D4388B30@AM2PR04MB0914.eurprd04.prod.outlook.com>
References: <AM2PR04MB091446283CDD50A841DC8D4388B30@AM2PR04MB0914.eurprd04.prod.outlook.com>
Message-ID: <20150606041224.GE8799@nicira.com>

On Thu, Jun 04, 2015 at 08:47:53AM +0000, Amal KAMMOUN wrote:
> I'm installing openvswitch 2.3.1 in ubuntu 14.04. the OpenFlow version is 1.0.
> 
> I'm using in my architecture Flowvisor and Floodlight.
> 
> My problem is that I don't get any flow entry in my switch!
> 
> How can I configure the switch so that it can get flow entries in its table?

Did you tell Flowvisor and Floodlight to install some entries?

From blp at nicira.com  Fri Jun  5 21:28:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 21:28:02 -0700
Subject: [ovs-discuss] Query about active-backup mode in lacp
In-Reply-To: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>
References: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>
Message-ID: <20150606042802.GH8799@nicira.com>

On Fri, Jun 05, 2015 at 05:21:29PM +0530, kunapaneni prashanth wrote:
>  I have question regarding how active port is selected when bond port
> in configured in active-backup. port priority seem to have no effect
> on active port selection.

I don't think OVS has a way to specify a priority.

From blp at nicira.com  Fri Jun  5 22:21:12 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 5 Jun 2015 22:21:12 -0700
Subject: [ovs-discuss] "Too many open files" leads to "Segmentation
	fault"
In-Reply-To: <556F0763.1090407@gmail.com>
References: <556F0763.1090407@gmail.com>
Message-ID: <20150606052112.GF8998@nicira.com>

On Wed, Jun 03, 2015 at 03:55:47PM +0200, ferran wrote:
> Well then, do you think that it's normal to reach the limit of open
> files under these conditions?
> Is there any way to limit this so it doesn't crash?
> And who is openning this file, here?

OVS file usage should be pretty stable under normal conditions; that is,
I would not expect it to open an increasing number of files over time.
The exception is if you add more and more ports or bridges over time,
since each port or bridge requires OVS to use more file descriptors.

When you see this, can you take a look at the files that OVS has open?
e.g. "ls -l /proc/$pid/fd" where $pid is the OVS process ID?  It would
also be a good idea to try this with a more recent version of OVS.

From benoitne at gmail.com  Sat Jun  6 09:13:32 2015
From: benoitne at gmail.com (Ben)
Date: Sat, 06 Jun 2015 18:13:32 +0200
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
Message-ID: <55731C2C.6030100@gmail.com>

Hi!

Working with openvswitch with netctl and I notice a problem when I 
shutdown -r now (strange thing is that I don't have this error when I 
poweroff my unit and start it again in this situation everything is 
working well).
When I shutdown -r now, I am unable to reach my unit, it is like netctl 
tries to add everything again but it has not been deleted correctly before.

Kernel : 4.0.4-2-ARCH
ovs-vsctl (Open vSwitch) 2.3.1
Compiled Dec 12 2014 13:19:48
DB Schema 7.6.2

my netctl configuration :

Description='Trusted Virtual Switch'
Interface=vswitch_trust
Connection=openvswitch
BindsToInterfaces=(eth1 eth2 eth3)
IP=static
Address=('10.20.8.10/24')
#Routes=('192.168.0.0/24 via 192.168.1.2')
Gateway='10.20.8.254'
DNS=('80.67.169.12')

Many thanks for your help!

belette

From blp at nicira.com  Sat Jun  6 12:41:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 6 Jun 2015 12:41:45 -0700
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
In-Reply-To: <55731C2C.6030100@gmail.com>
References: <55731C2C.6030100@gmail.com>
Message-ID: <20150606194145.GC5784@nicira.com>

On Sat, Jun 06, 2015 at 06:13:32PM +0200, Ben wrote:
> Working with openvswitch with netctl and I notice a problem when I shutdown
> -r now (strange thing is that I don't have this error when I poweroff my
> unit and start it again in this situation everything is working well).
> When I shutdown -r now, I am unable to reach my unit, it is like netctl
> tries to add everything again but it has not been deleted correctly before.

I'm confused.  It sounds like you're turning off your computer and
complaining that it no longer works.  Presumably this is not what you
are actually doing, can you explain?

From blp at nicira.com  Sat Jun  6 14:08:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 6 Jun 2015 14:08:49 -0700
Subject: [ovs-discuss] OFPBAC_BAD_SET_ARGUMENT received when set field
 of vlan id
In-Reply-To: <CAN2QyzYB1j2t8LwAWXgtJ--adPHDseOgpSaxE9eNu_BXOJbCdA@mail.gmail.com>
References: <CAN2QyzYB1j2t8LwAWXgtJ--adPHDseOgpSaxE9eNu_BXOJbCdA@mail.gmail.com>
Message-ID: <20150606210849.GH5784@nicira.com>

On Fri, May 29, 2015 at 02:41:33PM +0800, Vinllen Chen wrote:
> Hi, Dear all:
> 
>     I use the openflow13, ovs2.3 and ryu controller, and i send flow mod
> message from controller to ovs:
> 
> "match":
>             {
>             "in_port" : "2",
>             "vlan_vid" : "0"
>             },
>         "instructions":
>             [
>                 {
>                 "apply":
>                     [
>                         {
>                         "actions":
>                             [
>                             {
>                             "set_field":
>                                 {
>                                 "vlan_vid":"11"
>                                 }
>                             }
>                             ]
>                         }
>                     ]
>                 },
>                 {
>                 "goto":
>                     {
>                     "table":"mac"
>                     }
>                 }
>             ]
> 
>     It receive OFPBAC_BAD_SET_ARGUMENT through wireshark when i send the
> flow_mod message to ovs, but if i cut the apply-action, then i can send the
> flow_mod successfully.
> 
>     Does anyone kowns the problem, i found the question without solution
> posted before at here[1]

Probably you didn't set the OFPVID_PRESENT bit.  The OpenFlow spec says
that's required.

From blp at nicira.com  Sat Jun  6 15:00:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 6 Jun 2015 15:00:58 -0700
Subject: [ovs-discuss] Question on userspace ovs
In-Reply-To: <7A68AA4F-2824-4892-BDEC-D6C24454ECB0@yahoo.com>
References: <2C4BE3F8-36F8-4E33-BABA-7141777ADAF3@yahoo.com>
 <20150601053301.GB4188@nicira.com>
 <7A68AA4F-2824-4892-BDEC-D6C24454ECB0@yahoo.com>
Message-ID: <20150606220058.GS5784@nicira.com>

On Mon, Jun 01, 2015 at 05:15:07PM +0530, OVS wrote:
> I have one more query where need help, why ovs-net and br0, 2 TAP
> interfaces are created and where are they used for? I am looking right
> now for netdev type of bridge. My initial understanding was, any local
> PUNT of packet (e.g. L4 packet need to be sent to local applications)
> will go through local interface of bridge which is TAP interface. And
> by virtue of that, it will follow kernel stack for further
> processing. But i could not understand ovs-net role? Can you please
> brief on this?

The global interface (ovs-netdev, I think) is really there because the
Linux kernel needs such an interface named after the datapath, for
historical backward compatibility reasons, and we haven't bothered to
remove that for the userspace datapath because it is harmless.

> For netdev type of bridge, i guess netlink is not used, because i
> donâ€™t see any kernel configuration needed for this case. Is my
> understanding correct?

Netlink message formatting is used internally within Open vSwitch even
in the userspace case.

From benoitne at gmail.com  Sat Jun  6 17:15:27 2015
From: benoitne at gmail.com (Ben)
Date: Sun, 07 Jun 2015 02:15:27 +0200
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
In-Reply-To: <20150606194145.GC5784@nicira.com>
References: <55731C2C.6030100@gmail.com> <20150606194145.GC5784@nicira.com>
Message-ID: <55738D1F.1020804@gmail.com>

Hi Ben,

I have probably not been too accurate, let me try to explain:
I am using netcl to manage my network connection.
I have created one file in /etc/netctl named vswitch_trust

nano /etc/netctl/vswitch_trust
Description='Trusted Virtual Switch'
Interface=vswitch_trust
Connection=openvswitch
BindsToInterfaces=(eth1 eth2 eth3)
IP=static
Address=('10.20.8.10/24')
#Routes=('192.168.0.0/24 via 192.168.1.2')
Gateway='10.20.8.254'
DNS=('80.67.169.12')

Then I activated it with netctl enable vswitch_trust, then I should be 
able to retrieve everything when my computer boots.
I can confirm that it is working correctly when my computer is poweroff 
and I power on then all my openvswitch configuration came back with the 
information I put on my vswitch_trust file.
The problem is when I am on my computer and decide to do a reboot 
(shutdown -r now), then when the computer is rebooting all the rules are 
back but impossible to ping it not to ping external from the computer.

To summarize when my computer goes from poweroff to power on everything 
is ok but when I decide to reboot the computer then after the reboot my 
interface is not responding at all. (I need to do a manual netctl stop 
vswitch_trust and netctl start vswitch_trust to make it work)

On 06/06/15 21:41, Ben Pfaff wrote:
> On Sat, Jun 06, 2015 at 06:13:32PM +0200, Ben wrote:
>> Working with openvswitch with netctl and I notice a problem when I shutdown
>> -r now (strange thing is that I don't have this error when I poweroff my
>> unit and start it again in this situation everything is working well).
>> When I shutdown -r now, I am unable to reach my unit, it is like netctl
>> tries to add everything again but it has not been deleted correctly before.
> I'm confused.  It sounds like you're turning off your computer and
> complaining that it no longer works.  Presumably this is not what you
> are actually doing, can you explain?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150607/7b97cf74/attachment.html>

From tony.vanderpeet at gmail.com  Sun Jun  7 01:28:13 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Sun, 7 Jun 2015 20:28:13 +1200
Subject: [ovs-discuss] Behaviour change in OpenVSwitch
In-Reply-To: <20150605151858.GD24908@nicira.com>
References: <CAKL=qh8B0j-VJoAM3szW=EGSx+HJAQ_8ZJ3r4dZHO-6E0Cm7CQ@mail.gmail.com>
 <20150605151858.GD24908@nicira.com>
Message-ID: <CAKL=qh8DTLeqYoWN6MFLY8S-eN8x3592P+DgpF=tMj4T7ii8QQ@mail.gmail.com>

The test is basic.OutputExact in oftest, which is on GitHub at:

https://github.com/floodlight/oftest/blob/master/tests-1.3/basic.py

Yes, it does have a barrier between adding the flow and verifying packets,
so your idea would seem to be not only a total fix, but also the most
elegant way to do it.

To answer Alex in the same email:

1 - Yes, a flow remove would also fix it, although I'm not sure whether
this would make the timing of deleting the dpif flows any faster. But since
we're trying to use oftest without too many mods, and *not* doing the flow
remove actually tests something else (that changing a flow actually changes
the flow), which may in fact be the actual test case we are testing, we
really want this to work without the flow remove.

2 - Not sure exactly where I put the sleep in all cases (I intend to fix
our copy of oftest next week at work and may come up with a different
method anyway), but I think from memory that it's after the call to flow
add.

Tony

On Sat, Jun 6, 2015 at 3:18 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Jun 05, 2015 at 07:02:13PM +1200, Tony van der Peet wrote:
> > Turns out that the only behaviour change is a slight timing change. If I
> > put a 0.2s sleep into the outer loop of the test I can make is pass
> > reliably. In other words, the flows are still being deleted correctly,
> it's
> > just that the test is so quick in changing the flows and expecting to be
> > able to test the new flow that it's seeing a failure.
> >
> > In the real world, there would of course be much less chance of this sort
> > of coordination between data and flow changes, so I am satisfied that
> > OpenVSwitch continues to operate in the same high quality way that I have
> > always experienced.
>
> Does the test have an OpenFlow barrier between the flow table change and
> the packet?  I'm considering a change to OVS that would make OVS wait
> until datapath flows are up-to-date before replying to a barrier
> request.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150607/8152dc25/attachment-0001.html>

From blp at nicira.com  Sun Jun  7 08:52:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 7 Jun 2015 08:52:03 -0700
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
In-Reply-To: <55738D1F.1020804@gmail.com>
References: <55731C2C.6030100@gmail.com> <20150606194145.GC5784@nicira.com>
 <55738D1F.1020804@gmail.com>
Message-ID: <20150607155203.GA15830@nicira.com>

It's hard for me to guess whether this is an issue related to netctl or
to openvswitch.  It could be either one, but I would be inclined to
consider netctl first because Open vSwitch doesn't have any problems
with reboots when properly integrated to the software that controls it.

On Sun, Jun 07, 2015 at 02:15:27AM +0200, Ben wrote:
> Hi Ben,
> 
> I have probably not been too accurate, let me try to explain:
> I am using netcl to manage my network connection.
> I have created one file in /etc/netctl named vswitch_trust
> 
> nano /etc/netctl/vswitch_trust
> Description='Trusted Virtual Switch'
> Interface=vswitch_trust
> Connection=openvswitch
> BindsToInterfaces=(eth1 eth2 eth3)
> IP=static
> Address=('10.20.8.10/24')
> #Routes=('192.168.0.0/24 via 192.168.1.2')
> Gateway='10.20.8.254'
> DNS=('80.67.169.12')
> 
> Then I activated it with netctl enable vswitch_trust, then I should be able
> to retrieve everything when my computer boots.
> I can confirm that it is working correctly when my computer is poweroff and
> I power on then all my openvswitch configuration came back with the
> information I put on my vswitch_trust file.
> The problem is when I am on my computer and decide to do a reboot (shutdown
> -r now), then when the computer is rebooting all the rules are back but
> impossible to ping it not to ping external from the computer.
> 
> To summarize when my computer goes from poweroff to power on everything is
> ok but when I decide to reboot the computer then after the reboot my
> interface is not responding at all. (I need to do a manual netctl stop
> vswitch_trust and netctl start vswitch_trust to make it work)
> 
> On 06/06/15 21:41, Ben Pfaff wrote:
> >On Sat, Jun 06, 2015 at 06:13:32PM +0200, Ben wrote:
> >>Working with openvswitch with netctl and I notice a problem when I shutdown
> >>-r now (strange thing is that I don't have this error when I poweroff my
> >>unit and start it again in this situation everything is working well).
> >>When I shutdown -r now, I am unable to reach my unit, it is like netctl
> >>tries to add everything again but it has not been deleted correctly before.
> >I'm confused.  It sounds like you're turning off your computer and
> >complaining that it no longer works.  Presumably this is not what you
> >are actually doing, can you explain?
> 

From prask9 at gmail.com  Sun Jun  7 23:25:21 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Mon, 8 Jun 2015 11:55:21 +0530
Subject: [ovs-discuss] Query about active-backup mode in lacp
In-Reply-To: <20150606042802.GH8799@nicira.com>
References: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>
 <20150606042802.GH8799@nicira.com>
Message-ID: <CABZU2_Q9Kj8U4hA7pH3togA-vdZbOtXrSoiX1L8g+-ShAC+iZQ@mail.gmail.com>

Hi Ben,
 so how do we make sure one port is selected as the main port to pass traffic?

Currently in my setup, with active-backup configuration, for example
poct0 and poct1 part of bond0 on both sides.

I am seeing poct0 is selected as the active port. Peer selects poct1
as active port, causing Tx being done on one port and Rx traffic seen
on another port.

Is there a way to make sure both select one port.


Thank you,
Prashanth

On Sat, Jun 6, 2015 at 9:58 AM, Ben Pfaff <blp at nicira.com> wrote:
> On Fri, Jun 05, 2015 at 05:21:29PM +0530, kunapaneni prashanth wrote:
>>  I have question regarding how active port is selected when bond port
>> in configured in active-backup. port priority seem to have no effect
>> on active port selection.
>
> I don't think OVS has a way to specify a priority.

From ciara.loftus at intel.com  Mon Jun  8 02:26:12 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Mon, 8 Jun 2015 09:26:12 +0000
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
 usage.
In-Reply-To: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC225E91197@IRSMSX106.ger.corp.intel.com>

> 
> Hello.
> I am trying to build VM to VM scheme using Open vSwitch 2.3.9 and DPDK
> 2.0.0.
> After building and installing OVS+DPDK I'm running single bridge with extra
> port dpdkvhost type.
> I'm using user-defined vhost device called vhost-net1.
> 
> 
> #ovs-vswitchd --dpdk --cuse_dev_name vhost-net1 -c 0x01 -n 4 --socket-
> mem 1024,0 -- unix:/usr/local/var/run/openvswitch/db.sock --pidfile --
> detach
> 
> 014d4a3f-0a8a-4d8f-8fc3-222775266ebf
> Â  Â  Bridge "br10"
> Â  Â  Â  Â  Port "dpdkvhost0"
> Â  Â  Â  Â  Â  Â  Interface "dpdkvhost0"
> Â  Â  Â  Â  Â  Â  Â  Â  type: dpdkvhost
> Â  Â  Â  Â  Port "br10"
> Â  Â  Â  Â  Â  Â  Interface "br10"
> Â  Â  Â  Â  Â  Â  Â  Â  type: internal
> 
> Then I'm trying to run single KVM VM using qemu 2.0 (pretty old with -mem-
> prealloc option)

This will not work. If you are using the mem-prealloc & associated arguments you mention below,
you will need to use QEMU v1.6.2. If you wish to use a newer version of QEMU than v1.6.2, you will
need to use at least v2.1.0, with the -object memory-backend-file arguments, as documented in
INSTALL.DPDK.md.

> 
> #/usr/bin/qemu-system-x86_64
> Â -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
> file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none -
> mem-path /mnt/huge -numa node,memdev=mem -mem-prealloc -netdev
> type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,v
> hostfd=3 -device virtio-net-
> pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,gu
> est_tso6=off,guest_ecn=off
> 

[...]

> 
> Does this usage of CPU expected?
> 
> And, btw, does I need any extra guest VM configuration to run ping/iperf?
> --
> 
> Sergey Matov


From gowrishankar.m at linux.vnet.ibm.com  Mon Jun  8 07:37:53 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Mon, 08 Jun 2015 20:07:53 +0530
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
 usage.
In-Reply-To: <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>
Message-ID: <5575A8C1.3090504@linux.vnet.ibm.com>

Hi Andrey/Sergey,
I had posted some problem I am facing on similar topic as below:

http://comments.gmane.org/gmane.linux.network.openvswitch.general/9105

I too observed dpdkhost0 mac of addr:00:00:00:00:00:00 in ovs. I do not 
see packets
sent by VM on this port and seen by ovs (in fact, dump-flows also report 
0 packets).

I am looking for any one opinion on this if dpdkhost0 mac reported is 
expected
(and to quickly debug any other problem there).

I am on qemu 2.1.0 as well.

Thank you,
Gowrishankar

On Friday 05 June 2015 10:32 PM, Andrey Korolyov wrote:
> On Fri, Jun 5, 2015 at 11:49 AM, Sergey Matov <smatov at mirantis.com> wrote:
>> Hello.
>> I am trying to build VM to VM scheme using Open vSwitch 2.3.9 and DPDK
>> 2.0.0.
>> After building and installing OVS+DPDK I'm running single bridge with extra
>> port dpdkvhost type.
>> I'm using user-defined vhost device called vhost-net1.
>>
>>
>> #ovs-vswitchd --dpdk --cuse_dev_name vhost-net1 -c 0x01 -n 4 --socket-mem
>> 1024,0 -- unix:/usr/local/var/run/openvswitch/db.sock --pidfile --detach
>>
>> 014d4a3f-0a8a-4d8f-8fc3-222775266ebf
>>      Bridge "br10"
>>          Port "dpdkvhost0"
>>              Interface "dpdkvhost0"
>>                  type: dpdkvhost
>>          Port "br10"
>>              Interface "br10"
>>                  type: internal
>>
>> Then I'm trying to run single KVM VM using qemu 2.0 (pretty old with
>> -mem-prealloc option)
>>
>> #/usr/bin/qemu-system-x86_64
>>   -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
>> file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none
>> -mem-path /mnt/huge -numa node,memdev=mem -mem-prealloc -netdev
>> type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,vhostfd=3
>> -device
>> virtio-net-pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off
>>
>> It runs VM, but raises CPU usage up to 100%
>>   PID USER      PR  NI    VIRT      RES    SHR S  %CPU %MEM     TIME+
>> COMMAND
>>   5895 root        20   0   4296120   9412   2144 S    100.1    0.1
>> 0:52.50   ovs-vswitchd
>>
>> And dpdkvhost port stays down
>> #ovs-ofctl show
>> OFPT_FEATURES_REPLY (xid=0x2): dpid:00003acf36cb6443
>> n_tables:254, n_buffers:256
>> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
>> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
>>   1(dpdkvhost0): addr:00:00:00:00:00:00
>>       config:     PORT_DOWN
>>       state:      LINK_DOWN
>>       speed: 0 Mbps now, 0 Mbps max
>>   LOCAL(br10): addr:3a:cf:36:cb:64:43
>>       config:     PORT_DOWN
>>       state:      LINK_DOWN
>>       current:    10MB-FD COPPER
>>       speed: 10 Mbps now, 0 Mbps max
>> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>>
>> Reserved 6G of hugepages.
>> Running on Ubuntu 14.04 3.13.0-53-generic
>> CPU i5 with 16gb RAM
>>
>> Does this usage of CPU expected?
>>
>> And, btw, does I need any extra guest VM configuration to run ping/iperf?
>> --
>>
>> Sergey Matov
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
> Yes, this is expected behavior. If you followed INSTALL.DPDK, none of
> additional steps are required if the switch itself performing in a
> standalone mode.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss



From hardik.soni at inria.fr  Mon Jun  8 08:12:31 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 8 Jun 2015 17:12:31 +0200 (CEST)
Subject: [ovs-discuss] assigning number of cores to datapath
In-Reply-To: <1503265557.12539186.1433776175135.JavaMail.zimbra@inria.fr>
Message-ID: <1670498443.12540216.1433776351253.JavaMail.zimbra@inria.fr>

Hi All, 

How can I assign number of cores to datapath/bridges in the system? 
For example, 
I have 12 core machine. 
2 bridges are created using "ovs-vsctl add-br ...." 
I want to assign 2 cores to each of the bridges. 

Is it possible, directly or indirectly? 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150608/b4e07746/attachment.html>

From blp at nicira.com  Mon Jun  8 08:21:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:21:13 -0700
Subject: [ovs-discuss] assigning number of cores to datapath
In-Reply-To: <1670498443.12540216.1433776351253.JavaMail.zimbra@inria.fr>
References: <1503265557.12539186.1433776175135.JavaMail.zimbra@inria.fr>
 <1670498443.12540216.1433776351253.JavaMail.zimbra@inria.fr>
Message-ID: <20150608152113.GC28071@nicira.com>

On Mon, Jun 08, 2015 at 05:12:31PM +0200, Hardik Soni wrote:
> How can I assign number of cores to datapath/bridges in the system? 
> For example, 
> I have 12 core machine. 
> 2 bridges are created using "ovs-vsctl add-br ...." 
> I want to assign 2 cores to each of the bridges. 
> 
> Is it possible, directly or indirectly? 

The kernel datapath doesn't support that.  It would generally be a
waste, since switching work doesn't use much CPU time in common
situations.

From andrey at xdel.ru  Mon Jun  8 08:21:14 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Mon, 8 Jun 2015 18:21:14 +0300
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
	usage.
In-Reply-To: <5575A8C1.3090504@linux.vnet.ibm.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>
 <5575A8C1.3090504@linux.vnet.ibm.com>
Message-ID: <CABYiri9XCZs1hzLfC8AWT8Bx2V3zDxC4B4DHSYOJug66H2cH0w@mail.gmail.com>

On Mon, Jun 8, 2015 at 5:37 PM, gowrishankar
<gowrishankar.m at linux.vnet.ibm.com> wrote:
> Hi Andrey/Sergey,
> I had posted some problem I am facing on similar topic as below:
>
> http://comments.gmane.org/gmane.linux.network.openvswitch.general/9105
>
> I too observed dpdkhost0 mac of addr:00:00:00:00:00:00 in ovs. I do not see
> packets
> sent by VM on this port and seen by ovs (in fact, dump-flows also report 0
> packets).
>
> I am looking for any one opinion on this if dpdkhost0 mac reported is
> expected
> (and to quickly debug any other problem there).
>
> I am on qemu 2.1.0 as well.
>
> Thank you,
> Gowrishankar
>

I am not sure that the problem you observing has a same nature as one
described earlier in this topic - by a wild guess it looks like you`ve
missing attachment of a vm` interface to an appropriate file
descriptor. Bringing some bits in (like counters on VM intrerface and
dpdkvhost) would be very helpful. Also I`d suggest you to use a latest
ovs master because it simplified the VM-involved setup even more
lately.

From blp at nicira.com  Mon Jun  8 08:27:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:27:05 -0700
Subject: [ovs-discuss] Ovs-ofctl interoperability
In-Reply-To: <7E446A6128134441B5FE3C3D368FE101350F637B@SJEXCHMB10.corp.ad.broadcom.com>
References: <7E446A6128134441B5FE3C3D368FE101350F3EAC@SJEXCHMB10.corp.ad.broadcom.com>
 <20150606041143.GD8799@nicira.com>
 <7E446A6128134441B5FE3C3D368FE101350F637B@SJEXCHMB10.corp.ad.broadcom.com>
Message-ID: <20150608152705.GD28071@nicira.com>

On Mon, Jun 08, 2015 at 08:02:37AM +0000, Abhijit Bhadra wrote:
> I am using OVS 2.3.0 which supports both 1.0 and 1.3, do I need to
> advertise the variant used by my switch to OVS? If yes, then how?

Please read the FAQ.

### Q: What versions of OpenFlow does Open vSwitch support?

A: The following table lists the versions of OpenFlow supported by
   each version of Open vSwitch:

       Open vSwitch      OF1.0  OF1.1  OF1.2  OF1.3  OF1.4  OF1.5
       ###============   =====  =====  =====  =====  =====  =====
       1.9 and earlier    yes    ---    ---    ---    ---    ---
       1.10               yes    ---    [*]    [*]    ---    ---
       1.11               yes    ---    [*]    [*]    ---    ---
       2.0                yes    [*]    [*]    [*]    ---    ---
       2.1                yes    [*]    [*]    [*]    ---    ---
       2.2                yes    [*]    [*]    [*]    [%]    [*]
       2.3                yes    yes    yes    yes    [*]    [*]

       [*] Supported, with one or more missing features.
       [%] Experimental, unsafe implementation.

   Open vSwitch 2.3 enables OpenFlow 1.0, 1.1, 1.2, and 1.3 by default
   in ovs-vswitchd.  In Open vSwitch 1.10 through 2.2, OpenFlow 1.1,
   1.2, and 1.3 must be enabled manually in ovs-vswitchd.  OpenFlow
   1.4 and 1.5 are also supported, with missing features, in Open
   vSwitch 2.3 and later, but not enabled by default.  In any case,
   the user may override the default:

   - To enable OpenFlow 1.0, 1.1, 1.2, and 1.3 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13

   - To enable OpenFlow 1.0, 1.1, 1.2, 1.3, 1.4, and 1.5 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

   - To enable only OpenFlow 1.0 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10

   All current versions of ovs-ofctl enable only OpenFlow 1.0 by
   default.  Use the -O option to enable support for later versions of
   OpenFlow in ovs-ofctl.  For example:

       ovs-ofctl -O OpenFlow13 dump-flows br0

   (Open vSwitch 2.2 had an experimental implementation of OpenFlow
   1.4 that could cause crashes.  We don't recommend enabling it.)

   [OPENFLOW-1.1+.md] in the Open vSwitch source tree tracks support for
   OpenFlow 1.1 and later features.  When support for OpenFlow 1.4 and
   1.5 is solidly implemented, Open vSwitch will enable those version
   by default.  Also, the OpenFlow 1.5 specification is still under
   development and thus subject to change.

From blp at nicira.com  Mon Jun  8 08:28:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:28:48 -0700
Subject: [ovs-discuss] Query about active-backup mode in lacp
In-Reply-To: <CABZU2_Q9Kj8U4hA7pH3togA-vdZbOtXrSoiX1L8g+-ShAC+iZQ@mail.gmail.com>
References: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>
 <20150606042802.GH8799@nicira.com>
 <CABZU2_Q9Kj8U4hA7pH3togA-vdZbOtXrSoiX1L8g+-ShAC+iZQ@mail.gmail.com>
Message-ID: <20150608152848.GE28071@nicira.com>

On Mon, Jun 08, 2015 at 11:55:21AM +0530, kunapaneni prashanth wrote:
>  so how do we make sure one port is selected as the main port to pass
>  traffic?
> 
> Currently in my setup, with active-backup configuration, for example
> poct0 and poct1 part of bond0 on both sides.
> 
> I am seeing poct0 is selected as the active port. Peer selects poct1
> as active port, causing Tx being done on one port and Rx traffic seen
> on another port.
> 
> Is there a way to make sure both select one port.

An active-backup bond is meant to be connected to a MAC-learning switch,
which should not have a bond configured.

From blp at nicira.com  Mon Jun  8 08:30:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:30:58 -0700
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSNOiAg44CQc2Vla2luZyBoZWxw44CRcG9y?=
 =?utf-8?q?t-added_error_=26=26_openflow-port_Number_error?=
In-Reply-To: <85A20DEA89D668448D376D1D8313346ACBFABD@SZXEML503-MBS.china.huawei.com>
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
 <20150606040233.GC8799@nicira.com>
 <85A20DEA89D668448D376D1D8313346ACBFABD@SZXEML503-MBS.china.huawei.com>
Message-ID: <20150608153058.GF28071@nicira.com>

On Mon, Jun 08, 2015 at 01:51:59AM +0000, shenwei (G) wrote:
> >>such as running two ovs-vswitchd processes at once, or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
>   How to confirm if there are two ovs-vswitchd processes running at once ?

Does "ps" show multiple ovs-vswitchd processes?

> >> or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
>   Before reinserting a new ovs kernel module(using insmod openvswitch.ko) every time ,I just rmmoded the openvswitch.ko first.Is this right?
>   How to stop the running ovs-vswitchd? 

"kill"?

From benoitne at gmail.com  Mon Jun  8 08:31:25 2015
From: benoitne at gmail.com (Ben)
Date: Mon, 08 Jun 2015 17:31:25 +0200
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
In-Reply-To: <20150607155203.GA15830@nicira.com>
References: <55731C2C.6030100@gmail.com> <20150606194145.GC5784@nicira.com>
 <55738D1F.1020804@gmail.com> <20150607155203.GA15830@nicira.com>
Message-ID: <5575B54D.8060600@gmail.com>

Thanks for your reply.
If I remember well openvswitch keeps the configuration even after a 
reboot, perhaps the issue is caused by netctl which tries to erase 
everything again? (then if it is the case it should have a difference 
between reboot and starting from a cold start).

By the way speaking about netctl I am using this :

nano /etc/netctl/vswitch_trust
Description='Trusted Virtual Switch'
Interface=vswitch_trust
Connection=openvswitch
BindsToInterfaces=(eth1 eth2 eth3)
IP=static
Address=('10.20.8.10/24')
#Routes=('192.168.0.0/24 via 192.168.1.2')
Gateway='10.20.8.254'
DNS=('80.67.169.12')

Do you know if it is possible to indicate some vlan tag for eth1 eth2 
eth3 directly in netctl conf?
I am asking this because apparently openvswitch is supported as I am 
using Connection=openvswitch.

Many thanks

Ben

On 07/06/15 17:52, Ben Pfaff wrote:
> It's hard for me to guess whether this is an issue related to netctl or
> to openvswitch.  It could be either one, but I would be inclined to
> consider netctl first because Open vSwitch doesn't have any problems
> with reboots when properly integrated to the software that controls it.
>
> On Sun, Jun 07, 2015 at 02:15:27AM +0200, Ben wrote:
>> Hi Ben,
>>
>> I have probably not been too accurate, let me try to explain:
>> I am using netcl to manage my network connection.
>> I have created one file in /etc/netctl named vswitch_trust
>>
>> nano /etc/netctl/vswitch_trust
>> Description='Trusted Virtual Switch'
>> Interface=vswitch_trust
>> Connection=openvswitch
>> BindsToInterfaces=(eth1 eth2 eth3)
>> IP=static
>> Address=('10.20.8.10/24')
>> #Routes=('192.168.0.0/24 via 192.168.1.2')
>> Gateway='10.20.8.254'
>> DNS=('80.67.169.12')
>>
>> Then I activated it with netctl enable vswitch_trust, then I should be able
>> to retrieve everything when my computer boots.
>> I can confirm that it is working correctly when my computer is poweroff and
>> I power on then all my openvswitch configuration came back with the
>> information I put on my vswitch_trust file.
>> The problem is when I am on my computer and decide to do a reboot (shutdown
>> -r now), then when the computer is rebooting all the rules are back but
>> impossible to ping it not to ping external from the computer.
>>
>> To summarize when my computer goes from poweroff to power on everything is
>> ok but when I decide to reboot the computer then after the reboot my
>> interface is not responding at all. (I need to do a manual netctl stop
>> vswitch_trust and netctl start vswitch_trust to make it work)
>>
>> On 06/06/15 21:41, Ben Pfaff wrote:
>>> On Sat, Jun 06, 2015 at 06:13:32PM +0200, Ben wrote:
>>>> Working with openvswitch with netctl and I notice a problem when I shutdown
>>>> -r now (strange thing is that I don't have this error when I poweroff my
>>>> unit and start it again in this situation everything is working well).
>>>> When I shutdown -r now, I am unable to reach my unit, it is like netctl
>>>> tries to add everything again but it has not been deleted correctly before.
>>> I'm confused.  It sounds like you're turning off your computer and
>>> complaining that it no longer works.  Presumably this is not what you
>>> are actually doing, can you explain?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150608/341241b5/attachment-0001.html>

From blp at nicira.com  Mon Jun  8 08:31:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:31:43 -0700
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSNOiAg44CQc2Vla2luZyBoZWxw44CRcG9y?=
 =?utf-8?q?t-added_error_=26=26_openflow-port_Number_error?=
In-Reply-To: <85A20DEA89D668448D376D1D8313346ACBFB16@SZXEML503-MBS.china.huawei.com>
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
 <20150606040233.GC8799@nicira.com>
 <85A20DEA89D668448D376D1D8313346ACBFB16@SZXEML503-MBS.china.huawei.com>
Message-ID: <20150608153143.GG28071@nicira.com>

On Mon, Jun 08, 2015 at 11:00:27AM +0000, shenwei (G) wrote:
> As below ,I have got more details about the problem.
>  
> 1\ the total number of ports added to OVS bridge successfully is fixed. only when deleted one port(using ovs-vsctl del-port bridge_1 group11_0),another port could be added.
> 2\ when I set the veth interfaces as internal mode (ovs-vsctl set Interface group12_0 type=internal),all the ports can be added to the OVS bridge successfully. but openflow port number can`t be created at this time.

Are you running out of file descriptors?

From blp at nicira.com  Mon Jun  8 08:34:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:34:02 -0700
Subject: [ovs-discuss] netctl & openvswitch after shutdown -r now
In-Reply-To: <5575B54D.8060600@gmail.com>
References: <55731C2C.6030100@gmail.com> <20150606194145.GC5784@nicira.com>
 <55738D1F.1020804@gmail.com> <20150607155203.GA15830@nicira.com>
 <5575B54D.8060600@gmail.com>
Message-ID: <20150608153402.GH28071@nicira.com>

On Mon, Jun 08, 2015 at 05:31:25PM +0200, Ben wrote:
> Thanks for your reply.
> If I remember well openvswitch keeps the configuration even after a reboot,
> perhaps the issue is caused by netctl which tries to erase everything again?
> (then if it is the case it should have a difference between reboot and
> starting from a cold start).

It could be.  OVS can be started in a mode where it retains the previous
configuration after reboot, or in one where it deletes the bridges on
reboot.  In the latter mode, one passes --delete-bridges to the ovs-ctl
script.

> By the way speaking about netctl I am using this :
> 
> nano /etc/netctl/vswitch_trust
> Description='Trusted Virtual Switch'
> Interface=vswitch_trust
> Connection=openvswitch
> BindsToInterfaces=(eth1 eth2 eth3)
> IP=static
> Address=('10.20.8.10/24')
> #Routes=('192.168.0.0/24 via 192.168.1.2')
> Gateway='10.20.8.254'
> DNS=('80.67.169.12')
> 
> Do you know if it is possible to indicate some vlan tag for eth1 eth2 eth3
> directly in netctl conf?
> I am asking this because apparently openvswitch is supported as I am using
> Connection=openvswitch.

I don't use netctl.  I recommend asking about netctl on a mailing list
specialized for it.

From hardik.soni at inria.fr  Mon Jun  8 08:45:43 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 8 Jun 2015 17:45:43 +0200 (CEST)
Subject: [ovs-discuss] assigning number of cores to datapath
In-Reply-To: <20150608152113.GC28071@nicira.com>
References: <1503265557.12539186.1433776175135.JavaMail.zimbra@inria.fr>
 <1670498443.12540216.1433776351253.JavaMail.zimbra@inria.fr>
 <20150608152113.GC28071@nicira.com>
Message-ID: <955399342.12553073.1433778343414.JavaMail.zimbra@inria.fr>

Okay. I understand that switching doesnt take much time. 
But what about flowtable update in kernel datapath from userspace.

I was not elaborate in my question, I have following scenario.
I want to run 2 ovs-switch instances on single machine. But, they should not affect each other's performance.
So, I thought if I can assign # of physical cores to them..
I am using Open Vswitch with kernel module.

Thanks,
Hardik Soni

----- Original Message -----
> From: "Ben Pfaff" <blp at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: discuss at openvswitch.org
> Sent: Monday, 8 June, 2015 5:21:13 PM
> Subject: Re: [ovs-discuss] assigning number of cores to datapath
> 
> On Mon, Jun 08, 2015 at 05:12:31PM +0200, Hardik Soni wrote:
> > How can I assign number of cores to datapath/bridges in the system?
> > For example,
> > I have 12 core machine.
> > 2 bridges are created using "ovs-vsctl add-br ...."
> > I want to assign 2 cores to each of the bridges.
> > 
> > Is it possible, directly or indirectly?
> 
> The kernel datapath doesn't support that.  It would generally be a
> waste, since switching work doesn't use much CPU time in common
> situations.
> 

From blp at nicira.com  Mon Jun  8 08:47:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 8 Jun 2015 08:47:42 -0700
Subject: [ovs-discuss] assigning number of cores to datapath
In-Reply-To: <955399342.12553073.1433778343414.JavaMail.zimbra@inria.fr>
References: <1503265557.12539186.1433776175135.JavaMail.zimbra@inria.fr>
 <1670498443.12540216.1433776351253.JavaMail.zimbra@inria.fr>
 <20150608152113.GC28071@nicira.com>
 <955399342.12553073.1433778343414.JavaMail.zimbra@inria.fr>
Message-ID: <20150608154742.GI28071@nicira.com>

On Mon, Jun 08, 2015 at 05:45:43PM +0200, Hardik Soni wrote:
> Okay. I understand that switching doesnt take much time. 
> But what about flowtable update in kernel datapath from userspace.
> 
> I was not elaborate in my question, I have following scenario.
> I want to run 2 ovs-switch instances on single machine. But, they should not affect each other's performance.
> So, I thought if I can assign # of physical cores to them..
> I am using Open Vswitch with kernel module.

I believe that you can do that if you run them in different network
namespaces.  Container systems such as Docker might be a reasonable way
to do that.

From lucabianchi91 at hotmail.it  Fri Jun  5 10:19:14 2015
From: lucabianchi91 at hotmail.it (Luca Bianchi)
Date: Fri, 5 Jun 2015 19:19:14 +0200
Subject: [ovs-discuss] prio scheduler
Message-ID: <DUB127-W2D0E12EA66EF3BAE259D4C6B20@phx.gbl>




Hi,
I am trying to configure QoS on OVS, running on mininet network.

I install a PRIO qdisc on an interface with the command

tc qdisc add dev s1-eth4 root handle 1: prio

and then the classes 1:1, 1:2, 1:3 are automatically created.

The problem is that every user flow passing from that interface now has the whole interface capacity.

E.g. 3 user TCP flows pass from this interface (link of capacity 10Mbps), everyone
is served with 10Mbps...that is impossible. With htb qdisc (also if configured with tc commands)
there are no problems.

Thank you very much
Best regards

Luca Bianchi
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150605/0a58c220/attachment-0001.html>

From shenwei3 at huawei.com  Sun Jun  7 18:51:59 2015
From: shenwei3 at huawei.com (shenwei (G))
Date: Mon, 8 Jun 2015 01:51:59 +0000
Subject: [ovs-discuss] =?gb2312?b?tPC4tDogIKG+c2Vla2luZyBoZWxwob9wb3J0LWFk?=
 =?gb2312?b?ZGVkIGVycm9yICYmIG9wZW5mbG93LXBvcnQgTnVtYmVyIGVycm9y?=
In-Reply-To: <20150606040233.GC8799@nicira.com>
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
 <20150606040233.GC8799@nicira.com>
Message-ID: <85A20DEA89D668448D376D1D8313346ACBFABD@SZXEML503-MBS.china.huawei.com>

Hi Ben,
Thank you very much for your reply!


>>such as running two ovs-vswitchd processes at once, or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
  How to confirm if there are two ovs-vswitchd processes running at once ?

>> or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
  Before reinserting a new ovs kernel module(using insmod openvswitch.ko) every time ,I just rmmoded the openvswitch.ko first.Is this right?
  How to stop the running ovs-vswitchd? 

Look forward to your reply again.

Best regards.
Wei Shen



-----é‚®ä»¶åŽŸä»¶-----
å‘ä»¶äºº: Ben Pfaff [mailto:blp at nicira.com] 
å‘é€æ—¶é—´: 2015å¹´6æœˆ6æ—¥ 12:03
æ”¶ä»¶äºº: shenwei (G)
æŠ„é€: discuss at openvswitch.org
ä¸»é¢˜: Re: [ovs-discuss] ã€seeking helpã€‘port-added error && openflow-port Number error

On Fri, Jun 05, 2015 at 05:57:31AM +0000, shenwei (G) wrote:
>            seeinglog(/var/run/openvswitch/ovs-vswitchd.log): 
> 2015-06-04T01:28:22Z|57448|netlink_socket|INFO|netlink dump request 
> error (No such file or directory)

That is a very strange error.  It indicates something pretty seriously wrong.  I don't have a good guess as to what, though, because this is the first time I've seen this error reported.  It makes me wonder whether you did something really odd, such as running two ovs-vswitchd processes at once, or removing and reinserting the OVS kernel module while ovs-vswitchd is running.

From harshjain.prof at gmail.com  Mon Jun  8 00:19:36 2015
From: harshjain.prof at gmail.com (Harsh Jain)
Date: Mon, 8 Jun 2015 12:49:36 +0530
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to identify
	flow type in kernel
Message-ID: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>

Hi,


While trying to encrypt(IPsec policy) packets  based on GRE key
received in packets. kernel didn't encrypted the packets received from
OVS bridge. The packets forwarded to Desination unencrypted.
Kernel treats packet having different keys as same flow type.


Kernel Version used : 3.18.14
ovs-vswitchd (Open vSwitch) 2.0.1
Compiled Apr 16 2014 14:19:17
OpenFlow versions 0x1:0x1

Fix Applied :  Find attached initial patch.

Please confirm if it is bug?.


Regards
Harsh Jain
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gre_key.patch
Type: text/x-patch
Size: 527 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150608/ffd5acfe/attachment.bin>

From abhadra at broadcom.com  Mon Jun  8 01:02:37 2015
From: abhadra at broadcom.com (Abhijit Bhadra)
Date: Mon, 8 Jun 2015 08:02:37 +0000
Subject: [ovs-discuss] Ovs-ofctl interoperability
In-Reply-To: <20150606041143.GD8799@nicira.com>
References: <7E446A6128134441B5FE3C3D368FE101350F3EAC@SJEXCHMB10.corp.ad.broadcom.com>
 <20150606041143.GD8799@nicira.com>
Message-ID: <7E446A6128134441B5FE3C3D368FE101350F637B@SJEXCHMB10.corp.ad.broadcom.com>

Thanks Ben,
I am using OVS 2.3.0 which supports both 1.0 and 1.3, do I need to advertise the variant used by my switch to OVS? If yes, then how?
Regards,
Abhijit



-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Saturday, June 06, 2015 9:42 AM
To: Abhijit Bhadra
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Ovs-ofctl interoperability

On Fri, Jun 05, 2015 at 08:29:33AM +0000, Abhijit Bhadra wrote:
> I'd like to know, can I use old ovs-ofctl(wdp codebase) with new
> OVS(ovs 2.3.0)? 

I don't recommend using anything from wdp for anything.  It is a dead
branch.  The last commit was over 4 years ago.  It lacks 8,320 commits
found on master.  Don't use it.

Still, ovs-ofctl from wdp should interoperate.

> And do I need to advertise the OF variant(1.0 or 1.3) to OVS? If yes
> then how?

wdp only supports OpenFlow 1.0.

From shenwei3 at huawei.com  Mon Jun  8 04:00:27 2015
From: shenwei3 at huawei.com (shenwei (G))
Date: Mon, 8 Jun 2015 11:00:27 +0000
Subject: [ovs-discuss] =?gb2312?b?tPC4tDogIKG+c2Vla2luZyBoZWxwob9wb3J0LWFk?=
 =?gb2312?b?ZGVkIGVycm9yICYmIG9wZW5mbG93LXBvcnQgTnVtYmVyIGVycm9y?=
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
 <20150606040233.GC8799@nicira.com> 
Message-ID: <85A20DEA89D668448D376D1D8313346ACBFB16@SZXEML503-MBS.china.huawei.com>

Hi Ben,

As below ,I have got more details about the problem.
 
1\ the total number of ports added to OVS bridge successfully is fixed. only when deleted one port(using ovs-vsctl del-port bridge_1 group11_0),another port could be added.
2\ when I set the veth interfaces as internal mode (ovs-vsctl set Interface group12_0 type=internal),all the ports can be added to the OVS bridge successfully. but openflow port number can`t be created at this time.

Best regards
Wei Shen


-----é‚®ä»¶åŽŸä»¶-----
å‘ä»¶äºº: shenwei (G) 
å‘é€æ—¶é—´: 2015å¹´6æœˆ8æ—¥ 9:52
æ”¶ä»¶äºº: 'Ben Pfaff'
æŠ„é€: discuss at openvswitch.org
ä¸»é¢˜: ç­”å¤: [ovs-discuss] ã€seeking helpã€‘port-added error && openflow-port Number error

Hi Ben,
Thank you very much for your reply!


>>such as running two ovs-vswitchd processes at once, or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
  How to confirm if there are two ovs-vswitchd processes running at once ?

>> or removing and reinserting the OVS kernel module while ovs-vswitchd is running.
  Before reinserting a new ovs kernel module(using insmod openvswitch.ko) every time ,I just rmmoded the openvswitch.ko first.Is this right?
  How to stop the running ovs-vswitchd? 

Look forward to your reply again.

Best regards.
Wei Shen



-----é‚®ä»¶åŽŸä»¶-----
å‘ä»¶äºº: Ben Pfaff [mailto:blp at nicira.com]
å‘é€æ—¶é—´: 2015å¹´6æœˆ6æ—¥ 12:03
æ”¶ä»¶äºº: shenwei (G)
æŠ„é€: discuss at openvswitch.org
ä¸»é¢˜: Re: [ovs-discuss] ã€seeking helpã€‘port-added error && openflow-port Number error

On Fri, Jun 05, 2015 at 05:57:31AM +0000, shenwei (G) wrote:
>            seeinglog(/var/run/openvswitch/ovs-vswitchd.log): 
> 2015-06-04T01:28:22Z|57448|netlink_socket|INFO|netlink dump request 
> error (No such file or directory)

That is a very strange error.  It indicates something pretty seriously wrong.  I don't have a good guess as to what, though, because this is the first time I've seen this error reported.  It makes me wonder whether you did something really odd, such as running two ovs-vswitchd processes at once, or removing and reinserting the OVS kernel module while ovs-vswitchd is running.

From aatteka at nicira.com  Mon Jun  8 13:37:29 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Mon, 8 Jun 2015 13:37:29 -0700
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
Message-ID: <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>

On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
> Hi,
>
>
> While trying to encrypt(IPsec policy) packets  based on GRE key
> received in packets. kernel didn't encrypted the packets received from
> OVS bridge. The packets forwarded to Desination unencrypted.
> Kernel treats packet having different keys as same flow type.

It seems that you are not using ovs-monitor-ipsec to install IPsec
policies for you?

>
>
> Kernel Version used : 3.18.14
> ovs-vswitchd (Open vSwitch) 2.0.1
> Compiled Apr 16 2014 14:19:17
> OpenFlow versions 0x1:0x1
>
> Fix Applied :  Find attached initial patch.
>
> Please confirm if it is bug?.

I think this could be classified as bug for those use cases when one
wants to install such fine grained IPsec policies based on GRE key.
BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.


>
>
> Regards
> Harsh Jain
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From prask9 at gmail.com  Mon Jun  8 23:47:31 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Tue, 9 Jun 2015 12:17:31 +0530
Subject: [ovs-discuss] Query about active-backup mode in lacp
In-Reply-To: <20150608152848.GE28071@nicira.com>
References: <CABZU2_T1vEPrU5jbbyrzeZHTaNuHS89DkMj+8zcU6siweGae=w@mail.gmail.com>
 <20150606042802.GH8799@nicira.com>
 <CABZU2_Q9Kj8U4hA7pH3togA-vdZbOtXrSoiX1L8g+-ShAC+iZQ@mail.gmail.com>
 <20150608152848.GE28071@nicira.com>
Message-ID: <CABZU2_Q8q5EhaKvx3Ge90m3qd3LNN0DPXeGZtF2UTHidVJMppQ@mail.gmail.com>

Hi Ben,
 Thank you for clarifying.

On Mon, Jun 8, 2015 at 8:58 PM, Ben Pfaff <blp at nicira.com> wrote:
> On Mon, Jun 08, 2015 at 11:55:21AM +0530, kunapaneni prashanth wrote:
>>  so how do we make sure one port is selected as the main port to pass
>>  traffic?
>>
>> Currently in my setup, with active-backup configuration, for example
>> poct0 and poct1 part of bond0 on both sides.
>>
>> I am seeing poct0 is selected as the active port. Peer selects poct1
>> as active port, causing Tx being done on one port and Rx traffic seen
>> on another port.
>>
>> Is there a way to make sure both select one port.
>
> An active-backup bond is meant to be connected to a MAC-learning switch,
> which should not have a bond configured.

From ranker72 at gmail.com  Tue Jun  9 03:29:47 2015
From: ranker72 at gmail.com (ferran)
Date: Tue, 09 Jun 2015 12:29:47 +0200
Subject: [ovs-discuss] "Too many open files" leads to "Segmentation
	fault"
In-Reply-To: <20150606052112.GF8998@nicira.com>
References: <556F0763.1090407@gmail.com> <20150606052112.GF8998@nicira.com>
Message-ID: <5576C01B.8060504@gmail.com>

Hi Ben,

Thanks for taking your time with this and other questions. Fortunately,
it was the custom code not closing properly a sockets we use. I disabled
our modifications and it became stable again, so it is internal business
now.

As a reference, I used two programs to monitor the number of open file
descriptors:

# Number of FD owned by ovs
lsof | grep ovs-vswitchd | wc -l

# Total FD amount and related figures
sysctl fs.file-nr | awk '{print $3}'

More dettail here
http://www.cyberciti.biz/tips/linux-procfs-file-descriptors.html

Best regards,
Ferran


On 06/06/15 07:21, Ben Pfaff wrote:
> On Wed, Jun 03, 2015 at 03:55:47PM +0200, ferran wrote:
>> Well then, do you think that it's normal to reach the limit of open
>> files under these conditions?
>> Is there any way to limit this so it doesn't crash?
>> And who is openning this file, here?
> OVS file usage should be pretty stable under normal conditions; that is,
> I would not expect it to open an increasing number of files over time.
> The exception is if you add more and more ports or bridges over time,
> since each port or bridge requires OVS to use more file descriptors.
>
> When you see this, can you take a look at the files that OVS has open?
> e.g. "ls -l /proc/$pid/fd" where $pid is the OVS process ID?  It would
> also be a good idea to try this with a more recent version of OVS.



From nagaravind at gmail.com  Tue Jun  9 13:27:40 2015
From: nagaravind at gmail.com (aravind C)
Date: Tue, 9 Jun 2015 13:27:40 -0700
Subject: [ovs-discuss] Fwd: Support for arp requests with bonding
In-Reply-To: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>
References: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>
Message-ID: <CAJYsdDixj9okH9bDQne1LTjvmjo0nhpTWg_aTX8nAGoqXSFDLg@mail.gmail.com>

Hi,
I am using the following setup to test interface bonding with OVS.

VM1         |       VM2

(10.10.10.2/16)     (10.10.10.3/16)
    eth1 ========== eth1
   /                                 \
  /                                   \
bond0                              bond0
  \                                   /
   \                                 /
    eth2 ========== eth2
(10.10.20.2/16)     (10.10.20.3/16)

I can see that -
1. lacp status is negotiated
2. On both VMs initially eth1 is enabled and eth2 is the active slave

Is my assumption wrong that I should be able to ping either of the
bonded interfaces in VM2 from VM1?
- ping shows that the currently active interface is used to send out requests.
- tcpdump shows that the arp requests are received by the active
interface in VM2. No reply is generated.

Can anyone please explain what is wrong in my
configuration/expectation that arp request should generate a response
in this configuration?

Thanks,
Nagaravind

From saurabh at gmail.com  Tue Jun  9 23:16:34 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Tue, 9 Jun 2015 23:16:34 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
Message-ID: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>

Hi,

When OVSDB server sends updates to an OVSDB client, the IDL changes
idl_seqno. When idl_seqno changes, the client can rebrowse the IDL and look
for changes.

Does OVSDB server guarantee that the updates always maintain referential
integrity for row creation and row updates i.e. if the client browses the
IDL it should never run into a situation where rowA in tableA points to a
non-existent rowB in tableB because the update for rowA has arrived but
update for rowB is still in flight.

If the OVSDB server doesnt guarantee the above, what should the client do
to make sure that IDL is in a consistent state before it is browsed.

Thanks
--
Saurabh (à¤¸à¥Œà¤°à¤­)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150609/ec5fd745/attachment.html>

From tony.vanderpeet at gmail.com  Wed Jun 10 01:50:56 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Wed, 10 Jun 2015 20:50:56 +1200
Subject: [ovs-discuss] New test case - it fails
Message-ID: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>

* git clone carried out Wednesday 10/Jun/2015 (NZ time)
* test case suggested by a failing oftest case
* is this in the correct test file?
* is the test written to the correct standard?
* is it a valid test?
* what other test cases suggest themselves? (the fix is going to involve
*all* IPv6 protocols, not just ICMPv6)
* how do I proceed from here?
* if you apply the patch it should be test #912

Thanks
Tony

diff --git a/tests/ofproto-dpif.at b/tests/ofproto-dpif.at
index bd1b21c..4c3ab94 100644
--- a/tests/ofproto-dpif.at
+++ b/tests/ofproto-dpif.at
@@ -6673,6 +6673,21 @@
icmp6,vlan_tci=0x0000,dl_src=00:00:86:05:80:da,dl_dst=00:60:97:07:69:ea,ipv6_src
 OVS_VSWITCHD_STOP
 AT_CLEANUP

+AT_SETUP([ofproto-dpif - ICMPv6 Code produces correct dpif flow])
+OVS_VSWITCHD_START
+ADD_OF_PORTS([br0], 1, 2)
+
+AT_CHECK([ovs-ofctl add-flow br0
icmp6,icmpv6_code=3,action=output:controller])
+
+ovs-appctl netdev-dummy/receive p1
'0060970769ea0000860580da86dd6000000000203afffe80000000000000020086fffe0580dafe80000000000000026097fffe0769ea020368bd00000000fe80000000000000026097fffe0769ea
+
+AT_CHECK([ovs-appctl dpif/dump-flows br0 | STRIP_UFID | STRIP_USED |
sort], [0], [dnl
+recirc_id(0),in_port(1),eth_type(0x86dd),ipv6(proto=58,frag=no),icmpv6(code=3),
packets:0, bytes:0, used:never,
actions:userspace(pid=0,slow_path(controller))
+])
+
+OVS_VSWITCHD_STOP
+AT_CLEANUP
+
 # Tests the exact match of CFI bit in installed datapath flows matching
VLAN.
 AT_SETUP([ofproto-dpif - vlan matching])
 OVS_VSWITCHD_START(
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/cb5f95a3/attachment.html>

From blp at nicira.com  Wed Jun 10 07:55:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 07:55:20 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
Message-ID: <20150610145520.GB26182@nicira.com>

On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> When OVSDB server sends updates to an OVSDB client, the IDL changes
> idl_seqno. When idl_seqno changes, the client can rebrowse the IDL and look
> for changes.
> 
> Does OVSDB server guarantee that the updates always maintain referential
> integrity for row creation and row updates i.e. if the client browses the
> IDL it should never run into a situation where rowA in tableA points to a
> non-existent rowB in tableB because the update for rowA has arrived but
> update for rowB is still in flight.

Yes.

From blp at nicira.com  Wed Jun 10 08:15:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 08:15:28 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <20150610145520.GB26182@nicira.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com>
Message-ID: <20150610151528.GA673@nicira.com>

On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > When OVSDB server sends updates to an OVSDB client, the IDL changes
> > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL and look
> > for changes.
> > 
> > Does OVSDB server guarantee that the updates always maintain referential
> > integrity for row creation and row updates i.e. if the client browses the
> > IDL it should never run into a situation where rowA in tableA points to a
> > non-existent rowB in tableB because the update for rowA has arrived but
> > update for rowB is still in flight.
> 
> Yes.

I sent out a patch to document this:
        http://openvswitch.org/pipermail/dev/2015-June/056200.html

From gowrishankar.m at linux.vnet.ibm.com  Wed Jun 10 08:35:29 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Wed, 10 Jun 2015 21:05:29 +0530
Subject: [ovs-discuss] [dpdk-ovs] dpdkvhost port not handling arp
 response from kvm guest
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC220567C6E@IRSMSX106.ger.corp.intel.com>
References: <74F120C019F4A64C9B78E802F6AD4CC220567C3F@IRSMSX106.ger.corp.intel.com>
 <74F120C019F4A64C9B78E802F6AD4CC220567C6E@IRSMSX106.ger.corp.intel.com>
Message-ID: <55785941.2050509@linux.vnet.ibm.com>

Hi Ciara,

I switched to Fedora (22) and could get dpdkvhost functioning for VM. I 
could see ARP and
ICMP flying between VM (through dpdkvhost0 - cuse) and remote system 
connected to dpdk0,
but tcp (whether syn or syn-ack) from VM on dpdkvhost0 getting dropped 
inside ovs, it seems.

This problem was discussed earlier in ovs community:
http://openvswitch.org/pipermail/discuss/2015-May/017681.html

I am checking if this is finally fixed in dpdk upstream, after below 
discussion. Anyone aware of ?
http://dpdk.org/ml/archives/dev/2015-May/017919.html

dpdk version of my setup is 2.0.0.

ovs-vsctl (Open vSwitch) 2.3.90
Compiled Jun 10 2015 09:03:00
DB Schema 7.12.1
commit bdd7ecf5bfc4a255872aa60057b3b96f72b47d8a on May/29.

Is tcp working over dpdk 2.0.0 source otherwise (while integrated with 
current ovs-master) ?

Thanks,
Gowri Shankar

On Friday 05 June 2015 07:20 PM, Loftus, Ciara wrote:
>> Hi,
>>
>> I would like to bring up my kvm guest with dpdk vhost interface. Before
>> I run qemu, I have added
>> dpdkvhost interface in ovs bridge, so as to attach with qemu later (wrt
>> INSTALL.DPDK.md).
>>
>> Once I created dpdkvhost interface, I noticed that dpdkvhost0 was in
>> LINK_DOWN (I think it is
>> expected as the device does not exist yet).
> Correct.
>
>> ovs-master# ovs-vsctl add-port br0 dpdkvhost0 -- set Interface
>> dpdkvhost0 type=dpdkvhost
>>
>> ovs-master# ovs-ofctl show br0
>>
>> OFPT_FEATURES_REPLY (xid=0x2): dpid:000090e2ba1524ac
>> n_tables:254, n_buffers:256
>> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
>> ARP_MATCH_IP
>> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
>> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src
>> mod_tp_dst
>>    1(dpdk0): addr:90:e2:ba:15:24:ac
>>        config:     0
>>        state:      0
>>        current:    10GB-FD
>>        supported:  10MB-HD 100MB-HD 1GB-HD COPPER AUTO_NEG
>> AUTO_PAUSE
>>        speed: 10000 Mbps now, 1000 Mbps max
>>    2(dpdkvhost0): addr:00:00:00:00:00:00
>>        config:     PORT_DOWN
>>        state:      LINK_DOWN                 <<<<<<
>>        speed: 0 Mbps now, 0 Mbps max
>>    LOCAL(br0): addr:90:e2:ba:15:24:ac
>>        config:     0
>>        state:      0
>>        current:    10MB-FD COPPER
>>        speed: 10 Mbps now, 0 Mbps max
>>
>>   From ovs-vswitchd.log (with debug info):
>>
>> 2015-06-02T14:49:38.149Z|00464|bridge|INFO|bridge br0: added interface
>> dpdkvhost0 on port 2
>> 2015-06-
>> 02T14:49:38.149Z|00465|netlink_socket|DBG|nl_sock_transact_multiple__
>> (Success): nl(len:52, type=37(family-defined), flags=1[REQUEST], seq=1a,
>> pid=4294962434
>> 2015-06-02T14:49:38.149Z|00466|netlink_socket|DBG|nl_sock_recv__
>> (Success): nl(len:72, type=2(error), flags=0, seq=1a, pid=4294962434
>> error(-2(No such file or directory), in-reply-to(nl(len:52,
>> type=37(family-defined), flags=1[REQUEST], seq=1a, pid=4294962434))
>> 2015-06-02T14:49:38.149Z|00467|netlink_socket|DBG|received NAK error=0
>> (No such file or directory)
>>
>> Then I brought up qemu kvm, but still the state of dpdkvhost0 remains
>> same. Networking params I used in qemu are:
> LINK_DOWN here is still normal behaviour. Since you can see the ARP request on the port, it is safe to assume the port is up.
>
>>        -netdev
>> tap,id=hostnet2,script=no,downscript=no,ifname=dpdkvhost0,vhost=on
>>        -device
>> virtio-net-
>> pci,netdev=hostnet2,csum=off,gso=off,guest_tso4=off,guest_tso6=off,gues
>> t_ecn=off,id=net2,mac=52:54:00:a3:a3:5d,ioeventfd=on
>>
>>        -object
>> memory-backend-file,id=mem,size=4096M,mem-
>> path=/dev/hugepages,share=on
>> -numa node,memdev=mem -mem-prealloc
>>
>> Am I missing something here ?
> These parameters look ok, although I'm not sure if the ioeventfd=on parameter is needed.
>
>> dpdk0 port is Intel 82599 10Gbps NIC bound on igb_uio driver. VM could
>> recieve arp req from remote system (on dpdk0 port), but VM's arp
>> response does not seem to cross ovs.
>> I did not see any arp response reportedly logged by vswitchd even with
>> debug info turned on, or may be that ovs is dropping them internally ?.
>> Or, Should dpdkvhost0 be internal port (tap) here for ovs to handle arp
>> response from VM ?
> This shouldn't be necessary.
>
>> from ovs-ofctl dump-flows:
>> NXST_FLOW reply (xid=0x4):
>>    cookie=0x0, duration=47.090s, table=0, n_packets=59, n_bytes=3741,
>> idle_age=1, in_port=1 actions=output:2
>>    cookie=0x0, duration=42.129s, table=0, n_packets=0, n_bytes=0,
>> idle_age=42, in_port=2 actions=output:1
>>
>> This is blocking the connection to get established with VM (from remote
>> system talking through dpdk0).
>>
>> My env info:
>> Ubuntu 14.10
>> ovs-vsctl (Open vSwitch) 2.3.90
>> Compiled May 19 2015 04:27:58
>> DB Schema 7.12.1
>> dpdk-2.0.0
>>
>> Any help/pointer to further diagnose is greatly appreciated.
> I've created a similar setup on a Fedora system and I unfortunately I cannot reproduce. I have one bridge, with 1 x dpdkport and 1 x dpdkvhost port, and the same flows; in_port=1,output:2 & in_port=2,output:1
> I'm using a traffic generator to simulate the ARP request.
> On my guest, I bring up the dpdkvhost Ethernet device, assign it an IP address, and "arp -s <IP of sender of ARP req> <MAC of sender of ARP req>"
> When I send the ARP req, I see the response going through the switch and back to the traffic generator.
>
> Potentially there is an issue with your OS, I had a quick look and found a post in the discuss archive about a potential problem with Debian/Ubuntu systems and how they handle ARP packets with OVS: http://openvswitch.org/pipermail/discuss/2012-May/007348.html
> It is quite old however so I'm not sure if the issue still exists, or if this is relevant to your set up.
>
>> --
>> Regards,
>> Gowrishankar M
>



From blp at nicira.com  Wed Jun 10 08:44:27 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 08:44:27 -0700
Subject: [ovs-discuss] New test case - it fails
In-Reply-To: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
References: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
Message-ID: <20150610154427.GB673@nicira.com>

On Wed, Jun 10, 2015 at 08:50:56PM +1200, Tony van der Peet wrote:
> * git clone carried out Wednesday 10/Jun/2015 (NZ time)
> * test case suggested by a failing oftest case
> * is this in the correct test file?
> * is the test written to the correct standard?
> * is it a valid test?
> * what other test cases suggest themselves? (the fix is going to involve
> *all* IPv6 protocols, not just ICMPv6)
> * how do I proceed from here?
> * if you apply the patch it should be test #912

The flow extractor is bailing out because the IPv6 packet claims a
length longer than the actual space in the packet.

From saurabh at gmail.com  Wed Jun 10 09:41:51 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Wed, 10 Jun 2015 09:41:51 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <20150610151528.GA673@nicira.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com> <20150610151528.GA673@nicira.com>
Message-ID: <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>

Thanks Ben. I have seen that when a transaction is deleting rowA which
points to rowB which points to rowC, and if all the references to rowB and
rowC are gone, the updates generated can be in any order ie rowC delete can
be received before deletes for rowA or rowB. Should this be expected for
"deletes"?


--
Saurabh (à¤¸à¥Œà¤°à¤­)

On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > When OVSDB server sends updates to an OVSDB client, the IDL changes
> > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL and
> look
> > > for changes.
> > >
> > > Does OVSDB server guarantee that the updates always maintain
> referential
> > > integrity for row creation and row updates i.e. if the client browses
> the
> > > IDL it should never run into a situation where rowA in tableA points
> to a
> > > non-existent rowB in tableB because the update for rowA has arrived but
> > > update for rowB is still in flight.
> >
> > Yes.
>
> I sent out a patch to document this:
>         http://openvswitch.org/pipermail/dev/2015-June/056200.html
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/fb15bcc5/attachment.html>

From saurabh at gmail.com  Wed Jun 10 09:50:47 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Wed, 10 Jun 2015 09:50:47 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com> <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
Message-ID: <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>

An example of where deletes are received out of order: Mcast_Macs_Remote
points to Physical_Locator_Set which points to Physical_Locator. When a
transaction deletes Mcast_Macs_Remote, delete for Physical_Locator_Set is
received first.

[027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
135.227.147.205:43858: send request, method="transact",
params=["hardware_vtep",{"
lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
20","op":"comment"}], id=201
[027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS: ovs|09828|poll_loop|DBG|wakeup
due to [POLLIN] on fd 154 (FIFO) at
/home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
[027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS: ovs|09829|poll_loop|DBG|wakeup
due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858) at
/home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
[027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
135.227.147.205:43858: received notification, method="update",
params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
[027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
135.227.147.205:43858: received notification, method="update",
params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]



--
Saurabh (à¤¸à¥Œà¤°à¤­)

On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
saurabh at gmail.com> wrote:

> Thanks Ben. I have seen that when a transaction is deleting rowA which
> points to rowB which points to rowC, and if all the references to rowB and
> rowC are gone, the updates generated can be in any order ie rowC delete can
> be received before deletes for rowA or rowB. Should this be expected for
> "deletes"?
>
>
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
>
> On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
>> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
>> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
>> > > When OVSDB server sends updates to an OVSDB client, the IDL changes
>> > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL
>> and look
>> > > for changes.
>> > >
>> > > Does OVSDB server guarantee that the updates always maintain
>> referential
>> > > integrity for row creation and row updates i.e. if the client browses
>> the
>> > > IDL it should never run into a situation where rowA in tableA points
>> to a
>> > > non-existent rowB in tableB because the update for rowA has arrived
>> but
>> > > update for rowB is still in flight.
>> >
>> > Yes.
>>
>> I sent out a patch to document this:
>>         http://openvswitch.org/pipermail/dev/2015-June/056200.html
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/c3077a57/attachment-0001.html>

From jesse at nicira.com  Wed Jun 10 09:58:20 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 10 Jun 2015 09:58:20 -0700
Subject: [ovs-discuss] kernel BUG at
 /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode) (#81)
In-Reply-To: <556C828F.7060000@gmail.com>
References: <20150601153508.GC4188@nicira.com> <556C828F.7060000@gmail.com>
Message-ID: <CAEP_g=__W_T+7FNxN2Le_35aXn2paFkqbZFA=1nYy2hMLp=YFQ@mail.gmail.com>

It looks like this was already fixed with commit
b953042214201e2693a485a8ba8b19f69e5bdf34 ("datapath: simplify sample
action implementation" on branch-2.3. However, this has not yet been
part of a release. I expect that 2.3.2 will be released soon
containing this fix.

On Mon, Jun 1, 2015 at 9:04 AM, George Shuklin <george.shuklin at gmail.com> wrote:
>
> Oh, that was my bug. I thought github is a proper place for reports.
>
> I've done enclosing problem:
>
> It happens when we adding sflow entry on Bridge br-int in openstack
> installation (on VLANs). We have two patch ports outside (to br-ex1 and
> br-ex2), and bunch of tap interfaces plugged to br-int with tags (by
> neutron-plugin-openvswitch-agent). Bug happens every time within 1-2 minutes
> after configuration.
>
>
> On 06/01/2015 06:35 PM, Ben Pfaff wrote:
>>
>> This was reported on github.  I'm forwarding it here to make sure it
>> gets noticed.
>>
>> There is some additional information in a followup on github.
>>
>> ----- Forwarded message from George Shuklin <notifications at github.com>
>> -----
>>
>> Date: Mon, 01 Jun 2015 00:12:51 -0700
>> From: George Shuklin <notifications at github.com>
>> To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
>> Subject: [ovs-issues] kernel BUG at
>>         /build/buildd/linux-3.13.0/net/core/skbuff.c:1043 (invalid opcode)
>>         (#81)
>>
>> One of our nodes starts to trace aperiodically. We're gathing logs via
>> remote syslog, here trace (it is a bit unordered because of UDP in syslog).
>>
>> Configuration:
>> openvswitch-switch                  2.3.1
>> Linux: 3.13.0-52-generic
>>
>> We using: neutron with vlans, sFlow (inside OVS) on 'external' bridge.
>>
>> Trace:
>>
>> [12803.874856] ------------[ cut here ]------------
>> [12803.876861]  [<ffffffffa0158c98>] ? key_extract+0x6f8/0xa20
>> [openvswitch]
>> [12803.877797]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
>> [12803.877589]  [<ffffffffa02dedb1>] vhost_worker+0x101/0x1f0 [vhost]
>> [12803.875980]  ffff8800720fa100 ffff881fff403ac0 ffff8800720fa100
>> ffff881fb6e58200
>> [12803.877383]  [<ffffffff816263b8>] netif_rx_ni+0x28/0x30
>> [12803.877504]  [<ffffffffa02ecd99>] handle_tx+0x1b9/0x4d0 [vhost_net]
>> [12803.875673] RBP: ffff881fff403ac8 R08: 00000000e0400000 R09:
>> ffff881fff403bd0
>> [12803.874889] invalid opcode: 0000 [#1] SMP
>> [12803.876661]  [<ffffffffa015d01a>] ? flow_lookup.isra.4+0x4a/0xc0
>> [openvswitch]
>> [12803.876973]  [<ffffffffa015e4da>] ovs_vport_receive+0x2a/0x30
>> [openvswitch]
>> [12803.874870] kernel BUG at
>> /build/buildd/linux-3.13.0/net/core/skbuff.c:1043!
>> [12803.874916] Modules linked in: ip6table_nat nf_conntrack_ipv6
>> nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_raw iptable_raw 8021q
>> garp mrp vhost_net vhost macvtap macvlan dm_multipath scsi_dh nbd kvm_intel
>> ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4
>> nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT xt_CHECKSUM
>> iptable_mangle xt_tcpudp bridge stp llc xfs ip6table_filter ip6_tables
>> iptable_filter ip_tables x_tables openvswitch(OX) gre vxlan ip_tunnel
>> libcrc32c ipmi_devintf gpio_ich dcdbas x86_pkg_temp_thermal intel_powerclamp
>> coretemp kvm crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel
>> aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd lpc_ich ipmi_si
>> mei_me mei wmi shpchp acpi_power_meter mac_hid squashfs aufs igb
>> i2c_algo_bit ixgbe e1000e tg3 dca ptp ahci pps_core libahci megaraid_sas
>> mdio [last unloaded: kvm_intel]
>> [12803.877546]  [<ffffffffa02ed0e5>] handle_tx_kick+0x15/0x20 [vhost_net]
>> [12803.876251]  <IRQ>
>> [12803.877676]  [<ffffffff8108b6b2>] kthread+0xd2/0xf0
>> [12803.877714]  [<ffffffff8108b5e0>] ? kthread_create_on_node+0x1c0/0x1c0
>> [12803.877226]  [<ffffffff8106cc6c>] __do_softirq+0xec/0x2c0
>> [12803.875907] CR2: 00007eff8c072400 CR3: 0000001f86331000 CR4:
>> 00000000001427f0
>> [12803.876727]  [<ffffffffa0155077>] ovs_execute_actions+0x67/0x100
>> [openvswitch]
>> [12803.876551]  [<ffffffffa015fe0b>] ? netdev_send+0x4b/0xc0 [openvswitch]
>> [12803.877314]  [<ffffffff8106cee5>] do_softirq+0x55/0x60
>> [12803.877268]  [<ffffffff8173531c>] do_softirq_own_stack+0x1c/0x30
>> [12803.875548] RSP: 0018:ffff881fff403a90  EFLAGS: 00010202
>> [12803.877017]  [<ffffffffa01600e1>] netdev_frame_hook+0xc1/0x120
>> [openvswitch]
>> [12803.878203] RIP  [<ffffffff8161853e>] pskb_expand_head+0x20e/0x250
>> [12803.876219] Call Trace:
>> [12803.875802] FS:  0000000000000000(0000) GS:ffff881fff400000(0000)
>> knlGS:0000000000000000
>> [12803.876060]  00000000000005b4 ffff881f5c0e6cfc 00000000ffffffff
>> ffff881fff403b10
>> [12803.877061]  [<ffffffff81626892>] __netif_receive_skb_core+0x262/0x840
>> [12803.875715] R10: 0000000000000010 R11: ffff881f31d29d40 R12:
>> 0000000000000000
>> [12803.875868] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
>> [12803.877632]  [<ffffffffa02decb0>] ? vhost_dev_reset_owner+0x30/0x30
>> [vhost]
>> [12803.876904]  [<ffffffffa015812b>]
>> ovs_dp_process_received_packet+0x4b/0x80 [openvswitch]
>> [12803.877307]  <EOI>
>> [12803.876594]  [<ffffffffa01547cc>] do_execute_actions+0x3ac/0xbf0
>> [openvswitch]
>> [12803.876331]  [<ffffffff816252d3>] skb_checksum_help+0x123/0x190
>> [12803.875451] Hardware name: Dell Inc. PowerEdge R530/03XKDV, BIOS 1.1.10
>> 03/10/2015
>> [12803.875587] RAX: 0000000000000002 RBX: ffff8800720fa100 RCX:
>> 0000000000000020
>> [12803.877185]  [<ffffffff81627272>] net_rx_action+0x152/0x250
>> [12803.877757]  [<ffffffff81733868>] ret_from_fork+0x58/0x90
>> [12803.876374]  [<ffffffffa0156a2e>] queue_userspace_packet+0x3ae/0x400
>> [openvswitch]
>> [12803.875950] Stack:
>> [12803.876793]  [<ffffffffa015806f>]
>> ovs_dp_process_packet_with_key+0x7f/0xf0 [openvswitch]
>> [12803.877145]  [<ffffffff81627a1e>] process_backlog+0xae/0x1a0
>> [12803.877838] Code: ff ff ff 48 89 d7 48 89 55 c8 e8 ae 4f b4 ff 84 c0 48
>> 8b 55 c8 75 a1 eb 9b 0f 1f 40 00 0f 0b 41 81 cf 00 20 00 00 e9 43 fe ff ff
>> <0f> 0b 44 89 fe 4c 89 ef e8 e5 f4 ff ff 85 c0 74 12 48 89 df e8
>> [12803.875430] CPU: 0 PID: 17654 Comm: vhost-17644 Tainted: G           OX
>> 3.13.0-53-generic #89-Ubuntu
>> [12803.875495] RIP: 0010:[<ffffffff8161853e>]  [<ffffffff8161853e>]
>> pskb_expand_head+0x20e/0x250
>> [12803.875630] RDX: 00000000000006aa RSI: 0000000000000000 RDI:
>> ffff8800720fa100
>> [12803.876441]  [<ffffffffa0157fe5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
>> [12803.877464]  [<ffffffff8152825a>] tun_sendmsg+0x5a/0x80
>> [12803.878247]  RSP <ffff881fff403a90>
>> [12803.877103]  [<ffffffff81626e88>] __netif_receive_skb+0x18/0x60
>> [12803.877425]  [<ffffffff81527dc3>] tun_get_user+0x403/0x840
>> [12803.876258]  [<ffffffff81618ef0>] __pskb_pull_tail+0x50/0x360
>> [12803.876484]  [<ffffffffa0154796>] do_execute_actions+0x376/0xbf0
>> [openvswitch]
>> [12803.878792] ---[ end trace 4e8d5a14aaae59db ]---
>> [12803.875758] R13: ffff8800720fa100 R14: ffff881f5c0e6cfc R15:
>> 00000000ffffffff
>> [12803.875473] task: ffff88301f389800 ti: ffff88300fcce000 task.ti:
>> ffff88300fcce000
>> [12803.876140]  ffffffff81618ef0 ffffffffa01a41c0 000005b4cd428000
>> ffff8800720fa100
>>
>> ---
>> Reply to this email directly or view it on GitHub:
>> https://github.com/openvswitch/ovs-issues/issues/81
>>
>> ----- End forwarded message -----
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From aatteka at nicira.com  Wed Jun 10 10:05:27 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Wed, 10 Jun 2015 10:05:27 -0700
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
 <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
Message-ID: <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>

On Mon, Jun 8, 2015 at 7:57 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
> Hi Ansis,
>
>  I used "ip xfrm add policy" command to add policy.

> I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
No, ovs-monitor-ipsec can't be used used to install IPsec policies
that match on GRE key.

> I tested with GRE key value only.I will test weather Port no, based
> filtering is supported in OVS or not and revert.
Pravin told me that he will look into this patch before applying.

One small comment - if gre KEY is not set, shouldn't we set it to 0
instead of leaving unset before performing route lookup?

>
>
> Regards
> Harsh jain
>
>
> Regards
> Harsh Jain
>
> On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
>> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>>> Hi,
>>>
>>>
>>> While trying to encrypt(IPsec policy) packets  based on GRE key
>>> received in packets. kernel didn't encrypted the packets received from
>>> OVS bridge. The packets forwarded to Desination unencrypted.
>>> Kernel treats packet having different keys as same flow type.
>>
>> It seems that you are not using ovs-monitor-ipsec to install IPsec
>> policies for you?
>>
>>>
>>>
>>> Kernel Version used : 3.18.14
>>> ovs-vswitchd (Open vSwitch) 2.0.1
>>> Compiled Apr 16 2014 14:19:17
>>> OpenFlow versions 0x1:0x1
>>>
>>> Fix Applied :  Find attached initial patch.
>>>
>>> Please confirm if it is bug?.
>>
>> I think this could be classified as bug for those use cases when one
>> wants to install such fine grained IPsec policies based on GRE key.
>> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
>>
>>
>>>
>>>
>>> Regards
>>> Harsh Jain
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>

From hillad at gmail.com  Wed Jun 10 10:48:49 2015
From: hillad at gmail.com (Andy Hill)
Date: Wed, 10 Jun 2015 13:48:49 -0400
Subject: [ovs-discuss] force-reload-kmod and bonding
Message-ID: <CAC=Vi+o9Z6X3opSVvHdFXruVdS43=6rCuxXTo+z+TG9-2Hhj1Q@mail.gmail.com>

When testing force-reload-kmod on XenServer 6.2 running OVS 2.1/2.3 with
bonded LACP configurations, the disruption to data plane connectivity is
much longer than non-bonded configurations.

While debugging, one area that longer than expected was in the dp-ctl
del-dp calls[1]. The earlier dump-dps call only returned "system at ovs-system
".

I straced the calls and was surprised with this call taking over 3s:

https://gist.github.com/andyhky/b531751f00c5ca94ae24#file-bonded-L197

But non bonded <1s:

https://gist.github.com/andyhky/b531751f00c5ca94ae24#file-non-bonded-L196

Repeated testing on different bonded servers all took between 3s-5s.
Testing on non-bonded servers was always ~1s.

Within 1s of the del-dp command running, traffic drops from the host. Does
anyone have ideas on why this would take so much longer on a bonded
configuration?

[1]
https://github.com/openvswitch/ovs/blob/branch-2.1/utilities/ovs-ctl.in#L377-L379
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/78575dfe/attachment.html>

From blp at nicira.com  Wed Jun 10 12:51:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 12:51:19 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com>
 <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
 <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
Message-ID: <20150610195119.GB1318@nicira.com>

The updates you're showing me might not be related to the transaction at
all, since the update doesn't mention the Mcast_Macs_Remote table.
Where's the transaction reply?

On Wed, Jun 10, 2015 at 09:50:47AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> An example of where deletes are received out of order: Mcast_Macs_Remote
> points to Physical_Locator_Set which points to Physical_Locator. When a
> transaction deletes Mcast_Macs_Remote, delete for Physical_Locator_Set is
> received first.
> 
> [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: send request, method="transact",
> params=["hardware_vtep",{"
> lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> 20","op":"comment"}], id=201
> [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS: ovs|09828|poll_loop|DBG|wakeup
> due to [POLLIN] on fd 154 (FIFO) at
> /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS: ovs|09829|poll_loop|DBG|wakeup
> due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858) at
> /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: received notification, method="update",
> params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: received notification, method="update",
> params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> 
> 
> 
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
> 
> On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> saurabh at gmail.com> wrote:
> 
> > Thanks Ben. I have seen that when a transaction is deleting rowA which
> > points to rowB which points to rowC, and if all the references to rowB and
> > rowC are gone, the updates generated can be in any order ie rowC delete can
> > be received before deletes for rowA or rowB. Should this be expected for
> > "deletes"?
> >
> >
> > --
> > Saurabh (à¤¸à¥Œà¤°à¤­)
> >
> > On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> >> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> >> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> >> > > When OVSDB server sends updates to an OVSDB client, the IDL changes
> >> > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL
> >> and look
> >> > > for changes.
> >> > >
> >> > > Does OVSDB server guarantee that the updates always maintain
> >> referential
> >> > > integrity for row creation and row updates i.e. if the client browses
> >> the
> >> > > IDL it should never run into a situation where rowA in tableA points
> >> to a
> >> > > non-existent rowB in tableB because the update for rowA has arrived
> >> but
> >> > > update for rowB is still in flight.
> >> >
> >> > Yes.
> >>
> >> I sent out a patch to document this:
> >>         http://openvswitch.org/pipermail/dev/2015-June/056200.html
> >>
> >
> >

From blp at nicira.com  Wed Jun 10 12:47:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 12:47:25 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com>
 <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
Message-ID: <20150610194725.GA1318@nicira.com>

If the deletes are within a single transaction, they'll be reported as
part of a single update, and the IDL will present them all together as a
unit.

If the deletes happen in different transactions then they'll be reported
sequentially, in the same order they were applied to the database.

If you're actually seeing different behavior then I'd like a
reproduction case; that shouldn't happen.

On Wed, Jun 10, 2015 at 09:41:51AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> Thanks Ben. I have seen that when a transaction is deleting rowA which
> points to rowB which points to rowC, and if all the references to rowB and
> rowC are gone, the updates generated can be in any order ie rowC delete can
> be received before deletes for rowA or rowB. Should this be expected for
> "deletes"?
> 
> 
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
> 
> On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > > When OVSDB server sends updates to an OVSDB client, the IDL changes
> > > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL and
> > look
> > > > for changes.
> > > >
> > > > Does OVSDB server guarantee that the updates always maintain
> > referential
> > > > integrity for row creation and row updates i.e. if the client browses
> > the
> > > > IDL it should never run into a situation where rowA in tableA points
> > to a
> > > > non-existent rowB in tableB because the update for rowA has arrived but
> > > > update for rowB is still in flight.
> > >
> > > Yes.
> >
> > I sent out a patch to document this:
> >         http://openvswitch.org/pipermail/dev/2015-June/056200.html
> >

From tony.vanderpeet at gmail.com  Wed Jun 10 14:31:55 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Thu, 11 Jun 2015 09:31:55 +1200
Subject: [ovs-discuss] New test case - it fails
In-Reply-To: <20150610154427.GB673@nicira.com>
References: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
 <20150610154427.GB673@nicira.com>
Message-ID: <CAKL=qh-qUQ4yr_tGr6GWGEzk846SEnjqKRVLbeRJgQcVSKtzmg@mail.gmail.com>

I confess that I have no idea what your response means! The packet I am
using in that test is cribbed from another test "ofproto-dpif - Neighbor
Discovery set-field with checksum update", and does appear to have the
desired result, it create a dpif flow, just not the right one.

The testsuite.log file contains:
-recirc_id(0),in_port(1),eth_type(0x86dd),ipv6(proto=58,frag=no),icmpv6(code=3),
packets:0, bytes:0, used:never,
actions:userspace(pid=0,slow_path(controller))
+recirc_id(0),in_port(1),eth_type(0x86dd),ipv6(proto=58,frag=no),
packets:0, bytes:0, used:never,
actions:userspace(pid=0,slow_path(controller))

I think this is a result of this piece of code (flow.c, flow_wc_map)
    } else if (flow->dl_type == htons(ETH_TYPE_IPV6)) {
        map |= MINIFLOW_MAP(ipv6_src) | MINIFLOW_MAP(ipv6_dst)
            | MINIFLOW_MAP(ipv6_label)
            | MINIFLOW_MAP(nw_proto) | MINIFLOW_MAP(nw_frag)
            | MINIFLOW_MAP(nw_tos) | MINIFLOW_MAP(nw_ttl);
        if (OVS_UNLIKELY(flow->nw_proto == IPPROTO_ICMPV6)) {
            map |= MINIFLOW_MAP(nd_target)
                | MINIFLOW_MAP(arp_sha) | MINIFLOW_MAP(arp_tha);
        } else {
            map |= MINIFLOW_MAP(tcp_flags)
                | MINIFLOW_MAP(tp_src) | MINIFLOW_MAP(tp_dst);
        }
    } else if (eth_type_mpls(flow->dl_type)) {

which could look better as:
    } else if (flow->dl_type == htons(ETH_TYPE_IPV6)) {
        map |= MINIFLOW_MAP(ipv6_src) | MINIFLOW_MAP(ipv6_dst)
            | MINIFLOW_MAP(ipv6_label)
            | MINIFLOW_MAP(nw_proto) | MINIFLOW_MAP(nw_frag)
            | MINIFLOW_MAP(nw_tos) | MINIFLOW_MAP(nw_ttl);
        map |= MINIFLOW_MAP(tp_src) | MINIFLOW_MAP(tp_dst);
        if (OVS_UNLIKELY(flow->nw_proto == IPPROTO_ICMPV6)) {
            if (OVS_UNLIKELY(flow->tp_dst == 0 &&
                             (flow->tp_src == ND_NEIGHBOR_SOLICIT ||
                              flow->tp_src == ND_NEIGHBOR_ADVERT))) {
                map |= MINIFLOW_MAP(nd_target)
                    | MINIFLOW_MAP(arp_sha) | MINIFLOW_MAP(arp_tha);
            }
        } else {
            map |= MINIFLOW_MAP(tcp_flags);
        }
    } else if (eth_type_mpls(flow->dl_type)) {

based on functionally similar code a few hundred lines down in the same
file.

The first time I tried a fix it caused some TCP and UDP tests to fail,
hence my question about how many test cases would be appropriate here. I
don't want to write a bunch of test cases until I'm happy that I'm writing
them correctly.

Just to be clear, even though I originally found this on our platform (with
code modifications by us), I am writing and running this test on a clean
clone of the repo, with no other mods.

Cheers
Tony

On Thu, Jun 11, 2015 at 3:44 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Jun 10, 2015 at 08:50:56PM +1200, Tony van der Peet wrote:
> > * git clone carried out Wednesday 10/Jun/2015 (NZ time)
> > * test case suggested by a failing oftest case
> > * is this in the correct test file?
> > * is the test written to the correct standard?
> > * is it a valid test?
> > * what other test cases suggest themselves? (the fix is going to involve
> > *all* IPv6 protocols, not just ICMPv6)
> > * how do I proceed from here?
> > * if you apply the patch it should be test #912
>
> The flow extractor is bailing out because the IPv6 packet claims a
> length longer than the actual space in the packet.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/1ee5056c/attachment.html>

From saurabh at gmail.com  Wed Jun 10 18:01:16 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Wed, 10 Jun 2015 18:01:16 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <20150610195119.GB1318@nicira.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com> <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
 <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
 <20150610195119.GB1318@nicira.com>
Message-ID: <CAEgOKCyOE7VWjEAc2h1SGv8rJAkqUPipyOP9Jho6y3Wkq+JKgA@mail.gmail.com>

The transaction reply appears after all the updates are received (but I
dont have those traces at this time)

Here is the good case where all the changes to the database come in one
giant update instead of split up into 3 updates. Note that in the bad case
the 3 row deletes appeared as 3 different updates. I think the issue is
that sometimes the server will split up the updates.

good case:

[001 d 05/28/15 18:17:31.295]  A:dc_rpc:OVS: ovs|654524|jsonrpc|DBG|ssl:
135.227.147.205:44978: send request, method="transact",
params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","1f1d55cc-6ee4-4c67-81e0-3e5246c93c01"]]],"op":"delete"},{"comment":"thdl
969","op":"comment"}], id=17043
[001 d 05/28/15 18:17:31.301]  A:dc_rpc:OVS:
ovs|654526|poll_loop|DBG|wakeup due to [POLLIN] on fd 154 (FIFO) at
/home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
[001 d 05/28/15 18:17:31.304]  A:dc_rpc:OVS:
ovs|654527|poll_loop|DBG|wakeup due to [POLLIN] on fd 9378 (
135.227.144.122:6632<->135.227.147.205:44978) at
/home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
[001 d 05/28/15 18:17:31.307]  A:dc_rpc:OVS: ovs|654528|jsonrpc|DBG|ssl:
135.227.147.205:44978: received notification, method="update",
params=[null,{"Physical_Locator":{"f22d3188-8495-4108-8403-bd1c89a3801c":{"old":{"dst_ip":"10.15.33.254","encapsulation_type":"vxlan_over_ipv4"}}},"Physical_Locator_Set":{"dfdba754-179d-4380-bab0-6d1968dfa5ff":{"old":{"locators":["uuid","f22d3188-8495-4108-8403-bd1c89a3801c"]}}},"Mcast_Macs_Remote":{"1f1d55cc-6ee4-4c67-81e0-3e5246c93c01":{"old":{"ipaddr":"","logical_switch":["uuid","c70577c4-e61d-4049-9987-3b9f8bce19db"],"locator_set":["uuid","dfdba754-179d-4380-bab0-6d1968dfa5ff"],"MAC":"unknown-dst"}}}


bad case:

[027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
135.227.147.205:43858: send request, method="transact",
params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
20","op":"comment"}], id=201
[027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS: ovs|09828|poll_loop|DBG|wakeup
due to [POLLIN] on fd 154 (FIFO) at
/home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
[027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS: ovs|09829|poll_loop|DBG|wakeup
due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858) at
/home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
[027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
135.227.147.205:43858: received notification, method="update",
params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
[027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
135.227.147.205:43858: received notification, method="update",
params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]

< the Mcast_Macs_Remote update came at this point but I dont have the trace
with me >



--
Saurabh (à¤¸à¥Œà¤°à¤­)

On Wed, Jun 10, 2015 at 12:51 PM, Ben Pfaff <blp at nicira.com> wrote:

> The updates you're showing me might not be related to the transaction at
> all, since the update doesn't mention the Mcast_Macs_Remote table.
> Where's the transaction reply?
>
> On Wed, Jun 10, 2015 at 09:50:47AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > An example of where deletes are received out of order: Mcast_Macs_Remote
> > points to Physical_Locator_Set which points to Physical_Locator. When a
> > transaction deletes Mcast_Macs_Remote, delete for Physical_Locator_Set is
> > received first.
> >
> > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: send request, method="transact",
> > params=["hardware_vtep",{"
> >
> lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > 20","op":"comment"}], id=201
> > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> ovs|09828|poll_loop|DBG|wakeup
> > due to [POLLIN] on fd 154 (FIFO) at
> > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> ovs|09829|poll_loop|DBG|wakeup
> > due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858)
> at
> > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: received notification, method="update",
> >
> params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: received notification, method="update",
> >
> params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> >
> >
> >
> > --
> > Saurabh (à¤¸à¥Œà¤°à¤­)
> >
> > On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> > saurabh at gmail.com> wrote:
> >
> > > Thanks Ben. I have seen that when a transaction is deleting rowA which
> > > points to rowB which points to rowC, and if all the references to rowB
> and
> > > rowC are gone, the updates generated can be in any order ie rowC
> delete can
> > > be received before deletes for rowA or rowB. Should this be expected
> for
> > > "deletes"?
> > >
> > >
> > > --
> > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > >
> > > On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > >> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > >> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > >> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > >> > > When OVSDB server sends updates to an OVSDB client, the IDL
> changes
> > >> > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL
> > >> and look
> > >> > > for changes.
> > >> > >
> > >> > > Does OVSDB server guarantee that the updates always maintain
> > >> referential
> > >> > > integrity for row creation and row updates i.e. if the client
> browses
> > >> the
> > >> > > IDL it should never run into a situation where rowA in tableA
> points
> > >> to a
> > >> > > non-existent rowB in tableB because the update for rowA has
> arrived
> > >> but
> > >> > > update for rowB is still in flight.
> > >> >
> > >> > Yes.
> > >>
> > >> I sent out a patch to document this:
> > >>         http://openvswitch.org/pipermail/dev/2015-June/056200.html
> > >>
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/79af6acc/attachment-0001.html>

From blp at nicira.com  Wed Jun 10 18:06:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 18:06:40 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCyOE7VWjEAc2h1SGv8rJAkqUPipyOP9Jho6y3Wkq+JKgA@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com>
 <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
 <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
 <20150610195119.GB1318@nicira.com>
 <CAEgOKCyOE7VWjEAc2h1SGv8rJAkqUPipyOP9Jho6y3Wkq+JKgA@mail.gmail.com>
Message-ID: <20150611010640.GA12316@nicira.com>

The database server should always report a single transaction as a
single update.  It can sometimes merge multiple transactions into one
update but it's a bug if it ever splits a single transaction into
multiple updates.

Is this with bleeding-edge OVS from master, by any chance?  We've had a
lot of churn in that code over the last month or so, so new bugs are
possible.  (Before that, though, it is basically unchanged for years.)

I'd love a reproduction case.

On Wed, Jun 10, 2015 at 06:01:16PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> The transaction reply appears after all the updates are received (but I
> dont have those traces at this time)
> 
> Here is the good case where all the changes to the database come in one
> giant update instead of split up into 3 updates. Note that in the bad case
> the 3 row deletes appeared as 3 different updates. I think the issue is
> that sometimes the server will split up the updates.
> 
> good case:
> 
> [001 d 05/28/15 18:17:31.295]  A:dc_rpc:OVS: ovs|654524|jsonrpc|DBG|ssl:
> 135.227.147.205:44978: send request, method="transact",
> params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","1f1d55cc-6ee4-4c67-81e0-3e5246c93c01"]]],"op":"delete"},{"comment":"thdl
> 969","op":"comment"}], id=17043
> [001 d 05/28/15 18:17:31.301]  A:dc_rpc:OVS:
> ovs|654526|poll_loop|DBG|wakeup due to [POLLIN] on fd 154 (FIFO) at
> /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> [001 d 05/28/15 18:17:31.304]  A:dc_rpc:OVS:
> ovs|654527|poll_loop|DBG|wakeup due to [POLLIN] on fd 9378 (
> 135.227.144.122:6632<->135.227.147.205:44978) at
> /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> [001 d 05/28/15 18:17:31.307]  A:dc_rpc:OVS: ovs|654528|jsonrpc|DBG|ssl:
> 135.227.147.205:44978: received notification, method="update",
> params=[null,{"Physical_Locator":{"f22d3188-8495-4108-8403-bd1c89a3801c":{"old":{"dst_ip":"10.15.33.254","encapsulation_type":"vxlan_over_ipv4"}}},"Physical_Locator_Set":{"dfdba754-179d-4380-bab0-6d1968dfa5ff":{"old":{"locators":["uuid","f22d3188-8495-4108-8403-bd1c89a3801c"]}}},"Mcast_Macs_Remote":{"1f1d55cc-6ee4-4c67-81e0-3e5246c93c01":{"old":{"ipaddr":"","logical_switch":["uuid","c70577c4-e61d-4049-9987-3b9f8bce19db"],"locator_set":["uuid","dfdba754-179d-4380-bab0-6d1968dfa5ff"],"MAC":"unknown-dst"}}}
> 
> 
> bad case:
> 
> [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: send request, method="transact",
> params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> 20","op":"comment"}], id=201
> [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS: ovs|09828|poll_loop|DBG|wakeup
> due to [POLLIN] on fd 154 (FIFO) at
> /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS: ovs|09829|poll_loop|DBG|wakeup
> due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858) at
> /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: received notification, method="update",
> params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> 135.227.147.205:43858: received notification, method="update",
> params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> 
> < the Mcast_Macs_Remote update came at this point but I dont have the trace
> with me >
> 
> 
> 
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
> 
> On Wed, Jun 10, 2015 at 12:51 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > The updates you're showing me might not be related to the transaction at
> > all, since the update doesn't mention the Mcast_Macs_Remote table.
> > Where's the transaction reply?
> >
> > On Wed, Jun 10, 2015 at 09:50:47AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > An example of where deletes are received out of order: Mcast_Macs_Remote
> > > points to Physical_Locator_Set which points to Physical_Locator. When a
> > > transaction deletes Mcast_Macs_Remote, delete for Physical_Locator_Set is
> > > received first.
> > >
> > > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: send request, method="transact",
> > > params=["hardware_vtep",{"
> > >
> > lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > > 20","op":"comment"}], id=201
> > > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> > ovs|09828|poll_loop|DBG|wakeup
> > > due to [POLLIN] on fd 154 (FIFO) at
> > > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> > ovs|09829|poll_loop|DBG|wakeup
> > > due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858)
> > at
> > > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: received notification, method="update",
> > >
> > params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: received notification, method="update",
> > >
> > params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> > >
> > >
> > >
> > > --
> > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > >
> > > On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> > > saurabh at gmail.com> wrote:
> > >
> > > > Thanks Ben. I have seen that when a transaction is deleting rowA which
> > > > points to rowB which points to rowC, and if all the references to rowB
> > and
> > > > rowC are gone, the updates generated can be in any order ie rowC
> > delete can
> > > > be received before deletes for rowA or rowB. Should this be expected
> > for
> > > > "deletes"?
> > > >
> > > >
> > > > --
> > > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > > >
> > > > On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > >> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > > >> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > > >> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > >> > > When OVSDB server sends updates to an OVSDB client, the IDL
> > changes
> > > >> > > idl_seqno. When idl_seqno changes, the client can rebrowse the IDL
> > > >> and look
> > > >> > > for changes.
> > > >> > >
> > > >> > > Does OVSDB server guarantee that the updates always maintain
> > > >> referential
> > > >> > > integrity for row creation and row updates i.e. if the client
> > browses
> > > >> the
> > > >> > > IDL it should never run into a situation where rowA in tableA
> > points
> > > >> to a
> > > >> > > non-existent rowB in tableB because the update for rowA has
> > arrived
> > > >> but
> > > >> > > update for rowB is still in flight.
> > > >> >
> > > >> > Yes.
> > > >>
> > > >> I sent out a patch to document this:
> > > >>         http://openvswitch.org/pipermail/dev/2015-June/056200.html
> > > >>
> > > >
> > > >
> >

From saurabh at gmail.com  Wed Jun 10 18:19:19 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Wed, 10 Jun 2015 18:19:19 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <20150611010640.GA12316@nicira.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com> <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
 <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
 <20150610195119.GB1318@nicira.com>
 <CAEgOKCyOE7VWjEAc2h1SGv8rJAkqUPipyOP9Jho6y3Wkq+JKgA@mail.gmail.com>
 <20150611010640.GA12316@nicira.com>
Message-ID: <CAEgOKCxpCUuNHtxZrCCV6O5Hpc1f-ePMxtCJvHRN87L1pyM11A@mail.gmail.com>

This happens with an older (more than 6 month) OVSDB server. It is
difficult to reproduce this behaviour.

--
Saurabh (à¤¸à¥Œà¤°à¤­)

On Wed, Jun 10, 2015 at 6:06 PM, Ben Pfaff <blp at nicira.com> wrote:

> The database server should always report a single transaction as a
> single update.  It can sometimes merge multiple transactions into one
> update but it's a bug if it ever splits a single transaction into
> multiple updates.
>
> Is this with bleeding-edge OVS from master, by any chance?  We've had a
> lot of churn in that code over the last month or so, so new bugs are
> possible.  (Before that, though, it is basically unchanged for years.)
>
> I'd love a reproduction case.
>
> On Wed, Jun 10, 2015 at 06:01:16PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > The transaction reply appears after all the updates are received (but I
> > dont have those traces at this time)
> >
> > Here is the good case where all the changes to the database come in one
> > giant update instead of split up into 3 updates. Note that in the bad
> case
> > the 3 row deletes appeared as 3 different updates. I think the issue is
> > that sometimes the server will split up the updates.
> >
> > good case:
> >
> > [001 d 05/28/15 18:17:31.295]  A:dc_rpc:OVS: ovs|654524|jsonrpc|DBG|ssl:
> > 135.227.147.205:44978: send request, method="transact",
> >
> params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","1f1d55cc-6ee4-4c67-81e0-3e5246c93c01"]]],"op":"delete"},{"comment":"thdl
> > 969","op":"comment"}], id=17043
> > [001 d 05/28/15 18:17:31.301]  A:dc_rpc:OVS:
> > ovs|654526|poll_loop|DBG|wakeup due to [POLLIN] on fd 154 (FIFO) at
> > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > [001 d 05/28/15 18:17:31.304]  A:dc_rpc:OVS:
> > ovs|654527|poll_loop|DBG|wakeup due to [POLLIN] on fd 9378 (
> > 135.227.144.122:6632<->135.227.147.205:44978) at
> > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > [001 d 05/28/15 18:17:31.307]  A:dc_rpc:OVS: ovs|654528|jsonrpc|DBG|ssl:
> > 135.227.147.205:44978: received notification, method="update",
> >
> params=[null,{"Physical_Locator":{"f22d3188-8495-4108-8403-bd1c89a3801c":{"old":{"dst_ip":"10.15.33.254","encapsulation_type":"vxlan_over_ipv4"}}},"Physical_Locator_Set":{"dfdba754-179d-4380-bab0-6d1968dfa5ff":{"old":{"locators":["uuid","f22d3188-8495-4108-8403-bd1c89a3801c"]}}},"Mcast_Macs_Remote":{"1f1d55cc-6ee4-4c67-81e0-3e5246c93c01":{"old":{"ipaddr":"","logical_switch":["uuid","c70577c4-e61d-4049-9987-3b9f8bce19db"],"locator_set":["uuid","dfdba754-179d-4380-bab0-6d1968dfa5ff"],"MAC":"unknown-dst"}}}
> >
> >
> > bad case:
> >
> > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: send request, method="transact",
> >
> params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > 20","op":"comment"}], id=201
> > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> ovs|09828|poll_loop|DBG|wakeup
> > due to [POLLIN] on fd 154 (FIFO) at
> > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> ovs|09829|poll_loop|DBG|wakeup
> > due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858)
> at
> > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: received notification, method="update",
> >
> params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> > 135.227.147.205:43858: received notification, method="update",
> >
> params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> >
> > < the Mcast_Macs_Remote update came at this point but I dont have the
> trace
> > with me >
> >
> >
> >
> > --
> > Saurabh (à¤¸à¥Œà¤°à¤­)
> >
> > On Wed, Jun 10, 2015 at 12:51 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > The updates you're showing me might not be related to the transaction
> at
> > > all, since the update doesn't mention the Mcast_Macs_Remote table.
> > > Where's the transaction reply?
> > >
> > > On Wed, Jun 10, 2015 at 09:50:47AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > > An example of where deletes are received out of order:
> Mcast_Macs_Remote
> > > > points to Physical_Locator_Set which points to Physical_Locator.
> When a
> > > > transaction deletes Mcast_Macs_Remote, delete for
> Physical_Locator_Set is
> > > > received first.
> > > >
> > > > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS:
> ovs|09826|jsonrpc|DBG|ssl:
> > > > 135.227.147.205:43858: send request, method="transact",
> > > > params=["hardware_vtep",{"
> > > >
> > >
> lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > > > 20","op":"comment"}], id=201
> > > > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> > > ovs|09828|poll_loop|DBG|wakeup
> > > > due to [POLLIN] on fd 154 (FIFO) at
> > > > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > > > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> > > ovs|09829|poll_loop|DBG|wakeup
> > > > due to [POLLIN] on fd 246 (135.227.144.122:6632<->
> 135.227.147.205:43858)
> > > at
> > > > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > > > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS:
> ovs|09830|jsonrpc|DBG|ssl:
> > > > 135.227.147.205:43858: received notification, method="update",
> > > >
> > >
> params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > > > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS:
> ovs|09831|jsonrpc|DBG|ssl:
> > > > 135.227.147.205:43858: received notification, method="update",
> > > >
> > >
> params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> > > >
> > > >
> > > >
> > > > --
> > > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > > >
> > > > On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> > > > saurabh at gmail.com> wrote:
> > > >
> > > > > Thanks Ben. I have seen that when a transaction is deleting rowA
> which
> > > > > points to rowB which points to rowC, and if all the references to
> rowB
> > > and
> > > > > rowC are gone, the updates generated can be in any order ie rowC
> > > delete can
> > > > > be received before deletes for rowA or rowB. Should this be
> expected
> > > for
> > > > > "deletes"?
> > > > >
> > > > >
> > > > > --
> > > > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > > > >
> > > > > On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > >> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > > > >> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava
> (à¤¸à¥Œà¤°à¤­
> > > > >> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > > >> > > When OVSDB server sends updates to an OVSDB client, the IDL
> > > changes
> > > > >> > > idl_seqno. When idl_seqno changes, the client can rebrowse
> the IDL
> > > > >> and look
> > > > >> > > for changes.
> > > > >> > >
> > > > >> > > Does OVSDB server guarantee that the updates always maintain
> > > > >> referential
> > > > >> > > integrity for row creation and row updates i.e. if the client
> > > browses
> > > > >> the
> > > > >> > > IDL it should never run into a situation where rowA in tableA
> > > points
> > > > >> to a
> > > > >> > > non-existent rowB in tableB because the update for rowA has
> > > arrived
> > > > >> but
> > > > >> > > update for rowB is still in flight.
> > > > >> >
> > > > >> > Yes.
> > > > >>
> > > > >> I sent out a patch to document this:
> > > > >>
> http://openvswitch.org/pipermail/dev/2015-June/056200.html
> > > > >>
> > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/9799497e/attachment-0001.html>

From joestringer at nicira.com  Wed Jun 10 18:54:55 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 10 Jun 2015 18:54:55 -0700
Subject: [ovs-discuss] New test case - it fails
In-Reply-To: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
References: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
Message-ID: <CANr6G5wDjAhU3nCeczM2BCXr4Nai7j98HGQC0AvdHGyvoOLcDw@mail.gmail.com>

Hi Tony,

On 10 June 2015 at 01:50, Tony van der Peet <tony.vanderpeet at gmail.com> wrote:
> * git clone carried out Wednesday 10/Jun/2015 (NZ time)

Great, we always develop against the tip of master.

> * test case suggested by a failing oftest case
> * is this in the correct test file?

Yes, this is an appropriate file. I've also alternatively used
tests/dpif-netdev.at for testing userspace datapath behaviour like
this.

> * is the test written to the correct standard?
> * is it a valid test?

There is no end-quote on the netdev-dummy line, which suggests that
this is probably not identical to the test that you were running
locally. A common problem is that your email client is messing with
the patch. git format-patch (and git send-email) do a great job of
ensuring that a patch you've committed locally is sent in the correct
format.

Typically if I want to determine whether a datapath flow was installed
correctly, I will do something like the following:

- Increase log level at the beginning of the test (after vswitchd start)
AT_CHECK([ovs-appctl vlog/set dpif:dbg dpif_netdev:dbg])

- use FILTER_FLOW_INSTALL
AT_CHECK([cat ovs-vswitchd.log | grep 'in_port=[[1]]' |
FILTER_FLOW_INSTALL | STRIP_XOUT], [0], [dnl
<flow>
]

This alleviates some issues with test script race conditions when
running the tests on a highly-loaded system (or highly-parallel). You
can see some examples in the same test file; the macro is defined in
tests/dpif-netdev.at.

> * what other test cases suggest themselves? (the fix is going to involve
> *all* IPv6 protocols, not just ICMPv6)

I suspect if we'd thought of particular additional cases, we would
have added them. If there are more problems that oftest is showing up,
fixing those bugs and adding tests to show that the fix works would be
appropriate. Generally the CI we use (eg travis) doesn't run the
oftest framework, so this would be a way to ensure that there aren't
regressions in areas like this.

> * how do I proceed from here?
> * if you apply the patch it should be test #912

I noticed that if you apply something similar to the patch below on
branch-2.3 (complete with truncated packet), the datapath flow that's
generated still includes the icmp code (and seems fine). Yet on the
latest master that doesn't seem to be the case. Is that what you've
noticed? That seems like potentially a regression or change in the
behaviour since v2.3. Perhaps because the truncated packet doesn't
include a valid ICMPv6 option, so the newer OVS doesn't even parse the
type and/or code. (I haven't looked particularly close at the packet
you're using; I cheated with an online hexdump decoder)

From blp at nicira.com  Wed Jun 10 19:16:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 19:16:48 -0700
Subject: [ovs-discuss] New test case - it fails
In-Reply-To: <CANr6G5wDjAhU3nCeczM2BCXr4Nai7j98HGQC0AvdHGyvoOLcDw@mail.gmail.com>
References: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
 <CANr6G5wDjAhU3nCeczM2BCXr4Nai7j98HGQC0AvdHGyvoOLcDw@mail.gmail.com>
Message-ID: <20150611021648.GA12945@nicira.com>

On Wed, Jun 10, 2015 at 06:54:55PM -0700, Joe Stringer wrote:
> I suspect if we'd thought of particular additional cases, we would
> have added them. If there are more problems that oftest is showing up,
> fixing those bugs and adding tests to show that the fix works would be
> appropriate. Generally the CI we use (eg travis) doesn't run the
> oftest framework, so this would be a way to ensure that there aren't
> regressions in areas like this.

I have a pile of patches that fix a lot of bugs found by oftest (and
another pile that fixes bugs in oftest), which I have not yet posted,
but I don't remember anything like this showing up.

From tony.vanderpeet at gmail.com  Wed Jun 10 20:07:10 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Thu, 11 Jun 2015 15:07:10 +1200
Subject: [ovs-discuss] New test case - it fails
In-Reply-To: <20150611021648.GA12945@nicira.com>
References: <CAKL=qh98VbSM7NpE-S6oBW2aGSrVxM6chDfE_TBaVV7fXjXHjQ@mail.gmail.com>
 <CANr6G5wDjAhU3nCeczM2BCXr4Nai7j98HGQC0AvdHGyvoOLcDw@mail.gmail.com>
 <20150611021648.GA12945@nicira.com>
Message-ID: <CAKL=qh9Wa5_wdXKT_m9D_iJ40rsf=4SE3DvObTeumwdzJC-sgA@mail.gmail.com>

The commit that introduced flow_wc_map is dated 18/Oct/2014. I notice that
flow.c does not have any commits after Jun/2014 in the 2.3 branch, so that
explains why Joe hasn't seen the issue in that branch.

I'll take Joe's advice and try to clean up the test and submit it to the
delivery mailing list.

The packet is just one from the neighbor discovery test with type and code
changed. I'll try to make it more well-formed. Your comment about closing
quote probably explains Ben's original comment, I'll play around with that
tonight.

Tony



On Thu, Jun 11, 2015 at 2:16 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Jun 10, 2015 at 06:54:55PM -0700, Joe Stringer wrote:
> > I suspect if we'd thought of particular additional cases, we would
> > have added them. If there are more problems that oftest is showing up,
> > fixing those bugs and adding tests to show that the fix works would be
> > appropriate. Generally the CI we use (eg travis) doesn't run the
> > oftest framework, so this would be a way to ensure that there aren't
> > regressions in areas like this.
>
> I have a pile of patches that fix a lot of bugs found by oftest (and
> another pile that fixes bugs in oftest), which I have not yet posted,
> but I don't remember anything like this showing up.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/df69d8b3/attachment.html>

From blp at nicira.com  Wed Jun 10 21:33:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 10 Jun 2015 21:33:17 -0700
Subject: [ovs-discuss] OVSDB updates, IDL consistency
In-Reply-To: <CAEgOKCxpCUuNHtxZrCCV6O5Hpc1f-ePMxtCJvHRN87L1pyM11A@mail.gmail.com>
References: <CAEgOKCyi5w-0mcwNDtaMN+_XPw1h_DyG0puTrD5qkMgzRyL5BQ@mail.gmail.com>
 <20150610145520.GB26182@nicira.com>
 <20150610151528.GA673@nicira.com>
 <CAEgOKCw4XzgGbJjVvrxcT9Qmp800UqGo6O7RJOP0_24iqrNPrA@mail.gmail.com>
 <CAEgOKCzUePP6bgrMxFnWFJt4iMTUV4iiYAEzraP0d-96cX0_gQ@mail.gmail.com>
 <20150610195119.GB1318@nicira.com>
 <CAEgOKCyOE7VWjEAc2h1SGv8rJAkqUPipyOP9Jho6y3Wkq+JKgA@mail.gmail.com>
 <20150611010640.GA12316@nicira.com>
 <CAEgOKCxpCUuNHtxZrCCV6O5Hpc1f-ePMxtCJvHRN87L1pyM11A@mail.gmail.com>
Message-ID: <20150611043317.GA15439@nicira.com>

It's probably a long-standing bug then.

Does the problem seem correlated with a high transaction rate on the
database server, or does it happen even at a low to medium pace?  Do you
have other hints to what might trigger the issue?

On Wed, Jun 10, 2015 at 06:19:19PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> This happens with an older (more than 6 month) OVSDB server. It is
> difficult to reproduce this behaviour.
> 
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
> 
> On Wed, Jun 10, 2015 at 6:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > The database server should always report a single transaction as a
> > single update.  It can sometimes merge multiple transactions into one
> > update but it's a bug if it ever splits a single transaction into
> > multiple updates.
> >
> > Is this with bleeding-edge OVS from master, by any chance?  We've had a
> > lot of churn in that code over the last month or so, so new bugs are
> > possible.  (Before that, though, it is basically unchanged for years.)
> >
> > I'd love a reproduction case.
> >
> > On Wed, Jun 10, 2015 at 06:01:16PM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > The transaction reply appears after all the updates are received (but I
> > > dont have those traces at this time)
> > >
> > > Here is the good case where all the changes to the database come in one
> > > giant update instead of split up into 3 updates. Note that in the bad
> > case
> > > the 3 row deletes appeared as 3 different updates. I think the issue is
> > > that sometimes the server will split up the updates.
> > >
> > > good case:
> > >
> > > [001 d 05/28/15 18:17:31.295]  A:dc_rpc:OVS: ovs|654524|jsonrpc|DBG|ssl:
> > > 135.227.147.205:44978: send request, method="transact",
> > >
> > params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","1f1d55cc-6ee4-4c67-81e0-3e5246c93c01"]]],"op":"delete"},{"comment":"thdl
> > > 969","op":"comment"}], id=17043
> > > [001 d 05/28/15 18:17:31.301]  A:dc_rpc:OVS:
> > > ovs|654526|poll_loop|DBG|wakeup due to [POLLIN] on fd 154 (FIFO) at
> > > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > > [001 d 05/28/15 18:17:31.304]  A:dc_rpc:OVS:
> > > ovs|654527|poll_loop|DBG|wakeup due to [POLLIN] on fd 9378 (
> > > 135.227.144.122:6632<->135.227.147.205:44978) at
> > > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > > [001 d 05/28/15 18:17:31.307]  A:dc_rpc:OVS: ovs|654528|jsonrpc|DBG|ssl:
> > > 135.227.147.205:44978: received notification, method="update",
> > >
> > params=[null,{"Physical_Locator":{"f22d3188-8495-4108-8403-bd1c89a3801c":{"old":{"dst_ip":"10.15.33.254","encapsulation_type":"vxlan_over_ipv4"}}},"Physical_Locator_Set":{"dfdba754-179d-4380-bab0-6d1968dfa5ff":{"old":{"locators":["uuid","f22d3188-8495-4108-8403-bd1c89a3801c"]}}},"Mcast_Macs_Remote":{"1f1d55cc-6ee4-4c67-81e0-3e5246c93c01":{"old":{"ipaddr":"","logical_switch":["uuid","c70577c4-e61d-4049-9987-3b9f8bce19db"],"locator_set":["uuid","dfdba754-179d-4380-bab0-6d1968dfa5ff"],"MAC":"unknown-dst"}}}
> > >
> > >
> > > bad case:
> > >
> > > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS: ovs|09826|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: send request, method="transact",
> > >
> > params=["hardware_vtep",{"lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > > 20","op":"comment"}], id=201
> > > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> > ovs|09828|poll_loop|DBG|wakeup
> > > due to [POLLIN] on fd 154 (FIFO) at
> > > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> > ovs|09829|poll_loop|DBG|wakeup
> > > due to [POLLIN] on fd 246 (135.227.144.122:6632<->135.227.147.205:43858)
> > at
> > > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS: ovs|09830|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: received notification, method="update",
> > >
> > params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS: ovs|09831|jsonrpc|DBG|ssl:
> > > 135.227.147.205:43858: received notification, method="update",
> > >
> > params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> > >
> > > < the Mcast_Macs_Remote update came at this point but I dont have the
> > trace
> > > with me >
> > >
> > >
> > >
> > > --
> > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > >
> > > On Wed, Jun 10, 2015 at 12:51 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > The updates you're showing me might not be related to the transaction
> > at
> > > > all, since the update doesn't mention the Mcast_Macs_Remote table.
> > > > Where's the transaction reply?
> > > >
> > > > On Wed, Jun 10, 2015 at 09:50:47AM -0700, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > > > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > > > An example of where deletes are received out of order:
> > Mcast_Macs_Remote
> > > > > points to Physical_Locator_Set which points to Physical_Locator.
> > When a
> > > > > transaction deletes Mcast_Macs_Remote, delete for
> > Physical_Locator_Set is
> > > > > received first.
> > > > >
> > > > > [027 m 05/26/15 22:22:16.824]  A:dc_rpc:OVS:
> > ovs|09826|jsonrpc|DBG|ssl:
> > > > > 135.227.147.205:43858: send request, method="transact",
> > > > > params=["hardware_vtep",{"
> > > > >
> > > >
> > lock":"my_controller","op":"assert"},{"table":"Mcast_Macs_Remote","where":[["_uuid","==",["uuid","63bdbbfe-0f90-4f33-acdd-f6334852302c"]]],"op":"delete"},{"comment":"thdl
> > > > > 20","op":"comment"}], id=201
> > > > > [027 m 05/26/15 22:22:16.832]  A:dc_rpc:OVS:
> > > > ovs|09828|poll_loop|DBG|wakeup
> > > > > due to [POLLIN] on fd 154 (FIFO) at
> > > > > /home/saurabh/dc35/os/ovs/lib/stream-fd.c:131 (0% CPU usage)
> > > > > [027 m 05/26/15 22:22:16.835]  A:dc_rpc:OVS:
> > > > ovs|09829|poll_loop|DBG|wakeup
> > > > > due to [POLLIN] on fd 246 (135.227.144.122:6632<->
> > 135.227.147.205:43858)
> > > > at
> > > > > /home/saurabh/dc35/os/ovs/lib/stream-ssl.c:744 (0% CPU usage)
> > > > > [027 m 05/26/15 22:22:16.838]  A:dc_rpc:OVS:
> > ovs|09830|jsonrpc|DBG|ssl:
> > > > > 135.227.147.205:43858: received notification, method="update",
> > > > >
> > > >
> > params=[null,{"Physical_Locator_Set":{"ff6908de-98aa-4c30-8809-7e1395ea13c9":{"old":{"locators":["uuid","901cdefe-0292-48bb-a9df-6a4837061931"]}}}}]
> > > > > [027 m 05/26/15 22:22:16.846]  A:dc_rpc:OVS:
> > ovs|09831|jsonrpc|DBG|ssl:
> > > > > 135.227.147.205:43858: received notification, method="update",
> > > > >
> > > >
> > params=[null,{"Physical_Locator":{"901cdefe-0292-48bb-a9df-6a4837061931":{"old":{"dst_ip":"10.50.50.1","encapsulation_type":"vxlan_over_ipv4"}}}}]
> > > > >
> > > > >
> > > > >
> > > > > --
> > > > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > > > >
> > > > > On Wed, Jun 10, 2015 at 9:41 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­
> > à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> > > > > saurabh at gmail.com> wrote:
> > > > >
> > > > > > Thanks Ben. I have seen that when a transaction is deleting rowA
> > which
> > > > > > points to rowB which points to rowC, and if all the references to
> > rowB
> > > > and
> > > > > > rowC are gone, the updates generated can be in any order ie rowC
> > > > delete can
> > > > > > be received before deletes for rowA or rowB. Should this be
> > expected
> > > > for
> > > > > > "deletes"?
> > > > > >
> > > > > >
> > > > > > --
> > > > > > Saurabh (à¤¸à¥Œà¤°à¤­)
> > > > > >
> > > > > > On Wed, Jun 10, 2015 at 8:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > > >
> > > > > >> On Wed, Jun 10, 2015 at 07:55:20AM -0700, Ben Pfaff wrote:
> > > > > >> > On Tue, Jun 09, 2015 at 11:16:34PM -0700, Saurabh Shrivastava
> > (à¤¸à¥Œà¤°à¤­
> > > > > >> à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) wrote:
> > > > > >> > > When OVSDB server sends updates to an OVSDB client, the IDL
> > > > changes
> > > > > >> > > idl_seqno. When idl_seqno changes, the client can rebrowse
> > the IDL
> > > > > >> and look
> > > > > >> > > for changes.
> > > > > >> > >
> > > > > >> > > Does OVSDB server guarantee that the updates always maintain
> > > > > >> referential
> > > > > >> > > integrity for row creation and row updates i.e. if the client
> > > > browses
> > > > > >> the
> > > > > >> > > IDL it should never run into a situation where rowA in tableA
> > > > points
> > > > > >> to a
> > > > > >> > > non-existent rowB in tableB because the update for rowA has
> > > > arrived
> > > > > >> but
> > > > > >> > > update for rowB is still in flight.
> > > > > >> >
> > > > > >> > Yes.
> > > > > >>
> > > > > >> I sent out a patch to document this:
> > > > > >>
> > http://openvswitch.org/pipermail/dev/2015-June/056200.html
> > > > > >>
> > > > > >
> > > > > >
> > > >
> >

From ciara.loftus at intel.com  Thu Jun 11 03:16:58 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Thu, 11 Jun 2015 10:16:58 +0000
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
 usage.
In-Reply-To: <CAPykWKENyJ_zVUxTTeBnAi=H+1VvAprO_nRtVzB3dmoqyG6BWQ@mail.gmail.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <74F120C019F4A64C9B78E802F6AD4CC225E91197@IRSMSX106.ger.corp.intel.com>
 <CAPykWKENyJ_zVUxTTeBnAi=H+1VvAprO_nRtVzB3dmoqyG6BWQ@mail.gmail.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC225E96522@IRSMSX106.ger.corp.intel.com>


> Hello Ciara Loftus!
> 
> Thank you for the information.

You're welcome.

> The reason I'm using 2.0 qemu is that on newest versions following
> INSTALL.DPDK.md I've received following error
> 
> ERROR:/build/buildd/qemu-
> 2.0.0+dfsg/qom/object.c:437:object_new_with_type: assertion failed: (type
> != NULL)

QEMU 2.0 will not work with dpdkvhost ports, you cannot use it.
I get the same error as this when I try to use QEMU 2.0, you need to use QEMU 2.1 or later.

> 
> While using this command
> 
> /usr/bin/qemu-system-x86_64
> Â -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
> file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none -
> object memory-backend-file,id=mem,size=2048M,mem-
> path=/dev/hugepages, share=on -numa node,memdev=mem -mem-
> prealloc -netdev
> type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,v
> hostfd=3 -device virtio-net-
> pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,gu
> est_tso6=off,guest_ecn=off
> 
> It's blocked me to configure appropriate VM attached to file descriptor.
> 
> Does the configuration above correct to launch VM instance?

Yes it should, but only if you use QEMU v2.1 or later. Use this same command with QEMU v2.1 and your VM should boot.

> 
> 
> 

From ciara.loftus at intel.com  Thu Jun 11 03:22:48 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Thu, 11 Jun 2015 10:22:48 +0000
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
 usage.
In-Reply-To: <5575A8C1.3090504@linux.vnet.ibm.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>
 <5575A8C1.3090504@linux.vnet.ibm.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC225E96540@IRSMSX106.ger.corp.intel.com>

> 
> I too observed dpdkhost0 mac of addr:00:00:00:00:00:00 in ovs. I do not
> see packets
> sent by VM on this port and seen by ovs (in fact, dump-flows also report
> 0 packets).
> 
> I am looking for any one opinion on this if dpdkhost0 mac reported is
> expected
> (and to quickly debug any other problem there).

This mac of all zeros is expected.

> 
> I am on qemu 2.1.0 as well.
> 
> Thank you,
> Gowrishankar
> 

From prask9 at gmail.com  Thu Jun 11 03:55:14 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Thu, 11 Jun 2015 16:25:14 +0530
Subject: [ovs-discuss] Flows unmodified after clearing mirror
Message-ID: <CABZU2_RMiqGPULEsmt1VQx9vwocCzQY4bZ3qgMd0W6D2U7izxA@mail.gmail.com>

Hello,
 i am trying SPAN in openvswitch 2.3.0, by mirroring source traffic of
oct0 to output on port oct1.

After i start traffic, i can see packets in oct1. While  traffic is
running, i cleared the mirror. But still see mirroring happening.
Mirroring stops only after i stop and start traffic again. is this a
bug?


Mirror creation:

ovs-vsctl -- set Bridge br0 mirrors=@m  -- --id=@h0 get Port oct0  --
--id=@h1 get Port oct1  -- --id=@m create Mirror name=mymirror
select-src-p
ort=@h0 output-port=@h1
dc075662-e0f6-406f-a8e6-142ccbbdc287
~ #

Flows  with mirroring:

~ # ovs-dpctl dump-flows
recirc_id(0),skb_priority(0),in_port(3),eth(src=00:0f:b7:84:e6:d8,dst=00:0f:b7:84:39:6a),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:123380, bytes:12091240, used:0.000s, actions:2
recirc_id(0),skb_priority(0),in_port(2),eth(src=00:0f:b7:84:39:6a,dst=00:0f:b7:84:e6:d8),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:123380, bytes:12091240, used:0.000s, actions:3,4


Mirror delete:
#ovs-vsctl clear bridge br0 mirrors


Flows after mirror clear
~ #
~ # ovs-dpctl dump-flows
recirc_id(0),skb_priority(0),in_port(3),eth(src=00:0f:b7:84:e6:d8,dst=00:0f:b7:84:39:6a),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:127517, bytes:12496666, used:0.000s, actions:2
recirc_id(0),skb_priority(0),in_port(2),eth(src=00:0f:b7:84:39:6a,dst=00:0f:b7:84:e6:d8),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:127517, bytes:12496666, used:0.001s, actions:3,4
~ #


~ # ovs-dpctl show
system at ovs-system:
        lookups: hit:84810774 missed:6330 lost:0
        flows: 2
        masks: hit:84819861 total:1 hit/pkt:1.00
        port 0: ovs-system (internal)
        port 1: br0 (internal)
        port 2: oct0
        port 3: poct0
        port 4: oct1


Thanks,
Prashanth

From fichera.sil at gmail.com  Thu Jun 11 08:16:45 2015
From: fichera.sil at gmail.com (Silvia Fichera)
Date: Thu, 11 Jun 2015 17:16:45 +0200
Subject: [ovs-discuss] VMs can't ping each other
Message-ID: <CAEFdjR04wrp5MB5H7X6deDEVXBCN62s9C0VJr1oVZ9NGGp=-2A@mail.gmail.com>

Hi all,
I have a server with several VMs. One of these acts as my OVS. The others
are connected to it through bridges. It means that eth1 of each VM is
connected to the eth-x of the OVS.
I have also put an ODL Controller who is able to detect the network.
When I try to ping from 10.0.0.1 to 10.0.0.2 I receive the message
"Destination host unreachble".
I dumped the traffic and I can see that the arp request arrives to the
destination, the arp reply is sent but it never reaches the switch.
According to your knoledge, could be that it is blocked in some way by the
bridge?

If you need further information feel free to contact me.
Thanks
Regards,

-- 
Silvia Fichera
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/3f9fc2b9/attachment.html>

From ddesimon at cisco.com  Mon Jun  8 12:30:45 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Mon, 8 Jun 2015 19:30:45 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <20150522191000.GG30148@nicira.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com> <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com> <20150515233429.GC14637@nicira.com>
 <D17F667F.18A5FB%ddesimon@cisco.com> <20150518235408.GC6582@nicira.com>
 <D1841C82.18C29D%ddesimon@cisco.com> <20150522191000.GG30148@nicira.com>
Message-ID: <D19B643F.193A88%ddesimon@cisco.com>

Hi Ben,

IÂ¹m still not there yet. But I did see this commit,
19aef6ef26d36511d820e3e629c57df59eb0941d

auto-attach: Implement interface lldp disable and re-enable

This commit completes the implementation of the lldp enable
option. Specifically after enabling lldp on a particular interface, lldp
can
now be disabled and subsequently re-enabled. OVS will not transmit or
receive
lldp packets if lldp is disabled on the interface



When will there be another OVS release, so I can pick this up.

IÂ¹m trying to pull the latest code and build an RPM following this,
https://github.com/openvswitch/ovs/blob/master/INSTALL.RHEL.md

But this web page I think only converts a released OVS into an RPM?

Thanks,

â€¹Dave


On 5/22/15, 3:10 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Fri, May 22, 2015 at 03:45:54AM +0000, Dave DeSimone (ddesimon) wrote:
>> Just a fundamental question, that IÂ¹m not understanding.
>> 
>> Here is my bridge
>> 
>>     Bridge "br0"
>>         Port "br0"
>>             Interface "br0"
>>                 type: internal
>>         Port "enp130s0f0"
>>             Interface "enp130s0f0"
>>         Port "mgmt0"
>>             Interface "mgmt0"
>>                 type: internal
>> 
>> 
>> mgmt0 is carrying the ip address.
>> 
>> IÂ¹ve added a flow with this:
>> 
>> ovs-ofctl add-flow br0 dl_type=0x88cc,action=flood
>> 
>> 
>> 
>> When I dump the flows, I see pkts
>> 
>> ovs-ofctl dump-flows br0
>> 	NXST_FLOW reply (xid=0x4):
>> 	cookie=0x0, duration=23254.816s, table=0, n_packets=4647,
>> n_bytes=1329042, idle_age=3, dl_type=0x88cc actions=FLOOD
>> 
>> 
>> 
>> 
>> I also ran tcpdump on the mgmt0 interface and I see the lldp packets
>>there.
>> 
>> 
>> So, it looks like the pkts are coming in on the physical interface
>> (enp130s0f0) and getting sent to the internal interface mgmt0. But the
>> lldp daemon running on the linux os still is not seeing the pkts.
>> 
>> 
>> Is this valid? Why wouldnÂ¹t the lldp process see these packets is they
>> appear on the mgmt0 interface?
>
>If the packets show up in tcpdump on mgmt0, then that means that OVS
>sent them to the device.  Anything that happens beyond that point isn't
>the responsibility of OVS; OVS has no control over it.  In fact, it
>seems likely that the LLDP process receives packets from mgmt0 in the
>same way that tcpdump does, so it is a puzzle to me why it wouldn't see
>them.
>
>I know that's not really very helpful but I don't have experience with
>lldp daemons on Linux so I don't know what else to say.
>
>If you figure out what's going on then I'd be happy to add something to
>the FAQ to explain.


From nagaravind at gmail.com  Mon Jun  8 19:16:56 2015
From: nagaravind at gmail.com (aravind C)
Date: Mon, 8 Jun 2015 19:16:56 -0700
Subject: [ovs-discuss] Support for arp requests with bonding
Message-ID: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>

Hi,
I am using the following setup to test interface bonding with OVS.

VM1         |       VM2

(10.10.10.2/16)     (10.10.10.3/16)
    eth1 ========== eth1
   /                                 \
  /                                   \
bond0                              bond0
  \                                   /
   \                                 /
    eth2 ========== eth2
(10.10.20.2/16)     (10.10.20.3/16)

I can see that -
1. lacp status is negotiated
2. On both VMs initially eth1 is enabled and eth2 is the active slave

Is my assumption wrong that I should be able to ping either of the
bonded interfaces in VM2 from VM1?
- ping shows that the currently active interface is used to send out requests.
- tcpdump shows that the arp requests are received by the active
interface in VM2. No reply is generated.

Can anyone please explain what is wrong in my configuration?

Thanks,
Nagaravind

From calebmyu at gmail.com  Mon Jun  8 19:53:21 2015
From: calebmyu at gmail.com (Caleb Yu)
Date: Tue, 9 Jun 2015 10:53:21 +0800
Subject: [ovs-discuss] Installing openvswitch 1.4.3
Message-ID: <CAJ9ww9hBZtXBftFKqepa7ZfCxhQUaAHOcd5vB2PWtCFEDfwG4g@mail.gmail.com>

To whom it may concern,
Do to some research I need to install openvswitch 1.4.3 in unbuntu 12.04
with kernel 3.2.0-77-generic amd 64.  ./configure
--with-linux=/lib/modules/3.2.0-77-generic/build. During make I received
the following error.

/home/pads/Desktop/sdn/openvswitch-1.4.3/datapath/linux/tunnel.c:1294:3:
error: too many arguments to function â€˜ip_select_identâ€™
include/net/ip.h:291:20: note: declared here
make[5]: ***
[/home/pads/Desktop/sdn/openvswitch-1.4.3/datapath/linux/tunnel.o] Error 1

As a result, no .ko file was created. From online I see that openvswitch
1.4.3 support kernel version up to 3.2. Is my kernel version still too
high? Will kernel version 3.1 work better? Thank you.
Caleb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150609/d04bade2/attachment.html>

From harshjain.prof at gmail.com  Mon Jun  8 19:57:07 2015
From: harshjain.prof at gmail.com (Harsh Jain)
Date: Tue, 9 Jun 2015 08:27:07 +0530
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
Message-ID: <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>

Hi Ansis,

 I used "ip xfrm add policy" command to add policy.
I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
I tested with GRE key value only.I will test weather Port no, based
filtering is supported in OVS or not and revert.


Regards
Harsh jain


Regards
Harsh Jain

On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>> Hi,
>>
>>
>> While trying to encrypt(IPsec policy) packets  based on GRE key
>> received in packets. kernel didn't encrypted the packets received from
>> OVS bridge. The packets forwarded to Desination unencrypted.
>> Kernel treats packet having different keys as same flow type.
>
> It seems that you are not using ovs-monitor-ipsec to install IPsec
> policies for you?
>
>>
>>
>> Kernel Version used : 3.18.14
>> ovs-vswitchd (Open vSwitch) 2.0.1
>> Compiled Apr 16 2014 14:19:17
>> OpenFlow versions 0x1:0x1
>>
>> Fix Applied :  Find attached initial patch.
>>
>> Please confirm if it is bug?.
>
> I think this could be classified as bug for those use cases when one
> wants to install such fine grained IPsec policies based on GRE key.
> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
>
>
>>
>>
>> Regards
>> Harsh Jain
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>

From calebmyu at gmail.com  Mon Jun  8 21:04:58 2015
From: calebmyu at gmail.com (Caleb Yu)
Date: Tue, 9 Jun 2015 12:04:58 +0800
Subject: [ovs-discuss] Installing openvswitch 1.4.3
In-Reply-To: <CAJ9ww9hBZtXBftFKqepa7ZfCxhQUaAHOcd5vB2PWtCFEDfwG4g@mail.gmail.com>
References: <CAJ9ww9hBZtXBftFKqepa7ZfCxhQUaAHOcd5vB2PWtCFEDfwG4g@mail.gmail.com>
Message-ID: <CAJ9ww9iL4TR5ZgCiq1G_M4q9tfCjUC-JXpLLqfCAGeWN0sX4xw@mail.gmail.com>

About the question, I solve it. There some prerequisite programs I didn't
install. Thank you.
Caleb
On Jun 9, 2015 10:53 AM, "Caleb Yu" <calebmyu at gmail.com> wrote:

> To whom it may concern,
> Do to some research I need to install openvswitch 1.4.3 in unbuntu 12.04
> with kernel 3.2.0-77-generic amd 64.  ./configure
> --with-linux=/lib/modules/3.2.0-77-generic/build. During make I received
> the following error.
>
> /home/pads/Desktop/sdn/openvswitch-1.4.3/datapath/linux/tunnel.c:1294:3:
> error: too many arguments to function â€˜ip_select_identâ€™
> include/net/ip.h:291:20: note: declared here
> make[5]: ***
> [/home/pads/Desktop/sdn/openvswitch-1.4.3/datapath/linux/tunnel.o] Error 1
>
> As a result, no .ko file was created. From online I see that openvswitch
> 1.4.3 support kernel version up to 3.2. Is my kernel version still too
> high? Will kernel version 3.1 work better? Thank you.
> Caleb
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150609/912e1592/attachment-0001.html>

From shenwei3 at huawei.com  Tue Jun  9 05:25:36 2015
From: shenwei3 at huawei.com (shenwei (G))
Date: Tue, 9 Jun 2015 12:25:36 +0000
Subject: [ovs-discuss] =?gb2312?b?tPC4tDogtPC4tDogIKG+c2Vla2luZyBoZWxwob9w?=
 =?gb2312?b?b3J0LWFkZGVkIGVycm9yICYmIG9wZW5mbG93LXBvcnQgTnVtYmVyIGVycm9y?=
In-Reply-To: <20150608153143.GG28071@nicira.com>
References: <85A20DEA89D668448D376D1D8313346ACBFA3F@SZXEML503-MBS.china.huawei.com>
 <20150606040233.GC8799@nicira.com>
 <85A20DEA89D668448D376D1D8313346ACBFB16@SZXEML503-MBS.china.huawei.com>
 <20150608153143.GG28071@nicira.com>
Message-ID: <85A20DEA89D668448D376D1D8313346ACBFBC5@SZXEML503-MBS.china.huawei.com>

Hi Ben,

Thank you. I really appreciate your help.

Use the lsof command to find out that ovs-swtichd process has run out of the file descriptors when errors happened. 
Then I changed the system-wide maximum number of file handles from 1024 to 65535. The errors were fixed finally.

Best regards.
Wei Shen


-----é‚®ä»¶åŽŸä»¶-----
å‘ä»¶äºº: Ben Pfaff [mailto:blp at nicira.com] 
å‘é€æ—¶é—´: 2015å¹´6æœˆ8æ—¥ 23:32
æ”¶ä»¶äºº: shenwei (G)
æŠ„é€: discuss at openvswitch.org
ä¸»é¢˜: Re: ç­”å¤: [ovs-discuss] ã€seeking helpã€‘port-added error && openflow-port Number error

On Mon, Jun 08, 2015 at 11:00:27AM +0000, shenwei (G) wrote:
> As below ,I have got more details about the problem.
>  
> 1\ the total number of ports added to OVS bridge successfully is fixed. only when deleted one port(using ovs-vsctl del-port bridge_1 group11_0),another port could be added.
> 2\ when I set the veth interfaces as internal mode (ovs-vsctl set Interface group12_0 type=internal),all the ports can be added to the OVS bridge successfully. but openflow port number can`t be created at this time.

Are you running out of file descriptors?

From smatov at mirantis.com  Wed Jun 10 01:15:25 2015
From: smatov at mirantis.com (Sergey Matov)
Date: Wed, 10 Jun 2015 11:15:25 +0300
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
	usage.
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC225E91197@IRSMSX106.ger.corp.intel.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <74F120C019F4A64C9B78E802F6AD4CC225E91197@IRSMSX106.ger.corp.intel.com>
Message-ID: <CAPykWKENyJ_zVUxTTeBnAi=H+1VvAprO_nRtVzB3dmoqyG6BWQ@mail.gmail.com>

Hello Ciara Loftus!

Thank you for the information.
The reason I'm using 2.0 qemu is that on newest versions following
INSTALL.DPDK.md I've received following error

ERROR:/build/buildd/qemu-2.0.0+dfsg/qom/object.c:437:object_new_with_type:
assertion failed: (type != NULL)

While using this command

/usr/bin/qemu-system-x86_64
 -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none *-object
memory-backend-file,id=mem,size=2048M,mem-path=/dev/hugepages, share=on
-numa node,memdev=mem -mem-prealloc* -netdev
type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,vhostfd=3
-device
virtio-net-pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off

It's blocked me to configure appropriate VM attached to file descriptor.

Does the configuration above correct to launch VM instance?




2015-06-08 12:26 GMT+03:00 Loftus, Ciara <ciara.loftus at intel.com>:

> >
> > Hello.
> > I am trying to build VM to VM scheme using Open vSwitch 2.3.9 and DPDK
> > 2.0.0.
> > After building and installing OVS+DPDK I'm running single bridge with
> extra
> > port dpdkvhost type.
> > I'm using user-defined vhost device called vhost-net1.
> >
> >
> > #ovs-vswitchd --dpdk --cuse_dev_name vhost-net1 -c 0x01 -n 4 --socket-
> > mem 1024,0 -- unix:/usr/local/var/run/openvswitch/db.sock --pidfile --
> > detach
> >
> > 014d4a3f-0a8a-4d8f-8fc3-222775266ebf
> >     Bridge "br10"
> >         Port "dpdkvhost0"
> >             Interface "dpdkvhost0"
> >                 type: dpdkvhost
> >         Port "br10"
> >             Interface "br10"
> >                 type: internal
> >
> > Then I'm trying to run single KVM VM using qemu 2.0 (pretty old with
> -mem-
> > prealloc option)
>
> This will not work. If you are using the mem-prealloc & associated
> arguments you mention below,
> you will need to use QEMU v1.6.2. If you wish to use a newer version of
> QEMU than v1.6.2, you will
> need to use at least v2.1.0, with the -object memory-backend-file
> arguments, as documented in
> INSTALL.DPDK.md.
>
> >
> > #/usr/bin/qemu-system-x86_64
> >  -name qemu_smatov-0 -cpu host -m 2048 -smp 2 -boot once=c -drive
> > file=/var/lib/libvirt/images/qemu_smatov-0.qcow2 -enable-kvm -net none -
> > mem-path /mnt/huge -numa node,memdev=mem -mem-prealloc -netdev
> > type=tap,id=net1,script=no,downscript=no,ifname=dpdkvhost0,vhost=on,v
> > hostfd=3 -device virtio-net-
> > pci,netdev=net1,mac=52:54:f1:61:4c:84,csum=off,gso=off,guest_tso4=off,gu
> > est_tso6=off,guest_ecn=off
> >
>
> [...]
>
> >
> > Does this usage of CPU expected?
> >
> > And, btw, does I need any extra guest VM configuration to run ping/iperf?
> > --
> >
> > Sergey Matov
>
>


-- 
*Best Regards*
*Sergey Matov*
*Mirantis Inc*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/3aaeaa23/attachment-0001.html>

From xinli at bupt.edu.cn  Wed Jun 10 17:18:36 2015
From: xinli at bupt.edu.cn (=?gbk?B?wO7Qwg==?=)
Date: Wed, 10 Jun 2015 17:18:36 +0800(CST)
Subject: [ovs-discuss] =?gbk?q?How_to_extend_OVS_for_Optical_device_=28OTN?=
	=?gbk?q?=2C_ROADM=29?=
Message-ID: <20150610091836.DD8C119F3B9@mx3.bupt.edu.cn>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/97802eab/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Wed Jun 10 02:51:55 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Wed, 10 Jun 2015 14:51:55 +0500
Subject: [ovs-discuss] Learn Action
Message-ID: <CAN-u-61u96E0o-uCROh+MM36cBRiUfa95Pw4PdK39oUgDqwHFg@mail.gmail.com>

Hi,

Can anyone tell how I can use the learn action to change the priority of an
existing flow-entry?

Best,
Haleema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/0b806ce0/attachment-0001.html>

From gca1883 at rit.edu  Wed Jun 10 08:37:22 2015
From: gca1883 at rit.edu (Garrett Auer (RIT Student))
Date: Wed, 10 Jun 2015 11:37:22 -0400
Subject: [ovs-discuss] OpenVswitch spanning question
Message-ID: <CAC0L=vXOHxBPUpaWL_Jikbp92Jj+P_3ZDuKPO8=wmH73cKujPw@mail.gmail.com>

Hello,

I was wondering if some of the devs can help on this one. I am unsure if
this is a bug but I figured I should check with you guys just in case. I
have attached a copy of my topology to this email to better illustrate what
the problem is. I have also attached it to the bottom of this email.

The OVS version I am running is 1.11.0. However I have seen the exact same
behavior using version 2.1.3. I am running cent 6.5 in both environments
with a 2.6.32-431.29.2.el6.x86_64 kernel. I have also tried with the most
up to date kernel and still seeing the same issue.

Am I doing something wrong in my setup? Any information would be greatly
appreciated.

It looks like people have seen this behavior before, refer to the links
below.

-https://ask.openstack.org/en/question/61305/issue-regarding-port-mirroring/
-http://openvswitch.org/pipermail/discuss/2014-June/014318.html

The topology diagram can also be viewed here:
https://visualne.files.wordpress.com/2015/06/traffic-span-problem.jpg



â€‹
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/ca285208/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: traffic-span-problem.jpg
Type: image/jpeg
Size: 45248 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/ca285208/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: traffic-span-problem.jpg
Type: image/jpeg
Size: 45248 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150610/ca285208/attachment-0003.jpg>

From haleema.s.mahmood at gmail.com  Thu Jun 11 01:13:22 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Thu, 11 Jun 2015 13:13:22 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the switch
Message-ID: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>

Hi,

I was wondering if you could help me figuring out where the algorithm for
the group type "select" is implemented in ovs switch files? I want to
implement a function which takes the hash of the src/dst ip, and src/dst
port and selects the corresponding bucket for the packet.

Best,
Haleema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/59e41ade/attachment.html>

From msaifulla at yahoo.com  Thu Jun 11 04:32:26 2015
From: msaifulla at yahoo.com (saifullah M A)
Date: Thu, 11 Jun 2015 11:32:26 +0000 (UTC)
Subject: [ovs-discuss] Group action/updation of group counters
Message-ID: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>

Hi,
I am trying to understand how OVS updates group counters. But I am not able to find the group action in OVS code. Can you please point me how the group (bucket) counters are updated in OVS?
Openflow specification talks about group actions in Section 5.10 of OpenflowSpecification1.3.But I am not able to find the corresponding implementation in OVS code.
Thanks in advance,Saif

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/0cfa5a98/attachment.html>

From blp at nicira.com  Thu Jun 11 09:51:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 09:51:03 -0700
Subject: [ovs-discuss] Learn Action
In-Reply-To: <CAN-u-61u96E0o-uCROh+MM36cBRiUfa95Pw4PdK39oUgDqwHFg@mail.gmail.com>
References: <CAN-u-61u96E0o-uCROh+MM36cBRiUfa95Pw4PdK39oUgDqwHFg@mail.gmail.com>
Message-ID: <20150611165103.GA10099@nicira.com>

On Wed, Jun 10, 2015 at 02:51:55PM +0500, Haleema Sadia wrote:
> Can anyone tell how I can use the learn action to change the priority of an
> existing flow-entry?

It's not possible.

From blp at nicira.com  Thu Jun 11 09:56:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 09:56:23 -0700
Subject: [ovs-discuss] Group action/updation of group counters
In-Reply-To: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>
References: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150611165623.GC10099@nicira.com>

On Thu, Jun 11, 2015 at 11:32:26AM +0000, saifullah M A wrote:
> I am trying to understand how OVS updates group counters. But I am not
> able to find the group action in OVS code. Can you please point me how
> the group (bucket) counters are updated in OVS?

On current master, it happens in xlate_push_stats() in
ofproto-dpif-xlate.c.

From blp at nicira.com  Thu Jun 11 10:40:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 10:40:52 -0700
Subject: [ovs-discuss] Learn Action
In-Reply-To: <CAN-u-61hQC+4u_g1VZdSU3QXzoBDWx2xMA1Su70=s6pzuJyFXw@mail.gmail.com>
References: <CAN-u-61u96E0o-uCROh+MM36cBRiUfa95Pw4PdK39oUgDqwHFg@mail.gmail.com>
 <20150611165103.GA10099@nicira.com>
 <CAN-u-61hQC+4u_g1VZdSU3QXzoBDWx2xMA1Su70=s6pzuJyFXw@mail.gmail.com>
Message-ID: <20150611174052.GB32341@nicira.com>

No.

On Thu, Jun 11, 2015 at 10:22:02PM +0500, Haleema Sadia wrote:
> Is there any other way that I can change the priority of an existing flow?
> 
> 
> 
> On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Jun 10, 2015 at 02:51:55PM +0500, Haleema Sadia wrote:
> > > Can anyone tell how I can use the learn action to change the priority of
> > an
> > > existing flow-entry?
> >
> > It's not possible.
> >

From blp at nicira.com  Thu Jun 11 10:51:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 10:51:56 -0700
Subject: [ovs-discuss] force-reload-kmod and bonding
In-Reply-To: <CAC=Vi+o9Z6X3opSVvHdFXruVdS43=6rCuxXTo+z+TG9-2Hhj1Q@mail.gmail.com>
References: <CAC=Vi+o9Z6X3opSVvHdFXruVdS43=6rCuxXTo+z+TG9-2Hhj1Q@mail.gmail.com>
Message-ID: <20150611175156.GG32341@nicira.com>

On Wed, Jun 10, 2015 at 01:48:49PM -0400, Andy Hill wrote:
> When testing force-reload-kmod on XenServer 6.2 running OVS 2.1/2.3 with
> bonded LACP configurations, the disruption to data plane connectivity is
> much longer than non-bonded configurations.
> 
> While debugging, one area that longer than expected was in the dp-ctl
> del-dp calls[1]. The earlier dump-dps call only returned "system at ovs-system
> ".
> 
> I straced the calls and was surprised with this call taking over 3s:
> 
> https://gist.github.com/andyhky/b531751f00c5ca94ae24#file-bonded-L197
> 
> But non bonded <1s:
> 
> https://gist.github.com/andyhky/b531751f00c5ca94ae24#file-non-bonded-L196
> 
> Repeated testing on different bonded servers all took between 3s-5s.
> Testing on non-bonded servers was always ~1s.
> 
> Within 1s of the del-dp command running, traffic drops from the host. Does
> anyone have ideas on why this would take so much longer on a bonded
> configuration?

At a guess, without looking at code, I'd think that RCU synchronization
on removal from a datapath is costly for physical Ethernet devices and
that it multiples across the number of them present in the datapath.
Pravin, does this make any sense (or do you have another idea)?

From blp at nicira.com  Thu Jun 11 10:53:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 10:53:59 -0700
Subject: [ovs-discuss] prio scheduler
In-Reply-To: <DUB127-W2D0E12EA66EF3BAE259D4C6B20@phx.gbl>
References: <DUB127-W2D0E12EA66EF3BAE259D4C6B20@phx.gbl>
Message-ID: <20150611175359.GH32341@nicira.com>

On Fri, Jun 05, 2015 at 07:19:14PM +0200, Luca Bianchi wrote:
> I am trying to configure QoS on OVS, running on mininet network.
> 
> I install a PRIO qdisc on an interface with the command
> 
> tc qdisc add dev s1-eth4 root handle 1: prio
> 
> and then the classes 1:1, 1:2, 1:3 are automatically created.
> 
> The problem is that every user flow passing from that interface now has the whole interface capacity.
> 
> E.g. 3 user TCP flows pass from this interface (link of capacity 10Mbps), everyone
> is served with 10Mbps...that is impossible. With htb qdisc (also if configured with tc commands)
> there are no problems.

Are you just reporting how the prio qdisc works, or are you talking
about some interaction between OVS and the prio qdisc?

From blp at nicira.com  Thu Jun 11 10:59:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 10:59:03 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
Message-ID: <20150611175903.GJ32341@nicira.com>

On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> I was wondering if you could help me figuring out where the algorithm for
> the group type "select" is implemented in ovs switch files? I want to
> implement a function which takes the hash of the src/dst ip, and src/dst
> port and selects the corresponding bucket for the packet.

xlate_select_group() in ofproto-dpif-xlate.c

From haleema.s.mahmood at gmail.com  Thu Jun 11 11:07:56 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Thu, 11 Jun 2015 23:07:56 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <20150611175903.GJ32341@nicira.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
Message-ID: <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>

What is the current ovs version using for select type? As far as I could
understand it is taking a xor of src and destination addresses and tcp
ports? Is it correct?

On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > I was wondering if you could help me figuring out where the algorithm for
> > the group type "select" is implemented in ovs switch files? I want to
> > implement a function which takes the hash of the src/dst ip, and src/dst
> > port and selects the corresponding bucket for the packet.
>
> xlate_select_group() in ofproto-dpif-xlate.c
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150611/e42bae14/attachment.html>

From scott.lowe at scottlowe.org  Thu Jun 11 13:46:00 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Thu, 11 Jun 2015 14:46:00 -0600
Subject: [ovs-discuss] Support for arp requests with bonding
In-Reply-To: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>
References: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>
Message-ID: <536736D0-D536-4B66-B87E-A4FF23D134FC@scottlowe.org>

Please see my response below.


aravind C <nagaravind at gmail.com> wrote:

> Hi,
> I am using the following setup to test interface bonding with OVS.
> 
> VM1         |       VM2
> 
> (10.10.10.2/16)     (10.10.10.3/16)
>    eth1 ========== eth1
>   /                                 \
>  /                                   \
> bond0                              bond0
>  \                                   /
>   \                                 /
>    eth2 ========== eth2
> (10.10.20.2/16)     (10.10.20.3/16)
> 
> I can see that -
> 1. lacp status is negotiated
> 2. On both VMs initially eth1 is enabled and eth2 is the active slave
> 
> Is my assumption wrong that I should be able to ping either of the
> bonded interfaces in VM2 from VM1?
> - ping shows that the currently active interface is used to send out requests.
> - tcpdump shows that the arp requests are received by the active
> interface in VM2. No reply is generated.
> 
> Can anyone please explain what is wrong in my configuration?



Perhaps I'm completely misunderstanding what you're trying to accomplish here, but as I understand it you'd want the IP address assigned to the bond, not the individual interfaces that are members of the bond.

-- 
Scott


From nagaravind at gmail.com  Thu Jun 11 13:53:19 2015
From: nagaravind at gmail.com (aravind C)
Date: Thu, 11 Jun 2015 13:53:19 -0700
Subject: [ovs-discuss] Support for arp requests with bonding
In-Reply-To: <536736D0-D536-4B66-B87E-A4FF23D134FC@scottlowe.org>
References: <CAJYsdDgOT_z+4SeORipETet8Q4N8CRhfKXsGxbCqRnZkqwzW-w@mail.gmail.com>
 <536736D0-D536-4B66-B87E-A4FF23D134FC@scottlowe.org>
Message-ID: <CAJYsdDjRD2s2pCbDt9dzFSL6gr38erzwrrPjFHeD=jGKziVJjQ@mail.gmail.com>

Andy/Scott,
Thanks for your responses. My initial understanding was wrong. I
should have assigned the IP to the bridge and not the individual
interfaces.

Nagaravind

On Thu, Jun 11, 2015 at 1:46 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my response below.
>
>
> aravind C <nagaravind at gmail.com> wrote:
>
>> Hi,
>> I am using the following setup to test interface bonding with OVS.
>>
>> VM1         |       VM2
>>
>> (10.10.10.2/16)     (10.10.10.3/16)
>>    eth1 ========== eth1
>>   /                                 \
>>  /                                   \
>> bond0                              bond0
>>  \                                   /
>>   \                                 /
>>    eth2 ========== eth2
>> (10.10.20.2/16)     (10.10.20.3/16)
>>
>> I can see that -
>> 1. lacp status is negotiated
>> 2. On both VMs initially eth1 is enabled and eth2 is the active slave
>>
>> Is my assumption wrong that I should be able to ping either of the
>> bonded interfaces in VM2 from VM1?
>> - ping shows that the currently active interface is used to send out requests.
>> - tcpdump shows that the arp requests are received by the active
>> interface in VM2. No reply is generated.
>>
>> Can anyone please explain what is wrong in my configuration?
>
>
>
> Perhaps I'm completely misunderstanding what you're trying to accomplish here, but as I understand it you'd want the IP address assigned to the bond, not the individual interfaces that are members of the bond.
>
> --
> Scott
>

From blp at nicira.com  Thu Jun 11 15:20:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 15:20:24 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
Message-ID: <20150611222024.GB23632@nicira.com>

The default is a hash (not just an xor) over fields up to L4, but you
can configure another method using the extensions implemented by
Netronome.

On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> What is the current ovs version using for select type? As far as I could
> understand it is taking a xor of src and destination addresses and tcp
> ports? Is it correct?
> 
> On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > I was wondering if you could help me figuring out where the algorithm for
> > > the group type "select" is implemented in ovs switch files? I want to
> > > implement a function which takes the hash of the src/dst ip, and src/dst
> > > port and selects the corresponding bucket for the packet.
> >
> > xlate_select_group() in ofproto-dpif-xlate.c
> >

From blp at nicira.com  Thu Jun 11 15:21:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 11 Jun 2015 15:21:55 -0700
Subject: [ovs-discuss] prio scheduler
In-Reply-To: <DUB127-W5889817252F854F461E17C6BC0@phx.gbl>
References: <DUB127-W2D0E12EA66EF3BAE259D4C6B20@phx.gbl>
 <20150611175359.GH32341@nicira.com>
 <DUB127-W5889817252F854F461E17C6BC0@phx.gbl>
Message-ID: <20150611222155.GC23632@nicira.com>

Please don't drop the mailing list.

Are you sure Mininet isn't interfering?  It also sets up QoS.

Are you directing packets to queues?

### Q: I configured Quality of Service (QoS) in my OpenFlow network by
   adding records to the QoS and Queue table, but the results aren't
   what I expect.

A: Did you install OpenFlow flows that use your queues?  This is the
   primary way to tell Open vSwitch which queues you want to use.  If
   you don't do this, then the default queue will be used, which will
   probably not have the effect you want.

   Refer to the previous question for an example.

On Thu, Jun 11, 2015 at 08:17:09PM +0200, Luca Bianchi wrote:
> Hi,I am trying to configure a prio qdisc on an OVS switch (all the network is emulated on Mininet).Since officially OVS does not support this type of qdisc, I used directly tc commands to configure it.Then, when making packets pass through the interface with prio qdisc,I noticed this strange behaviour, and I think it's an interaction problem between OVS and prio.Can you please help me to do this configuration?Thank youBest Regards
> Luca Bianchi
> 
> > Date: Thu, 11 Jun 2015 10:53:59 -0700
> > From: blp at nicira.com
> > To: lucabianchi91 at hotmail.it
> > CC: bugs at openvswitch.org
> > Subject: Re: [ovs-discuss] prio scheduler
> > 
> > On Fri, Jun 05, 2015 at 07:19:14PM +0200, Luca Bianchi wrote:
> > > I am trying to configure QoS on OVS, running on mininet network.
> > > 
> > > I install a PRIO qdisc on an interface with the command
> > > 
> > > tc qdisc add dev s1-eth4 root handle 1: prio
> > > 
> > > and then the classes 1:1, 1:2, 1:3 are automatically created.
> > > 
> > > The problem is that every user flow passing from that interface now has the whole interface capacity.
> > > 
> > > E.g. 3 user TCP flows pass from this interface (link of capacity 10Mbps), everyone
> > > is served with 10Mbps...that is impossible. With htb qdisc (also if configured with tc commands)
> > > there are no problems.
> > 
> > Are you just reporting how the prio qdisc works, or are you talking
> > about some interaction between OVS and the prio qdisc?
>  		 	   		  

From jpettit at nicira.com  Thu Jun 11 23:03:03 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 11 Jun 2015 23:03:03 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
Message-ID: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>

We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:

	- Native Linux kernel STT support
	- Geneve tunneling
	- DPDK vhost and tunneling
	- OpenFlow 1.4 bundles (flow transactions)
	- Bash command completion
	- RSTP
	- Multicast snooping
	- Support for Linux kernels up to 4.0.x

The plan is to branch early next week and have an official release ready roughly six weeks after that.

We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.  

Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.

Happy switching!

--Justin



From liw at dtdream.com  Thu Jun 11 23:13:09 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Fri, 12 Jun 2015 14:13:09 +0800
Subject: [ovs-discuss]
	=?utf-8?q?=5Bovs-announce=5D_OVS_2=2E4_Release_Plan?= =?utf-8?q?s?=
In-Reply-To: 88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com
References: 88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com
Message-ID: <----P3------meVv3$fe41f4d8-6802-4850-852b-5e655062b68f@dtdream.com>

StatefulÂ Connection Tracking & Stateful NA is not in this release?*********************RTFSC*********************------------------------------------------------------------------From:Justin Pettit <jpettit at nicira.com>Send Time:2015å¹´6æœˆ12æ—¥(æ˜ŸæœŸäº”) 14:03To:announce <announce at openvswitch.org>ï¼Œdiscuss <discuss at openvswitch.org>Subject:[ovs-announce] OVS 2.4 Release PlansWeÂ wantedÂ toÂ provideÂ aÂ quickÂ updateÂ onÂ theÂ planÂ forÂ theÂ nextÂ coupleÂ releases.Â Â OVSÂ 2.4Â isÂ shapingÂ upÂ toÂ beÂ aÂ bigÂ releaseÂ withÂ aÂ numberÂ ofÂ greatÂ newÂ featuresÂ peopleÂ areÂ anxiousÂ toÂ use.Â SomeÂ ofÂ theÂ highlightsÂ include:Â -Â NativeÂ LinuxÂ kernelÂ STTÂ supportÂ -Â GeneveÂ tunnelingÂ -Â DPDKÂ vhostÂ andÂ tunnelingÂ -Â OpenFlowÂ 1.4Â bundlesÂ (flowÂ transactions)Â -Â BashÂ commandÂ completionÂ -Â RSTPÂ -Â MulticastÂ snoopingÂ -Â SupportÂ forÂ LinuxÂ kernelsÂ upÂ toÂ 4.0.xTheÂ planÂ isÂ toÂ branchÂ earlyÂ nextÂ weekÂ andÂ haveÂ anÂ officialÂ releaseÂ readyÂ roughlyÂ sixÂ weeksÂ afterÂ that.WeÂ originallyÂ hadÂ plannedÂ toÂ releaseÂ OVSÂ 2.4Â whenÂ theÂ newÂ connectionÂ trackingÂ featuresÂ wereÂ mergedÂ intoÂ theÂ upstreamÂ kernel.Â Unfortunately,Â thisÂ hasÂ takenÂ longerÂ thanÂ weÂ anticipated.Â Â WeÂ feelÂ weÂ areÂ makingÂ progressÂ onÂ thatÂ front,Â andÂ onceÂ supportÂ isÂ added,Â weÂ willÂ followÂ itÂ upÂ quicklyÂ withÂ anotherÂ release,Â whichÂ willÂ likelyÂ beÂ theÂ nextÂ LTS.Â Â Finally,Â onÂ theÂ subjectÂ ofÂ LTS,Â weÂ planÂ toÂ releaseÂ OVSÂ 2.3.2Â nextÂ week,Â whichÂ containsÂ aÂ numberÂ ofÂ bugÂ fixes.HappyÂ switching!--Justin_______________________________________________announceÂ mailingÂ listannounce at openvswitch.orghttp://openvswitch.org/mailman/listinfo/announce
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/e3cba836/attachment.html>

From jpettit at nicira.com  Thu Jun 11 23:27:03 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 11 Jun 2015 23:27:03 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <557A78D1.6050306@dtdream.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <557A78D1.6050306@dtdream.com>
Message-ID: <33C4F8AF-0F85-4099-B8D0-C13C47C71E71@nicira.com>


> On Jun 11, 2015, at 11:14 PM, Wei Li <liw at dtdream.com> wrote:
> 
> Stateful Connection Tracking & Stateful NA is not in this release?

Correct.  Connection tracking was this part of the announcement:

> We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.

The release of 2.4 won't really affect when connection tracking comes to an OVS release; we just didn't want to continue having it block the release of other useful features.  As soon as we can do a release with connection tracking, we will.

I don't know what stateful NA is.  Did you mean NAT?  If so, that was something being worked on by Thomas Graf, but he hasn't given a timeline.

--Justin



From gowrishankar.m at linux.vnet.ibm.com  Fri Jun 12 03:52:30 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Fri, 12 Jun 2015 16:22:30 +0530
Subject: [ovs-discuss] displaying ethernet mac addr in dpif/dump-flows
Message-ID: <557AB9EE.6080907@linux.vnet.ibm.com>

Hi,
Sometimes back, while checking datapath flows for my bridge br0, I had 
noticed src and dst mac been listed as below in eth().

ovs-appctl dpif/dump-flows br0
recirc_id(0),in_port(3),eth(src=00:02:c9:4c:e6:e2,dst=33:33:00:00:00:02),eth_type(0x86dd),ipv6(frag=no), 
packets:1418, bytes:87916, used:0.268s, actions:2,1,4
...

Not sure whether I turned on some debug setting within switch, as I had 
been checking with appctl vlog/list console and file settings.
Following restart of ovsdb server and daemon process, now I do not see 
those eth() info.

ovs-appctl dpif/dump-flows br0
recirc_id(0),in_port(2),eth_type(0x86dd),ipv6(frag=no), packets:245, 
bytes:15190, used:6.644s, actions:3

Any help to get back same verbose level in dpif/dump-flows is appreciated.

-- 
Regards,
Gowrishankar M


From gowrishankar.m at linux.vnet.ibm.com  Fri Jun 12 04:16:59 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Fri, 12 Jun 2015 16:46:59 +0530
Subject: [ovs-discuss] displaying ethernet mac addr in dpif/dump-flows
In-Reply-To: <557AB9EE.6080907@linux.vnet.ibm.com>
References: <557AB9EE.6080907@linux.vnet.ibm.com>
Message-ID: <557ABFAB.10503@linux.vnet.ibm.com>

Checking code, I see -m helping me to see all fields wildcarded by flow. 
Anyway, helpful to know if there is any other setting controlling it.

On Friday 12 June 2015 04:22 PM, gowrishankar wrote:
> Hi,
> Sometimes back, while checking datapath flows for my bridge br0, I had 
> noticed src and dst mac been listed as below in eth().
>
> ovs-appctl dpif/dump-flows br0
> recirc_id(0),in_port(3),eth(src=00:02:c9:4c:e6:e2,dst=33:33:00:00:00:02),eth_type(0x86dd),ipv6(frag=no), 
> packets:1418, bytes:87916, used:0.268s, actions:2,1,4
> ...
>
> Not sure whether I turned on some debug setting within switch, as I 
> had been checking with appctl vlog/list console and file settings.
> Following restart of ovsdb server and daemon process, now I do not see 
> those eth() info.
>
> ovs-appctl dpif/dump-flows br0
> recirc_id(0),in_port(2),eth_type(0x86dd),ipv6(frag=no), packets:245, 
> bytes:15190, used:6.644s, actions:3
>
> Any help to get back same verbose level in dpif/dump-flows is 
> appreciated.
>


-- 
Regards,
Gowrishankar M


From daniels at research.att.com  Fri Jun 12 05:29:28 2015
From: daniels at research.att.com (Scott Daniels)
Date: Fri, 12 Jun 2015 08:29:28 -0400 (EDT)
Subject: [ovs-discuss] Upcall to userspace threading question
Message-ID: <alpine.LSU.2.11.1506120827260.27561@ybpnyubfg>

Currently flow setup is done in a round-robin manner based on port to 
prevent the possibility of a denial of service attack.  However, in a 
situation where all GRE tunnels terminate on a single port (specifically 
in the case of an L3 node under Openstack) it seems to make sense to 
further split the flow setup from a single port to prevent the 
possibility of a similar DoS attack that affects the GRE traffic.

Has this split been considered, and if so are there reasons that it 
wasn't implemented?


Somewhat related, when an action list contains a sample action it causes 
the packet to be cloned and sent to userspace. The way I read it the 
samples share the same upcall path as flow setup upcalls. Given that 
sampling would be pushing larger packets into the upcall path, compared 
to SYNs during flow setup, I assume that if the sampling rate were too 
aggressive that this could lead to a full upcall queue which would have 
a negative impact on other traffic.

Has there been any thought given to splitting the sampling upcalls from 
the rest of the upcall "traffic?"


Thanks,
Scott


------------------------------------------------------------------------
E. Scott Daniels
PMTS - Cloud Software Research
AT&T Labs - Research
daniels AT research.att.com


From blp at nicira.com  Fri Jun 12 08:13:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 12 Jun 2015 08:13:25 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
Message-ID: <20150612151325.GC4542@nicira.com>

It's a hash, so it's probabilistic.  You'll only get a statistically
even distribution if you have a large number of flows.  For two flows,
there is a 50% chance they end up in the same bucket.

On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> My topology is two hosts connected to a switch and I am sending two flows
> from host 1 to host 2. What I want to do is use the select group type with
> two different buckets. But both of my flows are being mapped to one bucket,
> essentially. Shouldn't the select function, which is taking a hash of
> src/dst ports and ips, map each blow to different bucket?
> 
> 
> 
> On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > The default is a hash (not just an xor) over fields up to L4, but you
> > can configure another method using the extensions implemented by
> > Netronome.
> >
> > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > What is the current ovs version using for select type? As far as I could
> > > understand it is taking a xor of src and destination addresses and tcp
> > > ports? Is it correct?
> > >
> > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > > I was wondering if you could help me figuring out where the
> > algorithm for
> > > > > the group type "select" is implemented in ovs switch files? I want to
> > > > > implement a function which takes the hash of the src/dst ip, and
> > src/dst
> > > > > port and selects the corresponding bucket for the packet.
> > > >
> > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > >
> >

From blp at nicira.com  Fri Jun 12 08:19:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 12 Jun 2015 08:19:06 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
 <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
Message-ID: <20150612151906.GE4542@nicira.com>

Can you provide the entire ovs-ofctl command?

On Fri, Jun 12, 2015 at 08:15:52PM +0500, Haleema Sadia wrote:
> Yes, tested it with more flows a while ago and it was working fine! I tried
> giving selection_method=hash with the group type select. Ovs-ofctl telling
> me unknown keyword. Why is that?
> 
> On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > It's a hash, so it's probabilistic.  You'll only get a statistically
> > even distribution if you have a large number of flows.  For two flows,
> > there is a 50% chance they end up in the same bucket.
> >
> > On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > > My topology is two hosts connected to a switch and I am sending two flows
> > > from host 1 to host 2. What I want to do is use the select group type
> > with
> > > two different buckets. But both of my flows are being mapped to one
> > bucket,
> > > essentially. Shouldn't the select function, which is taking a hash of
> > > src/dst ports and ips, map each blow to different bucket?
> > >
> > >
> > >
> > > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> > <javascript:;>> wrote:
> > >
> > > > The default is a hash (not just an xor) over fields up to L4, but you
> > > > can configure another method using the extensions implemented by
> > > > Netronome.
> > > >
> > > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > > What is the current ovs version using for select type? As far as I
> > could
> > > > > understand it is taking a xor of src and destination addresses and
> > tcp
> > > > > ports? Is it correct?
> > > > >
> > > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> > wrote:
> > > > >
> > > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > > > > I was wondering if you could help me figuring out where the
> > > > algorithm for
> > > > > > > the group type "select" is implemented in ovs switch files? I
> > want to
> > > > > > > implement a function which takes the hash of the src/dst ip, and
> > > > src/dst
> > > > > > > port and selects the corresponding bucket for the packet.
> > > > > >
> > > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > > >
> > > >
> >

From blp at nicira.com  Fri Jun 12 08:22:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 12 Jun 2015 08:22:42 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-632Go-E-itfm3C+RygRUF5UeUtkey2ZDMfR0zL_k9Gesw@mail.gmail.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
 <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
 <20150612151906.GE4542@nicira.com>
 <CAN-u-632Go-E-itfm3C+RygRUF5UeUtkey2ZDMfR0zL_k9Gesw@mail.gmail.com>
Message-ID: <20150612152242.GG4542@nicira.com>

Try this (note that configuring the selection method only works with the
experimental OpenFlow 1.5 protocol):

utilities/ovs-ofctl -O OpenFlow15 add-group br0 group_id=1,type=select,selection_method=hash,bucket=output:2,bucket=output:3

On Fri, Jun 12, 2015 at 08:20:48PM +0500, Haleema Sadia wrote:
> Ovs-ofctl add-group group_id=1,
> type=select,selection_method=hash,bucket=output:2,bucket=output:3 -O
> OpenFlow13
> 
> On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Can you provide the entire ovs-ofctl command?
> >
> > On Fri, Jun 12, 2015 at 08:15:52PM +0500, Haleema Sadia wrote:
> > > Yes, tested it with more flows a while ago and it was working fine! I
> > tried
> > > giving selection_method=hash with the group type select. Ovs-ofctl
> > telling
> > > me unknown keyword. Why is that?
> > >
> > > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> > wrote:
> > >
> > > > It's a hash, so it's probabilistic.  You'll only get a statistically
> > > > even distribution if you have a large number of flows.  For two flows,
> > > > there is a 50% chance they end up in the same bucket.
> > > >
> > > > On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > > > > My topology is two hosts connected to a switch and I am sending two
> > flows
> > > > > from host 1 to host 2. What I want to do is use the select group type
> > > > with
> > > > > two different buckets. But both of my flows are being mapped to one
> > > > bucket,
> > > > > essentially. Shouldn't the select function, which is taking a hash of
> > > > > src/dst ports and ips, map each blow to different bucket?
> > > > >
> > > > >
> > > > >
> > > > > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> > <javascript:;>
> > > > <javascript:;>> wrote:
> > > > >
> > > > > > The default is a hash (not just an xor) over fields up to L4, but
> > you
> > > > > > can configure another method using the extensions implemented by
> > > > > > Netronome.
> > > > > >
> > > > > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > > > > What is the current ovs version using for select type? As far as
> > I
> > > > could
> > > > > > > understand it is taking a xor of src and destination addresses
> > and
> > > > tcp
> > > > > > > ports? Is it correct?
> > > > > > >
> > > > > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com
> > <javascript:;> <javascript:;>>
> > > > wrote:
> > > > > > >
> > > > > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > > > > > > I was wondering if you could help me figuring out where the
> > > > > > algorithm for
> > > > > > > > > the group type "select" is implemented in ovs switch files? I
> > > > want to
> > > > > > > > > implement a function which takes the hash of the src/dst ip,
> > and
> > > > > > src/dst
> > > > > > > > > port and selects the corresponding bucket for the packet.
> > > > > > > >
> > > > > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > > > > >
> > > > > >
> > > >
> >

From blp at nicira.com  Fri Jun 12 08:50:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 12 Jun 2015 08:50:28 -0700
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <CAN-u-6107o-v5NDtj4CAjtMXU5nyJwzM7cxFTPc=YmRyHd8iYA@mail.gmail.com>
References: <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
 <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
 <20150612151906.GE4542@nicira.com>
 <CAN-u-632Go-E-itfm3C+RygRUF5UeUtkey2ZDMfR0zL_k9Gesw@mail.gmail.com>
 <20150612152242.GG4542@nicira.com>
 <CAN-u-6107o-v5NDtj4CAjtMXU5nyJwzM7cxFTPc=YmRyHd8iYA@mail.gmail.com>
Message-ID: <20150612155028.GI4542@nicira.com>

Make sure you're using OVS from master.

On Fri, Jun 12, 2015 at 08:24:27PM +0500, Haleema Sadia wrote:
> Yes I tried it with -O OpenFlow15 but it said the same.
> 
> Sorry I missed the switch name in the previous command.
> ovs-ofctl -O OpenFlow15 add-group
> s1 group_id=1,type=select,selection_method=hash,bucket=output:2,bucket=output:3
> 
> On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Try this (note that configuring the selection method only works with the
> > experimental OpenFlow 1.5 protocol):
> >
> > utilities/ovs-ofctl -O OpenFlow15 add-group br0
> > group_id=1,type=select,selection_method=hash,bucket=output:2,bucket=output:3
> >
> > On Fri, Jun 12, 2015 at 08:20:48PM +0500, Haleema Sadia wrote:
> > > Ovs-ofctl add-group group_id=1,
> > > type=select,selection_method=hash,bucket=output:2,bucket=output:3 -O
> > > OpenFlow13
> > >
> > > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> > wrote:
> > >
> > > > Can you provide the entire ovs-ofctl command?
> > > >
> > > > On Fri, Jun 12, 2015 at 08:15:52PM +0500, Haleema Sadia wrote:
> > > > > Yes, tested it with more flows a while ago and it was working fine! I
> > > > tried
> > > > > giving selection_method=hash with the group type select. Ovs-ofctl
> > > > telling
> > > > > me unknown keyword. Why is that?
> > > > >
> > > > > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>
> > <javascript:;>>
> > > > wrote:
> > > > >
> > > > > > It's a hash, so it's probabilistic.  You'll only get a
> > statistically
> > > > > > even distribution if you have a large number of flows.  For two
> > flows,
> > > > > > there is a 50% chance they end up in the same bucket.
> > > > > >
> > > > > > On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > > > > > > My topology is two hosts connected to a switch and I am sending
> > two
> > > > flows
> > > > > > > from host 1 to host 2. What I want to do is use the select group
> > type
> > > > > > with
> > > > > > > two different buckets. But both of my flows are being mapped to
> > one
> > > > > > bucket,
> > > > > > > essentially. Shouldn't the select function, which is taking a
> > hash of
> > > > > > > src/dst ports and ips, map each blow to different bucket?
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> > <javascript:;>
> > > > <javascript:;>
> > > > > > <javascript:;>> wrote:
> > > > > > >
> > > > > > > > The default is a hash (not just an xor) over fields up to L4,
> > but
> > > > you
> > > > > > > > can configure another method using the extensions implemented
> > by
> > > > > > > > Netronome.
> > > > > > > >
> > > > > > > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > > > > > > What is the current ovs version using for select type? As
> > far as
> > > > I
> > > > > > could
> > > > > > > > > understand it is taking a xor of src and destination
> > addresses
> > > > and
> > > > > > tcp
> > > > > > > > > ports? Is it correct?
> > > > > > > > >
> > > > > > > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com
> > <javascript:;>
> > > > <javascript:;> <javascript:;>>
> > > > > > wrote:
> > > > > > > > >
> > > > > > > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia
> > wrote:
> > > > > > > > > > > I was wondering if you could help me figuring out where
> > the
> > > > > > > > algorithm for
> > > > > > > > > > > the group type "select" is implemented in ovs switch
> > files? I
> > > > > > want to
> > > > > > > > > > > implement a function which takes the hash of the src/dst
> > ip,
> > > > and
> > > > > > > > src/dst
> > > > > > > > > > > port and selects the corresponding bucket for the packet.
> > > > > > > > > >
> > > > > > > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > > > > > > >
> > > > > > > >
> > > > > >
> > > >
> >

From rbryant at redhat.com  Fri Jun 12 12:14:24 2015
From: rbryant at redhat.com (Russell Bryant)
Date: Fri, 12 Jun 2015 15:14:24 -0400
Subject: [ovs-discuss] ovscon 2015 scheduling proposal: Nov. 16-17
In-Reply-To: <20150528150550.GF8426@nicira.com>
References: <20150528150550.GF8426@nicira.com>
Message-ID: <557B2F90.4070004@redhat.com>

On 05/28/2015 11:05 AM, Ben Pfaff wrote:
> I'm thinking about scheduling this year's OVS conference for Nov. 16 and
> 17.  Any comments?  I haven't verified that the space is available on
> those days yet, so this is a very tentative idea.

I don't know of any conflicts on those dates, but if possible it would
be awesome if it got shifted by 1 or 2 days so that it didn't require
traveling over the weekend.

-- 
Russell Bryant

From blp at nicira.com  Fri Jun 12 12:51:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 12 Jun 2015 12:51:55 -0700
Subject: [ovs-discuss] ovscon 2015 scheduling proposal: Nov. 16-17
In-Reply-To: <557B2F90.4070004@redhat.com>
References: <20150528150550.GF8426@nicira.com>
 <557B2F90.4070004@redhat.com>
Message-ID: <20150612195155.GA5563@nicira.com>

On Fri, Jun 12, 2015 at 03:14:24PM -0400, Russell Bryant wrote:
> On 05/28/2015 11:05 AM, Ben Pfaff wrote:
> > I'm thinking about scheduling this year's OVS conference for Nov. 16 and
> > 17.  Any comments?  I haven't verified that the space is available on
> > those days yet, so this is a very tentative idea.
> 
> I don't know of any conflicts on those dates, but if possible it would
> be awesome if it got shifted by 1 or 2 days so that it didn't require
> traveling over the weekend.

Oh, I didn't even think of that.  We might be already too far along our
scheduling process (it really is happening) to change it for this year,
but for next year I'll try for Tuesday/Wednesday instead of
Monday/Tuesday.

From jesse at nicira.com  Fri Jun 12 20:02:05 2015
From: jesse at nicira.com (Jesse Gross)
Date: Fri, 12 Jun 2015 20:02:05 -0700
Subject: [ovs-discuss] Upcall to userspace threading question
In-Reply-To: <alpine.LSU.2.11.1506120827260.27561@ybpnyubfg>
References: <alpine.LSU.2.11.1506120827260.27561@ybpnyubfg>
Message-ID: <CAEP_g=-fS_-PatqdZ3OR9vPmnvd3P8oMpz0rjS0Nhmm4qNu8jQ@mail.gmail.com>

On Fri, Jun 12, 2015 at 5:29 AM, Scott Daniels <daniels at research.att.com> wrote:
> Currently flow setup is done in a round-robin manner based on port to
> prevent the possibility of a denial of service attack.  However, in a
> situation where all GRE tunnels terminate on a single port (specifically in
> the case of an L3 node under Openstack) it seems to make sense to further
> split the flow setup from a single port to prevent the possibility of a
> similar DoS attack that affects the GRE traffic.
>
> Has this split been considered, and if so are there reasons that it wasn't
> implemented?

This isn't entirely true any more (it used to be). Each port now has
an array of sockets that packets can be queued to and flows are spread
among them based on a hash of the flow.

> Somewhat related, when an action list contains a sample action it causes the
> packet to be cloned and sent to userspace. The way I read it the samples
> share the same upcall path as flow setup upcalls. Given that sampling would
> be pushing larger packets into the upcall path, compared to SYNs during flow
> setup, I assume that if the sampling rate were too aggressive that this
> could lead to a full upcall queue which would have a negative impact on
> other traffic.
>
> Has there been any thought given to splitting the sampling upcalls from the
> rest of the upcall "traffic?"

It's possible to implement this given the existing kernel
infrastructure but I haven't heard this being an issue before and so
nobody has bothered to do it to the best of my knowledge. Other types
of control packets - STP, CFM, etc. - are sent to a separate queue.

From zhangzhiming at yunshan.net.cn  Sat Jun 13 23:33:45 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Sun, 14 Jun 2015 14:33:45 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>, 
 <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>
Message-ID: <201506141433435278580@yunshan.net.cn>

Hi, Andy,

Do you need any other information to figure out this problem?




ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-05-27 10:13
To: zhangzhiming
CC: Alex Wang; discuss
Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi,
>
>
> Here you are.
> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
> simultaneously.
> The version of OVS is 2.3.1.
>
>

Thanks, this helps. The backtrace suggested there is a stack
corruption from 'execute_recirc()',  But it not
obvious what is the problem.  I will need to think about it more. In
the mean time, would you please post
a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows' command.

Thanks,

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150614/a21e0df9/attachment.html>

From gmussar at ciena.com  Mon Jun 15 12:13:02 2015
From: gmussar at ciena.com (Mussar, Gary)
Date: Mon, 15 Jun 2015 15:13:02 -0400
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
Message-ID: <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>

What are the plans for the QinQ patches?

Gary

-----Original Message-----
From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Justin Pettit
Sent: Friday, June 12, 2015 02:03
To: announce at openvswitch.org; discuss
Subject: [ovs-discuss] OVS 2.4 Release Plans

We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:

	- Native Linux kernel STT support
	- Geneve tunneling
	- DPDK vhost and tunneling
	- OpenFlow 1.4 bundles (flow transactions)
	- Bash command completion
	- RSTP
	- Multicast snooping
	- Support for Linux kernels up to 4.0.x

The plan is to branch early next week and have an official release ready roughly six weeks after that.

We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.  

Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.

Happy switching!

--Justin


_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Mon Jun 15 12:45:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 15 Jun 2015 12:45:55 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>
Message-ID: <20150615194555.GE18480@nicira.com>

I predict that they won't make it into 2.4 but will make it into 2.5.

On Mon, Jun 15, 2015 at 03:13:02PM -0400, Mussar, Gary wrote:
> What are the plans for the QinQ patches?
> 
> Gary
> 
> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Justin Pettit
> Sent: Friday, June 12, 2015 02:03
> To: announce at openvswitch.org; discuss
> Subject: [ovs-discuss] OVS 2.4 Release Plans
> 
> We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:
> 
> 	- Native Linux kernel STT support
> 	- Geneve tunneling
> 	- DPDK vhost and tunneling
> 	- OpenFlow 1.4 bundles (flow transactions)
> 	- Bash command completion
> 	- RSTP
> 	- Multicast snooping
> 	- Support for Linux kernels up to 4.0.x
> 
> The plan is to branch early next week and have an official release ready roughly six weeks after that.
> 
> We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.  
> 
> Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.
> 
> Happy switching!
> 
> --Justin
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From gmussar at ciena.com  Mon Jun 15 13:28:35 2015
From: gmussar at ciena.com (Mussar, Gary)
Date: Mon, 15 Jun 2015 16:28:35 -0400
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <20150615194555.GE18480@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>
 <20150615194555.GE18480@nicira.com>
Message-ID: <C281A17C31CFD745B242416D0E96EC6383D3384C@ONWVEXCHMB04.ciena.com>

2.4 has been a long time coming. Should we expect 2.5 to take a year too or might it be by the end of this year?

Gary

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Monday, June 15, 2015 15:46
To: Mussar, Gary
Cc: Justin Pettit; discuss
Subject: Re: [ovs-discuss] OVS 2.4 Release Plans

I predict that they won't make it into 2.4 but will make it into 2.5.

On Mon, Jun 15, 2015 at 03:13:02PM -0400, Mussar, Gary wrote:
> What are the plans for the QinQ patches?
> 
> Gary
> 
> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Justin Pettit
> Sent: Friday, June 12, 2015 02:03
> To: announce at openvswitch.org; discuss
> Subject: [ovs-discuss] OVS 2.4 Release Plans
> 
> We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:
> 
> 	- Native Linux kernel STT support
> 	- Geneve tunneling
> 	- DPDK vhost and tunneling
> 	- OpenFlow 1.4 bundles (flow transactions)
> 	- Bash command completion
> 	- RSTP
> 	- Multicast snooping
> 	- Support for Linux kernels up to 4.0.x
> 
> The plan is to branch early next week and have an official release ready roughly six weeks after that.
> 
> We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.  
> 
> Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.
> 
> Happy switching!
> 
> --Justin
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Mon Jun 15 13:32:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 15 Jun 2015 13:32:28 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <C281A17C31CFD745B242416D0E96EC6383D3384C@ONWVEXCHMB04.ciena.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>
 <20150615194555.GE18480@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D3384C@ONWVEXCHMB04.ciena.com>
Message-ID: <20150615203228.GA26882@nicira.com>

2.4 has taken too long.  We want to switch to time-based releases.  The
target is 3-4 times per year.

On Mon, Jun 15, 2015 at 04:28:35PM -0400, Mussar, Gary wrote:
> 2.4 has been a long time coming. Should we expect 2.5 to take a year too or might it be by the end of this year?
> 
> Gary
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com] 
> Sent: Monday, June 15, 2015 15:46
> To: Mussar, Gary
> Cc: Justin Pettit; discuss
> Subject: Re: [ovs-discuss] OVS 2.4 Release Plans
> 
> I predict that they won't make it into 2.4 but will make it into 2.5.
> 
> On Mon, Jun 15, 2015 at 03:13:02PM -0400, Mussar, Gary wrote:
> > What are the plans for the QinQ patches?
> > 
> > Gary
> > 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Justin Pettit
> > Sent: Friday, June 12, 2015 02:03
> > To: announce at openvswitch.org; discuss
> > Subject: [ovs-discuss] OVS 2.4 Release Plans
> > 
> > We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:
> > 
> > 	- Native Linux kernel STT support
> > 	- Geneve tunneling
> > 	- DPDK vhost and tunneling
> > 	- OpenFlow 1.4 bundles (flow transactions)
> > 	- Bash command completion
> > 	- RSTP
> > 	- Multicast snooping
> > 	- Support for Linux kernels up to 4.0.x
> > 
> > The plan is to branch early next week and have an official release ready roughly six weeks after that.
> > 
> > We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.  
> > 
> > Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.
> > 
> > Happy switching!
> > 
> > --Justin
> > 
> > 
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss

From azhou at nicira.com  Mon Jun 15 22:34:47 2015
From: azhou at nicira.com (Andy Zhou)
Date: Mon, 15 Jun 2015 22:34:47 -0700
Subject: [ovs-discuss] one patch was omitted to be pushed to
 branch-2.3---datapath: Fix recirc bug where skb is double freed
In-Reply-To: <201506141433435278580@yunshan.net.cn>
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>
 <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>
 <201506141433435278580@yunshan.net.cn>
Message-ID: <CACzMAJK7NRKUNasFr74AXRLbqBKAO9jBrZqho33aH+DuG=9huw@mail.gmail.com>

I was not able to reproduce the bug on my setup and did not find
anything obvious that will corrupt memory. I have not figured out what
I can do to narrow this down further.

Can you reliably reproduce it? If yes, will you be able to narrow it
down further at your end?

The following information may be tangentially useful:
Does this only happen on one kernel version?  If yes which one. Have
your tried more than one version of the kernel?
Any local changes to either Linux kernel or OVS?
Have you tried with more one distribution?


On Sat, Jun 13, 2015 at 11:33 PM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi, Andy,
>
> Do you need any other information to figure out this problem?
>
> ________________________________
> ZHANG Zhiming
> Yunshan Networks
>
> From: Andy Zhou
> Date: 2015-05-27 10:13
> To: zhangzhiming
> CC: Alex Wang; discuss
> Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to
> branch-2.3---datapath: Fix recirc bug where skb is double freed
> On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
> <zhangzhiming at yunshan.net.cn> wrote:
>> Hi,
>>
>>
>> Here you are.
>> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
>> simultaneously.
>> The version of OVS is 2.3.1.
>>
>>
>
> Thanks, this helps. The backtrace suggested there is a stack
> corruption from 'execute_recirc()',  But it not
> obvious what is the problem.  I will need to think about it more. In
> the mean time, would you please post
> a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows'
> command.
>
> Thanks,
>
> Andy

From zhangzhiming at yunshan.net.cn  Mon Jun 15 23:30:57 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Tue, 16 Jun 2015 14:30:57 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>
 <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>
 <201506141433435278580@yunshan.net.cn>, 
 <CACzMAJK7NRKUNasFr74AXRLbqBKAO9jBrZqho33aH+DuG=9huw@mail.gmail.com>
Message-ID: <2015061614305612730225@yunshan.net.cn>

Hiï¼ŒAndy,

Thanks for your response.

We did some local changes to Linux kernel and OVS. 
I will do more tests to narrow it down according to your advice, and let you know if I have any further progress.

Thanks again!




ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-06-16 13:34
To: zhangzhiming
CC: Alex Wang; discuss
Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
I was not able to reproduce the bug on my setup and did not find
anything obvious that will corrupt memory. I have not figured out what
I can do to narrow this down further.

Can you reliably reproduce it? If yes, will you be able to narrow it
down further at your end?

The following information may be tangentially useful:
Does this only happen on one kernel version?  If yes which one. Have
your tried more than one version of the kernel?
Any local changes to either Linux kernel or OVS?
Have you tried with more one distribution?


On Sat, Jun 13, 2015 at 11:33 PM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi, Andy,
>
> Do you need any other information to figure out this problem?
>
> ________________________________
> ZHANG Zhiming
> Yunshan Networks
>
> From: Andy Zhou
> Date: 2015-05-27 10:13
> To: zhangzhiming
> CC: Alex Wang; discuss
> Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to
> branch-2.3---datapath: Fix recirc bug where skb is double freed
> On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
> <zhangzhiming at yunshan.net.cn> wrote:
>> Hi,
>>
>>
>> Here you are.
>> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
>> simultaneously.
>> The version of OVS is 2.3.1.
>>
>>
>
> Thanks, this helps. The backtrace suggested there is a stack
> corruption from 'execute_recirc()',  But it not
> obvious what is the problem.  I will need to think about it more. In
> the mean time, would you please post
> a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows'
> command.
>
> Thanks,
>
> Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/ecd02f43/attachment.html>

From nsmurthy at freescale.com  Tue Jun 16 01:07:39 2015
From: nsmurthy at freescale.com (Nittala Nsmurthy)
Date: Tue, 16 Jun 2015 08:07:39 +0000
Subject: [ovs-discuss] IP-Reassembly and Fragmentation support in OVS-Switch
Message-ID: <CY1PR0301MB1275F8FA3CB5A4D8CB213F78CBA70@CY1PR0301MB1275.namprd03.prod.outlook.com>

Hi

Is IP-Reassembly feature supported by any version of OVS Switch?
If so please indicate the version.

Thanks
-ns murthy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/e9b6c4ff/attachment.html>

From stefano.salsano at uniroma2.it  Tue Jun 16 08:53:00 2015
From: stefano.salsano at uniroma2.it (Stefano Salsano)
Date: Tue, 16 Jun 2015 17:53:00 +0200
Subject: [ovs-discuss] MPLS bug in Ubuntu 14.04
Message-ID: <5580465C.60308@uniroma2.it>

Hi,

we are not able to push MPLS labels (even a single one) in Ubuntu 
14.04.1 LTS, with kernel 3.13.0-34 using open vswitch 2.390 (master branch)

previously it was working, for example we have no problem with kernel 
3.8.0-35 (in which we were also able to push multiple MPLS label)

as a simple test scenario, we use a mininet topology with 2 hosts and 
one ovs-kernel switch

H1 ----> SW -----> H2

SW is supposed to take ingress traffic from H1, push one MPLS label and 
forward to H2

the rules are installed in OVS and visible with ofctl, but when a packet 
enters the switch from H1, the packet is not forwarded (while the 
statistics are increased) and the following error is logged in 
ovs-vswitchd log:

2015-06-16T11:38:08.448Z|00179|dpif(handler9)|WARN|system at ovs-system: 
failed to put[create]
(Invalid argument) ufid:a89d1ff5-a023-42e2-ac9b-ba9c2ce87b06 
skb_priority(0/0), 
in_port(2),skb_mark(0/0),eth(src=a6:5d:18:53:e0:2e/00:00:00:00:00:00, 
dst=fa:d7:84:15:da:ff/00:00:00:00:00:00), eth_type(0x0800), 
ipv4(src=10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0xfc, 
ttl=64,frag=no), icmp(type=8/0,code=0/0), 
actions:push_mpls(label=524296, tc=0, ttl=64, bos=1, eth_type=0x8847),1

2015-06-16T11:38:08.448Z|00180|dpif(handler9)|WARN|system at ovs-system: 
execute push_mpls(label=524296,tc=0,ttl=64,bos=1,eth_type=0x8847), 1 
failed (Invalid argument) on packet icmp, vlan_tci=0x0000, 
dl_src=a6:5d:18:53:e0:2e, dl_dst=fa:d7:84:15:da:ff, nw_src=10.0.0.1, 
nw_dst=10.0.0.2, nw_tos=0, nw_ecn=0, nw_ttl=64, icmp_type=8,i cmp_code=0 
icmp_csum:a411

the mininet script we use to reproduce the problem is attached below

thank you for your support

ciao
Stefano e Pier Luigi


-- 
*******************************************************************
Stefano Salsano
Professore Associato
Dipartimento Ingegneria Elettronica
Universita' di Roma Tor Vergata
Via del Politecnico, 1 - 00133 Roma - ITALY

http://netgroup.uniroma2.it/Stefano_Salsano/

E-mail  : stefano.salsano at uniroma2.it
Cell.   : +39 320 4307310
Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
*******************************************************************
-------------- next part --------------
#!/usr/bin/python

import subprocess

from mininet.net import Mininet
from mininet.node import Host, OVSKernelSwitch, Node
from mininet.cli import CLI
from mininet.log import lg, info

def setup():

        lg.setLogLevel('info')

        net = Mininet(switch=OVSKernelSwitch, build=False, autoStaticArp=True )

        host1 = net.addHost("h1")
        host2 = net.addHost("h2")

        peo1 = net.addSwitch("peo1")

        net.addLink(host1, peo1)# N/A | 1
        net.addLink(host2, peo1)# N/A | 2

        net.start()

        #PEO1 Configuration
        root = Node( 'root', inNamespace=False )
        root.cmd('ovs-vsctl --no-wait set bridge %s protocols=OpenFlow13' %(peo1.name))
        root.cmd('ovs-ofctl -O OpenFlow13 add-flow %s "table=0,hard_timeout=0,priority=32768,in_port=1,eth_type=0x800,actions=push_mpls:0x8847,set_field:524296->mpls_lab$
        root.cmd('ovs-ofctl -O OpenFlow13 add-flow %s "table=1,hard_timeout=0,priority=32768,in_port=1,eth_type=0x8847,mpls_label=524296,action=output:2"' %(peo1.name))

        CLI(net)
        net.stop()
        subprocess.call(["sudo", "mn", "-c"], stdout=None, stderr=None)


if __name__ == '__main__':
        setup()


From stefan at bit.nl  Tue Jun 16 14:43:17 2015
From: stefan at bit.nl (Stefan Kooman)
Date: Tue, 16 Jun 2015 23:43:17 +0200
Subject: [ovs-discuss] How to convert a trunk port to an access port?
Message-ID: <20150616214317.GA21741@shell.dmz.bit.nl>

Hi list,

I followed the "FAQ" to change a "tagged / trunk" port to an "access
port":


If you want to configure an already added port as an access port, use
"ovs-vsctl set", e.g.:

   ovs-vsctl set port tap0 tag=9

However, the port (vnet) keeps the "trunks=vid" entry, and gets another
"tag=vid" entry. Example:

Bridge uplink
        Port "vnet6"
            tag: 226             <--- added by set port command
            trunks: [226, 227]
            Interface "vnet6"

Is the above configuration for port "vnet6" equivalent to a "native vlan" (native-untagged)? How
can one convert a trunk port to an "access port"

Thanks,

Stefan Kooman

-- 
| BIT BV  http://www.bit.nl/        Kamer van Koophandel 09090351
| GPG: 0xD14839C6                   +31 318 648 688 / info at bit.nl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 230 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/d2e69ce2/attachment.sig>

From blp at nicira.com  Tue Jun 16 14:45:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 16 Jun 2015 14:45:47 -0700
Subject: [ovs-discuss] How to convert a trunk port to an access port?
In-Reply-To: <20150616214317.GA21741@shell.dmz.bit.nl>
References: <20150616214317.GA21741@shell.dmz.bit.nl>
Message-ID: <20150616214547.GA10035@nicira.com>

On Tue, Jun 16, 2015 at 11:43:17PM +0200, Stefan Kooman wrote:
> Hi list,
> 
> I followed the "FAQ" to change a "tagged / trunk" port to an "access
> port":
> 
> 
> If you want to configure an already added port as an access port, use
> "ovs-vsctl set", e.g.:
> 
>    ovs-vsctl set port tap0 tag=9
> 
> However, the port (vnet) keeps the "trunks=vid" entry, and gets another
> "tag=vid" entry. Example:
> 
> Bridge uplink
>         Port "vnet6"
>             tag: 226             <--- added by set port command
>             trunks: [226, 227]
>             Interface "vnet6"
> 
> Is the above configuration for port "vnet6" equivalent to a "native vlan" (native-untagged)? How
> can one convert a trunk port to an "access port"

ovs-vsctl set port tap0 tag=9 -- clear port tap0 trunks

From blp at nicira.com  Tue Jun 16 16:35:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 16 Jun 2015 16:35:29 -0700
Subject: [ovs-discuss] IP-Reassembly and Fragmentation support in
 OVS-Switch
In-Reply-To: <CY1PR0301MB1275F8FA3CB5A4D8CB213F78CBA70@CY1PR0301MB1275.namprd03.prod.outlook.com>
References: <CY1PR0301MB1275F8FA3CB5A4D8CB213F78CBA70@CY1PR0301MB1275.namprd03.prod.outlook.com>
Message-ID: <20150616233529.GC10035@nicira.com>

On Tue, Jun 16, 2015 at 08:07:39AM +0000, Nittala Nsmurthy wrote:
> Is IP-Reassembly feature supported by any version of OVS Switch?

No.

From dev_raj82 at yahoo.com  Thu Jun 11 23:58:58 2015
From: dev_raj82 at yahoo.com (r devarajan)
Date: Fri, 12 Jun 2015 06:58:58 +0000 (UTC)
Subject: [ovs-discuss] action types defined in the source code
Message-ID: <1776455955.1559499.1434092338708.JavaMail.yahoo@mail.yahoo.com>

Hello,Â  Â  Â  Â  Â  I have a misunderstanding withe the source code. In "openvswitch.h" Â under "ovs_action_attr" the action types defined does not adhere to the openflow specification : openflow-spec-v1.1.0 Â (the implemented version, at least that's what it says), specifically the group action (which is a required action) has not been defined and so it has'nt been implemented Â do_execute_actions as well so how can a packet access group actions from the datapath. However there is the implementation in the control path with the OFPGC11_ADD, etc . please do help me with this dilemma. Thanks :)Â 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/73b6848e/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Fri Jun 12 03:30:37 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Fri, 12 Jun 2015 15:30:37 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <20150611222024.GB23632@nicira.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
Message-ID: <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>

My topology is two hosts connected to a switch and I am sending two flows
from host 1 to host 2. What I want to do is use the select group type with
two different buckets. But both of my flows are being mapped to one bucket,
essentially. Shouldn't the select function, which is taking a hash of
src/dst ports and ips, map each blow to different bucket?



On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com> wrote:

> The default is a hash (not just an xor) over fields up to L4, but you
> can configure another method using the extensions implemented by
> Netronome.
>
> On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > What is the current ovs version using for select type? As far as I could
> > understand it is taking a xor of src and destination addresses and tcp
> > ports? Is it correct?
> >
> > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > I was wondering if you could help me figuring out where the
> algorithm for
> > > > the group type "select" is implemented in ovs switch files? I want to
> > > > implement a function which takes the hash of the src/dst ip, and
> src/dst
> > > > port and selects the corresponding bucket for the packet.
> > >
> > > xlate_select_group() in ofproto-dpif-xlate.c
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/f4b62e75/attachment-0001.html>

From gopi2101 at yahoo.com  Fri Jun 12 05:32:14 2015
From: gopi2101 at yahoo.com (Gopikrishnan)
Date: Fri, 12 Jun 2015 12:32:14 +0000 (UTC)
Subject: [ovs-discuss] OF_DPA integration with OVS
Message-ID: <284876826.1627597.1434112334822.JavaMail.yahoo@mail.yahoo.com>

Hi,
I would like to know if anyone tried integrating OF-DPA software with the OVS code ?I didn't find much information on this topic.And is there any open source software similar to OF-DPA ?
Regards,Gopi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/8ebd263e/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Fri Jun 12 08:15:52 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Fri, 12 Jun 2015 20:15:52 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <20150612151325.GC4542@nicira.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
Message-ID: <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>

Yes, tested it with more flows a while ago and it was working fine! I tried
giving selection_method=hash with the group type select. Ovs-ofctl telling
me unknown keyword. Why is that?

On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:

> It's a hash, so it's probabilistic.  You'll only get a statistically
> even distribution if you have a large number of flows.  For two flows,
> there is a 50% chance they end up in the same bucket.
>
> On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > My topology is two hosts connected to a switch and I am sending two flows
> > from host 1 to host 2. What I want to do is use the select group type
> with
> > two different buckets. But both of my flows are being mapped to one
> bucket,
> > essentially. Shouldn't the select function, which is taking a hash of
> > src/dst ports and ips, map each blow to different bucket?
> >
> >
> >
> > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> <javascript:;>> wrote:
> >
> > > The default is a hash (not just an xor) over fields up to L4, but you
> > > can configure another method using the extensions implemented by
> > > Netronome.
> > >
> > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > What is the current ovs version using for select type? As far as I
> could
> > > > understand it is taking a xor of src and destination addresses and
> tcp
> > > > ports? Is it correct?
> > > >
> > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> wrote:
> > > >
> > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > > > I was wondering if you could help me figuring out where the
> > > algorithm for
> > > > > > the group type "select" is implemented in ovs switch files? I
> want to
> > > > > > implement a function which takes the hash of the src/dst ip, and
> > > src/dst
> > > > > > port and selects the corresponding bucket for the packet.
> > > > >
> > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/a994f764/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Fri Jun 12 08:20:48 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Fri, 12 Jun 2015 20:20:48 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <20150612151906.GE4542@nicira.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
 <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
 <20150612151906.GE4542@nicira.com>
Message-ID: <CAN-u-632Go-E-itfm3C+RygRUF5UeUtkey2ZDMfR0zL_k9Gesw@mail.gmail.com>

Ovs-ofctl add-group group_id=1,
type=select,selection_method=hash,bucket=output:2,bucket=output:3 -O
OpenFlow13

On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:

> Can you provide the entire ovs-ofctl command?
>
> On Fri, Jun 12, 2015 at 08:15:52PM +0500, Haleema Sadia wrote:
> > Yes, tested it with more flows a while ago and it was working fine! I
> tried
> > giving selection_method=hash with the group type select. Ovs-ofctl
> telling
> > me unknown keyword. Why is that?
> >
> > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> wrote:
> >
> > > It's a hash, so it's probabilistic.  You'll only get a statistically
> > > even distribution if you have a large number of flows.  For two flows,
> > > there is a 50% chance they end up in the same bucket.
> > >
> > > On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > > > My topology is two hosts connected to a switch and I am sending two
> flows
> > > > from host 1 to host 2. What I want to do is use the select group type
> > > with
> > > > two different buckets. But both of my flows are being mapped to one
> > > bucket,
> > > > essentially. Shouldn't the select function, which is taking a hash of
> > > > src/dst ports and ips, map each blow to different bucket?
> > > >
> > > >
> > > >
> > > > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> <javascript:;>
> > > <javascript:;>> wrote:
> > > >
> > > > > The default is a hash (not just an xor) over fields up to L4, but
> you
> > > > > can configure another method using the extensions implemented by
> > > > > Netronome.
> > > > >
> > > > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > > > What is the current ovs version using for select type? As far as
> I
> > > could
> > > > > > understand it is taking a xor of src and destination addresses
> and
> > > tcp
> > > > > > ports? Is it correct?
> > > > > >
> > > > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com
> <javascript:;> <javascript:;>>
> > > wrote:
> > > > > >
> > > > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia wrote:
> > > > > > > > I was wondering if you could help me figuring out where the
> > > > > algorithm for
> > > > > > > > the group type "select" is implemented in ovs switch files? I
> > > want to
> > > > > > > > implement a function which takes the hash of the src/dst ip,
> and
> > > > > src/dst
> > > > > > > > port and selects the corresponding bucket for the packet.
> > > > > > >
> > > > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/75a7ecdb/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Fri Jun 12 08:24:27 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Fri, 12 Jun 2015 20:24:27 +0500
Subject: [ovs-discuss] Implementing 'group type select' algo in the
	switch
In-Reply-To: <20150612152242.GG4542@nicira.com>
References: <CAN-u-62kDvxQZbcAOZdfuXUh9Zop-8xWAu+p1MrZxV9FbPMVSA@mail.gmail.com>
 <20150611175903.GJ32341@nicira.com>
 <CAN-u-63GXLe_hFXqDkfEk+VpyciKRiAwBcJXDpfDq3HFfzoOUg@mail.gmail.com>
 <20150611222024.GB23632@nicira.com>
 <CAN-u-63QcP0QemEJV2Ci+WdaBdKF-rdVktP3AkXfNe6kpYMgRA@mail.gmail.com>
 <20150612151325.GC4542@nicira.com>
 <CAN-u-60SbHTFTbHpQcLOH28ycbq9rqvsGA=MqMi5=emyE3rmGA@mail.gmail.com>
 <20150612151906.GE4542@nicira.com>
 <CAN-u-632Go-E-itfm3C+RygRUF5UeUtkey2ZDMfR0zL_k9Gesw@mail.gmail.com>
 <20150612152242.GG4542@nicira.com>
Message-ID: <CAN-u-6107o-v5NDtj4CAjtMXU5nyJwzM7cxFTPc=YmRyHd8iYA@mail.gmail.com>

Yes I tried it with -O OpenFlow15 but it said the same.

Sorry I missed the switch name in the previous command.
ovs-ofctl -O OpenFlow15 add-group
s1 group_id=1,type=select,selection_method=hash,bucket=output:2,bucket=output:3

On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com> wrote:

> Try this (note that configuring the selection method only works with the
> experimental OpenFlow 1.5 protocol):
>
> utilities/ovs-ofctl -O OpenFlow15 add-group br0
> group_id=1,type=select,selection_method=hash,bucket=output:2,bucket=output:3
>
> On Fri, Jun 12, 2015 at 08:20:48PM +0500, Haleema Sadia wrote:
> > Ovs-ofctl add-group group_id=1,
> > type=select,selection_method=hash,bucket=output:2,bucket=output:3 -O
> > OpenFlow13
> >
> > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>>
> wrote:
> >
> > > Can you provide the entire ovs-ofctl command?
> > >
> > > On Fri, Jun 12, 2015 at 08:15:52PM +0500, Haleema Sadia wrote:
> > > > Yes, tested it with more flows a while ago and it was working fine! I
> > > tried
> > > > giving selection_method=hash with the group type select. Ovs-ofctl
> > > telling
> > > > me unknown keyword. Why is that?
> > > >
> > > > On Friday, June 12, 2015, Ben Pfaff <blp at nicira.com <javascript:;>
> <javascript:;>>
> > > wrote:
> > > >
> > > > > It's a hash, so it's probabilistic.  You'll only get a
> statistically
> > > > > even distribution if you have a large number of flows.  For two
> flows,
> > > > > there is a 50% chance they end up in the same bucket.
> > > > >
> > > > > On Fri, Jun 12, 2015 at 03:30:37PM +0500, Haleema Sadia wrote:
> > > > > > My topology is two hosts connected to a switch and I am sending
> two
> > > flows
> > > > > > from host 1 to host 2. What I want to do is use the select group
> type
> > > > > with
> > > > > > two different buckets. But both of my flows are being mapped to
> one
> > > > > bucket,
> > > > > > essentially. Shouldn't the select function, which is taking a
> hash of
> > > > > > src/dst ports and ips, map each blow to different bucket?
> > > > > >
> > > > > >
> > > > > >
> > > > > > On Fri, Jun 12, 2015 at 3:20 AM, Ben Pfaff <blp at nicira.com
> <javascript:;>
> > > <javascript:;>
> > > > > <javascript:;>> wrote:
> > > > > >
> > > > > > > The default is a hash (not just an xor) over fields up to L4,
> but
> > > you
> > > > > > > can configure another method using the extensions implemented
> by
> > > > > > > Netronome.
> > > > > > >
> > > > > > > On Thu, Jun 11, 2015 at 11:07:56PM +0500, Haleema Sadia wrote:
> > > > > > > > What is the current ovs version using for select type? As
> far as
> > > I
> > > > > could
> > > > > > > > understand it is taking a xor of src and destination
> addresses
> > > and
> > > > > tcp
> > > > > > > > ports? Is it correct?
> > > > > > > >
> > > > > > > > On Thursday, June 11, 2015, Ben Pfaff <blp at nicira.com
> <javascript:;>
> > > <javascript:;> <javascript:;>>
> > > > > wrote:
> > > > > > > >
> > > > > > > > > On Thu, Jun 11, 2015 at 01:13:22PM +0500, Haleema Sadia
> wrote:
> > > > > > > > > > I was wondering if you could help me figuring out where
> the
> > > > > > > algorithm for
> > > > > > > > > > the group type "select" is implemented in ovs switch
> files? I
> > > > > want to
> > > > > > > > > > implement a function which takes the hash of the src/dst
> ip,
> > > and
> > > > > > > src/dst
> > > > > > > > > > port and selects the corresponding bucket for the packet.
> > > > > > > > >
> > > > > > > > > xlate_select_group() in ofproto-dpif-xlate.c
> > > > > > > > >
> > > > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150612/45b31170/attachment-0001.html>

From smatov at mirantis.com  Tue Jun 16 00:50:28 2015
From: smatov at mirantis.com (Sergey Matov)
Date: Tue, 16 Jun 2015 10:50:28 +0300
Subject: [ovs-discuss] High CPU load (up to 100%) with OVS+DPDK+vHOST
	usage.
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC225E96540@IRSMSX106.ger.corp.intel.com>
References: <CAPykWKF=mrQpbC17b4sM07UCowdu2WVt9am1KD71DoE=g1=Cyw@mail.gmail.com>
 <CABYiri9HK3=vsGKTNXY42urqtH_QB4kuEd6vgzG2bF6acKRuog@mail.gmail.com>
 <5575A8C1.3090504@linux.vnet.ibm.com>
 <74F120C019F4A64C9B78E802F6AD4CC225E96540@IRSMSX106.ger.corp.intel.com>
Message-ID: <CAPykWKGaQ6mhY2yXz0GoZm-G56cBB=vbFCLDnEO61ccrr+gEWA@mail.gmail.com>

It seems problems are resolved. Now I got VM to VM traffic.
I've moved to 14.10 Ubuntu and 2.1.0 qemu. Pulled latest OVS and there was
simple vhost-user guide.

Thanks a lot Ciara Loftus for OVS vhost-user commit, it was so much easier.
Thanks Andrey for helping.

2015-06-11 13:22 GMT+03:00 Loftus, Ciara <ciara.loftus at intel.com>:

> >
> > I too observed dpdkhost0 mac of addr:00:00:00:00:00:00 in ovs. I do not
> > see packets
> > sent by VM on this port and seen by ovs (in fact, dump-flows also report
> > 0 packets).
> >
> > I am looking for any one opinion on this if dpdkhost0 mac reported is
> > expected
> > (and to quickly debug any other problem there).
>
> This mac of all zeros is expected.
>
> >
> > I am on qemu 2.1.0 as well.
> >
> > Thank you,
> > Gowrishankar
> >
>



-- 
*Best Regards*
*Sergey Matov*
*Mirantis Inc*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/626f6556/attachment-0001.html>

From jayachandran.subramanian at wipro.com  Tue Jun 16 06:00:13 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Tue, 16 Jun 2015 13:00:13 +0000
Subject: [ovs-discuss] OVS dump-ports getting errors while traffic flowing
Message-ID: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,

We have brought up topology as below with OpenVSwitch 2.3.9 /DPDK enabled .

Sending 128 bytes of frame as bidirectional from Agilent N2X(traffic generator) and observed that , in OVS we have found many errors(marked in red colour) in dump-ports.

[cid:image002.png at 01D0A862.7AF5B9D0]

[root at Sodium ~]# ovs-ofctl dump-ports br0
OFPST_PORT reply (xid=0x2): 7 ports
  port 82: rx pkts=205811668, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=1161555867, bytes=?, drop=10352, errs=?, coll=?
  port  1: rx pkts=217870588, bytes=13943718072, drop=0, errs=432724934, frame=0, over=0, crc=0
           tx pkts=1161547090, bytes=74339015288, drop=1438, errs=0, coll=0
  port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
           tx pkts=28, bytes=3096, drop=0, errs=0, coll=0
  port 83: rx pkts=1161548507, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=217868276, bytes=?, drop=2333, errs=?, coll=?
  port  2: rx pkts=1180330673, bytes=75541163410, drop=0, errs=605287882, frame=0, over=0, crc=0
           tx pkts=205805599, bytes=13171559788, drop=0, errs=0, coll=0
  port 81: rx pkts=1161566219, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=205810764, bytes=?, drop=918, errs=?, coll=?
  port 80: rx pkts=205805578, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
[root at Sodium ~]#

PFA logs attached for your ref . Please let me know , is it OVS capable of supporting 1 gig throughput and let me know to resolve these errors.

Thanks
Jayachandran S

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/42bf7549/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 12249 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/42bf7549/attachment-0001.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dump logs.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/42bf7549/attachment-0001.txt>

From jesse at nicira.com  Tue Jun 16 17:30:45 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 16 Jun 2015 17:30:45 -0700
Subject: [ovs-discuss] action types defined in the source code
In-Reply-To: <1776455955.1559499.1434092338708.JavaMail.yahoo@mail.yahoo.com>
References: <1776455955.1559499.1434092338708.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAEP_g=-+FU5NsggrAVgmnDA+p54UzC4GRx5D7Rw-1SfKBFM0Kg@mail.gmail.com>

On Thu, Jun 11, 2015 at 11:58 PM, r devarajan <dev_raj82 at yahoo.com> wrote:
> Hello,
>           I have a misunderstanding withe the source code. In
> "openvswitch.h"  under "ovs_action_attr" the action types defined does not
> adhere to the openflow specification : openflow-spec-v1.1.0  (the
> implemented version, at least that's what it says), specifically the group
> action (which is a required action) has not been defined and so it has'nt
> been implemented  do_execute_actions as well so how can a packet access
> group actions from the datapath. However there is the implementation in the
> control path with the OFPGC11_ADD, etc . please do help me with this
> dilemma. Thanks :)

The actions implemented in the kernel are related to but not the same
as OpenFlow actions. In general they are simpler and not tied to
particular OpenFlow versions. Userspace can use these primitives to
implement OpenFlow.

From masoom.alam at wanclouds.net  Tue Jun 16 18:31:39 2015
From: masoom.alam at wanclouds.net (masoom alam)
Date: Tue, 16 Jun 2015 18:31:39 -0700
Subject: [ovs-discuss] Enabling Promiscuous mode in OVS
Message-ID: <CABk5PjJbDadffxyucggv7Zf5ST88JHoXEz+edTWhce1uSyBozA@mail.gmail.com>

HI Every one,

I want to enable Promiscuous mode in OVS so that on a port of my choice I
can listen to the traffic being passed through OVS. How is this possible?

Thanking you in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150616/ec756db2/attachment.html>

From blp at nicira.com  Tue Jun 16 21:38:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 16 Jun 2015 21:38:35 -0700
Subject: [ovs-discuss] Enabling Promiscuous mode in OVS
In-Reply-To: <CABk5PjJbDadffxyucggv7Zf5ST88JHoXEz+edTWhce1uSyBozA@mail.gmail.com>
References: <CABk5PjJbDadffxyucggv7Zf5ST88JHoXEz+edTWhce1uSyBozA@mail.gmail.com>
Message-ID: <20150617043835.GB30649@nicira.com>

On Tue, Jun 16, 2015 at 06:31:39PM -0700, masoom alam wrote:
> I want to enable Promiscuous mode in OVS so that on a port of my choice I
> can listen to the traffic being passed through OVS. How is this possible?

This is a FAQ.

### Q: Does Open vSwitch support configuring a port in promiscuous mode?

A: Yes.  How you configure it depends on what you mean by "promiscuous
   mode":

  - Conventionally, "promiscuous mode" is a feature of a network
    interface card.  Ordinarily, a NIC passes to the CPU only the
    packets actually destined to its host machine.  It discards
    the rest to avoid wasting memory and CPU cycles.  When
    promiscuous mode is enabled, however, it passes every packet
    to the CPU.  On an old-style shared-media or hub-based
    network, this allows the host to spy on all packets on the
    network.  But in the switched networks that are almost
    everywhere these days, promiscuous mode doesn't have much
    effect, because few packets not destined to a host are
    delivered to the host's NIC.

    This form of promiscuous mode is configured in the guest OS of
    the VMs on your bridge, e.g. with "ifconfig".

  - The VMware vSwitch uses a different definition of "promiscuous
    mode".  When you configure promiscuous mode on a VMware vNIC,
    the vSwitch sends a copy of every packet received by the
    vSwitch to that vNIC.  That has a much bigger effect than just
    enabling promiscuous mode in a guest OS.  Rather than getting
    a few stray packets for which the switch does not yet know the
    correct destination, the vNIC gets every packet.  The effect
    is similar to replacing the vSwitch by a virtual hub.

    This "promiscuous mode" is what switches normally call "port
    mirroring" or "SPAN".  For information on how to configure
    SPAN, see "How do I configure a port as a SPAN port, that is,
    enable mirroring of all traffic to that port?"

From blp at nicira.com  Tue Jun 16 21:41:36 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 16 Jun 2015 21:41:36 -0700
Subject: [ovs-discuss] OVS dump-ports getting errors while traffic
	flowing
In-Reply-To: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150617044136.GC30649@nicira.com>

Do you also see such large error counts from "ifconfig"?

On Tue, Jun 16, 2015 at 01:00:13PM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi ,
> 
> We have brought up topology as below with OpenVSwitch 2.3.9 /DPDK enabled .
> 
> Sending 128 bytes of frame as bidirectional from Agilent N2X(traffic generator) and observed that , in OVS we have found many errors(marked in red colour) in dump-ports.
> 
> [cid:image002.png at 01D0A862.7AF5B9D0]
> 
> [root at Sodium ~]# ovs-ofctl dump-ports br0
> OFPST_PORT reply (xid=0x2): 7 ports
>   port 82: rx pkts=205811668, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=1161555867, bytes=?, drop=10352, errs=?, coll=?
>   port  1: rx pkts=217870588, bytes=13943718072, drop=0, errs=432724934, frame=0, over=0, crc=0
>            tx pkts=1161547090, bytes=74339015288, drop=1438, errs=0, coll=0
>   port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
>            tx pkts=28, bytes=3096, drop=0, errs=0, coll=0
>   port 83: rx pkts=1161548507, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=217868276, bytes=?, drop=2333, errs=?, coll=?
>   port  2: rx pkts=1180330673, bytes=75541163410, drop=0, errs=605287882, frame=0, over=0, crc=0
>            tx pkts=205805599, bytes=13171559788, drop=0, errs=0, coll=0
>   port 81: rx pkts=1161566219, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=205810764, bytes=?, drop=918, errs=?, coll=?
>   port 80: rx pkts=205805578, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
> [root at Sodium ~]#
> 
> PFA logs attached for your ref . Please let me know , is it OVS capable of supporting 1 gig throughput and let me know to resolve these errors.
> 
> Thanks
> Jayachandran S
> 
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com



> [root at Sodium ~]# ovs-ofctl dump-ports br0
> OFPST_PORT reply (xid=0x2): 7 ports
>   port 82: rx pkts=205811668, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=1161555867, bytes=?, drop=10352, errs=?, coll=?
>   port  1: rx pkts=217870588, bytes=13943718072, drop=0, errs=432724934, frame=0, over=0, crc=0
>            tx pkts=1161547090, bytes=74339015288, drop=1438, errs=0, coll=0
>   port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
>            tx pkts=28, bytes=3096, drop=0, errs=0, coll=0
>   port 83: rx pkts=1161548507, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=217868276, bytes=?, drop=2333, errs=?, coll=?
>   port  2: rx pkts=1180330673, bytes=75541163410, drop=0, errs=605287882, frame=0, over=0, crc=0
>            tx pkts=205805599, bytes=13171559788, drop=0, errs=0, coll=0
>   port 81: rx pkts=1161566219, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=205810764, bytes=?, drop=918, errs=?, coll=?
>   port 80: rx pkts=205805578, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>            tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
> [root at Sodium ~]#
> 
> 
> [root at Sodium ~]# ovs-vsctl show
> 4d8805c0-fee8-4ab5-91da-8b946b9d5e09
>     Bridge "br0"
>         Port "dpdk1"
>             Interface "dpdk1"
>                 type: dpdk
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "dpdk0"
>             Interface "dpdk0"
>                 type: dpdk
>         Port "vnet0"
>             Interface "vnet0"
>                 type: dpdkvhost
>         Port "vnet3"
>             Interface "vnet3"
>                 type: dpdkvhost
>         Port "vnet1"
>             Interface "vnet1"
>                 type: dpdkvhost
>         Port "vnet4"
>             Interface "vnet4"
>                 type: dpdkvhost
> [root at Sodium ~]#
> 
> 
> [root at Sodium ~]# ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=5277.175s, table=0, n_packets=1199310196, n_bytes=74374229452, idle_age=0, in_port=81 actions=output:82
>  cookie=0x0, duration=5268.535s, table=0, n_packets=243555755, n_bytes=17028969136, idle_age=0, in_port=82 actions=output:81
>  cookie=0x0, duration=5200.014s, table=0, n_packets=1218075889, n_bytes=75500247426, idle_age=0, in_port=2 actions=output:80
>  cookie=0x0, duration=5192.145s, table=0, n_packets=243549059, n_bytes=17028526376, idle_age=0, in_port=80 actions=output:2
>  cookie=0x0, duration=5182.171s, table=0, n_packets=255615800, n_bytes=17752641932, idle_age=0, in_port=1 actions=output:83
>  cookie=0x0, duration=5172.287s, table=0, n_packets=1199292148, n_bytes=74373121978, idle_age=0, in_port=83 actions=output:1
> [root at Sodium ~]#
> [root at Sodium ~]#

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From jgao at Hillstonenet.com  Tue Jun 16 22:21:42 2015
From: jgao at Hillstonenet.com (=?utf-8?B?SmllIEdhbyjpq5jmnbAp?=)
Date: Wed, 17 Jun 2015 05:21:42 +0000
Subject: [ovs-discuss] =?utf-8?b?562U5aSNOiAgT1ZTIDIuNCBSZWxlYXNlIFBsYW5z?=
In-Reply-To: <20150615203228.GA26882@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D337CD@ONWVEXCHMB04.ciena.com>
 <20150615194555.GE18480@nicira.com>
 <C281A17C31CFD745B242416D0E96EC6383D3384C@ONWVEXCHMB04.ciena.com>
 <20150615203228.GA26882@nicira.com>
Message-ID: <0463889CE2226041953756FDBB1F6DB6A502A61F@MAIL1.Hillstonenet.com>

QINQ is a very use function, and hope that the official support as soon as possible

-----é‚®ä»¶åŽŸä»¶-----
å‘ä»¶äºº: discuss [mailto:discuss-bounces at openvswitch.org] ä»£è¡¨ Ben Pfaff
å‘é€æ—¶é—´: 2015å¹´6æœˆ16æ—¥ 4:32
æ”¶ä»¶äºº: Mussar, Gary
æŠ„é€: discuss
ä¸»é¢˜: Re: [ovs-discuss] OVS 2.4 Release Plans

2.4 has taken too long.  We want to switch to time-based releases.  The target is 3-4 times per year.

On Mon, Jun 15, 2015 at 04:28:35PM -0400, Mussar, Gary wrote:
> 2.4 has been a long time coming. Should we expect 2.5 to take a year too or might it be by the end of this year?
>
> Gary
>
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Monday, June 15, 2015 15:46
> To: Mussar, Gary
> Cc: Justin Pettit; discuss
> Subject: Re: [ovs-discuss] OVS 2.4 Release Plans
>
> I predict that they won't make it into 2.4 but will make it into 2.5.
>
> On Mon, Jun 15, 2015 at 03:13:02PM -0400, Mussar, Gary wrote:
> > What are the plans for the QinQ patches?
> >
> > Gary
> >
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> > Justin Pettit
> > Sent: Friday, June 12, 2015 02:03
> > To: announce at openvswitch.org; discuss
> > Subject: [ovs-discuss] OVS 2.4 Release Plans
> >
> > We wanted to provide a quick update on the plan for the next couple releases.  OVS 2.4 is shaping up to be a big release with a number of great new features people are anxious to use. Some of the highlights include:
> >
> >     - Native Linux kernel STT support
> >     - Geneve tunneling
> >     - DPDK vhost and tunneling
> >     - OpenFlow 1.4 bundles (flow transactions)
> >     - Bash command completion
> >     - RSTP
> >     - Multicast snooping
> >     - Support for Linux kernels up to 4.0.x
> >
> > The plan is to branch early next week and have an official release ready roughly six weeks after that.
> >
> > We originally had planned to release OVS 2.4 when the new connection tracking features were merged into the upstream kernel. Unfortunately, this has taken longer than we anticipated.  We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS.
> >
> > Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week, which contains a number of bug fixes.
> >
> > Happy switching!
> >
> > --Justin
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss
The information contained in this e-mail message (and any attachment transmitted herewith) is privileged and confidential and is intended for the exclusive use of the addressee(s). If you are not an intended addressee, any disclosure, reproduction, distribution or other dissemination or use of this communication is strictly prohibited. If you have received this communication in error, please delete this communication and contact us by replying to this e-mail immediately.

From stefan at bit.nl  Tue Jun 16 22:38:32 2015
From: stefan at bit.nl (Stefan Kooman)
Date: Wed, 17 Jun 2015 07:38:32 +0200
Subject: [ovs-discuss] How to convert a trunk port to an access port?
In-Reply-To: <20150616214547.GA10035@nicira.com>
References: <20150616214317.GA21741@shell.dmz.bit.nl>
 <20150616214547.GA10035@nicira.com>
Message-ID: <20150617053832.GA10665@shell.dmz.bit.nl>

Quoting Ben Pfaff (blp at nicira.com):
> On Tue, Jun 16, 2015 at 11:43:17PM +0200, Stefan Kooman wrote:
-- snip-- 
>>How can one convert a trunk port to an "access port"
> 
> ovs-vsctl set port tap0 tag=9 -- clear port tap0 trunks

Thanks, this works like a charm.

I would like to understand what functionality a mixed "tagged" and
"trunk" port provide? As far as I can see (tcpdump) the traffic bound for the
vnet (tap port) never reaches it's destination anymore after being
tagged (although being a trunk port as well). Shouldn't these modes be mutually
exclusive? I'm running an experimental "nested" virtualization solution:

hypervisor config (L0):

Port "vnet6"
            tag: 226
            trunks: [226, 227]
            Interface "vnet6"


guest hypervisor config (L1):

Bridge uplink
        Port uplink
            Interface uplink
                type: internal
        Port "eth1"
            trunks: [226, 227]
            Interface "eth1"
        Port "vnet0"
            tag: 226
            Interface "vnet0"

So, eth1 here (L1) is actually vnet6 on hypervisor (L0). If vnet6 (L0) has both
trunk and tag the traffic never reaches eth1 (L1) anymore (and of course also
not vnet0: guest vm (L2)).

What I would expect (but does not seem to happen) is to see traffic with vlan tag "226"
be both passed tagged as wel as untagged for vnet6 (L0).

Does this make sense?

Thanks,

Stefan Kooman

-- 
| BIT BV  http://www.bit.nl/        Kamer van Koophandel 09090351
| GPG: 0xD14839C6                   +31 318 648 688 / info at bit.nl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 230 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/62e071ae/attachment.sig>

From blp at nicira.com  Tue Jun 16 22:43:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 16 Jun 2015 22:43:11 -0700
Subject: [ovs-discuss] How to convert a trunk port to an access port?
In-Reply-To: <20150617053832.GA10665@shell.dmz.bit.nl>
References: <20150616214317.GA21741@shell.dmz.bit.nl>
 <20150616214547.GA10035@nicira.com>
 <20150617053832.GA10665@shell.dmz.bit.nl>
Message-ID: <20150617054311.GA30847@nicira.com>

On Wed, Jun 17, 2015 at 07:38:32AM +0200, Stefan Kooman wrote:
> Quoting Ben Pfaff (blp at nicira.com):
> > On Tue, Jun 16, 2015 at 11:43:17PM +0200, Stefan Kooman wrote:
> -- snip-- 
> >>How can one convert a trunk port to an "access port"
> > 
> > ovs-vsctl set port tap0 tag=9 -- clear port tap0 trunks
> 
> Thanks, this works like a charm.
> 
> I would like to understand what functionality a mixed "tagged" and
> "trunk" port provide? As far as I can see (tcpdump) the traffic bound for the
> vnet (tap port) never reaches it's destination anymore after being
> tagged (although being a trunk port as well). Shouldn't these modes be mutually
> exclusive? I'm running an experimental "nested" virtualization solution:

The native-tagged and native-untagged modes use "trunks" and "tag"
simultaneously.  The database schema format is not in any case powerful
enough to allow one to constrain fields so that one or the other but not
both may be set.

From phoracek at redhat.com  Wed Jun 17 06:26:30 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Wed, 17 Jun 2015 09:26:30 -0400 (EDT)
Subject: [ovs-discuss] Enable STP on fake bridge
In-Reply-To: <801056384.24593202.1434547424669.JavaMail.zimbra@redhat.com>
Message-ID: <324726699.24595841.1434547590453.JavaMail.zimbra@redhat.com>

Hello,

a question: Is it possible to set/get STP on fake-bridge/vlan
in OVS? This does not work:
$ vsctl set Bridge br0.1 stp_enable=true

Thanks a lot,
Petr

From blp at nicira.com  Wed Jun 17 07:31:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 17 Jun 2015 07:31:35 -0700
Subject: [ovs-discuss] Enable STP on fake bridge
In-Reply-To: <324726699.24595841.1434547590453.JavaMail.zimbra@redhat.com>
References: <801056384.24593202.1434547424669.JavaMail.zimbra@redhat.com>
 <324726699.24595841.1434547590453.JavaMail.zimbra@redhat.com>
Message-ID: <20150617143135.GD30847@nicira.com>

On Wed, Jun 17, 2015 at 09:26:30AM -0400, Petr Horacek wrote:
> a question: Is it possible to set/get STP on fake-bridge/vlan
> in OVS? This does not work:
> $ vsctl set Bridge br0.1 stp_enable=true

No, that's not supported.


From billy.o.mahony at intel.com  Wed Jun 17 07:55:40 2015
From: billy.o.mahony at intel.com (O Mahony, Billy)
Date: Wed, 17 Jun 2015 14:55:40 +0000
Subject: [ovs-discuss] packet modification on egress port
Message-ID: <03135AEA779D444E90975C2703F148DC1396B0F1@IRSMSX107.ger.corp.intel.com>

Hi All,

I'm trying to set up OF  flows on OVS that will modify packets just before egress on certain ports (but not other ports).

As part of a generic vSwitch (not just OVS) performance test suite I'd like to be able to add certain packet modification actions (dec_ttl, push vlan tag, modify src/dst ip etc) to arbitrary existing flow table configurations. i.e the code to add the rules determining the routing packets between ports would be largely independent of the code that inserted the rules modifying packets.

The test suite will support several different arrangements of VMs but always with two physical ports.  It seems simplest to apply any frame-modifications only to packets destined for egress on the physical ports where they return to the traffic generator.  Doing packet modification at ingress would possibly require further configuration changes to VM interfaces or VNFs which make the code to just 'turn on' packet modification much more complicated.

I thought that by using separate tables for routing and packet-modification along with write_actions in order to select an egress port without actually sending the packet until after any possible frame mod had been completed would look like this:

#start from a clean slate
ovs-ofctl del-flows br0

#table0 pre-route (empty in this example) ovs-ofctl  add-flow br0 "table=0,priority=1 actions=goto_table:1"

#table1 routing
#In this example everything coming in on port1 is egressing on port2 and vice-versa but #there could any number of egress ports involved here. I'm writing the egress port into the metadata in #order to share the selected egress port with table#2 add-flow br0 "table=1,priority=1,in_port=1 actions=write_actions(output:2),write_metadata:2,goto_table:2" ovs-ofctl add-flow br0 "table=1,priority=1,in_port=2 actions=write_actions(output:1),write_metadata:1,goto_table:2"

#table2 post-route
#I'd like any code that wants to modify a pkt before egress to only have to #add an entry here #If a test wants to modify everything egressing on port 2 it just adds the #appropriate high priority line to table#2 - it doesn't have to know or care #about the routing set up in table#1 ovs-ofctl  add-flow br0 "table=2,priority=1000,metadata=2 actions=push_vlan:0x8100,exit"
ovs-ofctl  add-flow br0 "table=2,priority=1 actions=exit"    # << I expect this to egress the pkt on the port set up in table#1

My first problem is:
ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=1 actions=write_actions(output:2),write_metadata:2,goto_table:2"
ovs-ofctl: none of the usable flow formats (OXM,OpenFlow11) is among the allowed flow formats (OpenFlow10,NXM)

This sounds like OF version mismatches, but despite much messing about with --flow_format options for ofctl and  ovs-vsctl set bridge br0
protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13 I could not get rid of this error.

Another funny is that goto_table & write_metadata both work (or at least are
accepted) separately but not together!

$ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=goto_table:2" 
$ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=write_metadata:1"
$ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=write_metadata:1,goto_table:2" OFPT_ERROR (xid=0x6):
NXBRC_UNENCODABLE_ERROR

I'd appreciate any help.  I feel that what I want to do is possible but it's turning out to be much more difficult than expected. I am also using dpdk enabled ports if that makes a difference.

$ ovs-vsctl show
 9ce3fe3f-568c-44fe-9d8b-94585311ccca
    Bridge "br0"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
        Port "br0"
            Interface "br0"
                type: internal

Kindest Regards,
Billy O'Mahony

From kevin.traynor at intel.com  Wed Jun 17 08:27:59 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 17 Jun 2015 15:27:59 +0000
Subject: [ovs-discuss] OVS dump-ports getting errors while
	traffic	flowing
In-Reply-To: <20150617044136.GC30649@nicira.com>
References: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150617044136.GC30649@nicira.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745162BCA@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Ben Pfaff
> Sent: Wednesday, June 17, 2015 5:42 AM
> To: jayachandran.subramanian at wipro.com
> Cc: subramani.paramasivam at wipro.com; pritesh.shinde at wipro.com;
> bugs at openvswitch.org
> Subject: Re: [ovs-discuss] OVS dump-ports getting errors while traffic
> flowing
> 
> Do you also see such large error counts from "ifconfig"?
> 
> On Tue, Jun 16, 2015 at 01:00:13PM +0000, jayachandran.subramanian at wipro.com
> wrote:
> > Hi ,
> >
> > We have brought up topology as below with OpenVSwitch 2.3.9 /DPDK enabled .
> >
> > Sending 128 bytes of frame as bidirectional from Agilent N2X(traffic
> generator) and observed that , in OVS we have found many errors(marked in red
> colour) in dump-ports.
> >
> > [cid:image002.png at 01D0A862.7AF5B9D0]

Just checking - you are using OVS with DPDK and not OVDK as per the diagram?

> >
> > [root at Sodium ~]# ovs-ofctl dump-ports br0
> > OFPST_PORT reply (xid=0x2): 7 ports
> >   port 82: rx pkts=205811668, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=1161555867, bytes=?, drop=10352, errs=?, coll=?
> >   port  1: rx pkts=217870588, bytes=13943718072, drop=0, errs=432724934,
> frame=0, over=0, crc=0
> >            tx pkts=1161547090, bytes=74339015288, drop=1438, errs=0, coll=0
> >   port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
> >            tx pkts=28, bytes=3096, drop=0, errs=0, coll=0
> >   port 83: rx pkts=1161548507, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=217868276, bytes=?, drop=2333, errs=?, coll=?
> >   port  2: rx pkts=1180330673, bytes=75541163410, drop=0, errs=605287882,
> frame=0, over=0, crc=0
> >            tx pkts=205805599, bytes=13171559788, drop=0, errs=0, coll=0
> >   port 81: rx pkts=1161566219, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=205810764, bytes=?, drop=918, errs=?, coll=?
> >   port 80: rx pkts=205805578, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?

I'm not quite sure I understand your setup, but the first thing I would check
is that you are affinitising your cores so that you are not trying to run a
pmd and other VM processing on the same core. You can use top -H and taskset.

> > [root at Sodium ~]#
> >
> > PFA logs attached for your ref . Please let me know , is it OVS capable of
> supporting 1 gig throughput and let me know to resolve these errors.
> >
> > Thanks
> > Jayachandran S
> >
> > The information contained in this electronic message and any attachments to
> this message are intended for the exclusive use of the addressee(s) and may
> contain proprietary, confidential or privileged information. If you are not
> the intended recipient, you should not disseminate, distribute or copy this
> e-mail. Please notify the sender immediately and destroy all copies of this
> message and any attachments. WARNING: Computer viruses can be transmitted via
> email. The recipient should check this email and any attachments for the
> presence of viruses. The company accepts no liability for any damage caused
> by any virus transmitted by this email. www.wipro.com
> 
> 
> 
> > [root at Sodium ~]# ovs-ofctl dump-ports br0
> > OFPST_PORT reply (xid=0x2): 7 ports
> >   port 82: rx pkts=205811668, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=1161555867, bytes=?, drop=10352, errs=?, coll=?
> >   port  1: rx pkts=217870588, bytes=13943718072, drop=0, errs=432724934,
> frame=0, over=0, crc=0
> >            tx pkts=1161547090, bytes=74339015288, drop=1438, errs=0, coll=0
> >   port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
> >            tx pkts=28, bytes=3096, drop=0, errs=0, coll=0
> >   port 83: rx pkts=1161548507, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=217868276, bytes=?, drop=2333, errs=?, coll=?
> >   port  2: rx pkts=1180330673, bytes=75541163410, drop=0, errs=605287882,
> frame=0, over=0, crc=0
> >            tx pkts=205805599, bytes=13171559788, drop=0, errs=0, coll=0
> >   port 81: rx pkts=1161566219, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=205810764, bytes=?, drop=918, errs=?, coll=?
> >   port 80: rx pkts=205805578, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
> >            tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
> > [root at Sodium ~]#
> >
> >
> > [root at Sodium ~]# ovs-vsctl show
> > 4d8805c0-fee8-4ab5-91da-8b946b9d5e09
> >     Bridge "br0"
> >         Port "dpdk1"
> >             Interface "dpdk1"
> >                 type: dpdk
> >         Port "br0"
> >             Interface "br0"
> >                 type: internal
> >         Port "dpdk0"
> >             Interface "dpdk0"
> >                 type: dpdk
> >         Port "vnet0"
> >             Interface "vnet0"
> >                 type: dpdkvhost
> >         Port "vnet3"
> >             Interface "vnet3"
> >                 type: dpdkvhost
> >         Port "vnet1"
> >             Interface "vnet1"
> >                 type: dpdkvhost
> >         Port "vnet4"
> >             Interface "vnet4"
> >                 type: dpdkvhost
> > [root at Sodium ~]#
> >
> >
> > [root at Sodium ~]# ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=5277.175s, table=0, n_packets=1199310196,
> n_bytes=74374229452, idle_age=0, in_port=81 actions=output:82
> >  cookie=0x0, duration=5268.535s, table=0, n_packets=243555755,
> n_bytes=17028969136, idle_age=0, in_port=82 actions=output:81
> >  cookie=0x0, duration=5200.014s, table=0, n_packets=1218075889,
> n_bytes=75500247426, idle_age=0, in_port=2 actions=output:80
> >  cookie=0x0, duration=5192.145s, table=0, n_packets=243549059,
> n_bytes=17028526376, idle_age=0, in_port=80 actions=output:2
> >  cookie=0x0, duration=5182.171s, table=0, n_packets=255615800,
> n_bytes=17752641932, idle_age=0, in_port=1 actions=output:83
> >  cookie=0x0, duration=5172.287s, table=0, n_packets=1199292148,
> n_bytes=74373121978, idle_age=0, in_port=83 actions=output:1
> > [root at Sodium ~]#
> > [root at Sodium ~]#
> 
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Wed Jun 17 09:30:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 17 Jun 2015 09:30:38 -0700
Subject: [ovs-discuss] packet modification on egress port
In-Reply-To: <03135AEA779D444E90975C2703F148DC1396B0F1@IRSMSX107.ger.corp.intel.com>
References: <03135AEA779D444E90975C2703F148DC1396B0F1@IRSMSX107.ger.corp.intel.com>
Message-ID: <20150617163038.GK30847@nicira.com>

On Wed, Jun 17, 2015 at 02:55:40PM +0000, O Mahony, Billy wrote:
> My first problem is:
> ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=1 actions=write_actions(output:2),write_metadata:2,goto_table:2"
> ovs-ofctl: none of the usable flow formats (OXM,OpenFlow11) is among the allowed flow formats (OpenFlow10,NXM)
> 
> This sounds like OF version mismatches, but despite much messing about with --flow_format options for ofctl and  ovs-vsctl set bridge br0
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13 I could not get rid of this error.

You need to enable later OpenFlow versions in ovs-ofctl, e.g. see the
FAQ:

   All current versions of ovs-ofctl enable only OpenFlow 1.0 by
   default.  Use the -O option to enable support for later versions of
   OpenFlow in ovs-ofctl.  For example:

       ovs-ofctl -O OpenFlow13 dump-flows br0

This is because OpenFlow 1.0, even with Nicira extensions, doesn't have
"write_actions".

I agree that this error message is difficult to interpret.

> Another funny is that goto_table & write_metadata both work (or at least are
> accepted) separately but not together!
> 
> $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=goto_table:2" 
> $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=write_metadata:1"

This is because OpenFlow 1.0 with Nicira extensions does support
goto_table and write_metadata.  The latter gets transformed into a
"resubmit" Open vSwitch extension however.

> $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2 actions=write_metadata:1,goto_table:2" OFPT_ERROR (xid=0x6):
> NXBRC_UNENCODABLE_ERROR

This is a bug one way or another.  When ovs-ofctl encodes the goto_table
into OF1.0, it transforms it into "resubmit".  When ovs-vswitchd decodes
it, it sees that the ordering is wrong--since OF1.1+ always executes
instructions in a particular order, OVS enforces that order for
instruction-like extension actions, including "resubmit" which it
classes as an "apply_actions" instruction--and refuses to accept it.
Probably, OVS should just transform that special case internally back
into goto_table.  I'll make a note to do that.

(But you should just add -O to enable your preferred version of
OpenFlow.)

From gowrishankar.m at linux.vnet.ibm.com  Wed Jun 17 10:31:56 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Wed, 17 Jun 2015 23:01:56 +0530
Subject: [ovs-discuss] OVS dump-ports getting errors
	while	traffic	flowing
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F745162BCA@IRSMSX104.ger.corp.intel.com>
References: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150617044136.GC30649@nicira.com>
 <BC0FEEC7D7650749874CEC11314A88F745162BCA@IRSMSX104.ger.corp.intel.com>
Message-ID: <5581AF0C.1080703@linux.vnet.ibm.com>

On Wednesday 17 June 2015 08:57 PM, Traynor, Kevin wrote:
>>
>>> Hi ,
>>>
>>> We have brought up topology as below with OpenVSwitch 2.3.9 /DPDK enabled .
>>>
>>> Sending 128 bytes of frame as bidirectional from Agilent N2X(traffic
>> generator) and observed that , in OVS we have found many errors(marked in red
>> colour) in dump-ports.
>>> [cid:image002.png at 01D0A862.7AF5B9D0]
> Just checking - you are using OVS with DPDK and not OVDK as per the diagram?
I see it is with dpdk as mentioned in the beginning of mail.

<cut>
>>
>>>             tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
> I'm not quite sure I understand your setup, but the first thing I would check
> is that you are affinitising your cores so that you are not trying to run a
> pmd and other VM processing on the same core. You can use top -H and taskset.

I too noticed many other fields with value "?" for vhost-user port, 
where as it is normally
showing packets/bytes count for other port types. I checked with both 
ofctl dump-ports
and appctl dpctl/show -s .

   port  1: rx pkts=2581437, bytes=183201033, drop=0, errs=0, frame=0, 
over=0, crc=0
            tx pkts=45101499, bytes=67075737796, drop=0, errs=0, coll=0
   port  2: rx pkts=45101499, bytes=?, drop=?, errs=?, frame=?, over=?, 
crc=?
            tx pkts=2581370, bytes=?, drop=0, errs=?, coll=?

As per netdev_dpdk_vhost_get_stats(), only rx/tx_packets and tx_drop 
counts are supported
and I was curious to know logic behind it, though I am checking code to 
assist myself.

Could anyone clarify on why only packets count are supported for dpdk ?

Regards,
Gowri Shankar


From billy.o.mahony at intel.com  Wed Jun 17 10:46:13 2015
From: billy.o.mahony at intel.com (O Mahony, Billy)
Date: Wed, 17 Jun 2015 17:46:13 +0000
Subject: [ovs-discuss] packet modification on egress port
In-Reply-To: <20150617163038.GK30847@nicira.com>
References: <03135AEA779D444E90975C2703F148DC1396B0F1@IRSMSX107.ger.corp.intel.com>
 <20150617163038.GK30847@nicira.com>
Message-ID: <03135AEA779D444E90975C2703F148DC1396B2E1@IRSMSX107.ger.corp.intel.com>

Hi Ben,

Thanks so much for the prompt response. 

Looks like I might have been using --flow_format instead of -O.  

At least what I'm trying to do sounds feasible so I'll keep trying.

/Billy.


> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Wednesday, June 17, 2015 5:31 PM
> To: O Mahony, Billy
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] packet modification on egress port
> 
> On Wed, Jun 17, 2015 at 02:55:40PM +0000, O Mahony, Billy wrote:
> > My first problem is:
> > ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=1
> actions=write_actions(output:2),write_metadata:2,goto_table:2"
> > ovs-ofctl: none of the usable flow formats (OXM,OpenFlow11) is among
> > the allowed flow formats (OpenFlow10,NXM)
> >
> > This sounds like OF version mismatches, but despite much messing about
> > with --flow_format options for ofctl and  ovs-vsctl set bridge br0
> > protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13 I could not
> get rid of this error.
> 
> You need to enable later OpenFlow versions in ovs-ofctl, e.g. see the
> FAQ:
> 
>    All current versions of ovs-ofctl enable only OpenFlow 1.0 by
>    default.  Use the -O option to enable support for later versions of
>    OpenFlow in ovs-ofctl.  For example:
> 
>        ovs-ofctl -O OpenFlow13 dump-flows br0
> 
> This is because OpenFlow 1.0, even with Nicira extensions, doesn't have
> "write_actions".
> 
> I agree that this error message is difficult to interpret.
> 
> > Another funny is that goto_table & write_metadata both work (or at
> > least are
> > accepted) separately but not together!
> >
> > $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2
> actions=goto_table:2"
> > $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2
> actions=write_metadata:1"
> 
> This is because OpenFlow 1.0 with Nicira extensions does support goto_table
> and write_metadata.  The latter gets transformed into a "resubmit" Open
> vSwitch extension however.
> 
> > $ ovs-ofctl  add-flow br0 "table=1,priority=1,in_port=2
> actions=write_metadata:1,goto_table:2" OFPT_ERROR (xid=0x6):
> > NXBRC_UNENCODABLE_ERROR
> 
> This is a bug one way or another.  When ovs-ofctl encodes the goto_table
> into OF1.0, it transforms it into "resubmit".  When ovs-vswitchd decodes it, it
> sees that the ordering is wrong--since OF1.1+ always executes instructions in
> a particular order, OVS enforces that order for instruction-like extension
> actions, including "resubmit" which it classes as an "apply_actions"
> instruction--and refuses to accept it.
> Probably, OVS should just transform that special case internally back into
> goto_table.  I'll make a note to do that.
> 
> (But you should just add -O to enable your preferred version of
> OpenFlow.)

From dev_raj82 at yahoo.com  Wed Jun 17 10:52:34 2015
From: dev_raj82 at yahoo.com (r devarajan)
Date: Wed, 17 Jun 2015 17:52:34 +0000 (UTC)
Subject: [ovs-discuss] Update of ofctl 'group' commands
Message-ID: <1844144465.552909.1434563554742.JavaMail.yahoo@mail.yahoo.com>

Have the ovs-ofctl 'group' commands been implemented yet,Â I'm still getting <ovs-ofctl: unknown command 'add-group'> error.
Thanks,Nishanth DÂ 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/995e96cb/attachment.html>

From blp at nicira.com  Wed Jun 17 11:16:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 17 Jun 2015 11:16:05 -0700
Subject: [ovs-discuss] Update of ofctl 'group' commands
In-Reply-To: <1844144465.552909.1434563554742.JavaMail.yahoo@mail.yahoo.com>
References: <1844144465.552909.1434563554742.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150617181605.GB2978@nicira.com>

On Wed, Jun 17, 2015 at 05:52:34PM +0000, r devarajan wrote:
> Have the ovs-ofctl 'group' commands been implemented yet,Â I'm still
> getting <ovs-ofctl: unknown command 'add-group'> error.

Groups are implemented.  I guess you need to upgrade.

From a.n.chippa at gmail.com  Wed Jun 17 11:43:35 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Wed, 17 Jun 2015 11:43:35 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
Message-ID: <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>

Hi Justin,

Any ETA for OVS2.4 with Conntrack?

Thanks,
Ashok

On Thu, Jun 11, 2015 at 11:03 PM, Justin Pettit <jpettit at nicira.com> wrote:

> We wanted to provide a quick update on the plan for the next couple
> releases.  OVS 2.4 is shaping up to be a big release with a number of great
> new features people are anxious to use. Some of the highlights include:
>
>         - Native Linux kernel STT support
>         - Geneve tunneling
>         - DPDK vhost and tunneling
>         - OpenFlow 1.4 bundles (flow transactions)
>         - Bash command completion
>         - RSTP
>         - Multicast snooping
>         - Support for Linux kernels up to 4.0.x
>
> The plan is to branch early next week and have an official release ready
> roughly six weeks after that.
>
> We originally had planned to release OVS 2.4 when the new connection
> tracking features were merged into the upstream kernel. Unfortunately, this
> has taken longer than we anticipated.  We feel we are making progress on
> that front, and once support is added, we will follow it up quickly with
> another release, which will likely be the next LTS.
>
> Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week,
> which contains a number of bug fixes.
>
> Happy switching!
>
> --Justin
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/199154ec/attachment-0001.html>

From blp at nicira.com  Wed Jun 17 13:12:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 17 Jun 2015 13:12:02 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>
Message-ID: <20150617201202.GE2978@nicira.com>

Did you read what Justin wrote?

On Wed, Jun 17, 2015 at 11:43:35AM -0700, Ashok Chippa wrote:
> Hi Justin,
> 
> Any ETA for OVS2.4 with Conntrack?
> 
> Thanks,
> Ashok
> 
> On Thu, Jun 11, 2015 at 11:03 PM, Justin Pettit <jpettit at nicira.com> wrote:
> 
> > We wanted to provide a quick update on the plan for the next couple
> > releases.  OVS 2.4 is shaping up to be a big release with a number of great
> > new features people are anxious to use. Some of the highlights include:
> >
> >         - Native Linux kernel STT support
> >         - Geneve tunneling
> >         - DPDK vhost and tunneling
> >         - OpenFlow 1.4 bundles (flow transactions)
> >         - Bash command completion
> >         - RSTP
> >         - Multicast snooping
> >         - Support for Linux kernels up to 4.0.x
> >
> > The plan is to branch early next week and have an official release ready
> > roughly six weeks after that.
> >
> > We originally had planned to release OVS 2.4 when the new connection
> > tracking features were merged into the upstream kernel. Unfortunately, this
> > has taken longer than we anticipated.  We feel we are making progress on
> > that front, and once support is added, we will follow it up quickly with
> > another release, which will likely be the next LTS.
> >
> > Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week,
> > which contains a number of bug fixes.
> >
> > Happy switching!
> >
> > --Justin
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From kevin.traynor at intel.com  Wed Jun 17 14:03:07 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 17 Jun 2015 21:03:07 +0000
Subject: [ovs-discuss] OVS dump-ports getting errors
	while	traffic	flowing
In-Reply-To: <5581AF0C.1080703@linux.vnet.ibm.com>
References: <SINPR03MB33101D8C702964400D44F7795A70@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150617044136.GC30649@nicira.com>
 <BC0FEEC7D7650749874CEC11314A88F745162BCA@IRSMSX104.ger.corp.intel.com>
 <5581AF0C.1080703@linux.vnet.ibm.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745162F3C@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: gowrishankar [mailto:gowrishankar.m at linux.vnet.ibm.com]
> Sent: Wednesday, June 17, 2015 6:32 PM
> To: Traynor, Kevin; Ben Pfaff
> Cc: jayachandran.subramanian at wipro.com; subramani.paramasivam at wipro.com;
> pritesh.shinde at wipro.com; bugs at openvswitch.org
> Subject: Re: [ovs-discuss] OVS dump-ports getting errors while traffic
> flowing
> 
> On Wednesday 17 June 2015 08:57 PM, Traynor, Kevin wrote:
> >>
> >>> Hi ,
> >>>
> >>> We have brought up topology as below with OpenVSwitch 2.3.9 /DPDK enabled
> .
> >>>
> >>> Sending 128 bytes of frame as bidirectional from Agilent N2X(traffic
> >> generator) and observed that , in OVS we have found many errors(marked in
> red
> >> colour) in dump-ports.
> >>> [cid:image002.png at 01D0A862.7AF5B9D0]
> > Just checking - you are using OVS with DPDK and not OVDK as per the
> diagram?
> I see it is with dpdk as mentioned in the beginning of mail.
> 
> <cut>
> >>
> >>>             tx pkts=1180319172, bytes=?, drop=11522, errs=?, coll=?
> > I'm not quite sure I understand your setup, but the first thing I would
> check
> > is that you are affinitising your cores so that you are not trying to run a
> > pmd and other VM processing on the same core. You can use top -H and
> taskset.
> 
> I too noticed many other fields with value "?" for vhost-user port,
> where as it is normally
> showing packets/bytes count for other port types. I checked with both
> ofctl dump-ports
> and appctl dpctl/show -s .
> 
>    port  1: rx pkts=2581437, bytes=183201033, drop=0, errs=0, frame=0,
> over=0, crc=0
>             tx pkts=45101499, bytes=67075737796, drop=0, errs=0, coll=0
>    port  2: rx pkts=45101499, bytes=?, drop=?, errs=?, frame=?, over=?,
> crc=?
>             tx pkts=2581370, bytes=?, drop=0, errs=?, coll=?
> 
> As per netdev_dpdk_vhost_get_stats(), only rx/tx_packets and tx_drop
> counts are supported
> and I was curious to know logic behind it, though I am checking code to
> assist myself.
> 
> Could anyone clarify on why only packets count are supported for dpdk ?

No real technical reason, just a legacy of the switch over to the DPDK
vhost library and the byte values not being exposed. There should be a
patch to add some of them very shortly.

> 
> Regards,
> Gowri Shankar


From a.n.chippa at gmail.com  Wed Jun 17 14:21:53 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Wed, 17 Jun 2015 14:21:53 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <20150617201202.GE2978@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>
 <20150617201202.GE2978@nicira.com>
Message-ID: <CABFtFwnddrpwBXcjRrSXG66XvvWWBdeMfHEkg4urQEbj=UzLvQ@mail.gmail.com>

Yes I did... "We feel we are making progress on that front, and once
support is added, we will follow it up quickly with another release, which
will likely be the next LTS"

I was looking for a ballpark data for the next LTS... Assuming 4 per year,
within the next 3 to 4 months? Would that be more or less right?

thanks


On Wed, Jun 17, 2015 at 1:12 PM, Ben Pfaff <blp at nicira.com> wrote:

> Did you read what Justin wrote?
>
> On Wed, Jun 17, 2015 at 11:43:35AM -0700, Ashok Chippa wrote:
> > Hi Justin,
> >
> > Any ETA for OVS2.4 with Conntrack?
> >
> > Thanks,
> > Ashok
> >
> > On Thu, Jun 11, 2015 at 11:03 PM, Justin Pettit <jpettit at nicira.com>
> wrote:
> >
> > > We wanted to provide a quick update on the plan for the next couple
> > > releases.  OVS 2.4 is shaping up to be a big release with a number of
> great
> > > new features people are anxious to use. Some of the highlights include:
> > >
> > >         - Native Linux kernel STT support
> > >         - Geneve tunneling
> > >         - DPDK vhost and tunneling
> > >         - OpenFlow 1.4 bundles (flow transactions)
> > >         - Bash command completion
> > >         - RSTP
> > >         - Multicast snooping
> > >         - Support for Linux kernels up to 4.0.x
> > >
> > > The plan is to branch early next week and have an official release
> ready
> > > roughly six weeks after that.
> > >
> > > We originally had planned to release OVS 2.4 when the new connection
> > > tracking features were merged into the upstream kernel. Unfortunately,
> this
> > > has taken longer than we anticipated.  We feel we are making progress
> on
> > > that front, and once support is added, we will follow it up quickly
> with
> > > another release, which will likely be the next LTS.
> > >
> > > Finally, on the subject of LTS, we plan to release OVS 2.3.2 next week,
> > > which contains a number of bug fixes.
> > >
> > > Happy switching!
> > >
> > > --Justin
> > >
> > >
> > > _______________________________________________
> > > discuss mailing list
> > > discuss at openvswitch.org
> > > http://openvswitch.org/mailman/listinfo/discuss
> > >
>
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/0bfd9e40/attachment.html>

From jpettit at nicira.com  Wed Jun 17 14:27:53 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 17 Jun 2015 14:27:53 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <CABFtFwnddrpwBXcjRrSXG66XvvWWBdeMfHEkg4urQEbj=UzLvQ@mail.gmail.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>
 <20150617201202.GE2978@nicira.com>
 <CABFtFwnddrpwBXcjRrSXG66XvvWWBdeMfHEkg4urQEbj=UzLvQ@mail.gmail.com>
Message-ID: <22E392E1-5CAE-4BA6-9443-A154A7A412AE@nicira.com>


> On Jun 17, 2015, at 2:21 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:
> 
> Yes I did... "We feel we are making progress on that front, and once support is added, we will follow it up quickly with another release, which will likely be the next LTS"
> 
> I was looking for a ballpark data for the next LTS... Assuming 4 per year, within the next 3 to 4 months? Would that be more or less right?

The first sentence in that paragraph you quoted was about needing the feature supported in the upstream kernel.  We don't maintain the upstream kernel, so it's outside of our control.  I hope that it will be accepted soon, but I don't want to hazard a guess on the timeline.  I will make sure to update everyone when a decision is made.

--Justin



From a.n.chippa at gmail.com  Wed Jun 17 14:36:09 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Wed, 17 Jun 2015 14:36:09 -0700
Subject: [ovs-discuss] OVS 2.4 Release Plans
In-Reply-To: <22E392E1-5CAE-4BA6-9443-A154A7A412AE@nicira.com>
References: <88273EA7-AE41-4FBD-BB50-7DDEDED66886@nicira.com>
 <CABFtFw=xhDgZhA-QRfZgqhP1qLHk5kry2uvvi8DwtE0YJb1JaA@mail.gmail.com>
 <20150617201202.GE2978@nicira.com>
 <CABFtFwnddrpwBXcjRrSXG66XvvWWBdeMfHEkg4urQEbj=UzLvQ@mail.gmail.com>
 <22E392E1-5CAE-4BA6-9443-A154A7A412AE@nicira.com>
Message-ID: <CABFtFwm=WMt8BPfkND5-L2_AVk-_K=TijAqXJeyiEi87PE-N6Q@mail.gmail.com>

Unfortunately some of our managers push us on dates... :(

Thanks for the info.

On Wed, Jun 17, 2015 at 2:27 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Jun 17, 2015, at 2:21 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:
> >
> > Yes I did... "We feel we are making progress on that front, and once
> support is added, we will follow it up quickly with another release, which
> will likely be the next LTS"
> >
> > I was looking for a ballpark data for the next LTS... Assuming 4 per
> year, within the next 3 to 4 months? Would that be more or less right?
>
> The first sentence in that paragraph you quoted was about needing the
> feature supported in the upstream kernel.  We don't maintain the upstream
> kernel, so it's outside of our control.  I hope that it will be accepted
> soon, but I don't want to hazard a guess on the timeline.  I will make sure
> to update everyone when a decision is made.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/2cdc0a06/attachment-0001.html>

From dev_raj82 at yahoo.com  Wed Jun 17 11:23:02 2015
From: dev_raj82 at yahoo.com (r devarajan)
Date: Wed, 17 Jun 2015 18:23:02 +0000 (UTC)
Subject: [ovs-discuss] Update of ofctl 'group' commands
In-Reply-To: <20150617181605.GB2978@nicira.com>
References: <20150617181605.GB2978@nicira.com>
Message-ID: <1809860920.570650.1434565382363.JavaMail.yahoo@mail.yahoo.com>

Terribly sorry but could you tell me how to go about; say adding a group to bridge br0
Thank you,Nishanth Dev      From: Ben Pfaff <blp at nicira.com>
 To: r devarajan <dev_raj82 at yahoo.com> 
Cc: discuss at openvswitch.org 
 Sent: Wednesday, June 17, 2015 11:46 PM
 Subject: Re: [ovs-discuss] Update of ofctl 'group' commands
   
On Wed, Jun 17, 2015 at 05:52:34PM +0000, r devarajan wrote:


> Have the ovs-ofctl 'group' commands been implemented yet,Â I'm still
> getting <ovs-ofctl: unknown command 'add-group'> error.

Groups are implemented.Â  I guess you need to upgrade.


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150617/8e9fa5b0/attachment.html>

From dwilder at us.ibm.com  Wed Jun 17 21:28:42 2015
From: dwilder at us.ibm.com (David J. Wilder)
Date: Wed, 17 Jun 2015 21:28:42 -0700
Subject: [ovs-discuss] Slow to load flows
Message-ID: <1434601722.2056.3.camel@oc7500204423.ibm.com>

Hi-

I am chasing a problem with intermittent delays in passing packets
between ports of a switch  (about 1 second delay).  I did some brute
force debugging with printks and saw an occasional 1 second delay in
obtaining a flow from user-space into the kernel.  Most of the flows are
loaded with little delay,  about 1% of the time I see the 1 second
delay.

I have a single instance of an OVS bridge with 2048 ports.  About 200 of
the ports are exchanging packets.  The traffic flow is very simplistic,
a single port only send packets to one other port, for example port 1
only exchanges packets with port 2, port 3 exchanges with port 4...  I
am creating only the minimal flows that I need for my test using
ovs-ofctl add-flow commands.

I tried setting a  -20 nice value for ovs-vswitchd and ovsdb-server with
no change in the results.

Anyone have an idea what the problem could be or how I might
troubleshoot this?

ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.1
Compiled Dec 18 2014 12:42:31
DB Schema 7.6.2
--------------------------
uname -r
3.19.0


From ian.stokes at intel.com  Thu Jun 18 07:19:40 2015
From: ian.stokes at intel.com (Stokes, Ian)
Date: Thu, 18 Jun 2015 14:19:40 +0000
Subject: [ovs-discuss] QoS removal from port and database
Message-ID: <CD7C01071941AC429549C17338DB8A526AC392A7@IRSMSX101.ger.corp.intel.com>

Hi All,

I have been experimenting with Openvswitch and QoS. I have a question regarding how an existing QoS configuration on a port is removed.

I setup QoS on an existing port with the following command

sudo ovs-vsctl -- set PortÂ $IF_NAMEÂ qos=@newqos -- \
Â Â Â  --id=@newqos create QoS type=linux-htb other-config:max-rate=4000000 queues=0=@q0 -- \
Â Â Â  --id=@q0 create Queue other-config:min-rate=4000000 other-config:max-rate=4000000

This gives me the _uuid of both the QoS and Queue entry

0b62cfb0-c335-45ca-8910-ca4030ea13af
24ff16d8-926e-4c12-aad8-b7b06c6ec575

When I send traffic I can see that QoS is indeed configured.

I then remove the QoS configuration on the port with the following command

sudo ovs-vsctl clear PortÂ $IF_NAMEÂ qos

I can see that QoS is no longer active on the port as the throughput is no longer being limited.

However when I check the database to see if QoS has been removed the QoS table entry is still present along with the queue entry.

sudo ovs-vsctl list qos
_uuid               : 0b62cfb0-c335-45ca-8910-ca4030ea13af
external_ids        : {}
other_config        : {max-rate="4000000"}
queues              : {0=24ff16d8-926e-4c12-aad8-b7b06c6ec575}
type                : linux-htb

To remove these entries I have to complete an additional step as follows for both QoS and queue

sudo ovs-vsctl  --  destroy  qos 0b62cfb0-c335-45ca-8910-ca4030ea13af
sudo ovs-vsctl  --  destroy  queue 24ff16d8-926e-4c12-aad8-b7b06c6ec575

Previously I assumed that clearing QoS from the port with my first command would automatically clear the database QoS entry as well but it would seem that this is not the case. Is this behavior expected?

I have also seen similar behavior if I destroy the QoS record first. Although the record will no longer be in the database it seems that the port is still configured for QoS until I call clear PortÂ $IF_NAMEÂ qos.

Appreciate any insight on this.

Thanks
Ian Stokes

From sbezverk at cisco.com  Thu Jun 18 09:03:03 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Thu, 18 Jun 2015 16:03:03 +0000
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2
 -Wno-cast-align"
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>


Hello,

I am trying to build OVS with DPDK support and I have everything prepared from DPDK side, CONFIG_RTE_LIBRTE_VHOST_USER=y CONFIG_RTE_BUILD_COMBINE_LIBS=y are set and I do see DPDK generated libintel_dpdk.a combined library. When I run:

configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"

I am getting :

configure: error:  ----- cannot link with dpdk ------

I would greatly appreciate some suggestion how to resolve this linking issue.  I am running RHEL 7.1 with 3.10.0-229.4.2.el7.x86_64. Latest DPDK cloned from the master and latest 2.3.90 OVS also cloned from the master.

Thank you

Serguei

[http://www.cisco.com/c/dam/assets/email-signature-tool/logo_07.png?ct=1423747865775]

Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com<mailto:sbezverk at cisco.com>
Phone: +1 416 306 7312
Mobile: +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527


Cisco.com<http://www.cisco.com/>



[http://www.cisco.com/assets/swa/img/thinkbeforeyouprint.gif] Think before you print.

This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
Please click here<http://www.cisco.com/web/about/doing_business/legal/cri/index.html> for Company Registration Information.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/1c6fd454/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 2629 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/1c6fd454/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 134 bytes
Desc: image002.gif
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/1c6fd454/attachment-0001.gif>

From blp at nicira.com  Thu Jun 18 09:13:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 18 Jun 2015 09:13:45 -0700
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
Message-ID: <20150618161345.GB5835@nicira.com>

On Thu, Jun 18, 2015 at 04:03:03PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> I am trying to build OVS with DPDK support and I have everything prepared from DPDK side, CONFIG_RTE_LIBRTE_VHOST_USER=y CONFIG_RTE_BUILD_COMBINE_LIBS=y are set and I do see DPDK generated libintel_dpdk.a combined library. When I run:
> 
> configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"
> 
> I am getting :
> 
> configure: error:  ----- cannot link with dpdk ------
> 
> I would greatly appreciate some suggestion how to resolve this linking issue.  I am running RHEL 7.1 with 3.10.0-229.4.2.el7.x86_64. Latest DPDK cloned from the master and latest 2.3.90 OVS also cloned from the master.

I'd start by looking at config.log.  It should show the commands that
"configure" used to try to link against DPDK.  Can you figure out why
they did not succeed?

From blp at nicira.com  Thu Jun 18 09:26:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 18 Jun 2015 09:26:06 -0700
Subject: [ovs-discuss] Update of ofctl 'group' commands
In-Reply-To: <6FC6E2E2-5A59-420D-B785-0C3495F68435@yahoo.com>
References: <1844144465.552909.1434563554742.JavaMail.yahoo@mail.yahoo.com>
 <20150617181605.GB2978@nicira.com>
 <6FC6E2E2-5A59-420D-B785-0C3495F68435@yahoo.com>
Message-ID: <20150618162606.GE5835@nicira.com>

Read the ovs-ofctl manpage.

On Wed, Jun 17, 2015 at 11:49:56PM +0530, Nishanth Devarajan wrote:
> Terribly sorry but could you tell me how to go about; say adding a group to bridge br0
> 
> Thank you,
> Nishanth Dev
> > On 17-Jun-2015, at 11:46 pm, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > On Wed, Jun 17, 2015 at 05:52:34PM +0000, r devarajan wrote:
> >> Have the ovs-ofctl 'group' commands been implemented yet, I'm still
> >> getting <ovs-ofctl: unknown command 'add-group'> error.
> > 
> > Groups are implemented.  I guess you need to upgrade.
> 

From blp at nicira.com  Thu Jun 18 09:27:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 18 Jun 2015 09:27:33 -0700
Subject: [ovs-discuss] Update of ofctl 'group' commands
In-Reply-To: <89677125.937820.1434602142656.JavaMail.yahoo@mail.yahoo.com>
References: <20150617181605.GB2978@nicira.com>
 <89677125.937820.1434602142656.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150618162733.GF5835@nicira.com>

Read the installation document.

On Thu, Jun 18, 2015 at 04:35:42AM +0000, r devarajan wrote:
> I've downloaded the openvswitch-2.3.1 code for the official site and when i type: Â ovs-ofctl -V
> I get : ovs-ofctl (Open vSwitch) 2.0.1
> but I require OVS 2.1 version to implement ovs-ofctl "groups" commands .How do I upgrade?
>       From: Ben Pfaff <blp at nicira.com>
>  To: r devarajan <dev_raj82 at yahoo.com> 
> Cc: discuss at openvswitch.org 
>  Sent: Wednesday, June 17, 2015 11:46 PM
>  Subject: Re: [ovs-discuss] Update of ofctl 'group' commands
>    
> On Wed, Jun 17, 2015 at 05:52:34PM +0000, r devarajan wrote:
> 
> 
> > Have the ovs-ofctl 'group' commands been implemented yet,Â I'm still
> > getting <ovs-ofctl: unknown command 'add-group'> error.
> 
> Groups are implemented.Â  I guess you need to upgrade.
> 
> 
>   

From sbezverk at cisco.com  Thu Jun 18 09:49:14 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Thu, 18 Jun 2015 16:49:14 +0000
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <20150618161345.GB5835@nicira.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
 <20150618161345.GB5835@nicira.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>

Hi Ben,

As you suggested I check config.log and it appears the error is not dpdk related but fusea related.

| /* end confdefs.h.  */
| #include <rte_config.h>
|                              #include <rte_eal.h>
| int
| main ()
| {
| int rte_argc; char ** rte_argv;
|                              rte_eal_init(rte_argc, rte_argv);
|   ;
|   return 0;
| }
configure:18260: gcc -std=gnu99 -o conftest -g -O2 -Wno-cast-align -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//include   -L/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//lib conftest.c -lintel_dpdk -ldl -lpthread -lrt -lm  -lfusea >&5
/usr/bin/ld: cannot find -lfusea
collect2: error: ld returned 1 exit status
configure:18260: $? = 1
configure: failed program was:
| /* confdefs.h */

I have fuse and fuse-devel installed.

Anything else I could check?

Thank you

Serguei


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Thursday, June 18, 2015 12:14 PM
To: Serguei Bezverkhi (sbezverk)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"

On Thu, Jun 18, 2015 at 04:03:03PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> I am trying to build OVS with DPDK support and I have everything prepared from DPDK side, CONFIG_RTE_LIBRTE_VHOST_USER=y CONFIG_RTE_BUILD_COMBINE_LIBS=y are set and I do see DPDK generated libintel_dpdk.a combined library. When I run:
> 
> configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"
> 
> I am getting :
> 
> configure: error:  ----- cannot link with dpdk ------
> 
> I would greatly appreciate some suggestion how to resolve this linking issue.  I am running RHEL 7.1 with 3.10.0-229.4.2.el7.x86_64. Latest DPDK cloned from the master and latest 2.3.90 OVS also cloned from the master.

I'd start by looking at config.log.  It should show the commands that "configure" used to try to link against DPDK.  Can you figure out why they did not succeed?

From blp at nicira.com  Thu Jun 18 09:56:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 18 Jun 2015 09:56:24 -0700
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
 <20150618161345.GB5835@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
Message-ID: <20150618165624.GG5835@nicira.com>

On Thu, Jun 18, 2015 at 04:49:14PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> Hi Ben,
> 
> As you suggested I check config.log and it appears the error is not dpdk related but fusea related.
> 
> | /* end confdefs.h.  */
> | #include <rte_config.h>
> |                              #include <rte_eal.h>
> | int
> | main ()
> | {
> | int rte_argc; char ** rte_argv;
> |                              rte_eal_init(rte_argc, rte_argv);
> |   ;
> |   return 0;
> | }
> configure:18260: gcc -std=gnu99 -o conftest -g -O2 -Wno-cast-align -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//include   -L/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//lib conftest.c -lintel_dpdk -ldl -lpthread -lrt -lm  -lfusea >&5
> /usr/bin/ld: cannot find -lfusea
> collect2: error: ld returned 1 exit status
> configure:18260: $? = 1
> configure: failed program was:
> | /* confdefs.h */
> 
> I have fuse and fuse-devel installed.

This doesn't make any sense, I can't find any references anywhere to
"libfusea".  OVS doesn't try to link against such a library, nor has
Google heard of such a library.  "libfuse", sure, but not "libfusea".

Dunno.

From sbezverk at cisco.com  Thu Jun 18 09:58:13 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Thu, 18 Jun 2015 16:58:13 +0000
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <20150618165624.GG5835@nicira.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
 <20150618161345.GB5835@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
 <20150618165624.GG5835@nicira.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C91BEA@xmb-rcd-x06.cisco.com>

The mystery is solved. In configure.

        LIBS="$DPDK_LIB $extras $save_LIBS $DPDK_EXTRA_LIB"a

By some reason there was 'a' at the end of this line

After I removed 'a' everything started to work. Thank you!!

Serguei


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Thursday, June 18, 2015 12:56 PM
To: Serguei Bezverkhi (sbezverk)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"

On Thu, Jun 18, 2015 at 04:49:14PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> Hi Ben,
> 
> As you suggested I check config.log and it appears the error is not dpdk related but fusea related.
> 
> | /* end confdefs.h.  */
> | #include <rte_config.h>
> |                              #include <rte_eal.h> int main () { int 
> | rte_argc; char ** rte_argv;
> |                              rte_eal_init(rte_argc, rte_argv);
> |   ;
> |   return 0;
> | }
> configure:18260: gcc -std=gnu99 -o conftest -g -O2 -Wno-cast-align -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//include   -L/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//lib conftest.c -lintel_dpdk -ldl -lpthread -lrt -lm  -lfusea >&5
> /usr/bin/ld: cannot find -lfusea
> collect2: error: ld returned 1 exit status
> configure:18260: $? = 1
> configure: failed program was:
> | /* confdefs.h */
> 
> I have fuse and fuse-devel installed.

This doesn't make any sense, I can't find any references anywhere to "libfusea".  OVS doesn't try to link against such a library, nor has Google heard of such a library.  "libfuse", sure, but not "libfusea".

Dunno.

From blp at nicira.com  Thu Jun 18 10:00:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 18 Jun 2015 10:00:38 -0700
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C91BEA@xmb-rcd-x06.cisco.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
 <20150618161345.GB5835@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
 <20150618165624.GG5835@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C91BEA@xmb-rcd-x06.cisco.com>
Message-ID: <20150618170038.GH5835@nicira.com>

I can't find that in the configure script, is this some local change?

On Thu, Jun 18, 2015 at 04:58:13PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> The mystery is solved. In configure.
> 
>         LIBS="$DPDK_LIB $extras $save_LIBS $DPDK_EXTRA_LIB"a
> 
> By some reason there was 'a' at the end of this line
> 
> After I removed 'a' everything started to work. Thank you!!
> 
> Serguei
> 
> 
> Serguei Bezverkhi,
> TECHNICAL LEADER.SERVICES
> Global SP Services
> sbezverk at cisco.com
> Phone:Â +1 416 306 7312
> Mobile:Â +1 514 234 7374
> 
> CCIE (R&S,SP,Sec) - #9527
> 
> Cisco.com
> 
> 
> 
> Â Think before you print.
> This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
> PleaseÂ click hereÂ for Company Registration Information.
> 
> 
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com] 
> Sent: Thursday, June 18, 2015 12:56 PM
> To: Serguei Bezverkhi (sbezverk)
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"
> 
> On Thu, Jun 18, 2015 at 04:49:14PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> > Hi Ben,
> > 
> > As you suggested I check config.log and it appears the error is not dpdk related but fusea related.
> > 
> > | /* end confdefs.h.  */
> > | #include <rte_config.h>
> > |                              #include <rte_eal.h> int main () { int 
> > | rte_argc; char ** rte_argv;
> > |                              rte_eal_init(rte_argc, rte_argv);
> > |   ;
> > |   return 0;
> > | }
> > configure:18260: gcc -std=gnu99 -o conftest -g -O2 -Wno-cast-align -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//include   -L/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//lib conftest.c -lintel_dpdk -ldl -lpthread -lrt -lm  -lfusea >&5
> > /usr/bin/ld: cannot find -lfusea
> > collect2: error: ld returned 1 exit status
> > configure:18260: $? = 1
> > configure: failed program was:
> > | /* confdefs.h */
> > 
> > I have fuse and fuse-devel installed.
> 
> This doesn't make any sense, I can't find any references anywhere to "libfusea".  OVS doesn't try to link against such a library, nor has Google heard of such a library.  "libfuse", sure, but not "libfusea".
> 
> Dunno.

From zhaojun12 at outlook.com  Thu Jun 18 07:48:32 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Thu, 18 Jun 2015 22:48:32 +0800
Subject: [ovs-discuss] how to remove GRE headers using open flow
Message-ID: <BAY172-W124514FDB5DFD7CE6DF642B2A50@phx.gbl>

hi all, i am new to OVS. i have a problem.
i have two servers, called A and B, both of them have installed OVS. and they are connected by GRE tunnel.
result of ovs-vsctl show in A:[root at 00259064a21e ~]# ovs-vsctl showaa44e5ff-a8fe-44bb-aef1-536c6cb6f10b    Bridge OVS-SWITCH        Port gre-fit-cernet            Interface gre-fit-cernet                type: gre                options: {remote_ip="115.25.86.12"}        Port "em1"            Interface "em1"        Port OVS-SWITCH            Interface OVS-SWITCH                type: internal        Port "em2"            Interface "em2"    ovs_version: "2.3.1-git4750c96"
and B:[root at fedora Documents]# ovs-vsctl show32f5a39d-d05f-4979-bc17-4914b6b1f84a    Bridge OVS-SWITCH        Port gre-cernet-fit            Interface gre-cernet-fit                type: gre                options: {remote_ip="202.38.101.24"}        Port "enp3s2"            Interface "enp3s2"        Port OVS-SWITCH            Interface OVS-SWITCH                type: internal    ovs_version: "2.3.1-git4750c96"
there is also a host H connected with A's port "em2" with an Intranet IP
all the traffic destined to H will be delivered through the GRE tunnel and arriving at A.
and i want to using ovs-ofctl add-flow command to add a flow rule to remove the packets GRE headers and redirect the rest message(embeded packet) through port "em2" to H 
but i donot know how to add the flow table rule.
here is some commands i have tried, but failed.
1)ovs-ofctl add-flow OVS-SWITCH idle_timeout=0,in_port=OVS-SWITCH/em1/gre-fit-cernet,dl_type=0x800,nw_proto=0x2F,actions=strip_vlan,output:em22)ovs-ofctl add-flow OVS-SWITCH idle_timeout=0,in_port=OVS-SWITCH/em1/gre-fit-cernet,dl_type=0x800,nw_src=115.25.86.12,tun_dst=10.0.0.2(host H's ip address),actions=output:em2
thanks!

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/892a17a6/attachment-0001.html>

From sbezverk at cisco.com  Thu Jun 18 08:49:45 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Thu, 18 Jun 2015 15:49:45 +0000
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2
 -Wno-cast-align"
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C91A1F@xmb-rcd-x06.cisco.com>

Hello,

I am trying to build OVS with DPDK support and I have everything prepared from DPDK side, CONFIG_RTE_LIBRTE_VHOST_USER=y CONFIG_RTE_BUILD_COMBINE_LIBS=y are set and I do see DPDK generated libintel_dpdk.a combined library. When I run:

configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"

I am getting :

configure: error:  ----- cannot link with dpdk ------

I would greatly appreciate some suggestion how to resolve this linking issue.  I am running RHEL 7.1 with 3.10.0-229.4.2.el7.x86_64. Latest DPDK cloned from the master and latest 2.3.90 OVS also cloned from the master.

Thank you

Serguei

[http://www.cisco.com/c/dam/assets/email-signature-tool/logo_07.png?ct=1423747865775]

Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com<mailto:sbezverk at cisco.com>
Phone: +1 416 306 7312
Mobile: +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527


Cisco.com<http://www.cisco.com/>



[http://www.cisco.com/assets/swa/img/thinkbeforeyouprint.gif] Think before you print.

This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
Please click here<http://www.cisco.com/web/about/doing_business/legal/cri/index.html> for Company Registration Information.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/111dc4d0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 2629 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/111dc4d0/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 134 bytes
Desc: image002.gif
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150618/111dc4d0/attachment-0001.gif>

From daniels at research.att.com  Thu Jun 18 12:46:45 2015
From: daniels at research.att.com (Scott Daniels)
Date: Thu, 18 Jun 2015 15:46:45 -0400 (EDT)
Subject: [ovs-discuss] Upcall to userspace threading question
In-Reply-To: <CAEP_g=-fS_-PatqdZ3OR9vPmnvd3P8oMpz0rjS0Nhmm4qNu8jQ@mail.gmail.com>
References: <alpine.LSU.2.11.1506120827260.27561@ybpnyubfg>
 <CAEP_g=-fS_-PatqdZ3OR9vPmnvd3P8oMpz0rjS0Nhmm4qNu8jQ@mail.gmail.com>
Message-ID: <alpine.LSU.2.11.1506181543120.27561@ybpnyubfg>

Jesse,

Thanks.

One follow-up in line.

Scott


On Friday 2015-06-12 23:02, Jesse Gross wrote:

>Date: Fri, 12 Jun 2015 23:02:05
>From: Jesse Gross <jesse at nicira.com>
>To: Scott Daniels <daniels at research.att.com>
>Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
>Subject: Re: [ovs-discuss] Upcall to userspace threading question
>
> On Fri, Jun 12, 2015 at 5:29 AM, Scott Daniels <daniels at research.att.com> wrote:
>> Currently flow setup is done in a round-robin manner based on port to
>> prevent the possibility of a denial of service attack.  However, in a
>> situation where all GRE tunnels terminate on a single port (specifically in
>> the case of an L3 node under Openstack) it seems to make sense to further
>> split the flow setup from a single port to prevent the possibility of a
>> similar DoS attack that affects the GRE traffic.
>>
>> Has this split been considered, and if so are there reasons that it wasn't
>> implemented?
>
> This isn't entirely true any more (it used to be). Each port now has
> an array of sockets that packets can be queued to and flows are spread
> among them based on a hash of the flow.

Looking through the change log I'm not able to tell when this was 
introduced -- want to make sure that we're at or beyond that point.  Do 
you know which version introduced this, or is there something in the 
source that would be easily spotted if I had a peek?

Thanks again,
Scott


  >
>> Somewhat related, when an action list contains a sample action it causes the
>> packet to be cloned and sent to userspace. The way I read it the samples
>> share the same upcall path as flow setup upcalls. Given that sampling would
>> be pushing larger packets into the upcall path, compared to SYNs during flow
>> setup, I assume that if the sampling rate were too aggressive that this
>> could lead to a full upcall queue which would have a negative impact on
>> other traffic.
>>
>> Has there been any thought given to splitting the sampling upcalls from the
>> rest of the upcall "traffic?"
>
> It's possible to implement this given the existing kernel
> infrastructure but I haven't heard this being an issue before and so
> nobody has bothered to do it to the best of my knowledge. Other types
> of control packets - STP, CFM, etc. - are sent to a separate queue.
>

From jpettit at nicira.com  Thu Jun 18 14:01:39 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 18 Jun 2015 14:01:39 -0700
Subject: [ovs-discuss] Open vSwitch 2.3.2 Available
Message-ID: <858019E1-4CA5-4C1B-8F92-8A6582E34B07@nicira.com>

The Open vSwitch team is pleased to announce the release of Open vSwitch 2.3.2:  

   http://openvswitch.org/releases/openvswitch-2.3.2.tar.gz

This release contains bug fixes for 2.3.1.

--The Open vSwitch Team  

--------------------  
Open vSwitch is a production quality, multilayer open source virtual switch. It is designed to enable massive network automation through programmatic extension, while still supporting standard management interfaces. Open vSwitch can operate both as a soft switch running within the hypervisor, and as the control stack for switching silicon. It has been ported to multiple virtualization platforms and switching chipsets.  



From fbl at sysclose.org  Thu Jun 18 17:22:12 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 18 Jun 2015 21:22:12 -0300
Subject: [ovs-discuss] fail configure --with-dpdk=$DPDK_BUILD CFLAGS="-g
 -O2 -Wno-cast-align"
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
References: <EDCEC56DA1E05E428B0B5FBB4D07139216C91ABD@xmb-rcd-x06.cisco.com>
 <20150618161345.GB5835@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C91BAE@xmb-rcd-x06.cisco.com>
Message-ID: <20150619002212.GA2579@x240.home>

On Thu, Jun 18, 2015 at 04:49:14PM +0000, Serguei Bezverkhi (sbezverk) wrote:
> Hi Ben,
> 
> As you suggested I check config.log and it appears the error is not dpdk related but fusea related.
> 
> | /* end confdefs.h.  */
> | #include <rte_config.h>
> |                              #include <rte_eal.h>
> | int
> | main ()
> | {
> | int rte_argc; char ** rte_argv;
> |                              rte_eal_init(rte_argc, rte_argv);
> |   ;
> |   return 0;
> | }
> configure:18260: gcc -std=gnu99 -o conftest -g -O2 -Wno-cast-align
> -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//include
> -L/root/virtualization/dpdk/x86_64-native-linuxapp-gcc//lib
> conftest.c -lintel_dpdk -ldl -lpthread -lrt -lm  -lfusea >&5
> /usr/bin/ld: cannot find -lfusea

Looks like your configure script is damaged with a typo, so just run
# grep -n 'lfusea' *

and you will find where it is.
I'd say to bootstrap the tree again.

fbl


From jesse at nicira.com  Thu Jun 18 17:26:40 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 18 Jun 2015 17:26:40 -0700
Subject: [ovs-discuss] Upcall to userspace threading question
In-Reply-To: <alpine.LSU.2.11.1506181543120.27561@ybpnyubfg>
References: <alpine.LSU.2.11.1506120827260.27561@ybpnyubfg>
 <CAEP_g=-fS_-PatqdZ3OR9vPmnvd3P8oMpz0rjS0Nhmm4qNu8jQ@mail.gmail.com>
 <alpine.LSU.2.11.1506181543120.27561@ybpnyubfg>
Message-ID: <CAEP_g=-F_A9sS6n9sQo3XyL_HWrwT_SoGOtONXdmgdivTNLqGQ@mail.gmail.com>

On Thu, Jun 18, 2015 at 12:46 PM, Scott Daniels
<daniels at research.att.com> wrote:
> Jesse,
>
> Thanks.
>
> One follow-up in line.
>
> Scott
>
>
> On Friday 2015-06-12 23:02, Jesse Gross wrote:
>
>> Date: Fri, 12 Jun 2015 23:02:05
>> From: Jesse Gross <jesse at nicira.com>
>> To: Scott Daniels <daniels at research.att.com>
>> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
>> Subject: Re: [ovs-discuss] Upcall to userspace threading question
>>
>> On Fri, Jun 12, 2015 at 5:29 AM, Scott Daniels <daniels at research.att.com>
>> wrote:
>>>
>>> Currently flow setup is done in a round-robin manner based on port to
>>> prevent the possibility of a denial of service attack.  However, in a
>>> situation where all GRE tunnels terminate on a single port (specifically
>>> in
>>> the case of an L3 node under Openstack) it seems to make sense to further
>>> split the flow setup from a single port to prevent the possibility of a
>>> similar DoS attack that affects the GRE traffic.
>>>
>>> Has this split been considered, and if so are there reasons that it
>>> wasn't
>>> implemented?
>>
>>
>> This isn't entirely true any more (it used to be). Each port now has
>> an array of sockets that packets can be queued to and flows are spread
>> among them based on a hash of the flow.
>
>
> Looking through the change log I'm not able to tell when this was introduced
> -- want to make sure that we're at or beyond that point.  Do you know which
> version introduced this, or is there something in the source that would be
> easily spotted if I had a peek?

You'll need OVS 2.3 for userspace and either the paired kernel module
or the module from Linux 3.17.

From sbezverk at cisco.com  Fri Jun 19 10:08:05 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Fri, 19 Jun 2015 17:08:05 +0000
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C92E06@xmb-rcd-x06.cisco.com>

Hello,

I tried to make OVS 2.3.2 with the latest dpdk library and compile is failing. I was wondering if it is me doing something wrong or it is in fact an issue. Here are the steps to repro:

1.       Git clone the latest dpdk

2.       Build it with Combine library and vhost_user set to Yes

3.       Run boot.sh

4.       ./configure --with-dpdk=$DPDK_BUILD (Completed sucsesfully)

5.       make CFLAGS='-O3 -march=native'


Below is the resulted messages.  I would greatly appreciate if you could confirm if it is the issue or I do something wrong.

Thank you

Serguei


make CFLAGS='-O3 -march=native'
make  all-recursive
make[1]: Entering directory `/root/virtualization/openvswitch-2.3.2'
Making all in datapath
make[2]: Entering directory `/root/virtualization/openvswitch-2.3.2/datapath'
make[3]: Entering directory `/root/virtualization/openvswitch-2.3.2/datapath'
make[3]: Nothing to be done for `all-am'.
make[3]: Leaving directory `/root/virtualization/openvswitch-2.3.2/datapath'
make[2]: Leaving directory `/root/virtualization/openvswitch-2.3.2/datapath'
make[2]: Entering directory `/root/virtualization/openvswitch-2.3.2'
depbase=`echo lib/aes128.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.    -I ./include -I ./lib -I ./lib   -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include  -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT lib/aes128.lo -MD -MP -MF $depbase.Tpo -c -o lib/aes128.lo lib/aes128.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT lib/aes128.lo -MD -MP -MF lib/.deps/aes128.Tpo -c lib/aes128.c -o lib/aes128.o
depbase=`echo lib/backtrace.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.    -I ./include -I ./lib -I ./lib   -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include  -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT lib/backtrace.lo -MD -MP -MF $depbase.Tpo -c -o lib/backtrace.lo lib/backtrace.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT lib/backtrace.lo -MD -MP -MF lib/.deps/backtrace.Tpo -c lib/backtrace.c -o lib/backtrace.o
depbase=`echo lib/bfd.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.    -I ./include -I ./lib -I ./lib   -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include  -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT lib/bfd.lo -MD -MP -MF $depbase.Tpo -c -o lib/bfd.lo lib/bfd.c &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include -Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT lib/bfd.lo -MD -MP -MF lib/.deps/bfd.Tpo -c lib/bfd.c -o lib/bfd.o
In file included from /root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:183:0,
                 from lib/netdev-dpdk.h:12,
                 from lib/ofpbuf.h:25,
                 from lib/dpif.h:393,
                 from lib/bfd.c:27:
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.h: In function 'rte_vlan_strip':
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.h:358:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
  struct vlan_hdr *vh = (struct vlan_hdr *)(eh + 1);
  ^
In file included from lib/netdev-dpdk.h:12:0,
                 from lib/ofpbuf.h:25,
                 from lib/dpif.h:393,
                 from lib/bfd.c:27:
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h: In function 'rte_eth_rx_burst':
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:2428:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
  int16_t nb_rx = (*dev->rx_pkt_burst)(dev->data->rx_queues[queue_id],
  ^
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h: In function 'rte_eth_tx_burst':
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:2572:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
  struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
  ^
In file included from lib/netdev-dpdk.h:17:0,
                 from lib/ofpbuf.h:25,
                 from lib/dpif.h:393,
                from lib/bfd.c:27:
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.h: In function 'rte_try_tm':
/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.h:117:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
  int retries = RTE_RTM_MAX_RETRIES;
  ^
In file included from lib/dpif.h:393:0,
                 from lib/bfd.c:27:
lib/ofpbuf.h: In function 'ofpbuf_data':
lib/ofpbuf.h:359:19: error: 'const struct rte_mbuf' has no member named 'pkt'
     return b->mbuf.pkt.data;
                   ^
lib/ofpbuf.h: In function 'ofpbuf_set_data':
lib/ofpbuf.h:364:12: error: 'struct rte_mbuf' has no member named 'pkt'
     b->mbuf.pkt.data = d;
            ^
lib/ofpbuf.h: In function 'ofpbuf_size':
lib/ofpbuf.h:379:19: error: 'const struct rte_mbuf' has no member named 'pkt'
     return b->mbuf.pkt.pkt_len;
                   ^
lib/ofpbuf.h: In function 'ofpbuf_set_size':
lib/ofpbuf.h:384:12: error: 'struct rte_mbuf' has no member named 'pkt'
     b->mbuf.pkt.data_len = v;    /* Current seg length. */
            ^
lib/ofpbuf.h:385:12: error: 'struct rte_mbuf' has no member named 'pkt'
     b->mbuf.pkt.pkt_len = v;     /* Total length of all segments linked to
            ^
lib/ofpbuf.h: In function 'ofpbuf_data':
lib/ofpbuf.h:360:1: warning: control reaches end of non-void function [-Wreturn-type]
}
^
lib/ofpbuf.h: In function 'ofpbuf_size':
lib/ofpbuf.h:380:1: warning: control reaches end of non-void function [-Wreturn-type]
}
^
make[2]: *** [lib/bfd.lo] Error 1
make[2]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
make: *** [all] Error 2

[http://www.cisco.com/c/dam/assets/email-signature-tool/logo_07.png?ct=1423747865775]

Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com<mailto:sbezverk at cisco.com>
Phone: +1 416 306 7312
Mobile: +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527


Cisco.com<http://www.cisco.com/>



[http://www.cisco.com/assets/swa/img/thinkbeforeyouprint.gif] Think before you print.

This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
Please click here<http://www.cisco.com/web/about/doing_business/legal/cri/index.html> for Company Registration Information.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/a6c64f8a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 2629 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/a6c64f8a/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 134 bytes
Desc: image002.gif
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/a6c64f8a/attachment-0001.gif>

From haleema.s.mahmood at gmail.com  Fri Jun 19 01:25:03 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Fri, 19 Jun 2015 13:25:03 +0500
Subject: [ovs-discuss] Load Action for Registers
Message-ID: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>

Hi,

I am trying to load the in_port value to register, like this:

ovs-ofctl add-flow br0 "tcp,in_port=1,actions=load:NXM_OF_IN_PORT[
]->NXM_NX_REG0[0..15]" -O OpenFlow13

But it keeps giving me the following error;

ovs-ofctl: NXM_OF_IN_PORT[ ]->NXM_NX_REG0[0..15]: missing `->' following
value
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/8c731bf5/attachment.html>

From diproiettod at vmware.com  Fri Jun 19 11:33:27 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Fri, 19 Jun 2015 18:33:27 +0000
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
Message-ID: <D1AA1D1A.3172%diproiettod@vmware.com>

Hi,

OVS 2.3.2 supports DPDK 1.6, as stated in INSTALL.DPDK.
Many APIs have changed in DPDK in a backward incompatible
way.

Also, DPDK support in OVS 2.3.2 is experimental.  It would be
better to use the code from branch-2.4

Daniele

On 19/06/2015 18:08, "Serguei Bezverkhi (sbezverk)" <sbezverk at cisco.com>
wrote:

>Hello,
> 
>I tried to make OVS 2.3.2 with the latest dpdk library and compile is
>failing. I was wondering if it is me doing something wrong or it is in
>fact an issue. Here are the steps to repro:
>1.      
>Git clone the latest dpdk
>2.      
>Build it with Combine library and vhost_user set to Yes
>3.      
>Run boot.sh
>4.      
>./configure --with-dpdk=$DPDK_BUILD
>(Completed sucsesfully)
>5.      
>make CFLAGS='-O3 -march=native'
> 
>Below is the resulted messages.  I would greatly appreciate if you could
>confirm if it is the issue or I do something wrong.
> 
>Thank you
> 
>Serguei
> 
> 
>make CFLAGS='-O3 -march=native'
>make  all-recursive
>make[1]: Entering directory `/root/virtualization/openvswitch-2.3.2'
>Making all in datapath
>make[2]: Entering directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[3]: Entering directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[3]: Nothing to be done for `all-am'.
>make[3]: Leaving directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[2]: Leaving directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[2]: Entering directory `/root/virtualization/openvswitch-2.3.2'
>depbase=`echo lib/aes128.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
> -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT
>lib/aes128.lo -MD -MP -MF $depbase.Tpo -c -o
> lib/aes128.lo lib/aes128.c &&\
>mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
>-Wdeclaration-after-statement -Wno-format-zero-length
> -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast
>-Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3
>-march=native -MT lib/aes128.lo -MD -MP -MF lib/.deps/aes128.Tpo -c
>lib/aes128.c -o lib/aes128.o
>depbase=`echo lib/backtrace.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
> -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT
>lib/backtrace.lo -MD -MP -MF $depbase.Tpo -c
> -o lib/backtrace.lo lib/backtrace.c &&\
>mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
>-Wdeclaration-after-statement -Wno-format-zero-length
> -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast
>-Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3
>-march=native -MT lib/backtrace.lo -MD -MP -MF lib/.deps/backtrace.Tpo -c
>lib/backtrace.c -o lib/backtrace.o
>depbase=`echo lib/bfd.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
> -Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native -MT
>lib/bfd.lo -MD -MP -MF $depbase.Tpo -c -o lib/bfd.lo
> lib/bfd.c &&\
>mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith
>-Wdeclaration-after-statement -Wno-format-zero-length
> -Wswitch-enum -Wunused-parameter -Wstrict-aliasing -Wbad-function-cast
>-Wcast-align -Wmissing-prototypes -Wmissing-field-initializers -O3
>-march=native -MT lib/bfd.lo -MD -MP -MF lib/.deps/bfd.Tpo -c lib/bfd.c
>-o lib/bfd.o
>In file included from
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>183:0,
>                 from lib/netdev-dpdk.h:12,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                 from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.h:
>In function 'rte_vlan_strip':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.h:3
>58:2: warning: ISO C90 forbids mixed declarations and code
>[-Wdeclaration-after-statement]
>  struct vlan_hdr *vh = (struct vlan_hdr *)(eh + 1);
>  ^
>In file included from lib/netdev-dpdk.h:12:0,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                 from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
> In function 'rte_eth_rx_burst':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>2428:2: warning: ISO C90 forbids mixed declarations and code
>[-Wdeclaration-after-statement]
>  int16_t nb_rx = (*dev->rx_pkt_burst)(dev->data->rx_queues[queue_id],
>  ^
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
> In function 'rte_eth_tx_burst':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>2572:2: warning: ISO C90 forbids mixed declarations and code
>[-Wdeclaration-after-statement]
>  struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
>  ^
>In file included from lib/netdev-dpdk.h:17:0,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.
>h: In function 'rte_try_tm':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.
>h:117:2: warning: ISO C90 forbids mixed declarations and code
>[-Wdeclaration-after-statement]
>  int retries = RTE_RTM_MAX_RETRIES;
>  ^
>In file included from lib/dpif.h:393:0,
>                 from lib/bfd.c:27:
>lib/ofpbuf.h: In function 'ofpbuf_data':
>lib/ofpbuf.h:359:19: error: 'const struct rte_mbuf' has no member named
>'pkt'
>     return b->mbuf.pkt.data;
>                   ^
>lib/ofpbuf.h: In function 'ofpbuf_set_data':
>lib/ofpbuf.h:364:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.data = d;
>            ^
>lib/ofpbuf.h: In function 'ofpbuf_size':
>lib/ofpbuf.h:379:19: error: 'const struct rte_mbuf' has no member named
>'pkt'
>     return b->mbuf.pkt.pkt_len;
>                   ^
>lib/ofpbuf.h: In function 'ofpbuf_set_size':
>lib/ofpbuf.h:384:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.data_len = v;    /* Current seg length. */
>            ^
>lib/ofpbuf.h:385:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.pkt_len = v;     /* Total length of all segments linked
>to
>            ^
>lib/ofpbuf.h: In function 'ofpbuf_data':
>lib/ofpbuf.h:360:1: warning: control reaches end of non-void function
>[-Wreturn-type]
>}
>^
>lib/ofpbuf.h: In function 'ofpbuf_size':
>lib/ofpbuf.h:380:1: warning: control reaches end of non-void function
>[-Wreturn-type]
>}
>^
>make[2]: *** [lib/bfd.lo] Error 1
>make[2]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
>make[1]: *** [all-recursive] Error 1
>make[1]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
>make: *** [all] Error 2
> 
>
>Serguei Bezverkhi,
>TECHNICAL LEADER.SERVICES
>Global SP Services
>sbezverk at cisco.com
>Phone: +1 416 306 7312
>Mobile: +1 514 234 7374
>
>CCIE (R&S,SP,Sec) - #9527
>
>Cisco.com 
><https://urldefense.proofpoint.com/v2/url?u=http-3A__www.cisco.com_&d=BQMF
>Ag&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5
>yUNjxgD4v5kJqZ2uWLlE&m=B98C2aGopMY09qsNsTskVIY7fZmI0O1Y390WyGq8wk8&s=YLwwg
>LP9CyATLLWkWAW9LGinrH4w0SlHiCkkr-3cbcQ&e=>
> 
> Think
> before you print.
>This email may contain confidential and privileged material for the sole
>use of the intended recipient.
> Any review, use, distribution or disclosure by others is strictly
>prohibited. If you are not the intended recipient (or authorized to
>receive for the recipient), please contact the sender by reply email and
>delete all copies of this message.
>Please click
> here 
><https://urldefense.proofpoint.com/v2/url?u=http-3A__www.cisco.com_web_abo
>ut_doing-5Fbusiness_legal_cri_index.html&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiD
>JAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=B98C
>2aGopMY09qsNsTskVIY7fZmI0O1Y390WyGq8wk8&s=VSmtFcvtanb_KEZgsoBcoMfE_zJZKVa7
>zJG3fGGRTvc&e=> for Company Registration Information.
> 
> 
>


From sbezverk at cisco.com  Fri Jun 19 11:39:01 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Fri, 19 Jun 2015 18:39:01 +0000
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
In-Reply-To: <D1AA1D1A.3172%diproiettod@vmware.com>
References: <D1AA1D1A.3172%diproiettod@vmware.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C92FC8@xmb-rcd-x06.cisco.com>

Hello Daniele,

Thank you for your reply. What is interesting is that ovs 2.3.1.90 compiled perfectly fine with dpdk 2.0 so I assumed since 2.3.2 was announced as 2.3.1 plus bug fixes, it would work fine as well.

Please let me know how I can clone  branch-2.4 and if it still has limitation of supporting only dpdk 1.6??

Thank you

Serguei

 


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Friday, June 19, 2015 2:33 PM
To: Serguei Bezverkhi (sbezverk)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue

Hi,

OVS 2.3.2 supports DPDK 1.6, as stated in INSTALL.DPDK.
Many APIs have changed in DPDK in a backward incompatible way.

Also, DPDK support in OVS 2.3.2 is experimental.  It would be better to use the code from branch-2.4

Daniele

On 19/06/2015 18:08, "Serguei Bezverkhi (sbezverk)" <sbezverk at cisco.com>
wrote:

>Hello,
> 
>I tried to make OVS 2.3.2 with the latest dpdk library and compile is 
>failing. I was wondering if it is me doing something wrong or it is in 
>fact an issue. Here are the steps to repro:
>1.      
>Git clone the latest dpdk
>2.      
>Build it with Combine library and vhost_user set to Yes
>3.      
>Run boot.sh
>4.      
>./configure --with-dpdk=$DPDK_BUILD
>(Completed sucsesfully)
>5.      
>make CFLAGS='-O3 -march=native'
> 
>Below is the resulted messages.  I would greatly appreciate if you 
>could confirm if it is the issue or I do something wrong.
> 
>Thank you
> 
>Serguei
> 
> 
>make CFLAGS='-O3 -march=native'
>make  all-recursive
>make[1]: Entering directory `/root/virtualization/openvswitch-2.3.2'
>Making all in datapath
>make[2]: Entering directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[3]: Entering directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[3]: Nothing to be done for `all-am'.
>make[3]: Leaving directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[2]: Leaving directory
>`/root/virtualization/openvswitch-2.3.2/datapath'
>make[2]: Entering directory `/root/virtualization/openvswitch-2.3.2'
>depbase=`echo lib/aes128.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith  
>-Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native 
>-MT lib/aes128.lo -MD -MP -MF $depbase.Tpo -c -o  lib/aes128.lo 
>lib/aes128.c &&\ mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I 
>./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith 
>-Wdeclaration-after-statement -Wno-format-zero-length  -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT 
>lib/aes128.lo -MD -MP -MF lib/.deps/aes128.Tpo -c lib/aes128.c -o 
>lib/aes128.o depbase=`echo lib/backtrace.lo | sed 
>'s|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith  
>-Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native 
>-MT lib/backtrace.lo -MD -MP -MF $depbase.Tpo -c  -o lib/backtrace.lo 
>lib/backtrace.c &&\ mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I 
>./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith 
>-Wdeclaration-after-statement -Wno-format-zero-length  -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT 
>lib/backtrace.lo -MD -MP -MF lib/.deps/backtrace.Tpo -c lib/backtrace.c 
>-o lib/backtrace.o depbase=`echo lib/bfd.lo | sed 
>'s|[^/]*$|.deps/&|;s|\.lo$||'`;\
>/bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.
>-I ./include -I ./lib -I ./lib
>-I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith  
>-Wdeclaration-after-statement -Wno-format-zero-length -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers  -O3 -march=native 
>-MT lib/bfd.lo -MD -MP -MF $depbase.Tpo -c -o lib/bfd.lo  lib/bfd.c &&\ 
>mv -f $depbase.Tpo $depbase.Plo
>libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I ./include -I ./lib -I 
>./lib -I/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include
>-Wstrict-prototypes -Wall -Wextra -Wno-sign-compare -Wpointer-arith 
>-Wdeclaration-after-statement -Wno-format-zero-length  -Wswitch-enum 
>-Wunused-parameter -Wstrict-aliasing -Wbad-function-cast -Wcast-align 
>-Wmissing-prototypes -Wmissing-field-initializers -O3 -march=native -MT 
>lib/bfd.lo -MD -MP -MF lib/.deps/bfd.Tpo -c lib/bfd.c -o lib/bfd.o In 
>file included from
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>183:0,
>                 from lib/netdev-dpdk.h:12,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                 from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.h:
>In function 'rte_vlan_strip':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ether.
>h:3
>58:2: warning: ISO C90 forbids mixed declarations and code 
>[-Wdeclaration-after-statement]
>  struct vlan_hdr *vh = (struct vlan_hdr *)(eh + 1);
>  ^
>In file included from lib/netdev-dpdk.h:12:0,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                 from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
> In function 'rte_eth_rx_burst':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>2428:2: warning: ISO C90 forbids mixed declarations and code 
>[-Wdeclaration-after-statement]
>  int16_t nb_rx = (*dev->rx_pkt_burst)(dev->data->rx_queues[queue_id],
>  ^
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
> In function 'rte_eth_tx_burst':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:
>2572:2: warning: ISO C90 forbids mixed declarations and code 
>[-Wdeclaration-after-statement]
>  struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
>  ^
>In file included from lib/netdev-dpdk.h:17:0,
>                 from lib/ofpbuf.h:25,
>                 from lib/dpif.h:393,
>                from lib/bfd.c:27:
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.
>h: In function 'rte_try_tm':
>/root/virtualization/dpdk/x86_64-native-linuxapp-gcc/include/rte_spinlock.
>h:117:2: warning: ISO C90 forbids mixed declarations and code 
>[-Wdeclaration-after-statement]
>  int retries = RTE_RTM_MAX_RETRIES;
>  ^
>In file included from lib/dpif.h:393:0,
>                 from lib/bfd.c:27:
>lib/ofpbuf.h: In function 'ofpbuf_data':
>lib/ofpbuf.h:359:19: error: 'const struct rte_mbuf' has no member named 
>'pkt'
>     return b->mbuf.pkt.data;
>                   ^
>lib/ofpbuf.h: In function 'ofpbuf_set_data':
>lib/ofpbuf.h:364:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.data = d;
>            ^
>lib/ofpbuf.h: In function 'ofpbuf_size':
>lib/ofpbuf.h:379:19: error: 'const struct rte_mbuf' has no member named 
>'pkt'
>     return b->mbuf.pkt.pkt_len;
>                   ^
>lib/ofpbuf.h: In function 'ofpbuf_set_size':
>lib/ofpbuf.h:384:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.data_len = v;    /* Current seg length. */
>            ^
>lib/ofpbuf.h:385:12: error: 'struct rte_mbuf' has no member named 'pkt'
>     b->mbuf.pkt.pkt_len = v;     /* Total length of all segments linked
>to
>            ^
>lib/ofpbuf.h: In function 'ofpbuf_data':
>lib/ofpbuf.h:360:1: warning: control reaches end of non-void function 
>[-Wreturn-type] } ^
>lib/ofpbuf.h: In function 'ofpbuf_size':
>lib/ofpbuf.h:380:1: warning: control reaches end of non-void function 
>[-Wreturn-type] } ^
>make[2]: *** [lib/bfd.lo] Error 1
>make[2]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
>make[1]: *** [all-recursive] Error 1
>make[1]: Leaving directory `/root/virtualization/openvswitch-2.3.2'
>make: *** [all] Error 2
> 
>
>Serguei Bezverkhi,
>TECHNICAL LEADER.SERVICES
>Global SP Services
>sbezverk at cisco.com
>Phone: +1 416 306 7312
>Mobile: +1 514 234 7374
>
>CCIE (R&S,SP,Sec) - #9527
>
>Cisco.com
><https://urldefense.proofpoint.com/v2/url?u=http-3A__www.cisco.com_&d=B
>QMF
>Ag&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_
>Cw5 
>yUNjxgD4v5kJqZ2uWLlE&m=B98C2aGopMY09qsNsTskVIY7fZmI0O1Y390WyGq8wk8&s=YL
>wwg LP9CyATLLWkWAW9LGinrH4w0SlHiCkkr-3cbcQ&e=>
> 
> Think
> before you print.
>This email may contain confidential and privileged material for the 
>sole use of the intended recipient.
> Any review, use, distribution or disclosure by others is strictly 
>prohibited. If you are not the intended recipient (or authorized to 
>receive for the recipient), please contact the sender by reply email 
>and delete all copies of this message.
>Please click
> here
><https://urldefense.proofpoint.com/v2/url?u=http-3A__www.cisco.com_web_
>abo 
>ut_doing-5Fbusiness_legal_cri_index.html&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LK
>IiD 
>JAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=B
>98C
>2aGopMY09qsNsTskVIY7fZmI0O1Y390WyGq8wk8&s=VSmtFcvtanb_KEZgsoBcoMfE_zJZK
>Va7 zJG3fGGRTvc&e=> for Company Registration Information.
> 
> 
>


From jpettit at nicira.com  Fri Jun 19 11:44:55 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 19 Jun 2015 11:44:55 -0700
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C92FC8@xmb-rcd-x06.cisco.com>
References: <D1AA1D1A.3172%diproiettod@vmware.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C92FC8@xmb-rcd-x06.cisco.com>
Message-ID: <7B485A36-D8A5-4AC0-A650-21756DC9BAA0@nicira.com>


> On Jun 19, 2015, at 11:39 AM, Serguei Bezverkhi (sbezverk) <sbezverk at cisco.com> wrote:
> 
> Hello Daniele,
> 
> Thank you for your reply. What is interesting is that ovs 2.3.1.90 compiled perfectly fine with dpdk 2.0 so I assumed since 2.3.2 was announced as 2.3.1 plus bug fixes, it would work fine as well.

I assume you mean "2.3.90" (which was master), not "2.3.1.90"; I don't think such a version ever existed.  We use ".90" to indicate that the code it contains will be part of the next major release.  In this case, 2.3.90 became 2.4.0.  If you look at master now, you'll see it's version is 2.4.90, which will become 2.5 or 3.0 depending on what we decide to call it.  If you look at branch-2.3, you'll see that it contains the next minor version number 2.3.3, since we don't use the .90 convention for minor releases.

> Please let me know how I can clone  branch-2.4 and if it still has limitation of supporting only dpdk 1.6??

I'll leave this one to Daniele.

--Justin



From sbezverk at cisco.com  Fri Jun 19 12:01:11 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Fri, 19 Jun 2015 19:01:11 +0000
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
In-Reply-To: <7B485A36-D8A5-4AC0-A650-21756DC9BAA0@nicira.com>
References: <D1AA1D1A.3172%diproiettod@vmware.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C92FC8@xmb-rcd-x06.cisco.com>
 <7B485A36-D8A5-4AC0-A650-21756DC9BAA0@nicira.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C93057@xmb-rcd-x06.cisco.com>

You are right, my mistake it was 2.3.90. As per your suggestion I cloned master and tried to compile again, it got much further but still failed with this errors:

lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `netdev_dpdk_vhost_rxq_recv':
/root/virtualization/ovs/lib/netdev-dpdk.c:905: undefined reference to `rte_vhost_dequeue_burst'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `dpdk_vhost_class_init':
/root/virtualization/ovs/lib/netdev-dpdk.c:1738: undefined reference to `rte_vhost_driver_callback_register'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `start_vhost_loop':
/root/virtualization/ovs/lib/netdev-dpdk.c:1731: undefined reference to `rte_vhost_driver_session_start'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `netdev_dpdk_vhost_user_construct':
/root/virtualization/ovs/lib/netdev-dpdk.c:640: undefined reference to `rte_vhost_driver_register'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `__netdev_dpdk_vhost_send':
/root/virtualization/ovs/lib/netdev-dpdk.c:971: undefined reference to `rte_vhost_enqueue_burst'
collect2: error: ld returned 1 exit status
make[2]: *** [utilities/ovs-testcontroller] Error 1
make[2]: Leaving directory `/root/virtualization/ovs'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/root/virtualization/ovs'
make: *** [all] Error 2

Also According to INSTALL.DPDK this version supports DPDK 2.0.  Any suggestions how to fix it?

Thank you

Serguei


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: Justin Pettit [mailto:jpettit at nicira.com] 
Sent: Friday, June 19, 2015 2:45 PM
To: Serguei Bezverkhi (sbezverk)
Cc: Daniele Di Proietto; bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue


> On Jun 19, 2015, at 11:39 AM, Serguei Bezverkhi (sbezverk) <sbezverk at cisco.com> wrote:
> 
> Hello Daniele,
> 
> Thank you for your reply. What is interesting is that ovs 2.3.1.90 compiled perfectly fine with dpdk 2.0 so I assumed since 2.3.2 was announced as 2.3.1 plus bug fixes, it would work fine as well.

I assume you mean "2.3.90" (which was master), not "2.3.1.90"; I don't think such a version ever existed.  We use ".90" to indicate that the code it contains will be part of the next major release.  In this case, 2.3.90 became 2.4.0.  If you look at master now, you'll see it's version is 2.4.90, which will become 2.5 or 3.0 depending on what we decide to call it.  If you look at branch-2.3, you'll see that it contains the next minor version number 2.3.3, since we don't use the .90 convention for minor releases.

> Please let me know how I can clone  branch-2.4 and if it still has limitation of supporting only dpdk 1.6??

I'll leave this one to Daniele.

--Justin



From sbezverk at cisco.com  Fri Jun 19 12:18:17 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Fri, 19 Jun 2015 19:18:17 +0000
Subject: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216C93057@xmb-rcd-x06.cisco.com>
References: <D1AA1D1A.3172%diproiettod@vmware.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C92FC8@xmb-rcd-x06.cisco.com>
 <7B485A36-D8A5-4AC0-A650-21756DC9BAA0@nicira.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216C93057@xmb-rcd-x06.cisco.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216C9309B@xmb-rcd-x06.cisco.com>

Ok It is fixed now. It appears if you enable CONFIG_RTE_LIBRTE_VHOST_USER=y  you must have  CONFIG_RTE_LIBRTE_VHOST=y as well otherwise it fails at linking stage. Probably is a good idea to add in the documentation.  Now I am up and running with traffic.

Thank you

Serguei


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Serguei Bezverkhi (sbezverk)
Sent: Friday, June 19, 2015 3:01 PM
To: Justin Pettit
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue

You are right, my mistake it was 2.3.90. As per your suggestion I cloned master and tried to compile again, it got much further but still failed with this errors:

lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `netdev_dpdk_vhost_rxq_recv':
/root/virtualization/ovs/lib/netdev-dpdk.c:905: undefined reference to `rte_vhost_dequeue_burst'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `dpdk_vhost_class_init':
/root/virtualization/ovs/lib/netdev-dpdk.c:1738: undefined reference to `rte_vhost_driver_callback_register'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `start_vhost_loop':
/root/virtualization/ovs/lib/netdev-dpdk.c:1731: undefined reference to `rte_vhost_driver_session_start'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `netdev_dpdk_vhost_user_construct':
/root/virtualization/ovs/lib/netdev-dpdk.c:640: undefined reference to `rte_vhost_driver_register'
lib/.libs/libopenvswitch.a(netdev-dpdk.o): In function `__netdev_dpdk_vhost_send':
/root/virtualization/ovs/lib/netdev-dpdk.c:971: undefined reference to `rte_vhost_enqueue_burst'
collect2: error: ld returned 1 exit status
make[2]: *** [utilities/ovs-testcontroller] Error 1
make[2]: Leaving directory `/root/virtualization/ovs'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/root/virtualization/ovs'
make: *** [all] Error 2

Also According to INSTALL.DPDK this version supports DPDK 2.0.  Any suggestions how to fix it?

Thank you

Serguei


Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com
Phone:Â +1 416 306 7312
Mobile:Â +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527

Cisco.com



Â Think before you print.
This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
PleaseÂ click hereÂ for Company Registration Information.



-----Original Message-----
From: Justin Pettit [mailto:jpettit at nicira.com] 
Sent: Friday, June 19, 2015 2:45 PM
To: Serguei Bezverkhi (sbezverk)
Cc: Daniele Di Proietto; bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs 2.3.2 and dpdk compiling issue


> On Jun 19, 2015, at 11:39 AM, Serguei Bezverkhi (sbezverk) <sbezverk at cisco.com> wrote:
> 
> Hello Daniele,
> 
> Thank you for your reply. What is interesting is that ovs 2.3.1.90 compiled perfectly fine with dpdk 2.0 so I assumed since 2.3.2 was announced as 2.3.1 plus bug fixes, it would work fine as well.

I assume you mean "2.3.90" (which was master), not "2.3.1.90"; I don't think such a version ever existed.  We use ".90" to indicate that the code it contains will be part of the next major release.  In this case, 2.3.90 became 2.4.0.  If you look at master now, you'll see it's version is 2.4.90, which will become 2.5 or 3.0 depending on what we decide to call it.  If you look at branch-2.3, you'll see that it contains the next minor version number 2.3.3, since we don't use the .90 convention for minor releases.

> Please let me know how I can clone  branch-2.4 and if it still has limitation of supporting only dpdk 1.6??

I'll leave this one to Daniele.

--Justin


_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Fri Jun 19 18:35:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 19 Jun 2015 18:35:56 -0700
Subject: [ovs-discuss] Load Action for Registers
In-Reply-To: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>
References: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>
Message-ID: <20150620013556.GA1105@nicira.com>

On Fri, Jun 19, 2015 at 01:25:03PM +0500, Haleema Sadia wrote:
> I am trying to load the in_port value to register, like this:
> 
> ovs-ofctl add-flow br0 "tcp,in_port=1,actions=load:NXM_OF_IN_PORT[
> ]->NXM_NX_REG0[0..15]" -O OpenFlow13
> 
> But it keeps giving me the following error;
> 
> ovs-ofctl: NXM_OF_IN_PORT[ ]->NXM_NX_REG0[0..15]: missing `->' following
> value

Did you read the documentation?

From johnson at snoopy.ORG  Fri Jun 19 13:52:07 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Fri, 19 Jun 2015 13:52:07 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
Message-ID: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>

 

Greetings,

 

I am currently running

3.16.0-4-amd64

No LSB modules are available.

Distributor ID: Debian

Description:    Debian GNU/Linux 8.1 (jessie)

Release:        8.1

Codename:       jessie

ovs-vsctl (Open vSwitch) 2.3.1

Compiled Jun 15 2015 19:30:36

DB Schema 7.6.2

libvirtd (libvirt) 1.2.9

 

and I am seeing an MTU issue where packets coming in from the physical side
are vanilla 1500Bytes

Once it gets to the virtual NIC I see the following in dmesg:

 

[ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500

[ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500

 

If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502 things
will flow

Otherwise mant protocols with full sized packets will see timeout.

 

Wireshark loaded on the client didn't help, as a trace done on the client
itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as 1500.

 

I think OVS must be doing something that added a tag to the packets.

Anyone with the same observation?

Cheers,

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/4c94da7f/attachment-0001.html>

From johnson at snoopy.ORG  Fri Jun 19 14:59:03 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Fri, 19 Jun 2015 14:59:03 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
Message-ID: <024301d0aadb$28318c80$7894a580$@snoopy.ORG>

(resend after member enrollment please excuse the hassle)

 

Greetings,

 

I am currently running OVS on

3.16.0-4-amd64

No LSB modules are available.

Distributor ID: Debian

Description:    Debian GNU/Linux 8.1 (jessie)

Release:        8.1

Codename:       jessie

ovs-vsctl (Open vSwitch) 2.3.1

Compiled Jun 15 2015 19:30:36

DB Schema 7.6.2

libvirtd (libvirt) 1.2.9

 

and I am seeing an MTU issue where packets coming in from the physical side
are vanilla 1500Bytes

Once it gets to the virtual NIC I see the following in dmesg:

 

[ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500

[ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500

 

If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502 things
will flow

Otherwise mant protocols with full sized packets will see timeout.

 

Wireshark loaded on the client didn't help, as a trace done on the client
itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as 1500.

 

I think OVS must be doing something that added a tag to the packets.

Anyone with the same observation?

Cheers,

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150619/ac209d60/attachment-0001.html>

From harshjain.prof at gmail.com  Fri Jun 19 21:18:39 2015
From: harshjain.prof at gmail.com (Harsh Jain)
Date: Sat, 20 Jun 2015 09:48:39 +0530
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
 <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
 <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>
Message-ID: <CAFXBA=ngD53vyyfBw6KhETauEgNaEqZEFm+UBrXTL8BwRMR27A@mail.gmail.com>

Hi all,

How to track weather bug is raised or community has ignored the
issue.I have not received any mail.


Regards
Harsh Jain

On Wed, Jun 10, 2015 at 10:35 PM, Ansis Atteka <aatteka at nicira.com> wrote:
> On Mon, Jun 8, 2015 at 7:57 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>> Hi Ansis,
>>
>>  I used "ip xfrm add policy" command to add policy.
>
>> I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
> No, ovs-monitor-ipsec can't be used used to install IPsec policies
> that match on GRE key.
>
>> I tested with GRE key value only.I will test weather Port no, based
>> filtering is supported in OVS or not and revert.
> Pravin told me that he will look into this patch before applying.
>
> One small comment - if gre KEY is not set, shouldn't we set it to 0
> instead of leaving unset before performing route lookup?
>
>>
>>
>> Regards
>> Harsh jain
>>
>>
>> Regards
>> Harsh Jain
>>
>> On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
>>> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>>>> Hi,
>>>>
>>>>
>>>> While trying to encrypt(IPsec policy) packets  based on GRE key
>>>> received in packets. kernel didn't encrypted the packets received from
>>>> OVS bridge. The packets forwarded to Desination unencrypted.
>>>> Kernel treats packet having different keys as same flow type.
>>>
>>> It seems that you are not using ovs-monitor-ipsec to install IPsec
>>> policies for you?
>>>
>>>>
>>>>
>>>> Kernel Version used : 3.18.14
>>>> ovs-vswitchd (Open vSwitch) 2.0.1
>>>> Compiled Apr 16 2014 14:19:17
>>>> OpenFlow versions 0x1:0x1
>>>>
>>>> Fix Applied :  Find attached initial patch.
>>>>
>>>> Please confirm if it is bug?.
>>>
>>> I think this could be classified as bug for those use cases when one
>>> wants to install such fine grained IPsec policies based on GRE key.
>>> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
>>>
>>>
>>>>
>>>>
>>>> Regards
>>>> Harsh Jain
>>>>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>

From emil.flink at gmail.com  Sat Jun 20 02:02:47 2015
From: emil.flink at gmail.com (Emil Flink)
Date: Sat, 20 Jun 2015 11:02:47 +0200
Subject: [ovs-discuss] Issue with over-mtu packets on tap interfaces for KVM
	guests
Message-ID: <CACqfFdJbkfM=2-yi-Nz6tED4iz+sBHE1A1X9-iw=nKHbwGX+Xg@mail.gmail.com>

Hi,

I am seeing a lot of (almost 50%) over-mtu packets on the tap interfaces
used by KVM guests.

I just don't know if this is an issue with Open vSwitch, the tap driver,
KVM or the guest OS?

Any feedback on how I could further troubleshoot/deal with this issue would
be appreciated.

OS on the hypervisor is Debian 8, latest stable. With Open vSwitch 2.3.0


# dmesg | tail
[48548.208021] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.208029] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.208035] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.208094] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243494] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243512] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243532] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243538] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243544] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500
[48548.243550] openvswitch: tap0: dropped over-mtu packet: 1501 > 1500

Note: If I increase the MTU of the tap0 interface to 1501, I start seeing
MTU 1502 packets

# ovs-vsctl get interface tap0 statistics
{collisions=0, rx_bytes=7244, rx_crc_err=0, rx_dropped=3, rx_errors=0,
rx_frame_err=0, rx_over_err=0, rx_packets=35, tx_bytes=24616649,
tx_dropped=16732, tx_errors=0, tx_packets=33296}

# ovs-vsctl show
99411ad2-a91e-49ec-88ce-1afe9093c469
    Bridge vmbrext
        Port "vbond0"
            Interface "eth0"
            Interface "eth1"
        Port "vlan92"
            tag: 92
            Interface "vlan92"
                type: internal
        Port "patchext-0"
            Interface "patchext-0"
                type: patch
                options: {peer="patch0-ext"}
        Port vmbrext
            Interface vmbrext
                type: internal
    Bridge "vmbr0"
        Port "vmbr0"
            Interface "vmbr0"
                type: internal
        Port "vlan57"
            tag: 57
            Interface "vlan57"
                type: internal
        Port "tap0"
            tag: 57
            Interface "tap0"
        Port "patch0-ext"
            Interface "patch0-ext"
                type: patch
                options: {peer="patchext-0"}
    ovs_version: "2.3.0"

# ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group
default
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master
ovs-system state UP group default qlen 1000
    link/ether 0c:c4:7a:14:25:48 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::ec4:7aff:fe14:2548/64 scope link
       valid_lft forever preferred_lft forever
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc mq master
ovs-system state UP group default qlen 1000
    link/ether 0c:c4:7a:14:25:49 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::ec4:7aff:fe14:2549/64 scope link
       valid_lft forever preferred_lft forever
4: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
default
    link/ether 0a:bc:10:fb:ae:e6 brd ff:ff:ff:ff:ff:ff
5: vmbrext: <BROADCAST,MULTICAST> mtu 9000 qdisc noop state DOWN group
default
    link/ether 0c:c4:7a:14:25:48 brd ff:ff:ff:ff:ff:ff
6: vbond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc noqueue state
UNKNOWN group default
    link/ether d2:f1:5a:92:ed:a6 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::d0f1:5aff:fe92:eda6/64 scope link
       valid_lft forever preferred_lft forever
7: vlan92: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9000 qdisc noqueue state
UNKNOWN group default
    link/ether ae:47:99:40:9e:ab brd ff:ff:ff:ff:ff:ff
    inet 10.62.16.101/21 brd 10.62.23.255 scope global vlan92
       valid_lft forever preferred_lft forever
    inet6 fe80::ac47:99ff:fe40:9eab/64 scope link
       valid_lft forever preferred_lft forever
8: vmbr0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
default
    link/ether 36:93:5d:b7:d1:40 brd ff:ff:ff:ff:ff:ff
9: vlan57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state
UNKNOWN group default
    link/ether 56:da:39:00:85:13 brd ff:ff:ff:ff:ff:ff
    inet 10.69.48.91/24 brd 10.69.48.255 scope global vlan57
       valid_lft forever preferred_lft forever
    inet6 fe80::54da:39ff:fe00:8513/64 scope link
       valid_lft forever preferred_lft forever
10: tap0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast
master ovs-system state UNKNOWN group default qlen 500
    link/ether 9e:1e:7c:da:5e:77 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::9c1e:7cff:feda:5e77/64 scope link
       valid_lft forever preferred_lft forever



Regards,

Emil Flink
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150620/929fa5af/attachment-0001.html>

From cynicholas at gmail.com  Sat Jun 20 07:48:28 2015
From: cynicholas at gmail.com (Xu_Zhaokui)
Date: Sat, 20 Jun 2015 14:48:28 +0000
Subject: [ovs-discuss] Seek advice for direct r/w to an ovs port
In-Reply-To: <CAM6TkHPKA1iRXktD4afLrZeOmom2MHAyxC+L=bVAcfZRjjDi_w@mail.gmail.com>
References: <CAM6TkHPKA1iRXktD4afLrZeOmom2MHAyxC+L=bVAcfZRjjDi_w@mail.gmail.com>
Message-ID: <CAM6TkHOomVqXEBj70sS4kW8E033aO0MhxFGc2bzAQUi+wynxvw@mail.gmail.com>

Hi all:

I am a developer who is using ovs in my personal project. Recently I am
trying to do some tcp/ip Nat stuff in a program running in userspace, so I
need to read/write whole L2 packets from ovs directly, the way I am taking
now is attaching a tap device to the ovs bridge, and then open the tap
device for reading and writing, Just like this:

ovs-vsctl add-br br0

ifconfig br0 up

ip tun tap add dev tap0 mode tap

ovs-vsctl add-port br0 tap0

However, I found the performance of the tap device is really bad, my Nat
program can just hold up to 2Gbps bandwidth in one tcp connection(test by
iperf), and the cpu(16 cores) usage are almost full, while the bandwidth
between two veth can be 30Gbps.

My nat program is written in GO, so I did a cpu prof of it, then I found
this:

The result of my programâ€™s cpuprof shows that most of cpu is wasting on the
syscalls to read/write tap device.

So, is there any other better way to read/write directly from/to an ovs
bridgeâ€™s port?

By the way, I notice that when adding a port to ovs bridge, there is an
option â€œtype=tapâ€ for setting, but I cannot find the related documents
anywhere, will it be any performance promotion if I set the tap interface
with this option? like this:

ovs-vsctl set interface tap0 type=tap

Thanks for paying attention to this help, waiting for your precious advice.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150620/99875582/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cpuprof.jpg
Type: image/jpeg
Size: 3048518 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150620/99875582/attachment-0001.jpg>

From blp at nicira.com  Sat Jun 20 11:56:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 20 Jun 2015 11:56:08 -0700
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAFXBA=ngD53vyyfBw6KhETauEgNaEqZEFm+UBrXTL8BwRMR27A@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
 <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
 <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>
 <CAFXBA=ngD53vyyfBw6KhETauEgNaEqZEFm+UBrXTL8BwRMR27A@mail.gmail.com>
Message-ID: <20150620185608.GB31810@nicira.com>

If you it find more satisfying, you can file an issue in the github
tracker:
        https://github.com/openvswitch/ovs-issues/

On Sat, Jun 20, 2015 at 09:48:39AM +0530, Harsh Jain wrote:
> Hi all,
> 
> How to track weather bug is raised or community has ignored the
> issue.I have not received any mail.
> 
> 
> Regards
> Harsh Jain
> 
> On Wed, Jun 10, 2015 at 10:35 PM, Ansis Atteka <aatteka at nicira.com> wrote:
> > On Mon, Jun 8, 2015 at 7:57 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
> >> Hi Ansis,
> >>
> >>  I used "ip xfrm add policy" command to add policy.
> >
> >> I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
> > No, ovs-monitor-ipsec can't be used used to install IPsec policies
> > that match on GRE key.
> >
> >> I tested with GRE key value only.I will test weather Port no, based
> >> filtering is supported in OVS or not and revert.
> > Pravin told me that he will look into this patch before applying.
> >
> > One small comment - if gre KEY is not set, shouldn't we set it to 0
> > instead of leaving unset before performing route lookup?
> >
> >>
> >>
> >> Regards
> >> Harsh jain
> >>
> >>
> >> Regards
> >> Harsh Jain
> >>
> >> On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
> >>> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
> >>>> Hi,
> >>>>
> >>>>
> >>>> While trying to encrypt(IPsec policy) packets  based on GRE key
> >>>> received in packets. kernel didn't encrypted the packets received from
> >>>> OVS bridge. The packets forwarded to Desination unencrypted.
> >>>> Kernel treats packet having different keys as same flow type.
> >>>
> >>> It seems that you are not using ovs-monitor-ipsec to install IPsec
> >>> policies for you?
> >>>
> >>>>
> >>>>
> >>>> Kernel Version used : 3.18.14
> >>>> ovs-vswitchd (Open vSwitch) 2.0.1
> >>>> Compiled Apr 16 2014 14:19:17
> >>>> OpenFlow versions 0x1:0x1
> >>>>
> >>>> Fix Applied :  Find attached initial patch.
> >>>>
> >>>> Please confirm if it is bug?.
> >>>
> >>> I think this could be classified as bug for those use cases when one
> >>> wants to install such fine grained IPsec policies based on GRE key.
> >>> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
> >>>
> >>>
> >>>>
> >>>>
> >>>> Regards
> >>>> Harsh Jain
> >>>>
> >>>> _______________________________________________
> >>>> discuss mailing list
> >>>> discuss at openvswitch.org
> >>>> http://openvswitch.org/mailman/listinfo/discuss
> >>>>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Sat Jun 20 11:59:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 20 Jun 2015 11:59:18 -0700
Subject: [ovs-discuss] Seek advice for direct r/w to an ovs port
In-Reply-To: <CAM6TkHOomVqXEBj70sS4kW8E033aO0MhxFGc2bzAQUi+wynxvw@mail.gmail.com>
References: <CAM6TkHPKA1iRXktD4afLrZeOmom2MHAyxC+L=bVAcfZRjjDi_w@mail.gmail.com>
 <CAM6TkHOomVqXEBj70sS4kW8E033aO0MhxFGc2bzAQUi+wynxvw@mail.gmail.com>
Message-ID: <20150620185918.GC31810@nicira.com>

On Sat, Jun 20, 2015 at 02:48:28PM +0000, Xu_Zhaokui wrote:
> By the way, I notice that when adding a port to ovs bridge, there is an
> option â€œtype=tapâ€ for setting, but I cannot find the related documents
> anywhere, will it be any performance promotion if I set the tap interface
> with this option? like this:
> 
> ovs-vsctl set interface tap0 type=tap

I don't have comments on the rest of your questions, but the FAQ answers
this one (please read to the end):

### Q: I created a tap device tap0, configured an IP address on it, and
    added it to a bridge, like this:

        tunctl -t tap0
	ifconfig tap0 192.168.0.123
	ovs-vsctl add-br br0
	ovs-vsctl add-port br0 tap0

    I expected that I could then use this IP address to contact other
    hosts on the network, but it doesn't work.  Why not?

A: The short answer is that this is a misuse of a "tap" device.  Use
   an "internal" device implemented by Open vSwitch, which works
   differently and is designed for this use.  To solve this problem
   with an internal device, instead run:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 int0 -- set Interface int0 type=internal
       ifconfig int0 192.168.0.123

   Even more simply, you can take advantage of the internal port that
   every bridge has under the name of the bridge:

       ovs-vsctl add-br br0
       ifconfig br0 192.168.0.123

   In more detail, a "tap" device is an interface between the Linux
   (or *BSD) network stack and a user program that opens it as a
   socket.  When the "tap" device transmits a packet, it appears in
   the socket opened by the userspace program.  Conversely, when the
   userspace program writes to the "tap" socket, the kernel TCP/IP
   stack processes the packet as if it had been received by the "tap"
   device.

   Consider the configuration above.  Given this configuration, if you
   "ping" an IP address in the 192.168.0.x subnet, the Linux kernel
   routing stack will transmit an ARP on the tap0 device.  Open
   vSwitch userspace treats "tap" devices just like any other network
   device; that is, it doesn't open them as "tap" sockets.  That means
   that the ARP packet will simply get dropped.

   You might wonder why the Open vSwitch kernel module doesn't
   intercept the ARP packet and bridge it.  After all, Open vSwitch
   intercepts packets on other devices.  The answer is that Open
   vSwitch only intercepts *received* packets, but this is a packet
   being transmitted.  The same thing happens for all other types of
   network devices, except for Open vSwitch "internal" ports.  If you,
   for example, add a physical Ethernet port to an OVS bridge,
   configure an IP address on a physical Ethernet port, and then issue
   a "ping" to an address in that subnet, the same thing happens: an
   ARP gets transmitted on the physical Ethernet port and Open vSwitch
   never sees it.  (You should not do that, as documented at the
   beginning of this section.)

   It can make sense to add a "tap" device to an Open vSwitch bridge,
   if some userspace program (other than Open vSwitch) has opened the
   tap socket.  This is the case, for example, if the "tap" device was
   created by KVM (or QEMU) to simulate a virtual NIC.  In such a
   case, when OVS bridges a packet to the "tap" device, the kernel
   forwards that packet to KVM in userspace, which passes it along to
   the VM, and in the other direction, when the VM sends a packet, KVM
   writes it to the "tap" socket, which causes OVS to receive it and
   bridge it to the other OVS ports.  Please note that in such a case
   no IP address is configured on the "tap" device (there is normally
   an IP address configured in the virtual NIC inside the VM, but this
   is not visible to the host Linux kernel or to Open vSwitch).

   There is one special case in which Open vSwitch does directly read
   and write "tap" sockets.  This is an implementation detail of the
   Open vSwitch userspace switch, which implements its "internal"
   ports as Linux (or *BSD) "tap" sockets.  In such a userspace
   switch, OVS receives packets sent on the "tap" device used to
   implement an "internal" port by reading the associated "tap"
   socket, and bridges them to the rest of the switch.  In the other
   direction, OVS transmits packets bridged to the "internal" port by
   writing them to the "tap" socket, causing them to be processed by
   the kernel TCP/IP stack as if they had been received on the "tap"
   device.  Users should not need to be concerned with this
   implementation detail.

   Open vSwitch has a network device type called "tap".  This is
   intended only for implementing "internal" ports in the OVS
   userspace switch and should not be used otherwise.  In particular,
   users should not configure KVM "tap" devices as type "tap" (use
   type "system", the default, instead).

From saurabh at gmail.com  Sat Jun 20 19:28:06 2015
From: saurabh at gmail.com (=?UTF-8?B?U2F1cmFiaCBTaHJpdmFzdGF2YSAo4KS44KWM4KSw4KStIOCktuCljeCksOClgOCkteCkvuCkuA==?= =?UTF-8?B?4KWN4KSk4KS1KQ==?=)
Date: Sat, 20 Jun 2015 19:28:06 -0700
Subject: [ovs-discuss] Load Action for Registers
In-Reply-To: <20150620013556.GA1105@nicira.com>
References: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>
 <20150620013556.GA1105@nicira.com>
Message-ID: <CAEgOKCzdUHE8baOTpowN4cDb-ytQ747tQDs8=FxofmTf45rWQw@mail.gmail.com>

You need to use "move" instead of "load".

--
Saurabh (à¤¸à¥Œà¤°à¤­)

On Fri, Jun 19, 2015 at 6:35 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Jun 19, 2015 at 01:25:03PM +0500, Haleema Sadia wrote:
> > I am trying to load the in_port value to register, like this:
> >
> > ovs-ofctl add-flow br0 "tcp,in_port=1,actions=load:NXM_OF_IN_PORT[
> > ]->NXM_NX_REG0[0..15]" -O OpenFlow13
> >
> > But it keeps giving me the following error;
> >
> > ovs-ofctl: NXM_OF_IN_PORT[ ]->NXM_NX_REG0[0..15]: missing `->' following
> > value
>
> Did you read the documentation?
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150620/c7aa3b0b/attachment.html>

From harshjain.prof at gmail.com  Sat Jun 20 21:11:23 2015
From: harshjain.prof at gmail.com (Harsh Jain)
Date: Sun, 21 Jun 2015 09:41:23 +0530
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <20150620185608.GB31810@nicira.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
 <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
 <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>
 <CAFXBA=ngD53vyyfBw6KhETauEgNaEqZEFm+UBrXTL8BwRMR27A@mail.gmail.com>
 <20150620185608.GB31810@nicira.com>
Message-ID: <CAFXBA=nLXX5qM9CtSGk5UQ1d4UB9nk8_pMcvuqKLoBGCRRHhdQ@mail.gmail.com>

Hi,

Thanks for reply. I missed Ansis's reply "Pravin told me that he will
look into this patch before applying".
Patch which I sent is for 3.18.4 kernel. latest kernel branch has
moved the code to new function.
If needed I can send the patch for latest kernel version.


Regards
Harsh Jain

On Sun, Jun 21, 2015 at 12:26 AM, Ben Pfaff <blp at nicira.com> wrote:
> If you it find more satisfying, you can file an issue in the github
> tracker:
>         https://github.com/openvswitch/ovs-issues/
>
> On Sat, Jun 20, 2015 at 09:48:39AM +0530, Harsh Jain wrote:
>> Hi all,
>>
>> How to track weather bug is raised or community has ignored the
>> issue.I have not received any mail.
>>
>>
>> Regards
>> Harsh Jain
>>
>> On Wed, Jun 10, 2015 at 10:35 PM, Ansis Atteka <aatteka at nicira.com> wrote:
>> > On Mon, Jun 8, 2015 at 7:57 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>> >> Hi Ansis,
>> >>
>> >>  I used "ip xfrm add policy" command to add policy.
>> >
>> >> I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
>> > No, ovs-monitor-ipsec can't be used used to install IPsec policies
>> > that match on GRE key.
>> >
>> >> I tested with GRE key value only.I will test weather Port no, based
>> >> filtering is supported in OVS or not and revert.
>> > Pravin told me that he will look into this patch before applying.
>> >
>> > One small comment - if gre KEY is not set, shouldn't we set it to 0
>> > instead of leaving unset before performing route lookup?
>> >
>> >>
>> >>
>> >> Regards
>> >> Harsh jain
>> >>
>> >>
>> >> Regards
>> >> Harsh Jain
>> >>
>> >> On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
>> >>> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>> >>>> Hi,
>> >>>>
>> >>>>
>> >>>> While trying to encrypt(IPsec policy) packets  based on GRE key
>> >>>> received in packets. kernel didn't encrypted the packets received from
>> >>>> OVS bridge. The packets forwarded to Desination unencrypted.
>> >>>> Kernel treats packet having different keys as same flow type.
>> >>>
>> >>> It seems that you are not using ovs-monitor-ipsec to install IPsec
>> >>> policies for you?
>> >>>
>> >>>>
>> >>>>
>> >>>> Kernel Version used : 3.18.14
>> >>>> ovs-vswitchd (Open vSwitch) 2.0.1
>> >>>> Compiled Apr 16 2014 14:19:17
>> >>>> OpenFlow versions 0x1:0x1
>> >>>>
>> >>>> Fix Applied :  Find attached initial patch.
>> >>>>
>> >>>> Please confirm if it is bug?.
>> >>>
>> >>> I think this could be classified as bug for those use cases when one
>> >>> wants to install such fine grained IPsec policies based on GRE key.
>> >>> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
>> >>>
>> >>>
>> >>>>
>> >>>>
>> >>>> Regards
>> >>>> Harsh Jain
>> >>>>
>> >>>> _______________________________________________
>> >>>> discuss mailing list
>> >>>> discuss at openvswitch.org
>> >>>> http://openvswitch.org/mailman/listinfo/discuss
>> >>>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From pshelar at nicira.com  Sun Jun 21 09:40:14 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Sun, 21 Jun 2015 09:40:14 -0700
Subject: [ovs-discuss] BUG:OVS kernel module didn't send gre_key to
 identify flow type in kernel
In-Reply-To: <CAFXBA=nLXX5qM9CtSGk5UQ1d4UB9nk8_pMcvuqKLoBGCRRHhdQ@mail.gmail.com>
References: <CAFXBA=k1Avgy1B=i5XucgzxMzGxj12GPfAbc0Jb=ivzwh6ZyTg@mail.gmail.com>
 <CAA=3OqnR8zRfHmy5hsvpmK3Jo9U4_jKgAG0+ikux22eAOyL=AA@mail.gmail.com>
 <CAFXBA==gHtjG7SLybFRaZi_NOxu+CcCYWBw5N+pRT7CLD9GAWA@mail.gmail.com>
 <CAA=3Oq=SUZHs_h6sq9FKMT6kjwkuCttvsvXsRU4q2XYxjso2xA@mail.gmail.com>
 <CAFXBA=ngD53vyyfBw6KhETauEgNaEqZEFm+UBrXTL8BwRMR27A@mail.gmail.com>
 <20150620185608.GB31810@nicira.com>
 <CAFXBA=nLXX5qM9CtSGk5UQ1d4UB9nk8_pMcvuqKLoBGCRRHhdQ@mail.gmail.com>
Message-ID: <CALnjE+rWgYDH4AVt=HKt7LdajuqEqyyBCK1mmPNdKAWgvB1G5w@mail.gmail.com>

On Sat, Jun 20, 2015 at 9:11 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
> Hi,
>
> Thanks for reply. I missed Ansis's reply "Pravin told me that he will
> look into this patch before applying".
> Patch which I sent is for 3.18.4 kernel. latest kernel branch has
> moved the code to new function.
> If needed I can send the patch for latest kernel version.
>
Sorry for late reply. I forgot to reply to your patch.
The patch is enhancement, so send the patch against latest net-next to
netdev and ovs-dev mailing list.

Thanks,
Pravin.


>
> Regards
> Harsh Jain
>
> On Sun, Jun 21, 2015 at 12:26 AM, Ben Pfaff <blp at nicira.com> wrote:
>> If you it find more satisfying, you can file an issue in the github
>> tracker:
>>         https://github.com/openvswitch/ovs-issues/
>>
>> On Sat, Jun 20, 2015 at 09:48:39AM +0530, Harsh Jain wrote:
>>> Hi all,
>>>
>>> How to track weather bug is raised or community has ignored the
>>> issue.I have not received any mail.
>>>
>>>
>>> Regards
>>> Harsh Jain
>>>
>>> On Wed, Jun 10, 2015 at 10:35 PM, Ansis Atteka <aatteka at nicira.com> wrote:
>>> > On Mon, Jun 8, 2015 at 7:57 PM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>>> >> Hi Ansis,
>>> >>
>>> >>  I used "ip xfrm add policy" command to add policy.
>>> >
>>> >> I have not used "ovs-monitor-ipsec".Can it be used to encryt based on GRE key?.
>>> > No, ovs-monitor-ipsec can't be used used to install IPsec policies
>>> > that match on GRE key.
>>> >
>>> >> I tested with GRE key value only.I will test weather Port no, based
>>> >> filtering is supported in OVS or not and revert.
>>> > Pravin told me that he will look into this patch before applying.
>>> >
>>> > One small comment - if gre KEY is not set, shouldn't we set it to 0
>>> > instead of leaving unset before performing route lookup?
>>> >
>>> >>
>>> >>
>>> >> Regards
>>> >> Harsh jain
>>> >>
>>> >>
>>> >> Regards
>>> >> Harsh Jain
>>> >>
>>> >> On Tue, Jun 9, 2015 at 2:07 AM, Ansis Atteka <aatteka at nicira.com> wrote:
>>> >>> On Mon, Jun 8, 2015 at 12:19 AM, Harsh Jain <harshjain.prof at gmail.com> wrote:
>>> >>>> Hi,
>>> >>>>
>>> >>>>
>>> >>>> While trying to encrypt(IPsec policy) packets  based on GRE key
>>> >>>> received in packets. kernel didn't encrypted the packets received from
>>> >>>> OVS bridge. The packets forwarded to Desination unencrypted.
>>> >>>> Kernel treats packet having different keys as same flow type.
>>> >>>
>>> >>> It seems that you are not using ovs-monitor-ipsec to install IPsec
>>> >>> policies for you?
>>> >>>
>>> >>>>
>>> >>>>
>>> >>>> Kernel Version used : 3.18.14
>>> >>>> ovs-vswitchd (Open vSwitch) 2.0.1
>>> >>>> Compiled Apr 16 2014 14:19:17
>>> >>>> OpenFlow versions 0x1:0x1
>>> >>>>
>>> >>>> Fix Applied :  Find attached initial patch.
>>> >>>>
>>> >>>> Please confirm if it is bug?.
>>> >>>
>>> >>> I think this could be classified as bug for those use cases when one
>>> >>> wants to install such fine grained IPsec policies based on GRE key.
>>> >>> BTW I looked in ip-xfrm man page and it has more fields in SELECTOR.
>>> >>>
>>> >>>
>>> >>>>
>>> >>>>
>>> >>>> Regards
>>> >>>> Harsh Jain
>>> >>>>
>>> >>>> _______________________________________________
>>> >>>> discuss mailing list
>>> >>>> discuss at openvswitch.org
>>> >>>> http://openvswitch.org/mailman/listinfo/discuss
>>> >>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From neelugaddam at gmail.com  Sun Jun 21 10:17:48 2015
From: neelugaddam at gmail.com (Neelakantam Gaddam)
Date: Sun, 21 Jun 2015 22:47:48 +0530
Subject: [ovs-discuss] OVS HW Offload
Message-ID: <CAOv37=CW6UwTp5hHF58V2-sj0kDYduMcCMOcuj08WO5j4k6Kzw@mail.gmail.com>

Hi All,

I came across the OVS HW offload design proposal at the below link:

http://openvswitch.org/pipermail/dev/2015-March/051937.html

Is there any implementation going on this design currently?
If so, please point me to the ovs repository having these changes.


-- 
Thanks & Regards
Neelakantam Gaddam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150621/b135f03e/attachment.html>

From blp at nicira.com  Sun Jun 21 11:19:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 21 Jun 2015 11:19:32 -0700
Subject: [ovs-discuss] Load Action for Registers
In-Reply-To: <CAN-u-63NR123teht0V0_J=h+fEjnyb8nkUb4sa3wsAVMiWA2tA@mail.gmail.com>
References: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>
 <20150620013556.GA1105@nicira.com>
 <CAEgOKCzdUHE8baOTpowN4cDb-ytQ747tQDs8=FxofmTf45rWQw@mail.gmail.com>
 <CAN-u-63NR123teht0V0_J=h+fEjnyb8nkUb4sa3wsAVMiWA2tA@mail.gmail.com>
Message-ID: <20150621181932.GA32699@nicira.com>

The "load" that it uses there is an argument to the "learn" action, not
an action of its own.

On Sun, Jun 21, 2015 at 11:06:49PM +0500, Haleema Sadia wrote:
> I was following this link:
> 
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=tutorial/Tutorial;hb=HEAD
> 
> The entry in Table 2 uses load.
> 
> 
> 
> On Sun, Jun 21, 2015 at 7:28 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
> saurabh at gmail.com> wrote:
> 
> > You need to use "move" instead of "load".
> >
> > --
> > Saurabh (à¤¸à¥Œà¤°à¤­)
> >
> > On Fri, Jun 19, 2015 at 6:35 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> On Fri, Jun 19, 2015 at 01:25:03PM +0500, Haleema Sadia wrote:
> >> > I am trying to load the in_port value to register, like this:
> >> >
> >> > ovs-ofctl add-flow br0 "tcp,in_port=1,actions=load:NXM_OF_IN_PORT[
> >> > ]->NXM_NX_REG0[0..15]" -O OpenFlow13
> >> >
> >> > But it keeps giving me the following error;
> >> >
> >> > ovs-ofctl: NXM_OF_IN_PORT[ ]->NXM_NX_REG0[0..15]: missing `->' following
> >> > value
> >>
> >> Did you read the documentation?
> >> _______________________________________________
> >> discuss mailing list
> >> discuss at openvswitch.org
> >> http://openvswitch.org/mailman/listinfo/discuss
> >>
> >
> >

From haleema.s.mahmood at gmail.com  Sun Jun 21 11:06:49 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Sun, 21 Jun 2015 23:06:49 +0500
Subject: [ovs-discuss] Load Action for Registers
In-Reply-To: <CAEgOKCzdUHE8baOTpowN4cDb-ytQ747tQDs8=FxofmTf45rWQw@mail.gmail.com>
References: <CAN-u-61p1ysGxjh+-7zti+Xk0D49h=zg0434UGDbD0d-bCLoQw@mail.gmail.com>
 <20150620013556.GA1105@nicira.com>
 <CAEgOKCzdUHE8baOTpowN4cDb-ytQ747tQDs8=FxofmTf45rWQw@mail.gmail.com>
Message-ID: <CAN-u-63NR123teht0V0_J=h+fEjnyb8nkUb4sa3wsAVMiWA2tA@mail.gmail.com>

I was following this link:

http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=tutorial/Tutorial;hb=HEAD

The entry in Table 2 uses load.



On Sun, Jun 21, 2015 at 7:28 AM, Saurabh Shrivastava (à¤¸à¥Œà¤°à¤­ à¤¶à¥à¤°à¥€à¤µà¤¾à¤¸à¥à¤¤à¤µ) <
saurabh at gmail.com> wrote:

> You need to use "move" instead of "load".
>
> --
> Saurabh (à¤¸à¥Œà¤°à¤­)
>
> On Fri, Jun 19, 2015 at 6:35 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Fri, Jun 19, 2015 at 01:25:03PM +0500, Haleema Sadia wrote:
>> > I am trying to load the in_port value to register, like this:
>> >
>> > ovs-ofctl add-flow br0 "tcp,in_port=1,actions=load:NXM_OF_IN_PORT[
>> > ]->NXM_NX_REG0[0..15]" -O OpenFlow13
>> >
>> > But it keeps giving me the following error;
>> >
>> > ovs-ofctl: NXM_OF_IN_PORT[ ]->NXM_NX_REG0[0..15]: missing `->' following
>> > value
>>
>> Did you read the documentation?
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150621/e75c25f6/attachment.html>

From prask9 at gmail.com  Mon Jun 22 02:09:19 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Mon, 22 Jun 2015 14:39:19 +0530
Subject: [ovs-discuss] Flows unmodified after clearing mirror
In-Reply-To: <CABZU2_RMiqGPULEsmt1VQx9vwocCzQY4bZ3qgMd0W6D2U7izxA@mail.gmail.com>
References: <CABZU2_RMiqGPULEsmt1VQx9vwocCzQY4bZ3qgMd0W6D2U7izxA@mail.gmail.com>
Message-ID: <CABZU2_QkArmM8r_sSY1m1TGhNEE3aOM0+DUjHnxiKYtz-+65pA@mail.gmail.com>

Retrying.

Did anyone face same issue?



On Thu, Jun 11, 2015 at 4:25 PM, kunapaneni prashanth <prask9 at gmail.com> wrote:
> Hello,
>  i am trying SPAN in openvswitch 2.3.0, by mirroring source traffic of
> oct0 to output on port oct1.
>
> After i start traffic, i can see packets in oct1. While  traffic is
> running, i cleared the mirror. But still see mirroring happening.
> Mirroring stops only after i stop and start traffic again. is this a
> bug?
>
>
> Mirror creation:
>
> ovs-vsctl -- set Bridge br0 mirrors=@m  -- --id=@h0 get Port oct0  --
> --id=@h1 get Port oct1  -- --id=@m create Mirror name=mymirror
> select-src-p
> ort=@h0 output-port=@h1
> dc075662-e0f6-406f-a8e6-142ccbbdc287
> ~ #
>
> Flows  with mirroring:
>
> ~ # ovs-dpctl dump-flows
> recirc_id(0),skb_priority(0),in_port(3),eth(src=00:0f:b7:84:e6:d8,dst=00:0f:b7:84:39:6a),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:123380, bytes:12091240, used:0.000s, actions:2
> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:0f:b7:84:39:6a,dst=00:0f:b7:84:e6:d8),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:123380, bytes:12091240, used:0.000s, actions:3,4
>
>
> Mirror delete:
> #ovs-vsctl clear bridge br0 mirrors
>
>
> Flows after mirror clear
> ~ #
> ~ # ovs-dpctl dump-flows
> recirc_id(0),skb_priority(0),in_port(3),eth(src=00:0f:b7:84:e6:d8,dst=00:0f:b7:84:39:6a),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:127517, bytes:12496666, used:0.000s, actions:2
> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:0f:b7:84:39:6a,dst=00:0f:b7:84:e6:d8),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:127517, bytes:12496666, used:0.001s, actions:3,4
> ~ #
>
>
> ~ # ovs-dpctl show
> system at ovs-system:
>         lookups: hit:84810774 missed:6330 lost:0
>         flows: 2
>         masks: hit:84819861 total:1 hit/pkt:1.00
>         port 0: ovs-system (internal)
>         port 1: br0 (internal)
>         port 2: oct0
>         port 3: poct0
>         port 4: oct1
>
>
> Thanks,
> Prashanth

From hardik.soni at inria.fr  Mon Jun 22 09:57:58 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 22 Jun 2015 18:57:58 +0200 (CEST)
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <20150522190403.GE30148@nicira.com>
References: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
 <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
 <20150522190403.GE30148@nicira.com>
Message-ID: <2124928304.2047785.1434992278275.JavaMail.zimbra@inria.fr>

perfect.. It works as intended

Thanks,
Hardik Soni

----- Original Message -----
> From: "Ben Pfaff" <blp at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: discuss at openvswitch.org
> Sent: Friday, 22 May, 2015 9:04:03 PM
> Subject: Re: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
> 
> On Fri, May 22, 2015 at 04:52:09PM +0200, Hardik Soni wrote:
> > I went through QoS section of FAQ.
> > https://github.com/openvswitch/ovs/blob/master/FAQ.md#quality-of-service-qos
> > 
> > As I understood, OVS doesnt implement QoS, It configures linux-QoS for the
> > interfaces it is handling.
> > If I set linux QoS using 'tc' for a given interface and attach the
> > interface to an OVS bridge using add-port command ovs-vsctl, will it
> > retain the configuration?
> > I want to make sure, OVS doesnt reset my pre-set linux-QoS for the
> > interface it is handling.
> > 
> > Example.
> > tc qdisc add dev eth0 root tbf rate 0.5mbit burst 5kb latency 70ms peakrate
> > 1mbit minburst 1540
> > creating a bridge br-0
> > ovs-vsctl add-port br-0 eth0
> > 
> > Now, eth0 will retain the QoS set by tc. Am I right?
> 
> I think so.  That's certainly the intent.
> 

From hardik.soni at inria.fr  Mon Jun 22 10:54:42 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 22 Jun 2015 19:54:42 +0200 (CEST)
Subject: [ovs-discuss] dhcp request originating from interfaces attached to
	OVS
In-Reply-To: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
Message-ID: <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>

Hi All, 

Is there any possibility that OVS allows DHCP request (broadcast) originating from the interfaces(mostly virtual interfaces like tap/tunnel) controlled by itself? 
The NetworkManager is running on the system, is there any possibility that NM is trying assign IP to the interfaces controlled by OVS? 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150622/e18fbbe0/attachment.html>

From shettyg at nicira.com  Mon Jun 22 10:56:44 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 22 Jun 2015 10:56:44 -0700
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
In-Reply-To: <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
References: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
 <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
Message-ID: <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>

On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> Hi All,
>
> Is there any possibility that OVS allows DHCP request (broadcast)
> originating from the interfaces(mostly virtual interfaces like tap/tunnel)
> controlled by itself?
Yes. That is possible.


> The NetworkManager is running on the system, is there any possibility that
> NM is trying assign IP to the interfaces controlled by OVS?
That is possible too.

>
> Thanks,
> Hardik Soni
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From hardik.soni at inria.fr  Mon Jun 22 11:18:37 2015
From: hardik.soni at inria.fr (hardik soni)
Date: Mon, 22 Jun 2015 20:18:37 +0200
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
Message-ID: <psxrt0dt24xnlas1hmue4tpv.1434997117004@email.android.com>


    
How to stop this, am I missing?


Sent from my Samsung device

-------- Original message --------
From: Gurucharan Shetty <shettyg at nicira.com> 
Date: 22/06/2015  19:56  (GMT+01:00) 
To: Hardik Soni <hardik.soni at inria.fr> 
Cc: "discuss at openvswitch.org discuss" <discuss at openvswitch.org> 
Subject: Re: [ovs-discuss] dhcp request originating from interfaces attached
  to OVS 

On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> Hi All,
>
> Is there any possibility that OVS allows DHCP request (broadcast)
> originating from the interfaces(mostly virtual interfaces like tap/tunnel)
> controlled by itself?
Yes. That is possible.


> The NetworkManager is running on the system, is there any possibility that
> NM is trying assign IP to the interfaces controlled by OVS?
That is possible too.

>
> Thanks,
> Hardik Soni
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150622/1855d172/attachment-0001.html>

From msaifulla at yahoo.com  Mon Jun 22 00:03:21 2015
From: msaifulla at yahoo.com (saifullah M A)
Date: Mon, 22 Jun 2015 07:03:21 +0000 (UTC)
Subject: [ovs-discuss] Simple arithmetic instructions in flow table actions
In-Reply-To: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>
References: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <1597058463.2949829.1434956601476.JavaMail.yahoo@mail.yahoo.com>

Hi,
I am trying to do simple arithmetic before giving the groupId as part of group actionÂ to flow entry like below:
For example: add 10 to groupId; (arithmetic operation)Â Â Â Â Â Â Â Â Â Â Â Â  group:groupIdÂ Â Â Â Â Â  (group action of flow entry)
But I am not able to find any reference in manual or other documents on how to do simple arithmetic operations to groupId before giving it to flow action like 'group:groupId'. I saw registers used for storing group ids but not able to find the arithmetic operations.
Thanks in advance,Saif



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150622/5fba93f4/attachment.html>

From adilahmad17 at gmail.com  Mon Jun 22 00:32:54 2015
From: adilahmad17 at gmail.com (Adil Ahmad)
Date: Mon, 22 Jun 2015 12:32:54 +0500
Subject: [ovs-discuss] Adding/Modifying Queues in OpenFlow
Message-ID: <CADgTXSN95cU2mgGC69JKnkaJ52_ozyjEV-jPw3UOmH04akAStQ@mail.gmail.com>

Hey,

I'm pretty new at this. But I was trying to add queues to my openvswitch
using ovs-vsctl. But I was wondering, is there any way that the openflow
controller would be able to add those queues by itself and modify their
min-rates, max-rates as required for weighted processor sharing in queues?

Regards,
Adil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150622/80c0f574/attachment.html>

From blp at nicira.com  Mon Jun 22 21:01:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 22 Jun 2015 21:01:31 -0700
Subject: [ovs-discuss] Simple arithmetic instructions in flow table
 actions
In-Reply-To: <1597058463.2949829.1434956601476.JavaMail.yahoo@mail.yahoo.com>
References: <1048756263.889092.1434022346874.JavaMail.yahoo@mail.yahoo.com>
 <1597058463.2949829.1434956601476.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150623040131.GC31446@nicira.com>

On Mon, Jun 22, 2015 at 07:03:21AM +0000, saifullah M A wrote:
> Hi,
> I am trying to do simple arithmetic before giving the groupId as part of group actionÂ to flow entry like below:
> For example: add 10 to groupId; (arithmetic operation)Â Â Â Â Â Â Â Â Â Â Â Â  group:groupIdÂ Â Â Â Â Â  (group action of flow entry)
> But I am not able to find any reference in manual or other documents on how to do simple arithmetic operations to groupId before giving it to flow action like 'group:groupId'. I saw registers used for storing group ids but not able to find the arithmetic operations.

OpenFlow does not support arithmetic.

From blp at nicira.com  Mon Jun 22 21:03:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 22 Jun 2015 21:03:33 -0700
Subject: [ovs-discuss] Adding/Modifying Queues in OpenFlow
In-Reply-To: <CADgTXSN95cU2mgGC69JKnkaJ52_ozyjEV-jPw3UOmH04akAStQ@mail.gmail.com>
References: <CADgTXSN95cU2mgGC69JKnkaJ52_ozyjEV-jPw3UOmH04akAStQ@mail.gmail.com>
Message-ID: <20150623040333.GD31446@nicira.com>

On Mon, Jun 22, 2015 at 12:32:54PM +0500, Adil Ahmad wrote:
> I'm pretty new at this. But I was trying to add queues to my openvswitch
> using ovs-vsctl. But I was wondering, is there any way that the openflow
> controller would be able to add those queues by itself and modify their
> min-rates, max-rates as required for weighted processor sharing in queues?

OpenFlow leaves queue configuration as a problem for configuration
protocols (such as OF-CONFIG and OVSDB).

From hardik.soni at inria.fr  Tue Jun 23 02:40:09 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Tue, 23 Jun 2015 11:40:09 +0200 (CEST)
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
In-Reply-To: <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>
References: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
 <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
 <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>
Message-ID: <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>

I thought OVS takes total control on the interfaces it handles.
How to stop this "DHCP request" messages?

Thanks,
Hardik Soni

----- Original Message -----
> From: "Gurucharan Shetty" <shettyg at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: "discuss at openvswitch.org discuss" <discuss at openvswitch.org>
> Sent: Monday, 22 June, 2015 7:56:44 PM
> Subject: Re: [ovs-discuss] dhcp request originating from interfaces attached to OVS
> 
> On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> > Hi All,
> >
> > Is there any possibility that OVS allows DHCP request (broadcast)
> > originating from the interfaces(mostly virtual interfaces like tap/tunnel)
> > controlled by itself?
> Yes. That is possible.
> 
> 
> > The NetworkManager is running on the system, is there any possibility that
> > NM is trying assign IP to the interfaces controlled by OVS?
> That is possible too.
> 
> >
> > Thanks,
> > Hardik Soni
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
> 

From kevin.traynor at intel.com  Tue Jun 23 03:08:40 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 23 Jun 2015 10:08:40 +0000
Subject: [ovs-discuss] [dpdk-dev] DPDK with Openvswitch Compatibility
	issue
In-Reply-To: <1920130021.2148253.1434998152825.JavaMail.yahoo@mail.yahoo.com>
References: <1920130021.2148253.1434998152825.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745175344@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: dev [mailto:dev-bounces at dpdk.org] On Behalf Of Sundar Ramakrishnan
> Sent: Monday, June 22, 2015 7:36 PM
> To: dev at dpdk.org
> Subject: [dpdk-dev] DPDK with Openvswitch Compatibility issue
> 
> Hello,
> I have trying to compile and install openvswitch with dpdk. I have tried
> dpdk-1.7.0 through dpdk-2.0.0 with openvswitch-2.0.0 through openvswitch-
> 2.3.2. I have been following these two guides -
> http://openvswitch.org/support/dist-docs/INSTALL.DPDK.md.txt

Probably best to switch to the ovs-discuss mailing list for this as it
doesn't look like a DPDK issue. I suggest using use the head of master
for OVS with DPDK 2.0.0 and stepping through the INSTALL.DPDK.md then.

> 
> IntelÂ® Data Plane Development Kit for Linux*: Guide
> 
> | Â  |
> | Â  |  | Â  | Â  | Â  | Â  | Â  |
> | IntelÂ® Data Plane Development Kit for Linux*: GuideGetting Started Guide:
> Describes how to install and configure the IntelÂ® Data Plane Development Kit
> for Linux*. (v.7, Jun. 2014) |
> |  |
> | View on www.intel.com | Preview by Yahoo |
> |  |
> | Â  |
> 
> 
> Currently this is what my error message says -
> /bin/sh /root/openvswitch-2.0.0/build-aux/missing --run autom4te --
> language=autotest -I '.' -o tests/testsuite.tmp
> tests/testsuite.attests/testsuite.at:56: error: possibly undefined macro:
> dnlÂ  Â  Â  If this token and others are legitimate, please use
> m4_pattern_allow.Â  Â  Â  See the Autoconf
> documentation.tests/testsuite.tmp:15559: error: possibly undefined macro:
> AT_FAIL_IFtests/testsuite.tmp:17108: error: possibly undefined macro:
> AT_SKIP_IFtests/testsuite.tmp:18411: error: possibly undefined macro:
> AT_CHECK_UNQUOTEDtests/testsuite.tmp:104490: error: possibly undefined macro:
> AS_VAR_COPY
> 
> Any help or pointers will be appreciated.
> I am using RHEL 6.6.
> ThanksSundar

From Kavitha_Ramalingham at Dell.com  Tue Jun 23 03:12:33 2015
From: Kavitha_Ramalingham at Dell.com (Kavitha_Ramalingham at Dell.com)
Date: Tue, 23 Jun 2015 15:42:33 +0530
Subject: [ovs-discuss] Issue with Broadcast Group
Message-ID: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>

Hi



I tested with the below mentioned topology, having a broadcast flow whose actions were set to broadcast group ID. When I tried to ping from host h1 to h2, ARP request packet is sent out to only one port and not to all ports. We have created a group of type "all" with the egress ports set to port3 and port4. The expectation here is that any flow that uses this group has to egress the traffic on both the ports. In the below tcpdump capture you can see that ARP-Request traffic goes out of port4 and not thro' port3.



This seems to be a bug and I request your inputs.



mininet> net
h1 h1-eth0:s1-eth1 h1-eth1:s1-eth2
h2 h2-eth0:s1-eth3
h3 h3-eth0:s1-eth4
s1 lo:  s1-eth1:h1-eth0 s1-eth2:h1-eth1 s1-eth3:h2-eth0 s1-eth4:h3-eth0
c0

[mininet at opendaylight test]\>sudo ovs-ofctl dump-groups s1 -O OpenFlow13
OFPST_GROUP_DESC reply (OF1.3) (xid=0x2):
group_id=32399,type=all,bucket=weight:0,actions=output:3,output:4
group_id=28326,type=select,bucket=weight:0,actions=output:1,output:2

mininet at opendaylight test]\>sudo ovs-ofctl dump-flows s1 -O OpenFlow13
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0x0, duration=4310.355s, table=0, n_packets=2790, n_bytes=117180, dl_dst=ff:ff:ff:ff:ff:ff actions=group:32399
cookie=0x3000000000000008, duration=4496.507s, table=0, n_packets=308, n_bytes=38192, priority=5,dl_dst=01:80:c2:00:00:02,dl_type=0x8809 actions=CONTROLLER:65535

[mininet at opendaylight test]\>sudo tcpdump -i s1-eth4
tcpdump: WARNING: s1-eth4: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on s1-eth4, link-type EN10MB (Ethernet), capture size 65535 bytes
01:17:27.237038 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28
01:17:28.238832 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28
01:17:29.240828 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28

[mininet at opendaylight test]\>sudo tcpdump -i s1-eth3
tcpdump: WARNING: s1-eth3: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on s1-eth3, link-type EN10MB (Ethernet), capture size 65535 bytes
01:17:16.334564 LLDP, length 49: openflow:1
01:17:21.334410 LLDP, length 49: openflow:1


Thanks and Regards
R. Kavitha

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/16ff362b/attachment.html>

From Kavitha_Ramalingham at Dell.com  Tue Jun 23 03:18:38 2015
From: Kavitha_Ramalingham at Dell.com (Kavitha_Ramalingham at Dell.com)
Date: Tue, 23 Jun 2015 15:48:38 +0530
Subject: [ovs-discuss] Groups within groups
Message-ID: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>

Hi
                We are experiencing a problem with traffic-flow with the below mentioned topology and scenario.

Topology :

H1 ----|      |
     ----| S1 |---H2


We have 2 links(Port1 and Port2) connected from host H1 to switch S1 and 1 link(Port3) between S1 and H2.

Groups :
We have the following 2 groups created where group 8165 uses both the group 58912 and port 3

OFPST_GROUP_DESC reply (OF1.3) (xid=0x2):
group_id=58912,type=select,bucket=weight:0,actions=output:1,output:2
group_id=8165,type=all,bucket=actions=group:58912,output:3

Flows:

root at mininet-89:~# sudo ovs-ofctl -O Openflow13 dump-flows s1
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0x0, duration=7433.711s, table=0, n_packets=1149, n_bytes=48258, arp,dl_src=02:01:02:03:04:08,dl_dst=ff:ff:ff:ff:ff:ff actions=group:8165
cookie=0x0, duration=7457.281s, table=0, n_packets=1062, n_bytes=44604, arp,dl_src=00:00:00:00:00:22,dl_dst=ff:ff:ff:ff:ff:ff actions=group:8165
cookie=0x3000000000000000, duration=8291.778s, table=0, n_packets=560, n_bytes=69440, priority=5,dl_dst=01:80:c2:00:00:02,dl_type=0x8809 actions=CONTROLLER:65535

We have created 2 flows manually to handle ARP request packet that would use the group 8165 as egress ports.


Observation :

*         Now when ARP request is sent from host H1 to H2, we do see that switch S1 is receiving ARP Requests and the ARP flow is hit. However, ARP request is not sent to the port3 as expected. In Group table, when Group ID 58912 is removed from group 8165, we see that the ARP requests are reaching H2 from H1.

*         Also when ARP request is sent from host H2 to H1, it is received in switch S1, but does not egress out


We always see that the traffic is not sent out of the ports described in the flows, when a flow uses a Group ID that in turn uses another group ID in the "actions" qualifier. This appears to be a bug. Can you pl. look into it.


Thanks and Regards
R. Kavitha

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/52dc9c76/attachment.html>

From zhangcy at cn.fujitsu.com  Tue Jun 23 03:37:13 2015
From: zhangcy at cn.fujitsu.com (Zhang, Chunyu)
Date: Tue, 23 Jun 2015 10:37:13 +0000
Subject: [ovs-discuss] how to use ovs-conntrack
Message-ID: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>

hi  all

i want to use ovs-conntrack.
i know ovs is in : https://github.com/justinpettit/ovs/tree/conntrack
i know kernel module should change : https://lkml.org/lkml/2015/3/2/835

my question is :

1.  ovs-conntrack use
should i use those patch ? https://lkml.org/lkml/2015/3/2/835

2. if i must use those kernel patch
 github( kernel+ovs kernel patch ) address is ?

3. ovs-ofctl command
in our project , we use nf_conntrack extension : 

static struct nf_ct_ext_type nf_ct_colo_extend __read_mostly = {
      .len        = sizeof(struct nf_conn_colo),
      .move       = nf_ct_colo_extend_move,
      .destroy    = nf_ct_colo_extend_destroy,
      .align      = __alignof__(struct nf_conn_colo),
      .id		= NF_CT_EXT_COLO,
};

if i want to nf_conntrack extension work.
ovs-ofctl command is ?
please give me some example and advise


thanks ...

From ian.stokes at intel.com  Tue Jun 23 04:56:20 2015
From: ian.stokes at intel.com (Stokes, Ian)
Date: Tue, 23 Jun 2015 11:56:20 +0000
Subject: [ovs-discuss] Make distcheck fails with "recipe for target
 'distcleancheck' failed"
Message-ID: <CD7C01071941AC429549C17338DB8A526AC42289@IRSMSX101.ger.corp.intel.com>

Hi All,

Running "make distcheck" on the latest commit to master in my environment (Fedora 21) and it fails due to files relating to ovn not being removed from the build directory. Command and output below.

make distcheck

...
rm -rf lib/.deps lib/lldp/.deps ofproto/.deps ovn/.deps ovn/controller/.deps ovn/lib/.deps ovn/northd/.deps ovsdb/.deps tests/.deps tests/dpdk/.deps utilities/.deps vswitchd/.deps vtep/.deps
rm -f Makefile
ERROR: files left in build directory after distclean:
./ovn/controller/ovn-controller.8
./ovn/utilities/ovn-ctl.8
./ovn/ovn-architecture.7
./ovn/ovn-nbctl.8
./utilities/ovs-sim
./utilities/ovs-sim.1
Makefile:4721: recipe for target 'distcleancheck' failed
make[1]: *** [distcleancheck] Error 1
make[1]: Leaving directory '/home/istokes/ovs/openvswitch-2.4.90/_build'
Makefile:4648: recipe for target 'distcheck' failed
make: *** [distcheck] Error 1

Has anyone else encountered this issue?

Regards
Ian Stokes

From jpettit at nicira.com  Tue Jun 23 05:23:39 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 23 Jun 2015 14:23:39 +0200
Subject: [ovs-discuss] how to use ovs-conntrack
In-Reply-To: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>
References: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>
Message-ID: <FBC0CB48-3723-4DC4-94F1-4D3E0A439CBE@nicira.com>


> On Jun 23, 2015, at 12:37 PM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
> 
> hi  all
> 
> i want to use ovs-conntrack.
> i know ovs is in : https://github.com/justinpettit/ovs/tree/conntrack
> i know kernel module should change : https://lkml.org/lkml/2015/3/2/835
> 
> my question is :
> 
> 1.  ovs-conntrack use
> should i use those patch ? https://lkml.org/lkml/2015/3/2/835

I would use the OVS repo.  Those were RFC patches and represent the code on that day.  The OVS repo is more current (there have been a number of bug fixes) and also contains the userspace parts that you need.

> 2. if i must use those kernel patch
> github( kernel+ovs kernel patch ) address is ?

As I mentioned, I'd recommend using the OVS repo, which has all the parts you need.  It should be rebased against OVS master in the next couple of days.  I imagine an updated kernel portion will be sent out to netdev in the next few weeks.

> 3. ovs-ofctl command
> in our project , we use nf_conntrack extension : 
> 
> static struct nf_ct_ext_type nf_ct_colo_extend __read_mostly = {
>      .len        = sizeof(struct nf_conn_colo),
>      .move       = nf_ct_colo_extend_move,
>      .destroy    = nf_ct_colo_extend_destroy,
>      .align      = __alignof__(struct nf_conn_colo),
>      .id		= NF_CT_EXT_COLO,
> };
> 
> if i want to nf_conntrack extension work.
> ovs-ofctl command is ?
> please give me some example and advise

If you use the OVS repo, the man pages for ovs-ofctl were updated.  Look for the new "ct" action and "conn_state" match.

--Justin



From shettyg at nicira.com  Tue Jun 23 07:21:53 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 23 Jun 2015 07:21:53 -0700
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
In-Reply-To: <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>
References: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
 <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
 <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>
 <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>
Message-ID: <CAHbON5rRoG5VqWnSHayhorko9=AutK8cvKxd=Y4B2QArenCiQA@mail.gmail.com>

I think there is a disconnect between your intent in the question and
my understanding of it. The best way is to not enable DHCP on OVS
interfaces or on external ports added as ports to a OVS bridge. If
your question is to programmatically disable it, you will need to add
OpenFlow flows to disable DHCP requests.

On Tue, Jun 23, 2015 at 2:40 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> I thought OVS takes total control on the interfaces it handles.
> How to stop this "DHCP request" messages?
>
> Thanks,
> Hardik Soni
>
> ----- Original Message -----
>> From: "Gurucharan Shetty" <shettyg at nicira.com>
>> To: "Hardik Soni" <hardik.soni at inria.fr>
>> Cc: "discuss at openvswitch.org discuss" <discuss at openvswitch.org>
>> Sent: Monday, 22 June, 2015 7:56:44 PM
>> Subject: Re: [ovs-discuss] dhcp request originating from interfaces attached to OVS
>>
>> On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
>> > Hi All,
>> >
>> > Is there any possibility that OVS allows DHCP request (broadcast)
>> > originating from the interfaces(mostly virtual interfaces like tap/tunnel)
>> > controlled by itself?
>> Yes. That is possible.
>>
>>
>> > The NetworkManager is running on the system, is there any possibility that
>> > NM is trying assign IP to the interfaces controlled by OVS?
>> That is possible too.
>>
>> >
>> > Thanks,
>> > Hardik Soni
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>>

From blp at nicira.com  Tue Jun 23 08:35:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 08:35:29 -0700
Subject: [ovs-discuss] Groups within groups
In-Reply-To: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>
Message-ID: <20150623153529.GH31446@nicira.com>

On Tue, Jun 23, 2015 at 03:48:38PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> We always see that the traffic is not sent out of the ports described
> in the flows, when a flow uses a Group ID that in turn uses another
> group ID in the "actions" qualifier. This appears to be a bug. Can you
> pl. look into it.

OpenFlow doesn't require support of group chaining.  OVS 2.4 and earlier
don't support group chaining, but OVS 2.5 will.

From shettyg at nicira.com  Tue Jun 23 08:42:16 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 23 Jun 2015 08:42:16 -0700
Subject: [ovs-discuss] Make distcheck fails with "recipe for target
 'distcleancheck' failed"
In-Reply-To: <CD7C01071941AC429549C17338DB8A526AC42289@IRSMSX101.ger.corp.intel.com>
References: <CD7C01071941AC429549C17338DB8A526AC42289@IRSMSX101.ger.corp.intel.com>
Message-ID: <CAHbON5pRZosFE+8FuDf4zL34Yy3VL9x28pxX_gwMVCUOxvC-Kg@mail.gmail.com>

On Tue, Jun 23, 2015 at 4:56 AM, Stokes, Ian <ian.stokes at intel.com> wrote:
> Hi All,
>
> Running "make distcheck" on the latest commit to master in my environment (Fedora 21) and it fails due to files relating to ovn not being removed from the build directory. Command and output below.
>
> make distcheck
>
> ...
> rm -rf lib/.deps lib/lldp/.deps ofproto/.deps ovn/.deps ovn/controller/.deps ovn/lib/.deps ovn/northd/.deps ovsdb/.deps tests/.deps tests/dpdk/.deps utilities/.deps vswitchd/.deps vtep/.deps
> rm -f Makefile
> ERROR: files left in build directory after distclean:
> ./ovn/controller/ovn-controller.8
> ./ovn/utilities/ovn-ctl.8
> ./ovn/ovn-architecture.7
> ./ovn/ovn-nbctl.8
> ./utilities/ovs-sim
> ./utilities/ovs-sim.1
> Makefile:4721: recipe for target 'distcleancheck' failed
> make[1]: *** [distcleancheck] Error 1
> make[1]: Leaving directory '/home/istokes/ovs/openvswitch-2.4.90/_build'
> Makefile:4648: recipe for target 'distcheck' failed
> make: *** [distcheck] Error 1
>
> Has anyone else encountered this issue?
>
It is a bug. I will send out a fix.

> Regards
> Ian Stokes
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Tue Jun 23 08:52:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 08:52:09 -0700
Subject: [ovs-discuss] Issue with Broadcast Group
In-Reply-To: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>
Message-ID: <20150623155209.GL31446@nicira.com>

On Tue, Jun 23, 2015 at 03:42:33PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> I tested with the below mentioned topology, having a broadcast flow
> whose actions were set to broadcast group ID. When I tried to ping
> from host h1 to h2, ARP request packet is sent out to only one port
> and not to all ports. We have created a group of type "all" with the
> egress ports set to port3 and port4. The expectation here is that any
> flow that uses this group has to egress the traffic on both the
> ports. In the below tcpdump capture you can see that ARP-Request
> traffic goes out of port4 and not thro' port3.

Your "all" group has one bucket with two output actions.  That's a
mistake, because OpenFlow says that the actions in a bucket are an
"action set", meaning that only one action of each type can be
effective.  The solution is to use two buckets, each with one output
action.

From sundar_ramki at yahoo.com  Mon Jun 22 15:30:32 2015
From: sundar_ramki at yahoo.com (Sundar Ramakrishnan)
Date: Mon, 22 Jun 2015 22:30:32 +0000 (UTC)
Subject: [ovs-discuss] Openvswitch with DPDK issue
Message-ID: <364072543.1310131.1435012232961.JavaMail.yahoo@mail.yahoo.com>

Hello,
I am a newbie to this environment and I am unable to find which release of DPDK works fine with Openvswitch. I hope you could enlighten me with some docs or references with which I could build a working setup -Â 
RHEL 6.6DPDK - 1.7.1OVS - 2.3.1
Following are some steps I figured out from the web & my experiments -Â 
Error:
/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h: In function Ã¢rte_is_alignedÃ¢:/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h:176: warning: cast from function call of type Ã¢uintptr_tÃ¢ to non-matching type Ã¢void *Ã¢lib/netdev-dpdk.c: In function Ã¢dpdk_class_initÃ¢:lib/netdev-dpdk.c:1081: warning: implicit declaration of function Ã¢rte_pmd_init_allÃ¢lib/netdev-dpdk.c: In function Ã¢dpdk_initÃ¢:lib/netdev-dpdk.c:1189: error: too few arguments to function Ã¢rte_memzone_dumpÃ¢make[2]: *** [lib/netdev-dpdk.lo] Error 1make[2]: Leaving directory `/usr/src/openvswitch-2.3.1'make[1]: *** [all-recursive] Error 1make[1]: Leaving directory `/usr/src/openvswitch-2.3.1'make: *** [all] Error 2

DPDK Open vSwitch Notes RHEL6.6:------------------------
Additions to kernel cmdline:iommu=pt intel_iommu=on default_hugepagesz=1G hugepagesz=1G transparent_hugepage=never hugepages=32
BUILD DPDK:cd /usr/src/dpdk-1.6.0r2 <--- 1st working versioncd /usr/src/dpdk-1.7.1 <--- Only works with 82599cd /usr/src/dpdk-1.8.0 <--- x540s are recognized ovs doesn't build with it thoexport DPDK=$(pwd)export TGT=x86_64-native-linuxapp-gccmake CONFIG_RTE_BUILD_COMBINE_LIBS=y CONFIG_RTE_BUILD_SHARED_LIB=n CONFIG_RTE_LIBRTE_IXGBE_PMD=y CONFIG_RTE_LIBRTE_IGB_PMD=y install T=$TGT

BUILD OpenvSwitch:cd /usr/src/openvswitch-2.3.1export OVS=$(pwd)./boot.sh./configure --disable-ssl --with-dpdk=$DPDK/$TGT LIBS=-ldlmakemake installln -sf /usr/local/bin/ovs-vsctl /usr/bin/ovs-vsctl <--- libvirt requires ovs-vsctl to be here

Please let me know if you find something wrong in what I am doing.
Thanking you
Sundar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150622/ecf2a50b/attachment-0001.html>

From dev_raj82 at yahoo.com  Mon Jun 22 23:18:14 2015
From: dev_raj82 at yahoo.com (r devarajan)
Date: Tue, 23 Jun 2015 06:18:14 +0000 (UTC)
Subject: [ovs-discuss] Group Bucket counters
Message-ID: <1168076548.3781242.1435040294834.JavaMail.yahoo@mail.yahoo.com>

Hello,
I created a no controller 2 host topology in mininet. I added the following flows:
user at user-HP-ProBook-4440s:~$ sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,nw_src=10.0.0.1,actions=group:1user at user-HP-ProBook-4440s:~$ sudo ovs-ofctl -O OpenFlow13 add-flow s1 ip,nw_src=10.0.0.2,actions=group:2
with the corresponding groups being:
user at user-HP-ProBook-4440s:~$ sudo ovs-ofctl -O OpenFlow13 dump-groups s1OFPST_GROUP_DESC reply (OF1.3) (xid=0x2):Â group_id=1,type=all,bucket=actions=output:2Â group_id=2,type=all,bucket=actions=output:1
I test it on Â mininet:

mininet> pingall*** Ping: testing ping reachabilityh1 -> h2Â h2 -> h1Â *** Results: 0% dropped (2/2 received)mininet> pingall*** Ping: testing ping reachabilityh1 -> h2Â h2 -> h1Â *** Results: 0% dropped (2/2 received)mininet> pingall*** Ping: testing ping reachabilityh1 -> h2Â h2 -> h1Â *** Results: 0% dropped (2/2 received)
Dumping flows i get:
cookie=0x0, duration=51.525s, table=0, n_packets=6, n_bytes=588, ip,nw_src=10.0.0.1 actions=group:1
Â cookie=0x0, duration=49.691s, table=0, n_packets=6, n_bytes=588, ip,nw_src=10.0.0.2 actions=group:2
But dumping groups I get:
user at user-HP-ProBook-4440s:~$ sudo ovs-ofctl -O OpenFlow13 dump-group-stats s1OFPST_GROUP reply (OF1.3) (xid=0x2):Â group_id=1,duration=2553.432s,ref_count=1,packet_count=0,byte_count=0,bucket0:packet_count=0,byte_count=0Â group_id=2,duration=2444.484s,ref_count=1,packet_count=0,byte_count=0,bucket0:packet_count=0,byte_count=0
Why are the bucket counters not getting updated like the flow counters? Is there something I should do for that? Also thanks :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/997406aa/attachment-0001.html>

From vrapelly at sonusnet.com  Tue Jun 23 00:23:47 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Tue, 23 Jun 2015 07:23:47 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
Message-ID: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>

Hi All,

I'm a newbie to openvswitch and I followed the below link to install ovs with DPDK on RHEL7 machine.

[root at artha ~]# uname -a
Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014 x86_64 x86_64 x86_64 GNU/Linux

https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md

When I ran vswitch daemon, it reports following error [I binded igb_uio to the i350 NIC].

2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try assigning ports to UIO.
2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0

Following PCI bind status.

[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status

Network devices using DPDK-compatible driver
============================================
0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=

Network devices using kernel driver
===================================
0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3 unused=
0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3 unused=
0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3 unused=
0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3 unused=
0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=

Other network devices
=====================
<none>

Then I created I ovs bridge using below cmd:
./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk

When I add dpdk port it reports, "could not open network device dpdk0 (Unknown error -19)"

Please let me know

1.  What could be possible reason for not detecting the interface which is binded to igb_uio?

2.  How to add the port which is binded to igb_uio here?

Thanks in advance.

Regards,
Varun

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/25120d9c/attachment-0001.html>

From dev_raj82 at yahoo.com  Tue Jun 23 01:28:09 2015
From: dev_raj82 at yahoo.com (r devarajan)
Date: Tue, 23 Jun 2015 08:28:09 +0000 (UTC)
Subject: [ovs-discuss] Is the incrementing of NXM registers possible?
Message-ID: <1874493200.3819699.1435048089716.JavaMail.yahoo@mail.yahoo.com>

Hello,Â Â  Â  Â  Â  Â  Â  Â I'd like to know if you can increment the registers ie:Â load:0x001122334455->NXM_NX_REG1[0..15]
and then after this can I do something to increment NXM_NX_REG1 Â ?
Thank you,Nishanth D
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/fd23bfbf/attachment-0001.html>

From Kavitha_Ramalingham at Dell.com  Tue Jun 23 03:03:35 2015
From: Kavitha_Ramalingham at Dell.com (Kavitha_Ramalingham at Dell.com)
Date: Tue, 23 Jun 2015 15:33:35 +0530
Subject: [ovs-discuss] Issue with Broadcast Group
Message-ID: <D5A6F3355F664C40AFB65BB1277D8D45040CA6003F@MAAX7MCDC101.APAC.DELL.COM>

Hi



I tested with the below mentioned topology, having a broadcast flow whose actions were set to broadcast group ID. When I tried to ping from host h1 to h2, ARP request packet is sent out to only one port and not to all ports. We have created a group of type "all" with the egress ports set to port3 and port4. The expectation here is that any flow that uses this group has to egress the traffic on both the ports. In the below tcpdump capture you can see that ARP-Request traffic goes out of port4 and not thro' port3.



This seems to be a bug and I request your inputs.



mininet> net
h1 h1-eth0:s1-eth1 h1-eth1:s1-eth2
h2 h2-eth0:s1-eth3
h3 h3-eth0:s1-eth4
s1 lo:  s1-eth1:h1-eth0 s1-eth2:h1-eth1 s1-eth3:h2-eth0 s1-eth4:h3-eth0
c0

[mininet at opendaylight test]\>sudo ovs-ofctl dump-groups s1 -O OpenFlow13
OFPST_GROUP_DESC reply (OF1.3) (xid=0x2):
group_id=32399,type=all,bucket=weight:0,actions=output:3,output:4
group_id=28326,type=select,bucket=weight:0,actions=output:1,output:2

mininet at opendaylight test]\>sudo ovs-ofctl dump-flows s1 -O OpenFlow13
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0x0, duration=4310.355s, table=0, n_packets=2790, n_bytes=117180, dl_dst=ff:ff:ff:ff:ff:ff actions=group:32399
cookie=0x3000000000000008, duration=4496.507s, table=0, n_packets=308, n_bytes=38192, priority=5,dl_dst=01:80:c2:00:00:02,dl_type=0x8809 actions=CONTROLLER:65535

[mininet at opendaylight test]\>sudo tcpdump -i s1-eth4
tcpdump: WARNING: s1-eth4: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on s1-eth4, link-type EN10MB (Ethernet), capture size 65535 bytes
01:17:27.237038 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28
01:17:28.238832 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28
01:17:29.240828 ARP, Request who-has 10.1.1.2 tell rtr-pet-01.force10networks.com, length 28

[mininet at opendaylight test]\>sudo tcpdump -i s1-eth3
tcpdump: WARNING: s1-eth3: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on s1-eth3, link-type EN10MB (Ethernet), capture size 65535 bytes
01:17:16.334564 LLDP, length 49: openflow:1
01:17:21.334410 LLDP, length 49: openflow:1


Thanks and Regards
R. Kavitha

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/7bbcccba/attachment-0001.html>

From diproiettod at vmware.com  Tue Jun 23 09:25:12 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 23 Jun 2015 16:25:12 +0000
Subject: [ovs-discuss] Openvswitch with DPDK issue
In-Reply-To: <364072543.1310131.1435012232961.JavaMail.yahoo@mail.yahoo.com>
References: <364072543.1310131.1435012232961.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <D1AF45AE.3513%diproiettod@vmware.com>

Hi,

OVS 2.3.2 supports DPDK 1.6, as stated in INSTALL.DPDK.
Many APIs have changed in DPDK in a backward incompatible
way.

Also, DPDK support in OVS 2.3.2 is experimental.  It would be
better to use the code from branch-2.4 (with DPDK 2.0)

Daniele


On 22/06/2015 23:30, "Sundar Ramakrishnan" <sundar_ramki at yahoo.com> wrote:

>
>Hello,
>
>
>I am a newbie to this environment and I am unable to find which release
>of DPDK works fine with Openvswitch. I hope you could enlighten me with
>some docs or references with which I could build a working setup -
>
>
>RHEL 6.6
>DPDK - 1.7.1
>OVS - 2.3.1
>
>
>Following are some steps I figured out from the web & my experiments -
>
>
>Error:
>
>
>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h: In
>function Ã¢rte_is_alignedÃ¢:
>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h:176:
>warning: cast from function call of type Ã¢uintptr_tÃ¢ to non-matching type
>Ã¢void *Ã¢
>lib/netdev-dpdk.c: In function Ã¢dpdk_class_initÃ¢:
>lib/netdev-dpdk.c:1081: warning: implicit declaration of function
>Ã¢rte_pmd_init_allÃ¢
>lib/netdev-dpdk.c: In function Ã¢dpdk_initÃ¢:
>lib/netdev-dpdk.c:1189: error: too few arguments to function
>Ã¢rte_memzone_dumpÃ¢
>make[2]: *** [lib/netdev-dpdk.lo] Error 1
>make[2]: Leaving directory `/usr/src/openvswitch-2.3.1'
>make[1]: *** [all-recursive] Error 1
>make[1]: Leaving directory `/usr/src/openvswitch-2.3.1'
>make: *** [all] Error 2
>
>
>
>
>DPDK Open vSwitch Notes RHEL6.6:
>------------------------
>
>
>Additions to kernel cmdline:
>iommu=pt intel_iommu=on default_hugepagesz=1G hugepagesz=1G
>transparent_hugepage=never hugepages=32
>
>
>BUILD DPDK:
>cd /usr/src/dpdk-1.6.0r2 <--- 1st working version
>cd /usr/src/dpdk-1.7.1 <--- Only works with 82599
>cd /usr/src/dpdk-1.8.0 <--- x540s are recognized ovs doesn't build with
>it tho
>export DPDK=$(pwd)
>export TGT=x86_64-native-linuxapp-gcc
>make CONFIG_RTE_BUILD_COMBINE_LIBS=y CONFIG_RTE_BUILD_SHARED_LIB=n
>CONFIG_RTE_LIBRTE_IXGBE_PMD=y CONFIG_RTE_LIBRTE_IGB_PMD=y install T=$TGT
>
>
>
>BUILD OpenvSwitch:
>cd /usr/src/openvswitch-2.3.1
>export OVS=$(pwd)
>./boot.sh
>./configure --disable-ssl --with-dpdk=$DPDK/$TGT LIBS=-ldl
>make
>make install
>ln -sf /usr/local/bin/ovs-vsctl /usr/bin/ovs-vsctl <--- libvirt requires
>ovs-vsctl to be here
>
>
>
>
>Please let me know if you find something wrong in what I am doing.
>
>
>Thanking you
>
>
>Sundar
>
>
>


From diproiettod at vmware.com  Tue Jun 23 09:45:51 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 23 Jun 2015 16:45:51 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <D1AF4783.3520%diproiettod@vmware.com>

The commands you're typing seem correct.

Which version of OVS are you using? How are you compiling it?

On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi All,
> 
>IÂ¹m a newbie to openvswitch and I followed the below link to install ovs
>with DPDK on RHEL7 machine.
> 
>[root at artha ~]# uname -a
>Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014 x86_64
>x86_64 x86_64 GNU/Linux
> 
>https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswit
>ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeA
>w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvXwU3yO
>I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-uRNfI
>C0hWg&e=>
> 
>When I ran vswitch daemon, it reports following error [I binded igb_uio
>to the i350 NIC].
> 
>2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
>assigning ports to UIO.
>2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> 
>Following PCI bind status.
> 
>[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> 
>Network devices using DPDK-compatible driver
>============================================
>0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> 
>Network devices using kernel driver
>===================================
>0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3
>unused=
>0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3
>unused=
>0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3
>unused=
>0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3
>unused=
>0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=
> 
>Other network devices
>=====================
><none>
> 
>Then I created I ovs bridge using below cmd:
>./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
>                  
>
>./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> 
>When I add dpdk port it reports, Â³could not open network device dpdk0
>(Unknown error -19)Â²
> 
>Please let me know
>1. 
>What could be possible reason for not detecting the interface which is
>binded to igb_uio?
>2. 
>How to add the port which is binded to igb_uio here?
>
> 
>Thanks in advance.
> 
>Regards,
>Varun
> 
>


From blp at nicira.com  Tue Jun 23 10:24:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 10:24:30 -0700
Subject: [ovs-discuss] Issue with Broadcast Group
In-Reply-To: <F7F9C3835CC5DD4B95CDEB03319E713816ECFE8E@KULX10HMDC101.APAC.DELL.COM>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>
 <20150623155209.GL31446@nicira.com>
 <F7F9C3835CC5DD4B95CDEB03319E713816ECFE8E@KULX10HMDC101.APAC.DELL.COM>
Message-ID: <20150623172430.GA2640@nicira.com>

I hope you realize that bugs at openvswitch.org is a public mailing list.
Nothing on it can be confidential.

Yes.  This is a property of how OpenFlow is defined.

On Tue, Jun 23, 2015 at 05:01:24PM +0000, C_Venkataraghavan at DELL.com wrote:
> Dell - Internal Use - Confidential
> Hi Ben,
> If we use group type "indirect" instead of "all", multiple egress ports in output action would still fail, right?
> 
> thanks
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Tuesday, June 23, 2015 9:22 PM
> To: Ramalingham, Kavitha
> Cc: bugs at openvswitch.org; K, Kalaiselvi; Sindagi, Rajesh; Venkataraghavan, C; Balasubram, Vasanthan; Manivasagam, Mahesh
> Subject: Re: [ovs-discuss] Issue with Broadcast Group
> 
> On Tue, Jun 23, 2015 at 03:42:33PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> > I tested with the below mentioned topology, having a broadcast flow
> > whose actions were set to broadcast group ID. When I tried to ping
> > from host h1 to h2, ARP request packet is sent out to only one port
> > and not to all ports. We have created a group of type "all" with the
> > egress ports set to port3 and port4. The expectation here is that any
> > flow that uses this group has to egress the traffic on both the ports.
> > In the below tcpdump capture you can see that ARP-Request traffic goes
> > out of port4 and not thro' port3.
> 
> Your "all" group has one bucket with two output actions. That's a mistake, because OpenFlow says that the actions in a bucket are an "action set", meaning that only one action of each type can be effective. The solution is to use two buckets, each with one output action.

From blp at nicira.com  Tue Jun 23 10:40:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 10:40:04 -0700
Subject: [ovs-discuss] Group Bucket counters
In-Reply-To: <1168076548.3781242.1435040294834.JavaMail.yahoo@mail.yahoo.com>
References: <1168076548.3781242.1435040294834.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150623174004.GB2640@nicira.com>

OpenFlow bucket stats are new in OVS 2.4.

From blp at nicira.com  Tue Jun 23 10:41:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 10:41:51 -0700
Subject: [ovs-discuss] Is the incrementing of NXM registers possible?
In-Reply-To: <1874493200.3819699.1435048089716.JavaMail.yahoo@mail.yahoo.com>
References: <1874493200.3819699.1435048089716.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150623174151.GD2640@nicira.com>

On Tue, Jun 23, 2015 at 08:28:09AM +0000, r devarajan wrote:
> Hello,Â Â  Â  Â  Â  Â  Â  Â I'd like to know if you can increment the registers ie:Â load:0x001122334455->NXM_NX_REG1[0..15]
> and then after this can I do something to increment NXM_NX_REG1 Â ?

OVS doesn't have a feature for that.

From blp at nicira.com  Tue Jun 23 10:45:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 10:45:16 -0700
Subject: [ovs-discuss] QoS removal from port and database
In-Reply-To: <CD7C01071941AC429549C17338DB8A526AC392A7@IRSMSX101.ger.corp.intel.com>
References: <CD7C01071941AC429549C17338DB8A526AC392A7@IRSMSX101.ger.corp.intel.com>
Message-ID: <20150623174516.GE2640@nicira.com>

On Thu, Jun 18, 2015 at 02:19:40PM +0000, Stokes, Ian wrote:
> Hi All,
> 
> I have been experimenting with Openvswitch and QoS. I have a question regarding how an existing QoS configuration on a port is removed.
> 
> I setup QoS on an existing port with the following command
> 
> sudo ovs-vsctl -- set PortÂ $IF_NAMEÂ qos=@newqos -- \
> Â Â Â  --id=@newqos create QoS type=linux-htb other-config:max-rate=4000000 queues=0=@q0 -- \
> Â Â Â  --id=@q0 create Queue other-config:min-rate=4000000 other-config:max-rate=4000000
> 
> This gives me the _uuid of both the QoS and Queue entry
> 
> 0b62cfb0-c335-45ca-8910-ca4030ea13af
> 24ff16d8-926e-4c12-aad8-b7b06c6ec575
> 
> When I send traffic I can see that QoS is indeed configured.
> 
> I then remove the QoS configuration on the port with the following command
> 
> sudo ovs-vsctl clear PortÂ $IF_NAMEÂ qos
> 
> I can see that QoS is no longer active on the port as the throughput is no longer being limited.
> 
> However when I check the database to see if QoS has been removed the QoS table entry is still present along with the queue entry.
> 
> sudo ovs-vsctl list qos
> _uuid               : 0b62cfb0-c335-45ca-8910-ca4030ea13af
> external_ids        : {}
> other_config        : {max-rate="4000000"}
> queues              : {0=24ff16d8-926e-4c12-aad8-b7b06c6ec575}
> type                : linux-htb
> 
> To remove these entries I have to complete an additional step as follows for both QoS and queue
> 
> sudo ovs-vsctl  --  destroy  qos 0b62cfb0-c335-45ca-8910-ca4030ea13af
> sudo ovs-vsctl  --  destroy  queue 24ff16d8-926e-4c12-aad8-b7b06c6ec575
> 
> Previously I assumed that clearing QoS from the port with my first command would automatically clear the database QoS entry as well but it would seem that this is not the case. Is this behavior expected?
> 
> I have also seen similar behavior if I destroy the QoS record first. Although the record will no longer be in the database it seems that the port is still configured for QoS until I call clear PortÂ $IF_NAMEÂ qos.
> 
> Appreciate any insight on this.

This behavior is documented in ovs-ofctl(8).  Search for "QoS" and
you'll find explanations and examples.

From blp at nicira.com  Tue Jun 23 10:45:36 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 10:45:36 -0700
Subject: [ovs-discuss] QoS removal from port and database
In-Reply-To: <20150623174516.GE2640@nicira.com>
References: <CD7C01071941AC429549C17338DB8A526AC392A7@IRSMSX101.ger.corp.intel.com>
 <20150623174516.GE2640@nicira.com>
Message-ID: <20150623174536.GF2640@nicira.com>

On Tue, Jun 23, 2015 at 10:45:16AM -0700, Ben Pfaff wrote:
> On Thu, Jun 18, 2015 at 02:19:40PM +0000, Stokes, Ian wrote:
> > Hi All,
> > 
> > I have been experimenting with Openvswitch and QoS. I have a question regarding how an existing QoS configuration on a port is removed.
> > 
> > I setup QoS on an existing port with the following command
> > 
> > sudo ovs-vsctl -- set PortÂ $IF_NAMEÂ qos=@newqos -- \
> > Â Â Â  --id=@newqos create QoS type=linux-htb other-config:max-rate=4000000 queues=0=@q0 -- \
> > Â Â Â  --id=@q0 create Queue other-config:min-rate=4000000 other-config:max-rate=4000000
> > 
> > This gives me the _uuid of both the QoS and Queue entry
> > 
> > 0b62cfb0-c335-45ca-8910-ca4030ea13af
> > 24ff16d8-926e-4c12-aad8-b7b06c6ec575
> > 
> > When I send traffic I can see that QoS is indeed configured.
> > 
> > I then remove the QoS configuration on the port with the following command
> > 
> > sudo ovs-vsctl clear PortÂ $IF_NAMEÂ qos
> > 
> > I can see that QoS is no longer active on the port as the throughput is no longer being limited.
> > 
> > However when I check the database to see if QoS has been removed the QoS table entry is still present along with the queue entry.
> > 
> > sudo ovs-vsctl list qos
> > _uuid               : 0b62cfb0-c335-45ca-8910-ca4030ea13af
> > external_ids        : {}
> > other_config        : {max-rate="4000000"}
> > queues              : {0=24ff16d8-926e-4c12-aad8-b7b06c6ec575}
> > type                : linux-htb
> > 
> > To remove these entries I have to complete an additional step as follows for both QoS and queue
> > 
> > sudo ovs-vsctl  --  destroy  qos 0b62cfb0-c335-45ca-8910-ca4030ea13af
> > sudo ovs-vsctl  --  destroy  queue 24ff16d8-926e-4c12-aad8-b7b06c6ec575
> > 
> > Previously I assumed that clearing QoS from the port with my first command would automatically clear the database QoS entry as well but it would seem that this is not the case. Is this behavior expected?
> > 
> > I have also seen similar behavior if I destroy the QoS record first. Although the record will no longer be in the database it seems that the port is still configured for QoS until I call clear PortÂ $IF_NAMEÂ qos.
> > 
> > Appreciate any insight on this.
> 
> This behavior is documented in ovs-ofctl(8).  Search for "QoS" and
> you'll find explanations and examples.

Excuse me, that's ovs-vsctl(8).

From aatteka at nicira.com  Tue Jun 23 11:49:25 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Tue, 23 Jun 2015 11:49:25 -0700
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
In-Reply-To: <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>
References: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
 <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
 <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>
 <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>
Message-ID: <CAA=3Oqns0TUfhWEHSJKB_DcWTbB7XO7kuh5RTbAKDCBX-UNuFw@mail.gmail.com>

On Tue, Jun 23, 2015 at 2:40 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> I thought OVS takes total control on the interfaces it handles.

Could you define "total control"?

> How to stop this "DHCP request" messages?

It is not Open vSwitch that chooses whether DHCP client will be
running for particular network interface. For example on Ubuntu 15.04,
If I do

ps -Af | grep dhclient
root      1011   773  0 Jun22 ?        00:00:00 /sbin/dhclient -d -q
-sf /usr/lib/NetworkManager/nm-dhcp-helper -pf
/run/sendsigs.omit.d/network-manager.dhclient-wlan0.pid -lf
/var/lib/NetworkManager/dhclient-cfb34368-76b5-4d00-93e0-6499bd8cf2cc-wlan0.lease
-cf /var/lib/NetworkManager/dhclient-wlan0.conf wlan0
root     12214   773  0 11:30 ?        00:00:00 /sbin/dhclient -d -q
-sf /usr/lib/NetworkManager/nm-dhcp-helper -pf
/run/sendsigs.omit.d/network-manager.dhclient-eth0.pid -lf
/var/lib/NetworkManager/dhclient-0e5f5c89-6b38-4564-941f-f7aa54b4deae-eth0.lease
-cf /var/lib/NetworkManager/dhclient-eth0.conf eth0

And then search for parent process (773 in my case):
root       773     1  0 Jun22 ?        00:00:22
/usr/sbin/NetworkManager --no-daemon

It says that it is NetworkManager that started dhclient (and not any
of Open vSwitch processes). So, if you don't want to run DHCP client
on OVS interfaces, then make sure that you are using the right Network
Manager configuration -
http://support.qacafe.com/knowledge-base/how-do-i-prevent-network-manager-from-controlling-an-interface/

>
> Thanks,
> Hardik Soni
>
> ----- Original Message -----
>> From: "Gurucharan Shetty" <shettyg at nicira.com>
>> To: "Hardik Soni" <hardik.soni at inria.fr>
>> Cc: "discuss at openvswitch.org discuss" <discuss at openvswitch.org>
>> Sent: Monday, 22 June, 2015 7:56:44 PM
>> Subject: Re: [ovs-discuss] dhcp request originating from interfaces attached to OVS
>>
>> On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
>> > Hi All,
>> >
>> > Is there any possibility that OVS allows DHCP request (broadcast)
>> > originating from the interfaces(mostly virtual interfaces like tap/tunnel)
>> > controlled by itself?
>> Yes. That is possible.
>>
>>
>> > The NetworkManager is running on the system, is there any possibility that
>> > NM is trying assign IP to the interfaces controlled by OVS?
>> That is possible too.
>>
>> >
>> > Thanks,
>> > Hardik Soni
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From hardik.soni at inria.fr  Tue Jun 23 12:19:39 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Tue, 23 Jun 2015 21:19:39 +0200 (CEST)
Subject: [ovs-discuss] dhcp request originating from interfaces attached
 to OVS
In-Reply-To: <CAA=3Oqns0TUfhWEHSJKB_DcWTbB7XO7kuh5RTbAKDCBX-UNuFw@mail.gmail.com>
References: <1251608955.2049972.1434993887248.JavaMail.zimbra@inria.fr>
 <1670088231.2053254.1434995682838.JavaMail.zimbra@inria.fr>
 <CAHbON5rLgpJBBjGYXwEZPhGxxriATcccknc1PoLTnAB_==qRxA@mail.gmail.com>
 <739884375.2214006.1435052409983.JavaMail.zimbra@inria.fr>
 <CAA=3Oqns0TUfhWEHSJKB_DcWTbB7XO7kuh5RTbAKDCBX-UNuFw@mail.gmail.com>
Message-ID: <1491054752.2394085.1435087179165.JavaMail.zimbra@inria.fr>

Yes, I stopped network manager from running DHCP client on OVS interfaces.

By total control, I meant no other local process can see/write to the OVS controlled interfaces.
I was wrong in my understanding.


Thanks,
Hardik Soni

----- Original Message -----
> From: "Ansis Atteka" <aatteka at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: "Gurucharan Shetty" <shettyg at nicira.com>, "discuss at openvswitch.org discuss" <discuss at openvswitch.org>
> Sent: Tuesday, 23 June, 2015 8:49:25 PM
> Subject: Re: [ovs-discuss] dhcp request originating from interfaces attached to OVS
> 
> On Tue, Jun 23, 2015 at 2:40 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> > I thought OVS takes total control on the interfaces it handles.
> 
> Could you define "total control"?
> 
> > How to stop this "DHCP request" messages?
> 
> It is not Open vSwitch that chooses whether DHCP client will be
> running for particular network interface. For example on Ubuntu 15.04,
> If I do
> 
> ps -Af | grep dhclient
> root      1011   773  0 Jun22 ?        00:00:00 /sbin/dhclient -d -q
> -sf /usr/lib/NetworkManager/nm-dhcp-helper -pf
> /run/sendsigs.omit.d/network-manager.dhclient-wlan0.pid -lf
> /var/lib/NetworkManager/dhclient-cfb34368-76b5-4d00-93e0-6499bd8cf2cc-wlan0.lease
> -cf /var/lib/NetworkManager/dhclient-wlan0.conf wlan0
> root     12214   773  0 11:30 ?        00:00:00 /sbin/dhclient -d -q
> -sf /usr/lib/NetworkManager/nm-dhcp-helper -pf
> /run/sendsigs.omit.d/network-manager.dhclient-eth0.pid -lf
> /var/lib/NetworkManager/dhclient-0e5f5c89-6b38-4564-941f-f7aa54b4deae-eth0.lease
> -cf /var/lib/NetworkManager/dhclient-eth0.conf eth0
> 
> And then search for parent process (773 in my case):
> root       773     1  0 Jun22 ?        00:00:22
> /usr/sbin/NetworkManager --no-daemon
> 
> It says that it is NetworkManager that started dhclient (and not any
> of Open vSwitch processes). So, if you don't want to run DHCP client
> on OVS interfaces, then make sure that you are using the right Network
> Manager configuration -
> http://support.qacafe.com/knowledge-base/how-do-i-prevent-network-manager-from-controlling-an-interface/
> 
> >
> > Thanks,
> > Hardik Soni
> >
> > ----- Original Message -----
> >> From: "Gurucharan Shetty" <shettyg at nicira.com>
> >> To: "Hardik Soni" <hardik.soni at inria.fr>
> >> Cc: "discuss at openvswitch.org discuss" <discuss at openvswitch.org>
> >> Sent: Monday, 22 June, 2015 7:56:44 PM
> >> Subject: Re: [ovs-discuss] dhcp request originating from interfaces
> >> attached to OVS
> >>
> >> On Mon, Jun 22, 2015 at 10:54 AM, Hardik Soni <hardik.soni at inria.fr>
> >> wrote:
> >> > Hi All,
> >> >
> >> > Is there any possibility that OVS allows DHCP request (broadcast)
> >> > originating from the interfaces(mostly virtual interfaces like
> >> > tap/tunnel)
> >> > controlled by itself?
> >> Yes. That is possible.
> >>
> >>
> >> > The NetworkManager is running on the system, is there any possibility
> >> > that
> >> > NM is trying assign IP to the interfaces controlled by OVS?
> >> That is possible too.
> >>
> >> >
> >> > Thanks,
> >> > Hardik Soni
> >> >
> >> >
> >> > _______________________________________________
> >> > discuss mailing list
> >> > discuss at openvswitch.org
> >> > http://openvswitch.org/mailman/listinfo/discuss
> >> >
> >>
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> 

From zhangcy at cn.fujitsu.com  Tue Jun 23 19:13:40 2015
From: zhangcy at cn.fujitsu.com (Zhang, Chunyu)
Date: Wed, 24 Jun 2015 02:13:40 +0000
Subject: [ovs-discuss] how to use ovs-conntrack
References: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>, 
 <FBC0CB48-3723-4DC4-94F1-4D3E0A439CBE@nicira.com>
Message-ID: <A43879EB4A7F5F449E2CA8148EA79E518A50BA@G08CNEXMBPEKD01.g08.fujitsu.local>

hi Justin
>
>> On Jun 23, 2015, at 12:37 PM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
>>
>> hi  all
>>
>> i want to use ovs-conntrack.
>> i know ovs is in : https://github.com/justinpettit/ovs/tree/conntrack
>> i know kernel module should change : https://lkml.org/lkml/2015/3/2/835
>>
>> my question is :
>>
>> 1.  ovs-conntrack use
>> should i use those patch ? https://lkml.org/lkml/2015/3/2/835
>
>I would use the OVS repo.  Those were RFC patches and represent the code on that day.  The OVS repo is more current (there have been a number of bug fixes) and also contains the userspace parts that you need.
>
>> 2. if i must use those kernel patch
>> github( kernel+ovs kernel patch ) address is ?
>
>As I mentioned, I'd recommend using the OVS repo, which has all the parts you need.  It should be rebased against OVS master in the next couple of days.  I imagine an updated kernel portion will be sent out to netdev in the next few weeks.
I found 2 ovs repo in Kernel.org git repositories
1. https://git.kernel.org/cgit/linux/kernel/git/pshelar/openvswitch.git/?h=net_next_ovs
2. https://git.kernel.org/cgit/linux/kernel/git/jesse/openvswitch.git/
which one you will push ?
I git clone net_next_ovs, but not find any kernel patch for ovs-conntrack

thanks
>
>> 3. ovs-ofctl command
>> in our project , we use nf_conntrack extension :
>>
>> static struct nf_ct_ext_type nf_ct_colo_extend __read_mostly = {
>>      .len        = sizeof(struct nf_conn_colo),
>>      .move       = nf_ct_colo_extend_move,
>>      .destroy    = nf_ct_colo_extend_destroy,
>>      .align      = __alignof__(struct nf_conn_colo),
>>      .id              = NF_CT_EXT_COLO,
>> };
>>
>> if i want to nf_conntrack extension work.
>> ovs-ofctl command is ?
>> please give me some example and advise
>
>If you use the OVS repo, the man pages for ovs-ofctl were updated.  Look for the new "ct" action and "conn_state" match.
>
>--Justin
>
>

From jesse at nicira.com  Tue Jun 23 19:16:42 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 23 Jun 2015 19:16:42 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
Message-ID: <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>

On Fri, Jun 19, 2015 at 1:52 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
>
>
> Greetings,
>
>
>
> I am currently running
>
> 3.16.0-4-amd64
>
> No LSB modules are available.
>
> Distributor ID: Debian
>
> Description:    Debian GNU/Linux 8.1 (jessie)
>
> Release:        8.1
>
> Codename:       jessie
>
> ovs-vsctl (Open vSwitch) 2.3.1
>
> Compiled Jun 15 2015 19:30:36
>
> DB Schema 7.6.2
>
> libvirtd (libvirt) 1.2.9
>
>
>
> and I am seeing an MTU issue where packets coming in from the physical side
> are vanilla 1500Bytes
>
> Once it gets to the virtual NIC I see the following in dmesg:
>
>
>
> [ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500
>
> [ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500
>
>
>
> If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502 things
> will flow
>
> Otherwise mant protocols with full sized packets will see timeout.
>
>
>
> Wireshark loaded on the client didnâ€™t help, as a trace done on the client
> itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as 1500.
>
>
>
> I think OVS must be doing something that added a tag to the packets.
>
> Anyone with the same observation?

I've never heard of this problem before and there were two threads
started on it within 10 minutes, so I'm combining them together on the
assumption that they are somehow related.

It's not really obvious to me how or why OVS would be increasing the
size of the packet by 1 or 2 bytes, especially if the packet is just
flowing through. As I said, I've never heard this reported before. In
the other message, it looks like OVS should be removing a VLAN tag. Is
that true in both cases?

Similarly, in the other thread, it looks the MTUs of the physical
interfaces are 9000, which makes it seems like it is possible that
these packets are actually coming across the wire. What happens if the
MTUs are all the same, as required by Ethernet specs?

Finally, it would be helpful to try this with the Linux bridge instead
of OVS, if possible, since it seems likely that the cause may be
another component.

From Kavitha_Ramalingham at Dell.com  Tue Jun 23 20:48:18 2015
From: Kavitha_Ramalingham at Dell.com (Kavitha_Ramalingham at Dell.com)
Date: Wed, 24 Jun 2015 09:18:18 +0530
Subject: [ovs-discuss] Groups within groups
In-Reply-To: <20150623153529.GH31446@nicira.com>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>
 <20150623153529.GH31446@nicira.com>
Message-ID: <D5A6F3355F664C40AFB65BB1277D8D45040CA601C1@MAAX7MCDC101.APAC.DELL.COM>

Dell - Internal Use - Confidential
Thank you Ben for your quick response. Is there any feature # that I could use if for reference for this enhancement work.

Thanks and Regards
R. Kavitha

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: Tuesday, June 23, 2015 9:05 PM
To: Ramalingham, Kavitha
Cc: bugs at openvswitch.org; K, Kalaiselvi; Sindagi, Rajesh; Venkataraghavan, C; Balasubram, Vasanthan; Manivasagam, Mahesh
Subject: Re: [ovs-discuss] Groups within groups

On Tue, Jun 23, 2015 at 03:48:38PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> We always see that the traffic is not sent out of the ports described
> in the flows, when a flow uses a Group ID that in turn uses another
> group ID in the "actions" qualifier. This appears to be a bug. Can you
> pl. look into it.

OpenFlow doesn't require support of group chaining. OVS 2.4 and earlier don't support group chaining, but OVS 2.5 will.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/808222dd/attachment.html>

From contact at progbau.de  Tue Jun 23 20:51:56 2015
From: contact at progbau.de (Chris)
Date: Wed, 24 Jun 2015 10:51:56 +0700
Subject: [ovs-discuss] Openvswitch network disconnect
In-Reply-To: <CAArS4XXLwUMJdipDCxzYnyozu3Hn+5YSEcPCsTJ6WQATzfuhrA@mail.gmail.com>
References: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
 <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>
 <062201d09e93$16df04c0$449d0e40$@progbau.de>
 <CAArS4XXLwUMJdipDCxzYnyozu3Hn+5YSEcPCsTJ6WQATzfuhrA@mail.gmail.com>
Message-ID: <02cc01d0ae31$1fdd9430$5f98bc90$@progbau.de>

Hello Alex,

 

It happened again and I got some gdp traces, please see the output in the attachment.

During the gdb session the openvswitch started working again, so Iâ€™m not sure if I got the right point.

 

Please have a look and let me know if you need additional information. 

Thanks in advance!

 

Cheers

Chris

 

From: Alex Wang [mailto:alexw at nicira.com] 
Sent: Thursday, June 04, 2015 14:00
To: Chris
Cc: discuss at openvswitch.org; openstack at lists.openstack.org; Soputhi Sea
Subject: Re: [ovs-discuss] Openvswitch network disconnect

 

Thx for the info, I'll try reproduce it on my local setup using active-backup

bond.  And use it as managment interface,

 

Will update if I run into the same issue~

 

Thanks,

Alex Wang,

 

On Wed, Jun 3, 2015 at 11:52 PM, Chris <contact at progbau.de <mailto:contact at progbau.de> > wrote:

Hello Alex,

 

I will do the gdb debug when it happens again. 

 

Here the output, in this case there are 4 VMs running on the host. The physical interfaces eth2 & eth3 are in active-passive mode bonded to bond0. mgmt0 is used for the management of the host system. Anything else is created by OpenStack.

The failure happens independent from the number of VMs running on the host: 

 

ovs-vsctl show

fbbaf640-ed82-4735-99d2-fbe09f4041f1

    Bridge "br-bond0"

        Port "mgmt0"

            Interface "mgmt0"

                type: internal

        Port "br-bond0"

            Interface "br-bond0"

                type: internal

        Port "phy-br-bond0"

            Interface "phy-br-bond0"

        Port "bond0"

            Interface "eth2"

            Interface "eth3"

    Bridge br-int

        fail_mode: secure

        Port br-int

            Interface br-int

                type: internal

        Port "qvo4166dc0a-69"

            tag: 1

            Interface "qvo4166dc0a-69"

        Port "qvo6d8b70de-9c"

            tag: 1

            Interface "qvo6d8b70de-9c"

        Port "qvoe75237cc-7f"

            tag: 1

            Interface "qvoe75237cc-7f"

        Port "qvoe3b9e1fc-a5"

            tag: 1

            Interface "qvoe3b9e1fc-a5"

        Port "int-br-bond0"

            Interface "int-br-bond0"

    ovs_version: "2.3.0"

 

ip a

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN

    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00

    inet 127.0.0.1/8 <http://127.0.0.1/8>  scope host lo

2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000

    link/ether 9c:b6:54:b3:67:34 brd ff:ff:ff:ff:ff:ff

3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000

    link/ether 9c:b6:54:b3:67:35 brd ff:ff:ff:ff:ff:ff

4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000

    link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff

5: eth3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000

    link/ether 64:51:06:f0:85:9c brd ff:ff:ff:ff:ff:ff

6: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether de:76:ca:6d:57:48 brd ff:ff:ff:ff:ff:ff

7: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether ee:f8:2f:ef:94:42 brd ff:ff:ff:ff:ff:ff

8: br-bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff

15: mgmt0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether fa:e1:51:33:5d:dc brd ff:ff:ff:ff:ff:ff

    inet 10.201.195.75/24 <http://10.201.195.75/24>  brd 10.201.195.255 scope global mgmt0

16: qbr4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff

17: qvo4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether ae:27:12:55:09:0c brd ff:ff:ff:ff:ff:ff

18: qvb4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff

19: tap4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:d6:34:82 brd ff:ff:ff:ff:ff:ff

20: qbre75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff

21: qvoe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 1e:7f:f4:57:aa:82 brd ff:ff:ff:ff:ff:ff

22: qvbe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff

23: tape75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:02:a4:d7 brd ff:ff:ff:ff:ff:ff

24: qbre3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff

25: qvoe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c6:5f:19:25:7c:be brd ff:ff:ff:ff:ff:ff

26: qvbe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff

27: tape3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:bb:a7:19 brd ff:ff:ff:ff:ff:ff

28: qbr6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN

    link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff

29: qvo6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 46:23:9e:4b:2a:fd brd ff:ff:ff:ff:ff:ff

30: qvb6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff

31: tap6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500

    link/ether fe:16:3e:40:9e:44 brd ff:ff:ff:ff:ff:ff

32: bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN

    link/ether f6:83:30:bc:4c:7c brd ff:ff:ff:ff:ff:ff

35: phy-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 76:51:9d:bd:24:83 brd ff:ff:ff:ff:ff:ff

36: int-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000

    link/ether 5e:fa:05:2a:1a:ef brd ff:ff:ff:ff:ff:ff

 

 

Cheers,

Chris

 

 

From: Alex Wang [mailto:alexw at nicira.com <mailto:alexw at nicira.com> ] 
Sent: Thursday, June 04, 2015 13:29
To: Chris
Cc: discuss at openvswitch.org <mailto:discuss at openvswitch.org> ; openstack at lists.openstack.org <mailto:openstack at lists.openstack.org> ; Soputhi Sea
Subject: Re: [ovs-discuss] Openvswitch network disconnect

 

 

 

On Wed, Jun 3, 2015 at 11:16 PM, Chris <contact at progbau.de <mailto:contact at progbau.de> > wrote:

Hello,

We are using Openvswitch in our Openstack setup.

ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.0
Compiled Oct 28 2014 17:48:05
OpenFlow versions 0x1:0x1

We experience openvswitch failures from time to time. It seems to happen
random, no network traffic spikes for example.
The VM ports and the openvswitch port for the host management just stop
working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
still running

For debug purpose the following commands has been executed:

- "ovs-vsctl show" the interfaces are still listed
The ones below didn't show any result and just hang after the execution:
- ovs-appctl bond/show bond0
- ovs-appctl vlog/list
- ovs-ofctl dump-flows br-bond0

 

 

This seems to indicate that the ovs-vswitchd process is dead locked...

I could not find comment in branch-2.3 that relates to dead lock.  It would be

helpful if you can gdb into the running ovs-vswitchd process and provide

the backtraces when there is a failure.

 

Or could I know what your setup looks like (ovs-vsctl show output)?

 

Thanks,

Alex Wang,

 

 

 

A "service openvswitch restart" fix it, the connection from the VMs and the
host are back immediately.

Any help appreciated!

Cheers,
Chris



_______________________________________________
discuss mailing list
discuss at openvswitch.org <mailto:discuss at openvswitch.org> 
http://openvswitch.org/mailman/listinfo/discuss

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/b17ab35e/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: gdb-session.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/b17ab35e/attachment-0001.txt>

From blp at nicira.com  Tue Jun 23 20:58:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 23 Jun 2015 20:58:24 -0700
Subject: [ovs-discuss] Groups within groups
In-Reply-To: <D5A6F3355F664C40AFB65BB1277D8D45040CA601C1@MAAX7MCDC101.APAC.DELL.COM>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>
 <20150623153529.GH31446@nicira.com>
 <D5A6F3355F664C40AFB65BB1277D8D45040CA601C1@MAAX7MCDC101.APAC.DELL.COM>
Message-ID: <20150624035824.GF15630@nicira.com>

On Wed, Jun 24, 2015 at 09:18:18AM +0530, Kavitha_Ramalingham at Dell.com wrote:
> Thank you Ben for your quick response. Is there any feature # that I
> could use if for reference for this enhancement work.

I don't have a feature number but the following commit, which is on the
OVS "master" branch, implements the feature.

--8<--------------------------cut here-------------------------->8--

From: Ben Pfaff <blp at nicira.com>
Date: Mon, 22 Jun 2015 15:15:40 -0700
Subject: [PATCH] ofproto-dpif-xlate: Add support for OpenFlow group chaining.

Requested-by: Vinllen Chen <cvinllen at gmail.com>
Signed-off-by: Ben Pfaff <blp at nicira.com>
Acked-by: Alex Wang <alexw at nicira.com>
---
 AUTHORS                      |  1 +
 NEWS                         |  3 +++
 ofproto/ofproto-dpif-xlate.c | 29 +++--------------------------
 ofproto/ofproto-dpif.c       | 13 -------------
 tests/ofproto-dpif.at        | 12 +++++++-----
 5 files changed, 14 insertions(+), 44 deletions(-)

diff --git a/AUTHORS b/AUTHORS
index d439fda..2240576 100644
--- a/AUTHORS
+++ b/AUTHORS
@@ -356,6 +356,7 @@ Torbjorn Tornkvist      kruskakli at gmail.com
 Valentin Bud            valentin at hackaserver.com
 Vasiliy Tolstov         v.tolstov at selfip.ru
 Vasu Dasari             vdasari at gmail.com
+Vinllen Chen            cvinllen at gmail.com
 Vishal Swarankar        vishal.swarnkar at gmail.com
 Vjekoslav Brajkovic     balkan at cs.washington.edu
 Voravit T.              voravit at kth.se
diff --git a/NEWS b/NEWS
index e9d1afa..a0664dc 100644
--- a/NEWS
+++ b/NEWS
@@ -1,5 +1,8 @@
 Post-v2.4.0
 ---------------------
+   - OpenFlow:
+     * Group chaining (where one OpenFlow group triggers another) is
+       now supported.
 
 
 v2.4.0 - xx xxx xxxx
diff --git a/ofproto/ofproto-dpif-xlate.c b/ofproto/ofproto-dpif-xlate.c
index d3ae567..8c68273 100644
--- a/ofproto/ofproto-dpif-xlate.c
+++ b/ofproto/ofproto-dpif-xlate.c
@@ -3330,6 +3330,7 @@ xlate_select_group(struct xlate_ctx *ctx, struct group_dpif *group)
 static void
 xlate_group_action__(struct xlate_ctx *ctx, struct group_dpif *group)
 {
+    bool was_in_group = ctx->in_group;
     ctx->in_group = true;
 
     switch (group_dpif_get_type(group)) {
@@ -3348,37 +3349,13 @@ xlate_group_action__(struct xlate_ctx *ctx, struct group_dpif *group)
     }
     group_dpif_unref(group);
 
-    ctx->in_group = false;
-}
-
-static bool
-xlate_group_resource_check(struct xlate_ctx *ctx)
-{
-    if (!xlate_resubmit_resource_check(ctx)) {
-        return false;
-    } else if (ctx->in_group) {
-        /* Prevent nested translation of OpenFlow groups.
-         *
-         * OpenFlow allows this restriction.  We enforce this restriction only
-         * because, with the current architecture, we would otherwise have to
-         * take a possibly recursive read lock on the ofgroup rwlock, which is
-         * unsafe given that POSIX allows taking a read lock to block if there
-         * is a thread blocked on taking the write lock.  Other solutions
-         * without this restriction are also possible, but seem unwarranted
-         * given the current limited use of groups. */
-        static struct vlog_rate_limit rl = VLOG_RATE_LIMIT_INIT(1, 1);
-
-        VLOG_ERR_RL(&rl, "cannot recursively translate OpenFlow group");
-        return false;
-    } else {
-        return true;
-    }
+    ctx->in_group = was_in_group;
 }
 
 static bool
 xlate_group_action(struct xlate_ctx *ctx, uint32_t group_id)
 {
-    if (xlate_group_resource_check(ctx)) {
+    if (xlate_resubmit_resource_check(ctx)) {
         struct group_dpif *group;
         bool got_group;
 
diff --git a/ofproto/ofproto-dpif.c b/ofproto/ofproto-dpif.c
index 8e68b0a..05a80b7 100644
--- a/ofproto/ofproto-dpif.c
+++ b/ofproto/ofproto-dpif.c
@@ -4105,19 +4105,6 @@ static enum ofperr
 group_construct(struct ofgroup *group_)
 {
     struct group_dpif *group = group_dpif_cast(group_);
-    const struct ofputil_bucket *bucket;
-
-    /* Prevent group chaining because our locking structure makes it hard to
-     * implement deadlock-free.  (See xlate_group_resource_check().) */
-    LIST_FOR_EACH (bucket, list_node, &group->up.buckets) {
-        const struct ofpact *a;
-
-        OFPACT_FOR_EACH (a, bucket->ofpacts, bucket->ofpacts_len) {
-            if (a->type == OFPACT_GROUP) {
-                return OFPERR_OFPGMFC_CHAINING_UNSUPPORTED;
-            }
-        }
-    }
 
     ovs_mutex_init_adaptive(&group->stats_mutex);
     ovs_mutex_lock(&group->stats_mutex);
diff --git a/tests/ofproto-dpif.at b/tests/ofproto-dpif.at
index bd1b21c..7f20786 100644
--- a/tests/ofproto-dpif.at
+++ b/tests/ofproto-dpif.at
@@ -294,13 +294,15 @@ Datapath actions: 10,set(tcp(src=91)),11
 OVS_VSWITCHD_STOP
 AT_CLEANUP
 
-AT_SETUP([ofproto-dpif - group chaining not supported])
+AT_SETUP([ofproto-dpif - group chaining])
 OVS_VSWITCHD_START
 ADD_OF_PORTS([br0], [1], [10], [11])
-AT_CHECK([ovs-ofctl -O OpenFlow12 add-group br0 'group_id=1234,type=all,bucket=output:10,set_field:192.168.3.90->ip_src,group:123,bucket=output:11'],
-  [1], [], [stderr])
-AT_CHECK([STRIP_XIDS stderr | sed 1q], [0],
-  [OFPT_ERROR (OF1.2): OFPGMFC_CHAINING_UNSUPPORTED
+AT_CHECK([ovs-ofctl -O OpenFlow12 add-group br0 'group_id=1234,type=all,bucket=set_field:192.168.3.90->ip_src,group:123,bucket=output:11'])
+AT_CHECK([ovs-ofctl -O OpenFlow12 add-group br0 'group_id=123,type=all,bucket=output:10'])
+AT_CHECK([ovs-ofctl -O OpenFlow12 add-flow br0 'ip actions=group:1234'])
+AT_CHECK([ovs-appctl ofproto/trace br0 'in_port=1,dl_src=50:54:00:00:00:05,dl_dst=50:54:00:00:00:07,dl_type=0x0800,nw_src=192.168.0.1,nw_dst=192.168.0.2,nw_proto=1,nw_tos=0,nw_ttl=128,icmp_type=8,icmp_code=0'], [0], [stdout])
+AT_CHECK([tail -1 stdout], [0],
+  [Datapath actions: set(ipv4(src=192.168.3.90)),10,set(ipv4(src=192.168.0.1)),11
 ])
 OVS_VSWITCHD_STOP
 AT_CLEANUP
-- 
2.1.3


From Kavitha_Ramalingham at Dell.com  Tue Jun 23 20:53:09 2015
From: Kavitha_Ramalingham at Dell.com (Kavitha_Ramalingham at Dell.com)
Date: Wed, 24 Jun 2015 09:23:09 +0530
Subject: [ovs-discuss] Groups within groups
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA60052@MAAX7MCDC101.APAC.DELL.COM>
 <20150623153529.GH31446@nicira.com> 
Message-ID: <D5A6F3355F664C40AFB65BB1277D8D45040CA601C5@MAAX7MCDC101.APAC.DELL.COM>


Thank you Ben for your quick response. Is there any feature # that I could use if for reference for this enhancement work.

Thanks and Regards
R. Kavitha

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: Tuesday, June 23, 2015 9:05 PM
To: Ramalingham, Kavitha
Cc: bugs at openvswitch.org<mailto:bugs at openvswitch.org>; K, Kalaiselvi; Sindagi, Rajesh; Venkataraghavan, C; Balasubram, Vasanthan; Manivasagam, Mahesh
Subject: Re: [ovs-discuss] Groups within groups

On Tue, Jun 23, 2015 at 03:48:38PM +0530, Kavitha_Ramalingham at Dell.com<mailto:Kavitha_Ramalingham at Dell.com> wrote:
> We always see that the traffic is not sent out of the ports described
> in the flows, when a flow uses a Group ID that in turn uses another
> group ID in the "actions" qualifier. This appears to be a bug. Can you
> pl. look into it.

OpenFlow doesn't require support of group chaining. OVS 2.4 and earlier don't support group chaining, but OVS 2.5 will.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/1e12de24/attachment.html>

From C_Venkataraghavan at DELL.com  Tue Jun 23 10:01:24 2015
From: C_Venkataraghavan at DELL.com (C_Venkataraghavan at DELL.com)
Date: Tue, 23 Jun 2015 17:01:24 +0000
Subject: [ovs-discuss] Issue with Broadcast Group
In-Reply-To: <20150623155209.GL31446@nicira.com>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>
 <20150623155209.GL31446@nicira.com>
Message-ID: <F7F9C3835CC5DD4B95CDEB03319E713816ECFE8E@KULX10HMDC101.APAC.DELL.COM>

Dell - Internal Use - Confidential
Hi Ben,
If we use group type "indirect" instead of "all", multiple egress ports in output action would still fail, right?

thanks

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: Tuesday, June 23, 2015 9:22 PM
To: Ramalingham, Kavitha
Cc: bugs at openvswitch.org; K, Kalaiselvi; Sindagi, Rajesh; Venkataraghavan, C; Balasubram, Vasanthan; Manivasagam, Mahesh
Subject: Re: [ovs-discuss] Issue with Broadcast Group

On Tue, Jun 23, 2015 at 03:42:33PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> I tested with the below mentioned topology, having a broadcast flow
> whose actions were set to broadcast group ID. When I tried to ping
> from host h1 to h2, ARP request packet is sent out to only one port
> and not to all ports. We have created a group of type "all" with the
> egress ports set to port3 and port4. The expectation here is that any
> flow that uses this group has to egress the traffic on both the ports.
> In the below tcpdump capture you can see that ARP-Request traffic goes
> out of port4 and not thro' port3.

Your "all" group has one bucket with two output actions. That's a mistake, because OpenFlow says that the actions in a bucket are an "action set", meaning that only one action of each type can be effective. The solution is to use two buckets, each with one output action.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150623/4bb2707c/attachment-0001.html>

From jvb127 at gmail.com  Tue Jun 23 13:30:46 2015
From: jvb127 at gmail.com (Jeroen van Bemmel)
Date: Tue, 23 Jun 2015 15:30:46 -0500
Subject: [ovs-discuss] Issue with symmetric flow hashing in
 'flow_hash_symmetric_l4' when including MACs
Message-ID: <CAOpSVYp8A9KknkZLTSCGjPGhr7mo7zPVQfGzkhtY-aVuc_UCEQ@mail.gmail.com>

All,

'flow_hash_symmetric_l4' in flow.c currently includes L2 information (
MAC addresses and VLAN ID) in the hash. However, in certain cases (
e.g. flow to a VRRP IP address on a router ), the MAC addresses for
the return flow are not symmetrical ( because a virtual MAC is used
for VRRP, whereas a physical interface MAC is used for the return
packet )

Why are the MAC addresses included in the hash for IP flows?

Regards,
Jeroen van Bemmel - Nuage Networks

From C_Venkataraghavan at DELL.com  Tue Jun 23 17:55:26 2015
From: C_Venkataraghavan at DELL.com (C_Venkataraghavan at DELL.com)
Date: Wed, 24 Jun 2015 00:55:26 +0000
Subject: [ovs-discuss] Issue with Broadcast Group
In-Reply-To: <20150623172430.GA2640@nicira.com>
References: <D5A6F3355F664C40AFB65BB1277D8D45040CA6004F@MAAX7MCDC101.APAC.DELL.COM>
 <20150623155209.GL31446@nicira.com>
 <F7F9C3835CC5DD4B95CDEB03319E713816ECFE8E@KULX10HMDC101.APAC.DELL.COM>
 <20150623172430.GA2640@nicira.com>
Message-ID: <F7F9C3835CC5DD4B95CDEB03319E713816ECFF9B@KULX10HMDC101.APAC.DELL.COM>

Thanks Ben.  I've removed the watermark on this mail.

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: Tuesday, June 23, 2015 10:55 PM
To: Venkataraghavan, C
Cc: Ramalingham, Kavitha; bugs at openvswitch.org; K, Kalaiselvi; Sindagi, Rajesh; Balasubram, Vasanthan; Manivasagam, Mahesh
Subject: Re: [ovs-discuss] Issue with Broadcast Group

I hope you realize that bugs at openvswitch.org is a public mailing list.
Nothing on it can be confidential.

Yes. This is a property of how OpenFlow is defined.

On Tue, Jun 23, 2015 at 05:01:24PM +0000, C_Venkataraghavan at DELL.com wrote:
> Dell - Internal Use - Confidential
> Hi Ben,
> If we use group type "indirect" instead of "all", multiple egress ports in output action would still fail, right?
>
> thanks
>
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Tuesday, June 23, 2015 9:22 PM
> To: Ramalingham, Kavitha
> Cc: bugs at openvswitch.org; K, Kalaiselvi; Sindagi, Rajesh;
> Venkataraghavan, C; Balasubram, Vasanthan; Manivasagam, Mahesh
> Subject: Re: [ovs-discuss] Issue with Broadcast Group
>
> On Tue, Jun 23, 2015 at 03:42:33PM +0530, Kavitha_Ramalingham at Dell.com wrote:
> > I tested with the below mentioned topology, having a broadcast flow
> > whose actions were set to broadcast group ID. When I tried to ping
> > from host h1 to h2, ARP request packet is sent out to only one port
> > and not to all ports. We have created a group of type "all" with the
> > egress ports set to port3 and port4. The expectation here is that
> > any flow that uses this group has to egress the traffic on both the ports.
> > In the below tcpdump capture you can see that ARP-Request traffic
> > goes out of port4 and not thro' port3.
>
> Your "all" group has one bucket with two output actions. That's a mistake, because OpenFlow says that the actions in a bucket are an "action set", meaning that only one action of each type can be effective. The solution is to use two buckets, each with one output action.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/21af3878/attachment-0001.html>

From johnson at snoopy.ORG  Tue Jun 23 20:18:11 2015
From: johnson at snoopy.ORG (Johnson Wu)
Date: Tue, 23 Jun 2015 20:18:11 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
Message-ID: <2D2C4D41-6D28-448F-82F9-687A693ED80D@snoopy.ORG>

It's sheer coincidence that that posts are only 10 min apart.  

In my setup all interfaces have MTU defined to be 1500 before I applied the workaround. 

I tried to do tcpdump on the client to see if the frames received are over 1516 and ip pkts over 1500... Nope

Will try a simple linux bridge and see. 

Thanks. 




Sent from my iPhone


> On Jun 23, 2015, at 7:16 PM, Jesse Gross <jesse at nicira.com> wrote:
> 
>> On Fri, Jun 19, 2015 at 1:52 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
>> 
>> 
>> Greetings,
>> 
>> 
>> 
>> I am currently running
>> 
>> 3.16.0-4-amd64
>> 
>> No LSB modules are available.
>> 
>> Distributor ID: Debian
>> 
>> Description:    Debian GNU/Linux 8.1 (jessie)
>> 
>> Release:        8.1
>> 
>> Codename:       jessie
>> 
>> ovs-vsctl (Open vSwitch) 2.3.1
>> 
>> Compiled Jun 15 2015 19:30:36
>> 
>> DB Schema 7.6.2
>> 
>> libvirtd (libvirt) 1.2.9
>> 
>> 
>> 
>> and I am seeing an MTU issue where packets coming in from the physical side
>> are vanilla 1500Bytes
>> 
>> Once it gets to the virtual NIC I see the following in dmesg:
>> 
>> 
>> 
>> [ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500
>> 
>> [ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500
>> 
>> 
>> 
>> If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502 things
>> will flow
>> 
>> Otherwise mant protocols with full sized packets will see timeout.
>> 
>> 
>> 
>> Wireshark loaded on the client didnâ€™t help, as a trace done on the client
>> itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as 1500.
>> 
>> 
>> 
>> I think OVS must be doing something that added a tag to the packets.
>> 
>> Anyone with the same observation?
> 
> I've never heard of this problem before and there were two threads
> started on it within 10 minutes, so I'm combining them together on the
> assumption that they are somehow related.
> 
> It's not really obvious to me how or why OVS would be increasing the
> size of the packet by 1 or 2 bytes, especially if the packet is just
> flowing through. As I said, I've never heard this reported before. In
> the other message, it looks like OVS should be removing a VLAN tag. Is
> that true in both cases?
> 
> Similarly, in the other thread, it looks the MTUs of the physical
> interfaces are 9000, which makes it seems like it is possible that
> these packets are actually coming across the wire. What happens if the
> MTUs are all the same, as required by Ethernet specs?
> 
> Finally, it would be helpful to try this with the Linux bridge instead
> of OVS, if possible, since it seems likely that the cause may be
> another component.

From vrapelly at sonusnet.com  Tue Jun 23 21:37:00 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Wed, 24 Jun 2015 04:37:00 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <D1AF4783.3520%diproiettod@vmware.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
Message-ID: <BLUPR03MB26422C0E6B8EA4A33E2C61BB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>

Hi Daniele,

Thanks for your reply :)

I'm using openvswitch-2.3.1 and compiled using below set of commands.

export DPDK_DIR=/root/dpdk-1.7.1
cd /root/dpdk-1.7.1
make install T=x86_64-native-linuxapp-gcc
cd /root/openvswitch-2.3.1
export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
./boot.sh
./configure --with-dpdk=$DPDK_BUILD
make

I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to that.

[root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status
Network devices using DPDK-compatible driver
============================================
<none>
Network devices using kernel driver
===================================
0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb unused=
0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=

 [root at artha ~]# ifconfig -a|grep flags
ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500

PFA setup.sh script, for all the cmd which I used to run ovs.

1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the boot line and 1 GB huge page created
2. When I bind igb_uio driver [to 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon [--with dpdk], Ideally it should detect binded PCI device. Am I right?

Please let me know if I'm missing something or something is incorrect

Thanks & Regards,
Varun
-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Tuesday, June 23, 2015 10:16 PM
To: Rapelly, Varun
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] No Ethernet devices found with I350

The commands you're typing seem correct.

Which version of OVS are you using? How are you compiling it?

On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi All,
> 
>IÂ¹m a newbie to openvswitch and I followed the below link to install 
>ovs with DPDK on RHEL7 machine.
> 
>[root at artha ~]# uname -a
>Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014 
>x86_64
>x86_64 x86_64 GNU/Linux
> 
>https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvs
>wit 
>ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJAX
>VeA 
>w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvXwU
>3yO 
>I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-uR
>NfI
>C0hWg&e=>
> 
>When I ran vswitch daemon, it reports following error [I binded igb_uio 
>to the i350 NIC].
> 
>2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try 
>assigning ports to UIO.
>2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> 
>Following PCI bind status.
> 
>[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> 
>Network devices using DPDK-compatible driver 
>============================================
>0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> 
>Network devices using kernel driver
>===================================
>0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3 
>unused=
>0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3 
>unused=
>0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3 
>unused=
>0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3 
>unused=
>0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb 
>unused=
> 
>Other network devices
>=====================
><none>
> 
>Then I created I ovs bridge using below cmd:
>./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
>                  
>
>./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> 
>When I add dpdk port it reports, Â³could not open network device dpdk0 
>(Unknown error -19)Â²
> 
>Please let me know
>1. 
>What could be possible reason for not detecting the interface which is 
>binded to igb_uio?
>2. 
>How to add the port which is binded to igb_uio here?
>
> 
>Thanks in advance.
> 
>Regards,
>Varun
> 
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup.sh
Type: application/octet-stream
Size: 1736 bytes
Desc: setup.sh
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/6e4d7a00/attachment-0001.obj>

From jpettit at nicira.com  Wed Jun 24 01:14:45 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 24 Jun 2015 10:14:45 +0200
Subject: [ovs-discuss] how to use ovs-conntrack
In-Reply-To: <A43879EB4A7F5F449E2CA8148EA79E518A50BA@G08CNEXMBPEKD01.g08.fujitsu.local>
References: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>
 <FBC0CB48-3723-4DC4-94F1-4D3E0A439CBE@nicira.com>
 <A43879EB4A7F5F449E2CA8148EA79E518A50BA@G08CNEXMBPEKD01.g08.fujitsu.local>
Message-ID: <8A95693A-E886-405D-8BE6-19AA8DB41FBB@nicira.com>


> On Jun 24, 2015, at 4:13 AM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
> 
> hi Justin
>> 
>>> On Jun 23, 2015, at 12:37 PM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
>>> 
>>> i want to use ovs-conntrack.
>>> i know ovs is in : https://github.com/justinpettit/ovs/tree/conntrack
>>> i know kernel module should change : https://lkml.org/lkml/2015/3/2/835
>> 
>> As I mentioned, I'd recommend using the OVS repo, which has all the parts you need.  It should be rebased against OVS master in the next couple of days.  I imagine an updated kernel portion will be sent out to netdev in the next few weeks.
> I found 2 ovs repo in Kernel.org git repositories
> 1. https://git.kernel.org/cgit/linux/kernel/git/pshelar/openvswitch.git/?h=net_next_ovs
> 2. https://git.kernel.org/cgit/linux/kernel/git/jesse/openvswitch.git/
> which one you will push ?
> I git clone net_next_ovs, but not find any kernel patch for ovs-conntrack

I thought I was using the terminology as you originally used.  The code you should be using is here:

	https://github.com/justinpettit/ovs/tree/conntrack

--Justin



From diproiettod at vmware.com  Wed Jun 24 04:32:03 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 24 Jun 2015 11:32:03 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <D1B04FC8.3648%diproiettod@vmware.com>

I find that surprising, because OVS 2.3 supports only DPDK 1.6.

To support DPDK 1.7 in OVS we had to

1) Change a few DPDK calls to reflect the updated APIs

2) Add --whole-archive in the linking process to include the pmd
   drivers.  A failure to do so would result in the exact same
   problem you're experiencing.

Somehow it appears that your local copy of OVS includes (1), but
doesn't include (2).

Where did you get the OVS code? Do you have local changes?

On 24/06/2015 11:42, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi Daniel,
>
>One more thing about the following command after creating the bridge br0:
>
>ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
>
>If I try to execute the above cmd, it says dpdk0 no such device. And if I
>give specific interface like ens3f0, even that also does not work.
>
>What exactly I should use in this case?
>
>Regards,
>Varun 
>
>-----Original Message-----
>From: Rapelly, Varun
>Sent: Wednesday, June 24, 2015 10:07 AM
>To: 'Daniele Di Proietto'
>Cc: bugs at openvswitch.org
>Subject: RE: [ovs-discuss] No Ethernet devices found with I350
>
>Hi Daniele,
>
>Thanks for your reply :)
>
>I'm using openvswitch-2.3.1 and compiled using below set of commands.
>
>export DPDK_DIR=/root/dpdk-1.7.1
>cd /root/dpdk-1.7.1
>make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1
>export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
>./boot.sh
>./configure --with-dpdk=$DPDK_BUILD
>make
>
>I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to
>that.
>
>[root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status Network
>devices using DPDK-compatible driver
>============================================
><none>
>Network devices using kernel driver
>===================================
>0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb unused=
>0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=
>
> [root at artha ~]# ifconfig -a|grep flags
>ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>
>PFA setup.sh script, for all the cmd which I used to run ovs.
>
>1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the boot
>line and 1 GB huge page created 2. When I bind igb_uio driver [to
>0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon [--with
>dpdk], Ideally it should detect binded PCI device. Am I right?
>
>Please let me know if I'm missing something or something is incorrect
>
>Thanks & Regards,
>Varun
>-----Original Message-----
>From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>Sent: Tuesday, June 23, 2015 10:16 PM
>To: Rapelly, Varun
>Cc: bugs at openvswitch.org
>Subject: Re: [ovs-discuss] No Ethernet devices found with I350
>
>The commands you're typing seem correct.
>
>Which version of OVS are you using? How are you compiling it?
>
>On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
>
>>Hi All,
>> 
>>IÂ¹m a newbie to openvswitch and I followed the below link to install
>>ovs with DPDK on RHEL7 machine.
>> 
>>[root at artha ~]# uname -a
>>Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
>>x86_64
>>x86_64 x86_64 GNU/Linux
>> 
>>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswit
>>ch_ovs_blob_master_INSTALL.DPDK.md&d=BQIFAw&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVe
>>Aw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=AwnwYy9W
>>hcgg7CnQNrIe2FW9HpahcKMYKh3R8a3Z5NI&s=GOUqQRne6KSVH7m7aCPjDfQb1Jql6_zIjSd
>>63q8BJoA&e= 
>><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvs
>>wit
>>ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJAX
>>VeA
>>w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvXwU
>>3yO
>>I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-uR
>>NfI
>>C0hWg&e=>
>> 
>>When I ran vswitch daemon, it reports following error [I binded igb_uio
>>to the i350 NIC].
>> 
>>2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
>>assigning ports to UIO.
>>2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
>> 
>>Following PCI bind status.
>> 
>>[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
>> 
>>Network devices using DPDK-compatible driver
>>============================================
>>0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
>> 
>>Network devices using kernel driver
>>===================================
>>0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3
>>unused=
>>0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3
>>unused=
>>0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3
>>unused=
>>0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3
>>unused=
>>0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
>>unused=
>> 
>>Other network devices
>>=====================
>><none>
>> 
>>Then I created I ovs bridge using below cmd:
>>./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
>>                 
>>
>>./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
>> 
>>When I add dpdk port it reports, Â³could not open network device dpdk0
>>(Unknown error -19)Â²
>> 
>>Please let me know
>>1. 
>>What could be possible reason for not detecting the interface which is
>>binded to igb_uio?
>>2. 
>>How to add the port which is binded to igb_uio here?
>>
>> 
>>Thanks in advance.
>> 
>>Regards,
>>Varun
>> 
>>
>


From john.hurley at netronome.com  Wed Jun 24 09:12:08 2015
From: john.hurley at netronome.com (John Hurley)
Date: Wed, 24 Jun 2015 17:12:08 +0100
Subject: [ovs-discuss] ovs-conntrack action ordering?
Message-ID: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>

Hi,

I have been playing about with ovs-conntrack and noticed an issue that
could be a bug. Either that or my understanding is incorrect and would
appreciate clarification.

When we add a rule with a ct(recirc) action I notice that the call to
Conntrack is always the first action in the kernel rule that is created. In
ofproto-dpif-xlate.c a call to compose_conntrack_action() will append a
nl_msg for this action, then call recirculate which uses
commit_odp_actions() to add messages for previous actions before adding its
own recirc action to kernel rule action list.  However, I have also noticed
that when a push mpls action is added that this commit_odp_actions()
function is also called which can affect the tuples sent to nf_conntrack.

e.g. adding the rule:
ovs-ofctl add-flow br0
"conn_state=-trk,action=set_field:1.2.3.4->nw_dst,ct(recirc)"

will result in a kernel rule with actions of order 'ct, set dst ip, recirc'
and the sk_buff sent to nf_conntrack_in will have the source and
destination IP addresses of the matching packet.


adding the rule:
ovs-ofctl add-flow br0
"conn_state=-trk,action=set_field:1.2.3.4->nw_dst,push_mpls:0x8847,ct(recirc)"

will have actions ordered 'set dst ip, ct, push mpls, recirc' and the
destination IP sent into nf_conntrack will be 1.2.3.4

Can you clarify if this discrepancy is a bug? Also, can you clarify what is
the correct way ovs should support Conntrack in an action list? For
example, in the first rule, is it correct that Conntrack should be applied
on the input packet tuples or should the set field be applied before
Conntrack as it appears before it in the ovs-ofctl rule?

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/452a270c/attachment.html>

From jesse at nicira.com  Wed Jun 24 11:05:51 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 24 Jun 2015 11:05:51 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
Message-ID: <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>

On Wed, Jun 24, 2015 at 10:34 AM, Johnson L. Wu <johnson at snoopy.org> wrote:
>
> Hi Jesse,
>
> I just checked to see if there's any vlan related settings in my OVS that might get it to insert a tag and I found nothing.
> I have a funny feeling that *might* be Debian 8 related vs OVS 2.3 (I am now using 2.3.2).  An old Wheezy machine using OVS OVS 1.11.1 doesnt have this problem when I compare them side-by-side.

Hmm, thanks for looking. I did notice that both of you are running
Debian 8. I guess trying the Linux bridge is still the easiest check
to make. One other thing: can you try running ovs-appctl
dpif/dump-flows <BR> while the problem is occurring and post the
output?

From jesse at nicira.com  Wed Jun 24 11:09:48 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 24 Jun 2015 11:09:48 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CACqfFdLPXFvc+jzKRqM+SuX0NzJXzC8icQMCT9Ui1255KT3aYQ@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <2D2C4D41-6D28-448F-82F9-687A693ED80D@snoopy.ORG>
 <CACqfFdLPXFvc+jzKRqM+SuX0NzJXzC8icQMCT9Ui1255KT3aYQ@mail.gmail.com>
Message-ID: <CAEP_g=_dOcL7m9Px8AVEyr=KN94X5xcUQQkPwKyxm3bq=1qbYQ@mail.gmail.com>

On Wed, Jun 24, 2015 at 1:16 AM, Emil Flink <emil.flink at gmail.com> wrote:
> I worked around this issue by setting the MTU for my VM interfaces on the
> hypervisor to 1503. Reducing the MTU on the interfaces inside the VMs had no
> effect, ie. I was still getting MTU 1501 packets even when I set the MTU as
> low as 1000.

I don't totally understand this part. Does this mean that the packet
grows by 501 bytes in this situation? I guess that this can't be the
case, so you probably mean that the receiving VMs MTU was lowered,
which wouldn't really matter in this case since it isn't generating
the packets and they aren't getting there either. Is that correct?
When lowering the MTU, I was to referring to the physical Ethernet
adapters, which are set to 9000.

From David.Griswold at overturenetworks.com  Wed Jun 24 13:40:45 2015
From: David.Griswold at overturenetworks.com (David Griswold)
Date: Wed, 24 Jun 2015 20:40:45 +0000
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
Message-ID: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>

Iâ€™m trying to get flow-mode tunneling working with native GRE tunneling.  I have a 2 port switch, access and trunk (tunnel) with the 2 ports connected to test gear. The problem is that the trunk-to-access direction is not working. It looks like packets are egressing from b1 on port NORMAL, where they disappear.

When I configure port-mode tunneling, everything works and I notice that b1 does not egress to port NORMAL but ingresses directly to b0 from b1.

Another observation is that when it is working for port mode tunneling, the call to â€œtnl_port_should_receiveâ€ in function â€œxlate_lookup_ofproto_â€
sometimes return â€œtrueâ€. For flow mode tunneling, this function always returns â€œfalseâ€.

Here is my flow mode configuration.
I was wondering if you could spot anything obviously wrong or if this is a known issue.



## Flow-based GRE Tunnel

## Access Side
##
ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre options:remote_ip=flow options:key=flow
ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
ovs-vsctl set Interface gre0 ofport_request=1
ovs-vsctl set Interface dpdk0 ofport_request=2
ifconfig b0 10.10.20.40 netmask 255.255.255.0

## Output Bridge:
## Tunnel Side
##
ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
ovs-vsctl set Interface dpdk1 ofport_request=1
ifconfig b1  10.10.10.40 netmask 255.255.255.0

## Set up flows:

## Access
##
# in dpdk0, out gre
ovs-ofctl add-flow b0 "in_port=2 action=set_tunnel:123,set_field:10.10.10.2->tun_dst,output:NORMAL"

# in gre, out dpdk0
ovs-ofctl add-flow b0 "in_port=1,tun_src=10.10.10.2,tun_id=123,action=output:2"

## Tunnel
##
# in linux, out dpdk2
ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1

# in dpdk2, out linux
ovs-ofctl add-flow b1 in_port=1,action=output:NORMAL


Best regards and thanks,

David




This email and attachments may contain privileged or confidential information intended only for the addressee(s) indicated. The sender does not waive any of its rights, privileges or protections respecting this information. If you are not the named addressee, an employee, or agent responsible for sending this message to the named addressee (or this message was received by mistake), you are not authorized to read, print, retain, copy or disseminate this message or any part of it. If received in error, please notify us immediately by e-mail, discard any paper copies and delete all electronic files of the email.

Computer viruses can be transmitted via email. The recipient should check this email and any attachments for viruses. Email transmission cannot be guaranteed to be secured or error-free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete, or contain viruses. The sender accepts no liability for any damage caused by any transmitted viruses or errors or omissions in the contents of this message.

Overture Networks, Inc. 637 Davis Drive, Morrisville, NC USA 27560 www.overturenetworks.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/7bec3a20/attachment.html>

From tyler.bishop at beyondhosting.net  Wed Jun 24 14:32:14 2015
From: tyler.bishop at beyondhosting.net (Tyler Bishop)
Date: Wed, 24 Jun 2015 17:32:14 -0400 (EDT)
Subject: [ovs-discuss] Issues with OpenVSwitch 2.3.2 and Intel 40GE nic
	(i40e driver)
In-Reply-To: <1642679771.1039.1435167199398.JavaMail.zimbra@beyondhosting.net>
References: <1642679771.1039.1435167199398.JavaMail.zimbra@beyondhosting.net>
Message-ID: <314193336.22890.1435181534489.JavaMail.zimbra@beyondhosting.net>


Trying to troubleshoot a layer 2 issue with the latest intel i40e (Intel X710 / 40Gbit) 

Tested running kernel 3.10 and 4.1. 

Losing connectivity randomly and the arp table displays incomplete entries. 

I've found enabling vlan splinters helps but performance is only about 1.1Gbit enabled. 

Not really sure how to debug this further, have tried the latest intel website drivers to, issue is still persistent with OVS. 

I have tested vmware round robin vswitch and this issue does not persist. 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/cad74be5/attachment.html>

From jesse at nicira.com  Wed Jun 24 15:00:03 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 24 Jun 2015 15:00:03 -0700
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
In-Reply-To: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
References: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
Message-ID: <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>

On Wed, Jun 24, 2015 at 1:40 PM, David Griswold
<David.Griswold at overturenetworks.com> wrote:
> Iâ€™m trying to get flow-mode tunneling working with native GRE tunneling.  I
> have a 2 port switch, access and trunk (tunnel) with the 2 ports connected
> to test gear. The problem is that the trunk-to-access direction is not
> working. It looks like packets are egressing from b1 on port NORMAL, where
> they disappear.
>
> When I configure port-mode tunneling, everything works and I notice that b1
> does not egress to port NORMAL but ingresses directly to b0 from b1.

I think I see the problem, a check from port based tunneling was
carried over to the more general native tunneling case. I just sent
out a patch, can you please try it out?

> Another observation is that when it is working for port mode tunneling, the
> call to â€œtnl_port_should_receiveâ€ in function â€œxlate_lookup_ofproto_â€
>
> sometimes return â€œtrueâ€. For flow mode tunneling, this function always
> returns â€œfalseâ€.

This check only tests to see if a flow has tunnel IP addresses, which
should be true for all decapsulated packets. I guess you are probably
looking at this on the physical bridge, where the packet hasn't been
decapsulated yet? The "sometimes" for port based tunnels would depend
on whether the packet has been decapsulated yet and the never for flow
based tunnels is because the process fails before decapsulation.

From jesse at nicira.com  Wed Jun 24 15:16:45 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 24 Jun 2015 15:16:45 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
Message-ID: <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>

On Wed, Jun 24, 2015 at 2:43 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Thanks Jesse,
>
> This is plain vanilla when all MTU left at default.  Dmesg showing
> [  752.962014] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500
> [  752.962027] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500

Hmm, thanks. All of this seems pretty normal looking. Here's another
thing to try if you can: I think that you are probably running the
kernel module that is part of the upstream kernel in Debian. Since
this problem appears to be isolated to Debian, maybe somehow there is
an issue in the version of the OVS kernel module that they picked up.
Can you try compiling and installing the module that is packaged with
OVS 2.3? I guess either than will fix the issue (as it has been out a
while and nobody has reported a problem) or the issue is somewhere
else in the stack and it will continue even if you swap out OVS for
the Linux bridge.

From blp at nicira.com  Wed Jun 24 18:05:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 24 Jun 2015 18:05:26 -0700
Subject: [ovs-discuss] Issue with symmetric flow hashing in
 'flow_hash_symmetric_l4' when including MACs
In-Reply-To: <CAOpSVYp8A9KknkZLTSCGjPGhr7mo7zPVQfGzkhtY-aVuc_UCEQ@mail.gmail.com>
References: <CAOpSVYp8A9KknkZLTSCGjPGhr7mo7zPVQfGzkhtY-aVuc_UCEQ@mail.gmail.com>
Message-ID: <20150625010526.GC31001@nicira.com>

On Tue, Jun 23, 2015 at 03:30:46PM -0500, Jeroen van Bemmel wrote:
> 'flow_hash_symmetric_l4' in flow.c currently includes L2 information (
> MAC addresses and VLAN ID) in the hash. However, in certain cases (
> e.g. flow to a VRRP IP address on a router ), the MAC addresses for
> the return flow are not symmetrical ( because a virtual MAC is used
> for VRRP, whereas a physical interface MAC is used for the return
> packet )
> 
> Why are the MAC addresses included in the hash for IP flows?

This is something of a legacy hash function that we shouldn't change
because it's used to coordinate OVS instances running on different
nodes.  That's why it's one of the few places where we're still using
Jenkins hash instead of the better murmurhash.

I'd have no problem introducing a new L4 symmetric hash function that we
can use in places where it's possible to configure a particular hash
function, but we shouldn't change this one.

From jesse at nicira.com  Wed Jun 24 18:41:39 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 24 Jun 2015 18:41:39 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
 <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
Message-ID: <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>

On Wed, Jun 24, 2015 at 6:16 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Thanks for the kind advice.
>
> Tried this:
>
> /usr/local/src/openvswitch-2.3.2# ./configure --prefix=/usr --localstatedir=/var --with-linux=/lib/modules/`uname -r`/build
> And got this:
>
> configure: error: Linux kernel in /lib/modules/3.16.0-4-amd64/build is version 3.16.7, but version newer than 3.14.x is not supported (please refer to the FAQ for advice)
>
> How do I compile and install the kernel modules?

Sorry, I should have checked whether 2.3 was compatible with your
kernel. You'll need to use pre-release 2.4 instead, which you can find
in branch-2.4 in git.

From rsr624 at yahoo.com  Wed Jun 24 19:36:12 2015
From: rsr624 at yahoo.com (Ravi Ramaswamy)
Date: Thu, 25 Jun 2015 02:36:12 +0000 (UTC)
Subject: [ovs-discuss] OVS Performance
Message-ID: <360797519.929566.1435199772089.JavaMail.yahoo@mail.yahoo.com>

Hello - Apologies. Â Newbie to OVS and this is my first posting. Â I am trying to get a high level understanding of the following. Â Any pointers is greatly appreciated
* IP forwarding performance and dependence on packet size, flow distribution, etc* MPLS support on OVS* Multi-tenant support (I am thinking VRFs / MPLS/VPNs)
Thanks
Ravi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/055dc72d/attachment.html>

From emil.flink at gmail.com  Wed Jun 24 01:16:44 2015
From: emil.flink at gmail.com (Emil Flink)
Date: Wed, 24 Jun 2015 10:16:44 +0200
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <2D2C4D41-6D28-448F-82F9-687A693ED80D@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <2D2C4D41-6D28-448F-82F9-687A693ED80D@snoopy.ORG>
Message-ID: <CACqfFdLPXFvc+jzKRqM+SuX0NzJXzC8icQMCT9Ui1255KT3aYQ@mail.gmail.com>

For me it definitely appears to be something internal to openvswitch, KVM
or the tap driver as I can do MTU 1500 pings to external addresses from
inside the VM which to my limited understanding indicates the extra bytes
are not present when the traffic leaves the hypervisor node.

I worked around this issue by setting the MTU for my VM interfaces on the
hypervisor to 1503. Reducing the MTU on the interfaces inside the VMs had
no effect, ie. I was still getting MTU 1501 packets even when I set the MTU
as low as 1000.

My setup as detailed in my other post is essentially:
Bridge for external traffic with OVS-bond (MTU 9000) - Patch port - Bridge
for VMs - A port for each VM with a tagged VLAN

2015-06-24 5:18 GMT+02:00 Johnson Wu <johnson at snoopy.org>:

> It's sheer coincidence that that posts are only 10 min apart.
>
> In my setup all interfaces have MTU defined to be 1500 before I applied
> the workaround.
>
> I tried to do tcpdump on the client to see if the frames received are over
> 1516 and ip pkts over 1500... Nope
>
> Will try a simple linux bridge and see.
>
> Thanks.
>
>
>
>
> Sent from my iPhone
>
>
> > On Jun 23, 2015, at 7:16 PM, Jesse Gross <jesse at nicira.com> wrote:
> >
> >> On Fri, Jun 19, 2015 at 1:52 PM, Johnson L. Wu <johnson at snoopy.org>
> wrote:
> >>
> >>
> >> Greetings,
> >>
> >>
> >>
> >> I am currently running
> >>
> >> 3.16.0-4-amd64
> >>
> >> No LSB modules are available.
> >>
> >> Distributor ID: Debian
> >>
> >> Description:    Debian GNU/Linux 8.1 (jessie)
> >>
> >> Release:        8.1
> >>
> >> Codename:       jessie
> >>
> >> ovs-vsctl (Open vSwitch) 2.3.1
> >>
> >> Compiled Jun 15 2015 19:30:36
> >>
> >> DB Schema 7.6.2
> >>
> >> libvirtd (libvirt) 1.2.9
> >>
> >>
> >>
> >> and I am seeing an MTU issue where packets coming in from the physical
> side
> >> are vanilla 1500Bytes
> >>
> >> Once it gets to the virtual NIC I see the following in dmesg:
> >>
> >>
> >>
> >> [ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500
> >>
> >> [ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 >
> 1500
> >>
> >>
> >>
> >> If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502
> things
> >> will flow
> >>
> >> Otherwise mant protocols with full sized packets will see timeout.
> >>
> >>
> >>
> >> Wireshark loaded on the client didnâ€™t help, as a trace done on the
> client
> >> itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as
> 1500.
> >>
> >>
> >>
> >> I think OVS must be doing something that added a tag to the packets.
> >>
> >> Anyone with the same observation?
> >
> > I've never heard of this problem before and there were two threads
> > started on it within 10 minutes, so I'm combining them together on the
> > assumption that they are somehow related.
> >
> > It's not really obvious to me how or why OVS would be increasing the
> > size of the packet by 1 or 2 bytes, especially if the packet is just
> > flowing through. As I said, I've never heard this reported before. In
> > the other message, it looks like OVS should be removing a VLAN tag. Is
> > that true in both cases?
> >
> > Similarly, in the other thread, it looks the MTUs of the physical
> > interfaces are 9000, which makes it seems like it is possible that
> > these packets are actually coming across the wire. What happens if the
> > MTUs are all the same, as required by Ethernet specs?
> >
> > Finally, it would be helpful to try this with the Linux bridge instead
> > of OVS, if possible, since it seems likely that the cause may be
> > another component.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/1785ccd1/attachment-0001.html>

From vrapelly at sonusnet.com  Wed Jun 24 03:42:40 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Wed, 24 Jun 2015 10:42:40 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com> 
Message-ID: <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>

Hi Daniel,

One more thing about the following command after creating the bridge br0:

ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk. 

If I try to execute the above cmd, it says dpdk0 no such device. And if I give specific interface like ens3f0, even that also does not work.

What exactly I should use in this case?

Regards,
Varun 

-----Original Message-----
From: Rapelly, Varun 
Sent: Wednesday, June 24, 2015 10:07 AM
To: 'Daniele Di Proietto'
Cc: bugs at openvswitch.org
Subject: RE: [ovs-discuss] No Ethernet devices found with I350

Hi Daniele,

Thanks for your reply :)

I'm using openvswitch-2.3.1 and compiled using below set of commands.

export DPDK_DIR=/root/dpdk-1.7.1
cd /root/dpdk-1.7.1
make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1 export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
./boot.sh
./configure --with-dpdk=$DPDK_BUILD
make

I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to that.

[root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status Network devices using DPDK-compatible driver ============================================
<none>
Network devices using kernel driver
===================================
0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb unused=
0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=

 [root at artha ~]# ifconfig -a|grep flags
ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500

PFA setup.sh script, for all the cmd which I used to run ovs.

1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the boot line and 1 GB huge page created 2. When I bind igb_uio driver [to 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon [--with dpdk], Ideally it should detect binded PCI device. Am I right?

Please let me know if I'm missing something or something is incorrect

Thanks & Regards,
Varun
-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
Sent: Tuesday, June 23, 2015 10:16 PM
To: Rapelly, Varun
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] No Ethernet devices found with I350

The commands you're typing seem correct.

Which version of OVS are you using? How are you compiling it?

On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi All,
> 
>IÂ¹m a newbie to openvswitch and I followed the below link to install 
>ovs with DPDK on RHEL7 machine.
> 
>[root at artha ~]# uname -a
>Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
>x86_64
>x86_64 x86_64 GNU/Linux
> 
>https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvs
>wit
>ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJAX
>VeA
>w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvXwU
>3yO
>I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-uR
>NfI
>C0hWg&e=>
> 
>When I ran vswitch daemon, it reports following error [I binded igb_uio 
>to the i350 NIC].
> 
>2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try 
>assigning ports to UIO.
>2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> 
>Following PCI bind status.
> 
>[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> 
>Network devices using DPDK-compatible driver 
>============================================
>0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> 
>Network devices using kernel driver
>===================================
>0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3 
>unused=
>0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3 
>unused=
>0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3 
>unused=
>0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3 
>unused=
>0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb 
>unused=
> 
>Other network devices
>=====================
><none>
> 
>Then I created I ovs bridge using below cmd:
>./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
>                  
>
>./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> 
>When I add dpdk port it reports, Â³could not open network device dpdk0 
>(Unknown error -19)Â²
> 
>Please let me know
>1. 
>What could be possible reason for not detecting the interface which is 
>binded to igb_uio?
>2. 
>How to add the port which is binded to igb_uio here?
>
> 
>Thanks in advance.
> 
>Regards,
>Varun
> 
>


From tyler.bishop at beyondhosting.net  Wed Jun 24 10:33:19 2015
From: tyler.bishop at beyondhosting.net (Tyler Bishop)
Date: Wed, 24 Jun 2015 13:33:19 -0400 (EDT)
Subject: [ovs-discuss] Issues with OpenVSwitch 2.3.2 and Intel 40GE nic
	(i40e driver)
Message-ID: <1642679771.1039.1435167199398.JavaMail.zimbra@beyondhosting.net>

Trying to troubleshoot a layer 2 issue with the latest intel i40e (Intel X710 / 40Gbit) 

Tested running kernel 3.10 and 4.1. 

Losing connectivity randomly and the arp table displays incomplete entries. 

I've found enabling vlan splinters helps but performance is only about 1.1Gbit enabled. 

Not really sure how to debug this further, have tried the latest intel website drivers to, issue is still persistent with OVS. 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150624/f61a7163/attachment-0001.html>

From johnson at snoopy.ORG  Wed Jun 24 10:34:52 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Wed, 24 Jun 2015 10:34:52 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
Message-ID: <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>


Hi Jesse,

I just checked to see if there's any vlan related settings in my OVS that might get it to insert a tag and I found nothing.
I have a funny feeling that *might* be Debian 8 related vs OVS 2.3 (I am now using 2.3.2).  An old Wheezy machine using OVS OVS 1.11.1 doesnt have this problem when I compare them side-by-side.

-Johnson

 
root at jwu-lenovo:~# ovs-vsctl list port | grep vlan
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
vlan_mode           : []
root at jwu-lenovo:~# ovs-vsctl list port | grep 'trunk'
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
trunks              : []
root at jwu-lenovo:~#  ovs-vsctl list port | grep 'tag'
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
tag                 : []
-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Tuesday, June 23, 2015 7:17 PM
To: Johnson L. Wu; Emil Flink
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)

On Fri, Jun 19, 2015 at 1:52 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
>
>
> Greetings,
>
>
>
> I am currently running
>
> 3.16.0-4-amd64
>
> No LSB modules are available.
>
> Distributor ID: Debian
>
> Description:    Debian GNU/Linux 8.1 (jessie)
>
> Release:        8.1
>
> Codename:       jessie
>
> ovs-vsctl (Open vSwitch) 2.3.1
>
> Compiled Jun 15 2015 19:30:36
>
> DB Schema 7.6.2
>
> libvirtd (libvirt) 1.2.9
>
>
>
> and I am seeing an MTU issue where packets coming in from the physical 
> side are vanilla 1500Bytes
>
> Once it gets to the virtual NIC I see the following in dmesg:
>
>
>
> [ 6754.472356] openvswitch: vnet5: dropped over-mtu packet: 1502 > 
> 1500
>
> [ 6754.472363] openvswitch: inter-1tom: dropped over-mtu packet: 1502 
> > 1500
>
>
>
> If I set BOTH the vnet5 vnic to mtu 1502 AND the guest OS MTU to 1502 
> things will flow
>
> Otherwise mant protocols with full sized packets will see timeout.
>
>
>
> Wireshark loaded on the client didnâ€™t help, as a trace done on the 
> client itself sees the IP packets coming in (AFTER adjusting MTU to 1502) as 1500.
>
>
>
> I think OVS must be doing something that added a tag to the packets.
>
> Anyone with the same observation?

I've never heard of this problem before and there were two threads started on it within 10 minutes, so I'm combining them together on the assumption that they are somehow related.

It's not really obvious to me how or why OVS would be increasing the size of the packet by 1 or 2 bytes, especially if the packet is just flowing through. As I said, I've never heard this reported before. In the other message, it looks like OVS should be removing a VLAN tag. Is that true in both cases?

Similarly, in the other thread, it looks the MTUs of the physical interfaces are 9000, which makes it seems like it is possible that these packets are actually coming across the wire. What happens if the MTUs are all the same, as required by Ethernet specs?

Finally, it would be helpful to try this with the Linux bridge instead of OVS, if possible, since it seems likely that the cause may be another component.


From johnson at snoopy.ORG  Wed Jun 24 14:43:36 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Wed, 24 Jun 2015 14:43:36 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
Message-ID: <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>

Thanks Jesse,

This is plain vanilla when all MTU left at default.  Dmesg showing 
[  752.962014] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500
[  752.962027] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 1500

* 10.128.0.12 is the VM on the virtual side
The others are the internet hosts
23.36.60.124 is apple.com trying to send it 1500Byte packets.
It stalls as I get the 1502 message in dmesg.

h# ovs-appctl   dpif/dump-flows switch-1
recirc_id(0),skb_priority(0),in_port(5),eth(src=20:e5:2a:07:0d:cf,dst=52:54:00:3d:a6:db),eth_type(0x0800),ipv4(src=23.36.60.124/255.255.255.255,dst=10.128.0.12/255.255.255.255,proto=6/0xff,tos=0x8/0,ttl=55/0,frag=no/0xff), packets:22, bytes:26040, used:1.388s, flags:SFP., actions:15,13
recirc_id(0),skb_priority(0),in_port(15),eth(src=52:54:00:3d:a6:db,dst=20:e5:2a:07:0d:cf),eth_type(0x0800),ipv4(src=10.128.0.12/255.255.255.255,dst=23.56.123.171/255.255.255.255,proto=6/0xff,tos=0/0,ttl=128/0,frag=no/0xff), packets:0, bytes:0, used:never, actions:5,13
recirc_id(0),skb_priority(0),in_port(5),eth(src=20:e5:2a:07:0d:cf,dst=52:54:00:3d:a6:db),eth_type(0x0800),ipv4(src=172.230.227.22/255.255.255.255,dst=10.128.0.12/255.255.255.255,proto=6/0xff,tos=0/0,ttl=57/0,frag=no/0xff), packets:0, bytes:0, used:never, actions:15,13
recirc_id(0),skb_priority(0),in_port(5),eth(src=20:e5:2a:07:0d:cf,dst=52:54:00:3d:a6:db),eth_type(0x0800),ipv4(src=23.56.123.171/255.255.255.255,dst=10.128.0.12/255.255.255.255,proto=6/0xff,tos=0/0,ttl=57/0,frag=no/0xff), packets:0, bytes:0, used:never, actions:15,13
recirc_id(0),skb_priority(0),in_port(5),eth(src=20:e5:2a:07:0d:cf,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0800),ipv4(src=10.128.0.1/255.255.255.255,dst=255.255.255.255/255.255.255.255,proto=17/0xff,tos=0/0,ttl=64/0,frag=no/0xff),udp(src=32772/0x8000,dst=7423/0xf000), packets:0, bytes:0, used:never, actions:13

root at jwu-lenovo:/var/run/openvswitch# ovs-appctl   dpif/show      
system at ovs-system: hit:8304 missed:1447
        control-switch:
                control-switch 65534/2: (internal)
                vnet0 1/6: (system)
                vnet1 2/8: (system)
                vnet3 3/10: (system)
        mirror-switch:
                inter-mto1 2/14: (system)
                mirror-port 1/11: (system)
                mirror-switch 65534/1: (internal)
        switch-1:
                control-proxy-1 3/7: (system)
                inter-1tom 6/13: (system)
                svc-port-1 2/3: (internal)
                switch-1 65534/4: (internal)
                vmnic1 1/5: (system)
                vnet2 4/9: (system)
                vnet4 5/12: (system)
                vnet5 7/15: (system)
root at jwu-lenovo:/var/run/openvswitch#


-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Wednesday, June 24, 2015 11:06 AM
To: Johnson L. Wu
Cc: Emil Flink; discuss at openvswitch.org
Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)

On Wed, Jun 24, 2015 at 10:34 AM, Johnson L. Wu <johnson at snoopy.org> wrote:
>
> Hi Jesse,
>
> I just checked to see if there's any vlan related settings in my OVS that might get it to insert a tag and I found nothing.
> I have a funny feeling that *might* be Debian 8 related vs OVS 2.3 (I am now using 2.3.2).  An old Wheezy machine using OVS OVS 1.11.1 doesnt have this problem when I compare them side-by-side.

Hmm, thanks for looking. I did notice that both of you are running Debian 8. I guess trying the Linux bridge is still the easiest check to make. One other thing: can you try running ovs-appctl dpif/dump-flows <BR> while the problem is occurring and post the output?


From johnson at snoopy.ORG  Wed Jun 24 18:16:48 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Wed, 24 Jun 2015 18:16:48 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
Message-ID: <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>

Thanks for the kind advice.

Tried this:

/usr/local/src/openvswitch-2.3.2# ./configure --prefix=/usr --localstatedir=/var --with-linux=/lib/modules/`uname -r`/build
And got this:

configure: error: Linux kernel in /lib/modules/3.16.0-4-amd64/build is version 3.16.7, but version newer than 3.14.x is not supported (please refer to the FAQ for advice)

How do I compile and install the kernel modules?
Thanks,

-Johnson



-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Wednesday, June 24, 2015 3:17 PM
To: Johnson L. Wu
Cc: Emil Flink; discuss at openvswitch.org
Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)

On Wed, Jun 24, 2015 at 2:43 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Thanks Jesse,
>
> This is plain vanilla when all MTU left at default.  Dmesg showing [  
> 752.962014] openvswitch: vnet5: dropped over-mtu packet: 1502 > 1500 [  
> 752.962027] openvswitch: inter-1tom: dropped over-mtu packet: 1502 > 
> 1500

Hmm, thanks. All of this seems pretty normal looking. Here's another thing to try if you can: I think that you are probably running the kernel module that is part of the upstream kernel in Debian. Since this problem appears to be isolated to Debian, maybe somehow there is an issue in the version of the OVS kernel module that they picked up.
Can you try compiling and installing the module that is packaged with OVS 2.3? I guess either than will fix the issue (as it has been out a while and nobody has reported a problem) or the issue is somewhere else in the stack and it will continue even if you swap out OVS for the Linux bridge.


From johnson at snoopy.ORG  Wed Jun 24 19:37:07 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Wed, 24 Jun 2015 19:37:07 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
 <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
 <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>
Message-ID: <004d01d0aeef$d5989db0$80c9d910$@snoopy.ORG>

Tried configuring 2.4 by hand

root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.4.90
Compiled Jun 24 2015 19:16:45
DB Schema 7.12.1
root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# uname -r      
3.16.0-4-amd64
root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps#


./configure --prefix=/usr --localstatedir=/var --with-linux=/lib/modules/`uname -r`/build
 make; make install;
 make modules_install; sudo depmod -a

and its still the same, 2 bytes off.

Will update if I see anything else.  Thanks!

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Wednesday, June 24, 2015 6:42 PM
To: Johnson L. Wu
Cc: Emil Flink; discuss at openvswitch.org
Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)

On Wed, Jun 24, 2015 at 6:16 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Thanks for the kind advice.
>
> Tried this:
>
> /usr/local/src/openvswitch-2.3.2# ./configure --prefix=/usr 
> --localstatedir=/var --with-linux=/lib/modules/`uname -r`/build And got this:
>
> configure: error: Linux kernel in /lib/modules/3.16.0-4-amd64/build is 
> version 3.16.7, but version newer than 3.14.x is not supported (please 
> refer to the FAQ for advice)
>
> How do I compile and install the kernel modules?

Sorry, I should have checked whether 2.3 was compatible with your kernel. You'll need to use pre-release 2.4 instead, which you can find in branch-2.4 in git.


From dongj at dtdream.com  Thu Jun 25 01:01:23 2015
From: dongj at dtdream.com (Dongjun)
Date: Thu, 25 Jun 2015 16:01:23 +0800
Subject: [ovs-discuss] [dpdk-ovs]VXLAN encapsulation exceeds the MTU of dpdk
 port .
Message-ID: <558BB553.2020403@dtdream.com>

As following topology, two VMs communicate via VXLAN tunnel.
TCP pkts may be droped for exceeding the MTU of host DPDK port in br2.
Now I can change the VMs' MTU from default to smaller to accommodate the 
traffics, it works well.

The way I have not find to change mtu of DPDK phy port, is there a 
blueprint for supporting this by ovs, like "ovs-appctl 
netdev-dpdk/set-xxx" or another way?

         Host1                  |                     Host2
                     (l-ip)-   L3    -(r-ip)
-----   -----        -----     |     -----       -----  ----- -----
|VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
-----   -----        -----     |     -----       -----  ----- -----

From eunho.cha at atto-research.com  Thu Jun 25 01:30:40 2015
From: eunho.cha at atto-research.com (=?UTF-8?B?7LCo7J2A7Zi4?=)
Date: Thu, 25 Jun 2015 17:30:40 +0900
Subject: [ovs-discuss] [dpdk-ovs] dpdk pmd threads use only one numa node
Message-ID: <CAJoD7yQ-Qm3zRwsuUi8i6J=O1XXJq0gnYPJV5nWjq3OKhyG5Mw@mail.gmail.com>

Hello.

I am trying to build VM to VM scheme using ovs (git branch-2.4) and DPDK
2.0.0.

I start ovs-vswitchd like this.

# ovs-vswitchd --dpdk -cuse_dev_name my-vhost-net -c 0x401 -n 4
--socket-mem 1024,1024 -- unix:$DB_SOCK --pidfile --detach

and for increase pmd threads, I use following command. (This system has 2
numa nodes and each node has 10 cores.)

# ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=401

but pmd threads are created only on numa node 0. pmd threads are not
created on numa node 1.

So. I test bandwidth rate VM to VM.
VM1, VM2 are on numa node 0
VM3, VM4 are on numa node 1

bandwidth between VM1 to VM2 is about 10Gbps.
but bandwidth between VM3 to VM4 is about 6Gbps.

I think that pmd threads are created on numa node 1, bandwidth between VM3
to VM4 is up to 10Gbps.

Why does pmd threads use only numa node 0?
How can I use pmd threads on all numa nodes?

Thanks,
Cha.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/aa0e3c67/attachment.html>

From joestringer at nicira.com  Thu Jun 25 02:05:20 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 25 Jun 2015 11:05:20 +0200
Subject: [ovs-discuss] ovs-conntrack action ordering?
In-Reply-To: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
References: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
Message-ID: <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>

Hi John,

Thanks for reporting this. It sounds like a bug. As an OpenFlow user,
It would be surprising for the order of these actions in the action
list to be rearranged like you report. For many fields this doesn't
matter (eg, if you only write IP then write TCP port), however for
conntrack, the order is more important - when you change the IP
address affects how the connection is tracked.  So the flow generation
for the first rule looks wrong from that perspective.

The core problem here is that while processing the actions list, many
of the "set_field" operations are deferred until the end of the
processing, whereas conntrack action is not. I think we need to come
up with some way to ensure that the flow changes are committed before
adding the conntrack action to the datapath actions list. I suspect
much of the code is already there for this, it just needs to be hooked
up correctly.

For the second flow, in some ways I'm inclined to go with the same
approach - Commit the MPLS before committing the conntrack action.
Also, I don't know what you're expecting the connection tracker to do
when it receives MPLS packets. I doubt that the connection tracker
would understand how to track MPLS packets or associate them with
connections. I'm not sure what behaviour you're getting today, but I
would expect all such packets to come back with conn_state=+trk+inv
(ie, invalid). What does it even mean to connection-track MPLS
packets?

On 24 June 2015 at 18:12, John Hurley <john.hurley at netronome.com> wrote:
> Hi,
>
> I have been playing about with ovs-conntrack and noticed an issue that could
> be a bug. Either that or my understanding is incorrect and would appreciate
> clarification.
>
> When we add a rule with a ct(recirc) action I notice that the call to
> Conntrack is always the first action in the kernel rule that is created. In
> ofproto-dpif-xlate.c a call to compose_conntrack_action() will append a
> nl_msg for this action, then call recirculate which uses
> commit_odp_actions() to add messages for previous actions before adding its
> own recirc action to kernel rule action list.  However, I have also noticed
> that when a push mpls action is added that this commit_odp_actions()
> function is also called which can affect the tuples sent to nf_conntrack.
>
> e.g. adding the rule:
> ovs-ofctl add-flow br0
> "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,ct(recirc)"
>
> will result in a kernel rule with actions of order 'ct, set dst ip, recirc'
> and the sk_buff sent to nf_conntrack_in will have the source and destination
> IP addresses of the matching packet.
>
>
> adding the rule:
> ovs-ofctl add-flow br0
> "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,push_mpls:0x8847,ct(recirc)"
>
> will have actions ordered 'set dst ip, ct, push mpls, recirc' and the
> destination IP sent into nf_conntrack will be 1.2.3.4
>
> Can you clarify if this discrepancy is a bug? Also, can you clarify what is
> the correct way ovs should support Conntrack in an action list? For example,
> in the first rule, is it correct that Conntrack should be applied on the
> input packet tuples or should the set field be applied before Conntrack as
> it appears before it in the ovs-ofctl rule?
>
> Thanks,
> John
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From kevin.traynor at intel.com  Thu Jun 25 02:36:46 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 25 Jun 2015 09:36:46 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Rapelly,
> Varun
> Sent: Wednesday, June 24, 2015 11:43 AM
> To: Daniele Di Proietto
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> 
> Hi Daniel,
> 
> One more thing about the following command after creating the bridge br0:
> 
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
> 
> If I try to execute the above cmd, it says dpdk0 no such device. And if I
> give specific interface like ens3f0, even that also does not work.

dpdk0 is the correct syntax and should work - using ens3f0 is incorrect and
will not work. 

I think you have a version mismatch between OVS and DPDK. I don't necessarily
think that is the root cause of the problem you are seeing but best to eliminate
and work from a more stable point. How about moving to the OVS 2.4 branch and
using DPDK 2.0? 

> 
> What exactly I should use in this case?
> 
> Regards,
> Varun
> 
> -----Original Message-----
> From: Rapelly, Varun
> Sent: Wednesday, June 24, 2015 10:07 AM
> To: 'Daniele Di Proietto'
> Cc: bugs at openvswitch.org
> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
> 
> Hi Daniele,
> 
> Thanks for your reply :)
> 
> I'm using openvswitch-2.3.1 and compiled using below set of commands.
> 
> export DPDK_DIR=/root/dpdk-1.7.1
> cd /root/dpdk-1.7.1
> make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1 export
> DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> ./boot.sh
> ./configure --with-dpdk=$DPDK_BUILD
> make
> 
> I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to that.
> 
> [root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status Network
> devices using DPDK-compatible driver
> ============================================
> <none>
> Network devices using kernel driver
> ===================================
> 0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb unused=
> 0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb unused=
> 
>  [root at artha ~]# ifconfig -a|grep flags
> ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> 
> PFA setup.sh script, for all the cmd which I used to run ovs.
> 
> 1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the boot
> line and 1 GB huge page created 2. When I bind igb_uio driver [to
> 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon [--with
> dpdk], Ideally it should detect binded PCI device. Am I right?
> 
> Please let me know if I'm missing something or something is incorrect
> 
> Thanks & Regards,
> Varun
> -----Original Message-----
> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> Sent: Tuesday, June 23, 2015 10:16 PM
> To: Rapelly, Varun
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> 
> The commands you're typing seem correct.
> 
> Which version of OVS are you using? How are you compiling it?
> 
> On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
> 
> >Hi All,
> >
> >IÂ¹m a newbie to openvswitch and I followed the below link to install
> >ovs with DPDK on RHEL7 machine.
> >
> >[root at artha ~]# uname -a
> >Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
> >x86_64
> >x86_64 x86_64 GNU/Linux
> >
> >https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
> ><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvs
> >wit
> >ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJAX
> >VeA
> >w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvXwU
> >3yO
> >I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-uR
> >NfI
> >C0hWg&e=>
> >
> >When I ran vswitch daemon, it reports following error [I binded igb_uio
> >to the i350 NIC].
> >
> >2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
> >assigning ports to UIO.
> >2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> >
> >Following PCI bind status.
> >
> >[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> >
> >Network devices using DPDK-compatible driver
> >============================================
> >0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> >
> >Network devices using kernel driver
> >===================================
> >0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 drv=tg3
> >unused=
> >0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 drv=tg3
> >unused=
> >0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 drv=tg3
> >unused=
> >0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 drv=tg3
> >unused=
> >0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
> >unused=
> >
> >Other network devices
> >=====================
> ><none>
> >
> >Then I created I ovs bridge using below cmd:
> >./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs datapath_type=netdev
> >
> >
> >./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> >
> >When I add dpdk port it reports, Â³could not open network device dpdk0
> >(Unknown error -19)Â²
> >
> >Please let me know
> >1.
> >What could be possible reason for not detecting the interface which is
> >binded to igb_uio?
> >2.
> >How to add the port which is binded to igb_uio here?
> >
> >
> >Thanks in advance.
> >
> >Regards,
> >Varun
> >
> >
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From john.hurley at netronome.com  Thu Jun 25 02:50:10 2015
From: john.hurley at netronome.com (John Hurley)
Date: Thu, 25 Jun 2015 10:50:10 +0100
Subject: [ovs-discuss] ovs-conntrack action ordering?
In-Reply-To: <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>
References: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
 <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>
Message-ID: <CAK+XE=kNCFUdeqp3vu5BHWQ9N9wsXHTDFNU2K86eMV5k5qY_iw@mail.gmail.com>

Hi Joe,

Thanks for the response.

Agree with your MPLS points. I was just using the MPLS example as a
hypothetical situation as I noticed it called the action commit function so
it could be used to modify IP address fields before Conntrack that were not
be modified in other ways.

I was more looking clarification that the ordering of the rule actions is
important in ovs-conntrack so that if we do an IP address set field
followed by a CT() then the updated IP field should pass into nf_conntrack
rather than it being the original tuples (as is now).

To me, the former makes more sense here. For example, if the OVS was
implementing some form of NAT along with connection tracking then using the
input tuples and not updated fields means we could not track flows
bidirectionally.

I will take from your response that OVS-Conntrack should consider the
ordering in this way?

I 'think' the fix for this in the code is quite simple. Just move the
action commit call from the compose_recirculate_action__() in
ofproto-dpif-xlate.c to before the netlink message generation in
compose_conntrack_action() in the same file.  That way previous actions
will be pushed before the conntrack action.  The commit code would also
need to be added to compose_recirculation_action() to ensure the actions
are committed if a recirculation action occurs outside of conntrack.

Thanks,
John




On Thu, Jun 25, 2015 at 10:05 AM, Joe Stringer <joestringer at nicira.com>
wrote:

> Hi John,
>
> Thanks for reporting this. It sounds like a bug. As an OpenFlow user,
> It would be surprising for the order of these actions in the action
> list to be rearranged like you report. For many fields this doesn't
> matter (eg, if you only write IP then write TCP port), however for
> conntrack, the order is more important - when you change the IP
> address affects how the connection is tracked.  So the flow generation
> for the first rule looks wrong from that perspective.
>
> The core problem here is that while processing the actions list, many
> of the "set_field" operations are deferred until the end of the
> processing, whereas conntrack action is not. I think we need to come
> up with some way to ensure that the flow changes are committed before
> adding the conntrack action to the datapath actions list. I suspect
> much of the code is already there for this, it just needs to be hooked
> up correctly.
>
> For the second flow, in some ways I'm inclined to go with the same
> approach - Commit the MPLS before committing the conntrack action.
> Also, I don't know what you're expecting the connection tracker to do
> when it receives MPLS packets. I doubt that the connection tracker
> would understand how to track MPLS packets or associate them with
> connections. I'm not sure what behaviour you're getting today, but I
> would expect all such packets to come back with conn_state=+trk+inv
> (ie, invalid). What does it even mean to connection-track MPLS
> packets?
>
> On 24 June 2015 at 18:12, John Hurley <john.hurley at netronome.com> wrote:
> > Hi,
> >
> > I have been playing about with ovs-conntrack and noticed an issue that
> could
> > be a bug. Either that or my understanding is incorrect and would
> appreciate
> > clarification.
> >
> > When we add a rule with a ct(recirc) action I notice that the call to
> > Conntrack is always the first action in the kernel rule that is created.
> In
> > ofproto-dpif-xlate.c a call to compose_conntrack_action() will append a
> > nl_msg for this action, then call recirculate which uses
> > commit_odp_actions() to add messages for previous actions before adding
> its
> > own recirc action to kernel rule action list.  However, I have also
> noticed
> > that when a push mpls action is added that this commit_odp_actions()
> > function is also called which can affect the tuples sent to nf_conntrack.
> >
> > e.g. adding the rule:
> > ovs-ofctl add-flow br0
> > "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,ct(recirc)"
> >
> > will result in a kernel rule with actions of order 'ct, set dst ip,
> recirc'
> > and the sk_buff sent to nf_conntrack_in will have the source and
> destination
> > IP addresses of the matching packet.
> >
> >
> > adding the rule:
> > ovs-ofctl add-flow br0
> >
> "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,push_mpls:0x8847,ct(recirc)"
> >
> > will have actions ordered 'set dst ip, ct, push mpls, recirc' and the
> > destination IP sent into nf_conntrack will be 1.2.3.4
> >
> > Can you clarify if this discrepancy is a bug? Also, can you clarify what
> is
> > the correct way ovs should support Conntrack in an action list? For
> example,
> > in the first rule, is it correct that Conntrack should be applied on the
> > input packet tuples or should the set field be applied before Conntrack
> as
> > it appears before it in the ovs-ofctl rule?
> >
> > Thanks,
> > John
> >
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/e3fd1627/attachment-0001.html>

From joestringer at nicira.com  Thu Jun 25 03:23:51 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 25 Jun 2015 12:23:51 +0200
Subject: [ovs-discuss] ovs-conntrack action ordering?
In-Reply-To: <CAK+XE=kNCFUdeqp3vu5BHWQ9N9wsXHTDFNU2K86eMV5k5qY_iw@mail.gmail.com>
References: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
 <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>
 <CAK+XE=kNCFUdeqp3vu5BHWQ9N9wsXHTDFNU2K86eMV5k5qY_iw@mail.gmail.com>
Message-ID: <CANr6G5w8huEGRwsfQ85bsnQKzaT9J5CO1_m8RUm5HQ-BzCBLnA@mail.gmail.com>

Good example. I agree that the ovs conntrack support should consider
the ordering this way. Setting conn_mark/conn_label is also relevant
to this, as they are currently done via commit_odp_actions(). So they
cannot be done before conntrack() action. This was already how we were
thinking about these commands, and perhaps their ordering should also
be enforced by OpenFlow.

Right, the commit call is what I was looking for. I'll roll this
change into the series soon and start testing with it, see what comes
up. Perhaps the datapath flow translation like this would be a good
test case for the kernel module testsuite too.

Thanks,
Joe

On 25 June 2015 at 11:50, John Hurley <john.hurley at netronome.com> wrote:
> Hi Joe,
>
> Thanks for the response.
>
> Agree with your MPLS points. I was just using the MPLS example as a
> hypothetical situation as I noticed it called the action commit function so
> it could be used to modify IP address fields before Conntrack that were not
> be modified in other ways.
>
> I was more looking clarification that the ordering of the rule actions is
> important in ovs-conntrack so that if we do an IP address set field followed
> by a CT() then the updated IP field should pass into nf_conntrack rather
> than it being the original tuples (as is now).
>
> To me, the former makes more sense here. For example, if the OVS was
> implementing some form of NAT along with connection tracking then using the
> input tuples and not updated fields means we could not track flows
> bidirectionally.
>
> I will take from your response that OVS-Conntrack should consider the
> ordering in this way?
>
> I 'think' the fix for this in the code is quite simple. Just move the action
> commit call from the compose_recirculate_action__() in ofproto-dpif-xlate.c
> to before the netlink message generation in compose_conntrack_action() in
> the same file.  That way previous actions will be pushed before the
> conntrack action.  The commit code would also need to be added to
> compose_recirculation_action() to ensure the actions are committed if a
> recirculation action occurs outside of conntrack.
>
> Thanks,
> John
>
>
>
>
> On Thu, Jun 25, 2015 at 10:05 AM, Joe Stringer <joestringer at nicira.com>
> wrote:
>>
>> Hi John,
>>
>> Thanks for reporting this. It sounds like a bug. As an OpenFlow user,
>> It would be surprising for the order of these actions in the action
>> list to be rearranged like you report. For many fields this doesn't
>> matter (eg, if you only write IP then write TCP port), however for
>> conntrack, the order is more important - when you change the IP
>> address affects how the connection is tracked.  So the flow generation
>> for the first rule looks wrong from that perspective.
>>
>> The core problem here is that while processing the actions list, many
>> of the "set_field" operations are deferred until the end of the
>> processing, whereas conntrack action is not. I think we need to come
>> up with some way to ensure that the flow changes are committed before
>> adding the conntrack action to the datapath actions list. I suspect
>> much of the code is already there for this, it just needs to be hooked
>> up correctly.
>>
>> For the second flow, in some ways I'm inclined to go with the same
>> approach - Commit the MPLS before committing the conntrack action.
>> Also, I don't know what you're expecting the connection tracker to do
>> when it receives MPLS packets. I doubt that the connection tracker
>> would understand how to track MPLS packets or associate them with
>> connections. I'm not sure what behaviour you're getting today, but I
>> would expect all such packets to come back with conn_state=+trk+inv
>> (ie, invalid). What does it even mean to connection-track MPLS
>> packets?
>>
>> On 24 June 2015 at 18:12, John Hurley <john.hurley at netronome.com> wrote:
>> > Hi,
>> >
>> > I have been playing about with ovs-conntrack and noticed an issue that
>> > could
>> > be a bug. Either that or my understanding is incorrect and would
>> > appreciate
>> > clarification.
>> >
>> > When we add a rule with a ct(recirc) action I notice that the call to
>> > Conntrack is always the first action in the kernel rule that is created.
>> > In
>> > ofproto-dpif-xlate.c a call to compose_conntrack_action() will append a
>> > nl_msg for this action, then call recirculate which uses
>> > commit_odp_actions() to add messages for previous actions before adding
>> > its
>> > own recirc action to kernel rule action list.  However, I have also
>> > noticed
>> > that when a push mpls action is added that this commit_odp_actions()
>> > function is also called which can affect the tuples sent to
>> > nf_conntrack.
>> >
>> > e.g. adding the rule:
>> > ovs-ofctl add-flow br0
>> > "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,ct(recirc)"
>> >
>> > will result in a kernel rule with actions of order 'ct, set dst ip,
>> > recirc'
>> > and the sk_buff sent to nf_conntrack_in will have the source and
>> > destination
>> > IP addresses of the matching packet.
>> >
>> >
>> > adding the rule:
>> > ovs-ofctl add-flow br0
>> >
>> > "conn_state=-trk,action=set_field:1.2.3.4->nw_dst,push_mpls:0x8847,ct(recirc)"
>> >
>> > will have actions ordered 'set dst ip, ct, push mpls, recirc' and the
>> > destination IP sent into nf_conntrack will be 1.2.3.4
>> >
>> > Can you clarify if this discrepancy is a bug? Also, can you clarify what
>> > is
>> > the correct way ovs should support Conntrack in an action list? For
>> > example,
>> > in the first rule, is it correct that Conntrack should be applied on the
>> > input packet tuples or should the set field be applied before Conntrack
>> > as
>> > it appears before it in the ovs-ofctl rule?
>> >
>> > Thanks,
>> > John
>> >
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>
>

From gal.sagie at gmail.com  Thu Jun 25 04:21:07 2015
From: gal.sagie at gmail.com (Gal Sagie)
Date: Thu, 25 Jun 2015 14:21:07 +0300
Subject: [ovs-discuss] OVN - Pluggable Distributed DB Infrastructure for
	OVSDB
Message-ID: <CAG9LJa505-0uDXHz46Pgy9WKyT1LAG7LjTN5iCSesEA=8HCyKg@mail.gmail.com>

Hello All,

Currently OVN uses centralized ovsdb-server to serve the Northbound and the
Southbound DB to all the local controllers (sitting at each of the compute
nodes).

It is a single point of failure and probably a major bottleneck to the
operation of OVN in scale.
I know there are efforts to make ovsdb-server distributed using Raft, while
i think this is an important effort i believe that open source is about
being open to alternative and choices while reusing other open and reliable
solutions, this is why i want to suggest the following idea:

Design the DB distribution layer in a pluggable manner, doing so, users can
pick alternate distributed DB options that are reliable and have been in
the market for some time which also have performance optimizations. (Of
course that the default plugin will use the ovsdb-server implementation)
I think an important aspect in this regards is that different
environments/setups with different scale needs can have different solutions
that fits them, the ability to choose which back end to use can help in
these scenarios.

If we analyze OVSDB, there are 3 major areas an alternate solution needs to
support:

1) The DB JSON schema itself
     Should be the same between all solutions

2) The OVSDB protocol features
    like: monitor (publish-subscribe) / transactions / garbage collection /
locking
           sync-verify (multi writes/reads for same values)

    It is important to note that any pluggable solution must support all
these features

3) The connection between the client and the server
     This i believe can be pluggable as long as the messages that are
exchanged (the protocol
     features) are still exchanged

Then the only thing that needs to be modified is basically the client
library which can map
the API's to the client requests depending on the picked solution.

Looking forward hearing your opinions.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/45b63898/attachment.html>

From kevin.traynor at intel.com  Thu Jun 25 05:23:30 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 25 Jun 2015 12:23:30 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
 <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>
 <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745179CB6@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Rapelly, Varun [mailto:vrapelly at sonusnet.com]
> Sent: Thursday, June 25, 2015 10:47 AM
> To: Traynor, Kevin
> Cc: bugs at openvswitch.org; Daniele Di Proietto
> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
> 
> Hi Kevin,
> 
> I'm using branch 2.4 with DPDK2.0.
> But facing cannot link with dpdk while configuring ovs.
> 
> [root at artha ovs-branch-2.4]# grep CONFIG_RTE_LIBRTE_VHOST ~/dpdk-
> 2.0.0/config/common_linuxapp
> CONFIG_RTE_LIBRTE_VHOST=y
> CONFIG_RTE_LIBRTE_VHOST_USER=y
> CONFIG_RTE_LIBRTE_VHOST_DEBUG=n
> [root at artha ovs-branch-2.4]# grep CONFIG_RTE_BUILD ~/dpdk-
> 2.0.0/config/common_linuxapp
> CONFIG_RTE_BUILD_SHARED_LIB=n
> CONFIG_RTE_BUILD_COMBINE_LIBS=y
>  [root at artha ovs-branch-2.4]# ./configure --with-dpdk=$DPDK_BUILD"
> 
> checking for working posix_memalign... yes
> checking whether the preprocessor supports include_next... yes
> checking whether system header files limit the line length... no
> checking for stdio.h... yes
> checking for string.h... (cached) yes
> checking whether gcc -std=gnu99 accepts -Werror... yes
> checking whether gcc -std=gnu99 accepts -Wall... yes
> checking whether gcc -std=gnu99 accepts -Wextra... yes
> checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
> checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
> checking whether gcc -std=gnu99 accepts -Wformat-security... no
> checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
> checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
> checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
> checking whether gcc -std=gnu99 accepts -Wcast-align... yes
> checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
> checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
> checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
> checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers... yes
> checking whether gcc -std=gnu99 accepts -Wthread-safety... no
> checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
> checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
> checking whether gcc -std=gnu99 accepts -Wno-unused... yes
> checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
> checking target hint for cgcc... x86_64
> checking whether make has GNU make $(if) extension... yes
> configure: error: cannot link with dpdk
> 
> Is this a known issue or what?

No, it should be fine. I would probably step through 
https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#building-and-installing
and check if your paths are correct or that you've missed any steps.

> 
> -----Original Message-----
> From: Traynor, Kevin [mailto:kevin.traynor at intel.com]
> Sent: Thursday, June 25, 2015 3:07 PM
> To: Rapelly, Varun; Daniele Di Proietto
> Cc: bugs at openvswitch.org
> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
> 
> 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> > Rapelly, Varun
> > Sent: Wednesday, June 24, 2015 11:43 AM
> > To: Daniele Di Proietto
> > Cc: bugs at openvswitch.org
> > Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> >
> > Hi Daniel,
> >
> > One more thing about the following command after creating the bridge br0:
> >
> > ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
> >
> > If I try to execute the above cmd, it says dpdk0 no such device. And
> > if I give specific interface like ens3f0, even that also does not work.
> 
> dpdk0 is the correct syntax and should work - using ens3f0 is incorrect and
> will not work.
> 
> I think you have a version mismatch between OVS and DPDK. I don't necessarily
> think that is the root cause of the problem you are seeing but best to
> eliminate and work from a more stable point. How about moving to the OVS 2.4
> branch and using DPDK 2.0?
> 
> >
> > What exactly I should use in this case?
> >
> > Regards,
> > Varun
> >
> > -----Original Message-----
> > From: Rapelly, Varun
> > Sent: Wednesday, June 24, 2015 10:07 AM
> > To: 'Daniele Di Proietto'
> > Cc: bugs at openvswitch.org
> > Subject: RE: [ovs-discuss] No Ethernet devices found with I350
> >
> > Hi Daniele,
> >
> > Thanks for your reply :)
> >
> > I'm using openvswitch-2.3.1 and compiled using below set of commands.
> >
> > export DPDK_DIR=/root/dpdk-1.7.1
> > cd /root/dpdk-1.7.1
> > make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1
> > export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> > ./boot.sh
> > ./configure --with-dpdk=$DPDK_BUILD
> > make
> >
> > I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to
> that.
> >
> > [root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> > Network devices using DPDK-compatible driver
> > ============================================
> > <none>
> > Network devices using kernel driver
> > ===================================
> > 0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb
> > unused=
> > 0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
> > unused=
> >
> >  [root at artha ~]# ifconfig -a|grep flags
> > ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> > ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> >
> > PFA setup.sh script, for all the cmd which I used to run ovs.
> >
> > 1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the
> > boot line and 1 GB huge page created 2. When I bind igb_uio driver [to
> > 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon
> > [--with dpdk], Ideally it should detect binded PCI device. Am I right?
> >
> > Please let me know if I'm missing something or something is incorrect
> >
> > Thanks & Regards,
> > Varun
> > -----Original Message-----
> > From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> > Sent: Tuesday, June 23, 2015 10:16 PM
> > To: Rapelly, Varun
> > Cc: bugs at openvswitch.org
> > Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> >
> > The commands you're typing seem correct.
> >
> > Which version of OVS are you using? How are you compiling it?
> >
> > On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
> >
> > >Hi All,
> > >
> > >IÂ¹m a newbie to openvswitch and I followed the below link to install
> > >ovs with DPDK on RHEL7 machine.
> > >
> > >[root at artha ~]# uname -a
> > >Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
> > >x86_64
> > >x86_64 x86_64 GNU/Linux
> > >
> > >https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
> > ><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_open
> > >vs
> > >wit
> > >ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJ
> > >AX
> > >VeA
> > >w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvX
> > >wU
> > >3yO
> > >I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-
> > >uR
> > >NfI
> > >C0hWg&e=>
> > >
> > >When I ran vswitch daemon, it reports following error [I binded
> > >igb_uio to the i350 NIC].
> > >
> > >2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
> > >assigning ports to UIO.
> > >2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> > >
> > >Following PCI bind status.
> > >
> > >[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> > >
> > >Network devices using DPDK-compatible driver
> > >============================================
> > >0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> > >
> > >Network devices using kernel driver
> > >===================================
> > >0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1
> > >drv=tg3 unused=
> > >0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2
> > >drv=tg3 unused=
> > >0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3
> > >drv=tg3 unused=
> > >0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4
> > >drv=tg3 unused=
> > >0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
> > >unused=
> > >
> > >Other network devices
> > >=====================
> > ><none>
> > >
> > >Then I created I ovs bridge using below cmd:
> > >./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs
> > >datapath_type=netdev
> > >
> > >
> > >./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> > >
> > >When I add dpdk port it reports, Â³could not open network device dpdk0
> > >(Unknown error -19)Â²
> > >
> > >Please let me know
> > >1.
> > >What could be possible reason for not detecting the interface which
> > >is binded to igb_uio?
> > >2.
> > >How to add the port which is binded to igb_uio here?
> > >
> > >
> > >Thanks in advance.
> > >
> > >Regards,
> > >Varun
> > >
> > >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss

From David.Griswold at overturenetworks.com  Thu Jun 25 07:01:34 2015
From: David.Griswold at overturenetworks.com (David Griswold)
Date: Thu, 25 Jun 2015 14:01:34 +0000
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
In-Reply-To: <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>
References: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>
Message-ID: <8300925C4469CC4D9B142B85733CCF37737B3EE7@mbx024-e1-nj-2.exch024.domain.local>

The patch works. Thanks for that.

One other anomaly I noticed when displaying tunnel ports:

## port-mode tunnel port, looks good.
##
ovs-appctl tnl/ports/show
Listening ports:
gre_sys (2) : eth_type(0x0800),ipv4(proto=47,frag=no)

## flow-mode tunnel port, port type is garbled
##
ovs-appctl tnl/ports/show
Listening ports:
ï¿½ï¿½ï¿½  (2) : eth_type(0x0800),ipv4(proto=47,frag=no)



-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com]
Sent: Wednesday, June 24, 2015 6:00 PM
To: David Griswold
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Flow-Mode Userspace GRE Tunneling

On Wed, Jun 24, 2015 at 1:40 PM, David Griswold <David.Griswold at overturenetworks.com> wrote:
> Iâ€™m trying to get flow-mode tunneling working with native GRE
> tunneling.  I have a 2 port switch, access and trunk (tunnel) with the
> 2 ports connected to test gear. The problem is that the
> trunk-to-access direction is not working. It looks like packets are
> egressing from b1 on port NORMAL, where they disappear.
>
> When I configure port-mode tunneling, everything works and I notice
> that b1 does not egress to port NORMAL but ingresses directly to b0 from b1.

I think I see the problem, a check from port based tunneling was carried over to the more general native tunneling case. I just sent out a patch, can you please try it out?

> Another observation is that when it is working for port mode
> tunneling, the call to â€œtnl_port_should_receiveâ€ in function â€œxlate_lookup_ofproto_â€
>
> sometimes return â€œtrueâ€. For flow mode tunneling, this function always
> returns â€œfalseâ€.

This check only tests to see if a flow has tunnel IP addresses, which should be true for all decapsulated packets. I guess you are probably looking at this on the physical bridge, where the packet hasn't been decapsulated yet? The "sometimes" for port based tunnels would depend on whether the packet has been decapsulated yet and the never for flow based tunnels is because the process fails before decapsulation.


This email and attachments may contain privileged or confidential information intended only for the addressee(s) indicated. The sender does not waive any of its rights, privileges or protections respecting this information. If you are not the named addressee, an employee, or agent responsible for sending this message to the named addressee (or this message was received by mistake), you are not authorized to read, print, retain, copy or disseminate this message or any part of it. If received in error, please notify us immediately by e-mail, discard any paper copies and delete all electronic files of the email.

Computer viruses can be transmitted via email. The recipient should check this email and any attachments for viruses. Email transmission cannot be guaranteed to be secured or error-free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete, or contain viruses. The sender accepts no liability for any damage caused by any transmitted viruses or errors or omissions in the contents of this message.

Overture Networks, Inc. 637 Davis Drive, Morrisville, NC USA 27560 www.overturenetworks.com

From diproiettod at vmware.com  Thu Jun 25 07:50:28 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Thu, 25 Jun 2015 14:50:28 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
 <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>
 <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <D1B1D0A1.3980%diproiettod@vmware.com>

Would you check config.log? It usually explains what went wrong.

I suspect that the problem you're experiencing might be related
to not having libfuse-dev installed on your system.

Anyway, OVS should depend on libfuse only if DPDK has vhost-cuse
support.  We updated the documentation, but we forgot to update
the build system.

I just sent a patch for that:

http://openvswitch.org/pipermail/dev/2015-June/056853.html

Would you mind checking if it solves your problem?

Thanks,

Daniele

On 25/06/2015 10:47, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi Kevin,
>
>
>
>I'm using branch 2.4 with DPDK2.0.
>
>But facing cannot link with dpdk while configuring ovs.
>
>
>
>[root at artha ovs-branch-2.4]# grep CONFIG_RTE_LIBRTE_VHOST
>~/dpdk-2.0.0/config/common_linuxapp
>
>CONFIG_RTE_LIBRTE_VHOST=y
>
>CONFIG_RTE_LIBRTE_VHOST_USER=y
>
>CONFIG_RTE_LIBRTE_VHOST_DEBUG=n
>
>[root at artha ovs-branch-2.4]# grep CONFIG_RTE_BUILD
>~/dpdk-2.0.0/config/common_linuxapp
>
>CONFIG_RTE_BUILD_SHARED_LIB=n
>
>CONFIG_RTE_BUILD_COMBINE_LIBS=y
>
> [root at artha ovs-branch-2.4]# ./configure --with-dpdk=$DPDK_BUILD"
>
>
>
>checking for working posix_memalign... yes
>
>checking whether the preprocessor supports include_next... yes
>
>checking whether system header files limit the line length... no
>
>checking for stdio.h... yes
>
>checking for string.h... (cached) yes
>
>checking whether gcc -std=gnu99 accepts -Werror... yes
>
>checking whether gcc -std=gnu99 accepts -Wall... yes
>
>checking whether gcc -std=gnu99 accepts -Wextra... yes
>
>checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
>
>checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
>
>checking whether gcc -std=gnu99 accepts -Wformat-security... no
>
>checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
>
>checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
>
>checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
>
>checking whether gcc -std=gnu99 accepts -Wcast-align... yes
>
>checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
>
>checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
>
>checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
>
>checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers...
>yes
>
>checking whether gcc -std=gnu99 accepts -Wthread-safety... no
>
>checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
>
>checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
>
>checking whether gcc -std=gnu99 accepts -Wno-unused... yes
>
>checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
>
>checking target hint for cgcc... x86_64
>
>checking whether make has GNU make $(if) extension... yes
>
>configure: error: cannot link with dpdk
>
>
>
>Is this a known issue or what?
>
>
>
>-----Original Message-----
>
>From: Traynor, Kevin [mailto:kevin.traynor at intel.com]
>
>Sent: Thursday, June 25, 2015 3:07 PM
>
>To: Rapelly, Varun; Daniele Di Proietto
>
>Cc: bugs at openvswitch.org
>
>Subject: RE: [ovs-discuss] No Ethernet devices found with I350
>
>
>
>
>
>> -----Original Message-----
>
>> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
>
>> Rapelly, Varun
>
>> Sent: Wednesday, June 24, 2015 11:43 AM
>
>> To: Daniele Di Proietto
>
>> Cc: bugs at openvswitch.org
>
>> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> Hi Daniel,
>
>> 
>
>> One more thing about the following command after creating the bridge
>>br0:
>
>> 
>
>> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
>
>> 
>
>> If I try to execute the above cmd, it says dpdk0 no such device. And
>
>> if I give specific interface like ens3f0, even that also does not work.
>
>
>
>dpdk0 is the correct syntax and should work - using ens3f0 is incorrect
>and will not work.
>
>
>
>I think you have a version mismatch between OVS and DPDK. I don't
>necessarily think that is the root cause of the problem you are seeing
>but best to eliminate and work from a more stable point. How about moving
>to the OVS 2.4 branch and using DPDK 2.0?
>
>
>
>> 
>
>> What exactly I should use in this case?
>
>> 
>
>> Regards,
>
>> Varun
>
>> 
>
>> -----Original Message-----
>
>> From: Rapelly, Varun
>
>> Sent: Wednesday, June 24, 2015 10:07 AM
>
>> To: 'Daniele Di Proietto'
>
>> Cc: bugs at openvswitch.org
>
>> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> Hi Daniele,
>
>> 
>
>> Thanks for your reply :)
>
>> 
>
>> I'm using openvswitch-2.3.1 and compiled using below set of commands.
>
>> 
>
>> export DPDK_DIR=/root/dpdk-1.7.1
>
>> cd /root/dpdk-1.7.1
>
>> make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1
>
>> export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
>
>> ./boot.sh
>
>> ./configure --with-dpdk=$DPDK_BUILD
>
>> make
>
>> 
>
>> I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to
>>that.
>
>> 
>
>> [root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status
>
>> Network devices using DPDK-compatible driver
>
>> ============================================
>
>> <none>
>
>> Network devices using kernel driver
>
>> ===================================
>
>> 0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb
>
>> unused=
>
>> 0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
>
>> unused=
>
>> 
>
>>  [root at artha ~]# ifconfig -a|grep flags
>
>> ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>
>> ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>
>> 
>
>> PFA setup.sh script, for all the cmd which I used to run ovs.
>
>> 
>
>> 1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the
>
>> boot line and 1 GB huge page created 2. When I bind igb_uio driver [to
>
>> 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon
>
>> [--with dpdk], Ideally it should detect binded PCI device. Am I right?
>
>> 
>
>> Please let me know if I'm missing something or something is incorrect
>
>> 
>
>> Thanks & Regards,
>
>> Varun
>
>> -----Original Message-----
>
>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>
>> Sent: Tuesday, June 23, 2015 10:16 PM
>
>> To: Rapelly, Varun
>
>> Cc: bugs at openvswitch.org
>
>> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> The commands you're typing seem correct.
>
>> 
>
>> Which version of OVS are you using? How are you compiling it?
>
>> 
>
>> On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
>
>> 
>
>> >Hi All,
>
>> >
>
>> >IÂ¹m a newbie to openvswitch and I followed the below link to install
>
>> >ovs with DPDK on RHEL7 machine.
>
>> >
>
>> >[root at artha ~]# uname -a
>
>> >Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
>
>> >x86_64
>
>> >x86_64 x86_64 GNU/Linux
>
>> >
>
>> 
>>>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswi
>>>tch_ovs_blob_master_INSTALL.DPDK.md&d=BQIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAX
>>>VeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=R_Ue3
>>>0CzlqHA05bc5wDd_3-gLaJ9AFXE0N4_C6eg4oc&s=H7oKBrmHam88FMfuimEctZkchrnA3ti
>>>0F5h3s6zRCvM&e= 
>
>> ><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_open
>
>> >vs
>
>> >wit
>
>> >ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJ
>
>> >AX
>
>> >VeA
>
>> >w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvX
>
>> >wU
>
>> >3yO
>
>> >I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-
>
>> >uR
>
>> >NfI
>
>> >C0hWg&e=>
>
>> >
>
>> >When I ran vswitch daemon, it reports following error [I binded
>
>> >igb_uio to the i350 NIC].
>
>> >
>
>> >2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
>
>> >assigning ports to UIO.
>
>> >2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
>
>> >
>
>> >Following PCI bind status.
>
>> >
>
>> >[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
>
>> >
>
>> >Network devices using DPDK-compatible driver
>
>> >============================================
>
>> >0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
>
>> >
>
>> >Network devices using kernel driver
>
>> >===================================
>
>> >0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1
>
>> >drv=tg3 unused=
>
>> >0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2
>
>> >drv=tg3 unused=
>
>> >0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3
>
>> >drv=tg3 unused=
>
>> >0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4
>
>> >drv=tg3 unused=
>
>> >0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
>
>> >unused=
>
>> >
>
>> >Other network devices
>
>> >=====================
>
>> ><none>
>
>> >
>
>> >Then I created I ovs bridge using below cmd:
>
>> >./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs
>
>> >datapath_type=netdev
>
>> >
>
>> >
>
>> >./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
>
>> >
>
>> >When I add dpdk port it reports, Â³could not open network device dpdk0
>
>> >(Unknown error -19)Â²
>
>> >
>
>> >Please let me know
>
>> >1.
>
>> >What could be possible reason for not detecting the interface which
>
>> >is binded to igb_uio?
>
>> >2.
>
>> >How to add the port which is binded to igb_uio here?
>
>> >
>
>> >
>
>> >Thanks in advance.
>
>> >
>
>> >Regards,
>
>> >Varun
>
>> >
>
>> >
>
>> 
>
>> _______________________________________________
>
>> discuss mailing list
>
>> discuss at openvswitch.org
>
>> 
>>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailm
>>an_listinfo_discuss&d=BQIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uE
>>s&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=R_Ue30CzlqHA05bc5wDd_3-
>>gLaJ9AFXE0N4_C6eg4oc&s=gXljBuGE9ayrKr5ND4F_MUuQHbWQTzy6rw7PRD5aVJ4&e=
>


From dongj at dtdream.com  Thu Jun 25 00:27:24 2015
From: dongj at dtdream.com (Dongjun)
Date: Thu, 25 Jun 2015 15:27:24 +0800
Subject: [ovs-discuss] Vxlan encapsulation exceeds the MTU of dpdk port .
Message-ID: <558BAD5C.9000402@dtdream.com>

As following topology, two VMs communicate via Vxlan tunnel.
TCP pkts may be droped for exceeding the mtu of host DPDK port in br2.
Now I can change the VMs' mtu from default to smaller to accommodate the 
traffics, it works well.

The way I have not find to change mtu of DPDK phy port, is there a 
blueprint for supporting this by ovs, like "ovs-appctl 
netdev-dpdk/set-xxx" or another way?

         Host1                  |                     Host2
                     (l-ip)-   L3    -(r-ip)
-----   -----        -----     |     -----       -----  ----- -----
|VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
-----   -----        -----     |     -----       -----  ----- -----


From vrapelly at sonusnet.com  Thu Jun 25 02:47:14 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Thu, 25 Jun 2015 09:47:14 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
 <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>
Message-ID: <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>

Hi Kevin,

I'm using branch 2.4 with DPDK2.0.
But facing cannot link with dpdk while configuring ovs.

[root at artha ovs-branch-2.4]# grep CONFIG_RTE_LIBRTE_VHOST ~/dpdk-2.0.0/config/common_linuxapp
CONFIG_RTE_LIBRTE_VHOST=y
CONFIG_RTE_LIBRTE_VHOST_USER=y
CONFIG_RTE_LIBRTE_VHOST_DEBUG=n
[root at artha ovs-branch-2.4]# grep CONFIG_RTE_BUILD ~/dpdk-2.0.0/config/common_linuxapp
CONFIG_RTE_BUILD_SHARED_LIB=n
CONFIG_RTE_BUILD_COMBINE_LIBS=y
 [root at artha ovs-branch-2.4]# ./configure --with-dpdk=$DPDK_BUILD"

checking for working posix_memalign... yes
checking whether the preprocessor supports include_next... yes
checking whether system header files limit the line length... no
checking for stdio.h... yes
checking for string.h... (cached) yes
checking whether gcc -std=gnu99 accepts -Werror... yes
checking whether gcc -std=gnu99 accepts -Wall... yes
checking whether gcc -std=gnu99 accepts -Wextra... yes
checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
checking whether gcc -std=gnu99 accepts -Wformat-security... no
checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
checking whether gcc -std=gnu99 accepts -Wcast-align... yes
checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers... yes
checking whether gcc -std=gnu99 accepts -Wthread-safety... no
checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
checking whether gcc -std=gnu99 accepts -Wno-unused... yes
checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
checking target hint for cgcc... x86_64
checking whether make has GNU make $(if) extension... yes
configure: error: cannot link with dpdk

Is this a known issue or what?

-----Original Message-----
From: Traynor, Kevin [mailto:kevin.traynor at intel.com] 
Sent: Thursday, June 25, 2015 3:07 PM
To: Rapelly, Varun; Daniele Di Proietto
Cc: bugs at openvswitch.org
Subject: RE: [ovs-discuss] No Ethernet devices found with I350


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of 
> Rapelly, Varun
> Sent: Wednesday, June 24, 2015 11:43 AM
> To: Daniele Di Proietto
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> 
> Hi Daniel,
> 
> One more thing about the following command after creating the bridge br0:
> 
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
> 
> If I try to execute the above cmd, it says dpdk0 no such device. And 
> if I give specific interface like ens3f0, even that also does not work.

dpdk0 is the correct syntax and should work - using ens3f0 is incorrect and will not work. 

I think you have a version mismatch between OVS and DPDK. I don't necessarily think that is the root cause of the problem you are seeing but best to eliminate and work from a more stable point. How about moving to the OVS 2.4 branch and using DPDK 2.0? 

> 
> What exactly I should use in this case?
> 
> Regards,
> Varun
> 
> -----Original Message-----
> From: Rapelly, Varun
> Sent: Wednesday, June 24, 2015 10:07 AM
> To: 'Daniele Di Proietto'
> Cc: bugs at openvswitch.org
> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
> 
> Hi Daniele,
> 
> Thanks for your reply :)
> 
> I'm using openvswitch-2.3.1 and compiled using below set of commands.
> 
> export DPDK_DIR=/root/dpdk-1.7.1
> cd /root/dpdk-1.7.1
> make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1 
> export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> ./boot.sh
> ./configure --with-dpdk=$DPDK_BUILD
> make
> 
> I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports to that.
> 
> [root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status 
> Network devices using DPDK-compatible driver 
> ============================================
> <none>
> Network devices using kernel driver
> ===================================
> 0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb 
> unused=
> 0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb 
> unused=
> 
>  [root at artha ~]# ifconfig -a|grep flags
> ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> 
> PFA setup.sh script, for all the cmd which I used to run ovs.
> 
> 1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the 
> boot line and 1 GB huge page created 2. When I bind igb_uio driver [to
> 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon 
> [--with dpdk], Ideally it should detect binded PCI device. Am I right?
> 
> Please let me know if I'm missing something or something is incorrect
> 
> Thanks & Regards,
> Varun
> -----Original Message-----
> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> Sent: Tuesday, June 23, 2015 10:16 PM
> To: Rapelly, Varun
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
> 
> The commands you're typing seem correct.
> 
> Which version of OVS are you using? How are you compiling it?
> 
> On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
> 
> >Hi All,
> >
> >IÂ¹m a newbie to openvswitch and I followed the below link to install 
> >ovs with DPDK on RHEL7 machine.
> >
> >[root at artha ~]# uname -a
> >Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
> >x86_64
> >x86_64 x86_64 GNU/Linux
> >
> >https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md
> ><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_open
> >vs
> >wit
> >ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiDJ
> >AX
> >VeA
> >w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELvX
> >wU
> >3yO
> >I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr-
> >uR
> >NfI
> >C0hWg&e=>
> >
> >When I ran vswitch daemon, it reports following error [I binded 
> >igb_uio to the i350 NIC].
> >
> >2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try 
> >assigning ports to UIO.
> >2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
> >
> >Following PCI bind status.
> >
> >[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
> >
> >Network devices using DPDK-compatible driver 
> >============================================
> >0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
> >
> >Network devices using kernel driver
> >===================================
> >0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1 
> >drv=tg3 unused=
> >0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2 
> >drv=tg3 unused=
> >0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3 
> >drv=tg3 unused=
> >0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4 
> >drv=tg3 unused=
> >0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb 
> >unused=
> >
> >Other network devices
> >=====================
> ><none>
> >
> >Then I created I ovs bridge using below cmd:
> >./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs 
> >datapath_type=netdev
> >
> >
> >./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
> >
> >When I add dpdk port it reports, Â³could not open network device dpdk0 
> >(Unknown error -19)Â²
> >
> >Please let me know
> >1.
> >What could be possible reason for not detecting the interface which 
> >is binded to igb_uio?
> >2.
> >How to add the port which is binded to igb_uio here?
> >
> >
> >Thanks in advance.
> >
> >Regards,
> >Varun
> >
> >
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From vrapelly at sonusnet.com  Thu Jun 25 04:13:07 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Thu, 25 Jun 2015 11:13:07 +0000
Subject: [ovs-discuss] Did anybody successfully compiled branch 2.4 with
	dpdk 2.0?
Message-ID: <BLUPR03MB264A73F6989CB50E980CDA5B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>

Hi Team,

When I tried to configure with branch2.4 [and in master branch also] with DPDK, getting following error. I had updated the following in config/common_linuxapp file in dpdk-2.0 dir.

     `CONFIG_RTE_BUILD_COMBINE_LIBS=y`
     `CONFIG_RTE_LIBRTE_VHOST=y`

Following error is coming:

checking for stdio.h... yes
checking for string.h... (cached) yes
checking whether gcc -std=gnu99 accepts -Werror... yes
checking whether gcc -std=gnu99 accepts -Wall... yes
checking whether gcc -std=gnu99 accepts -Wextra... yes
checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
checking whether gcc -std=gnu99 accepts -Wformat-security... no
checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
checking whether gcc -std=gnu99 accepts -Wcast-align... yes
checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers... yes
checking whether gcc -std=gnu99 accepts -Wthread-safety... no
checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
checking whether gcc -std=gnu99 accepts -Wno-unused... yes
checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
checking target hint for cgcc... x86_64
checking whether make has GNU make $(if) extension... yes
configure: error: cannot link with dpdk


Regards,
Varun

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/27f307d1/attachment-0001.html>

From lapngodoan at gmail.com  Thu Jun 25 09:46:36 2015
From: lapngodoan at gmail.com (Ngo Doan Lap)
Date: Thu, 25 Jun 2015 23:46:36 +0700
Subject: [ovs-discuss] Did anybody successfully compiled branch 2.4 with
 dpdk 2.0?
In-Reply-To: <BLUPR03MB264A73F6989CB50E980CDA5B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
References: <BLUPR03MB264A73F6989CB50E980CDA5B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
Message-ID: <CAEgdzZJWR=4zm_B47XR1GUCskZUG=8WTtJKUF-KXzh-A_L2inA@mail.gmail.com>

Hi,
I got this issue also and after check the config.log, I found that dpdk
build directory was not set correctly.
The correct config: ./configure --with-dpdk=$RTE_SDK/$RTE_TARGET
Where RTE_SDK is your dpdk source and RTE_TARGET is your build target.
Of course, you need to build dpdk first.



On Thu, Jun 25, 2015 at 6:13 PM, Rapelly, Varun <vrapelly at sonusnet.com>
wrote:

>  Hi Team,
>
>
>
> When I tried to configure with branch2.4 [and in master branch also] with
> DPDK, getting following error. I had updated the following in
> config/common_linuxapp file in dpdk-2.0 dir.
>
>
>
>      `CONFIG_RTE_BUILD_COMBINE_LIBS=y`
>
>      `CONFIG_RTE_LIBRTE_VHOST=y`
>
>
>
> Following error is coming:
>
>
>
> checking for stdio.h... yes
>
> checking for string.h... (cached) yes
>
> checking whether gcc -std=gnu99 accepts -Werror... yes
>
> checking whether gcc -std=gnu99 accepts -Wall... yes
>
> checking whether gcc -std=gnu99 accepts -Wextra... yes
>
> checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
>
> checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
>
> checking whether gcc -std=gnu99 accepts -Wformat-security... no
>
> checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
>
> checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
>
> checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
>
> checking whether gcc -std=gnu99 accepts -Wcast-align... yes
>
> checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
>
> checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
>
> checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
>
> checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers... yes
>
> checking whether gcc -std=gnu99 accepts -Wthread-safety... no
>
> checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
>
> checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
>
> checking whether gcc -std=gnu99 accepts -Wno-unused... yes
>
> checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
>
> checking target hint for cgcc... x86_64
>
> checking whether make has GNU make $(if) extension... yes
>
> configure: error: cannot link with dpdk
>
>
>
>
>
> Regards,
>
> Varun
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>


-- 
Thanks and Best Regards,
Ngo Doan Lap
Mobile: 0977.833.757
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/f351a1d7/attachment.html>

From lapngodoan at gmail.com  Thu Jun 25 09:51:22 2015
From: lapngodoan at gmail.com (Ngo Doan Lap)
Date: Thu, 25 Jun 2015 23:51:22 +0700
Subject: [ovs-discuss] OVS Performance
In-Reply-To: <360797519.929566.1435199772089.JavaMail.yahoo@mail.yahoo.com>
References: <360797519.929566.1435199772089.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAEgdzZLkzoCv6yLv1B0HEjW8t09jwsGg6_qZNib+x+nsj0gpRw@mail.gmail.com>

Hi,
Just for 1), please refer to test case 3,7,8,9 here
https://01.org/sites/default/files/page/intel_onp_server_release_1.3.1_benchmark_test_report.pdf


On Thu, Jun 25, 2015 at 9:36 AM, Ravi Ramaswamy <rsr624 at yahoo.com> wrote:

> Hello - Apologies.  Newbie to OVS and this is my first posting.  I am
> trying to get a high level understanding of the following.  Any pointers is
> greatly appreciated
>
> * IP forwarding performance and dependence on packet size, flow
> distribution, etc
> * MPLS support on OVS
> * Multi-tenant support (I am thinking VRFs / MPLS/VPNs)
>
> Thanks
>
> Ravi
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>


-- 
Thanks and Best Regards,
Ngo Doan Lap
Mobile: 0977.833.757
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150625/808879fa/attachment.html>

From jesse at nicira.com  Thu Jun 25 16:17:43 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 25 Jun 2015 16:17:43 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <004d01d0aeef$d5989db0$80c9d910$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
 <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
 <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>
 <004d01d0aeef$d5989db0$80c9d910$@snoopy.ORG>
Message-ID: <CAEP_g=_GSTKN1WnDnrQ5WS0tZGjHzjrBuu=QKeyCMdVKPQF3cg@mail.gmail.com>

On Wed, Jun 24, 2015 at 7:37 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Tried configuring 2.4 by hand
>
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.4.90
> Compiled Jun 24 2015 19:16:45
> DB Schema 7.12.1
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# uname -r
> 3.16.0-4-amd64
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps#
>
>
> ./configure --prefix=/usr --localstatedir=/var --with-linux=/lib/modules/`uname -r`/build
>  make; make install;
>  make modules_install; sudo depmod -a
>
> and its still the same, 2 bytes off.
>
> Will update if I see anything else.  Thanks!

OK, thanks. I guess it seems somewhat unlikely to be related to OVS at
this point, although I don't have a good theory as to what would cause
this. Let us know if you find anything more.

From jesse at nicira.com  Thu Jun 25 16:29:19 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 25 Jun 2015 16:29:19 -0700
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
In-Reply-To: <8300925C4469CC4D9B142B85733CCF37737B3EE7@mbx024-e1-nj-2.exch024.domain.local>
References: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>
 <8300925C4469CC4D9B142B85733CCF37737B3EE7@mbx024-e1-nj-2.exch024.domain.local>
Message-ID: <CAEP_g=8Cbxv7Pe=s5yavV-gJBxh==8DO1u5acV9toeq9ikZudg@mail.gmail.com>

On Thu, Jun 25, 2015 at 7:01 AM, David Griswold
<David.Griswold at overturenetworks.com> wrote:
> The patch works. Thanks for that.
>
> One other anomaly I noticed when displaying tunnel ports:
>
> ## port-mode tunnel port, looks good.
> ##
> ovs-appctl tnl/ports/show
> Listening ports:
> gre_sys (2) : eth_type(0x0800),ipv4(proto=47,frag=no)
>
> ## flow-mode tunnel port, port type is garbled
> ##
> ovs-appctl tnl/ports/show
> Listening ports:
> ï¿½ï¿½ï¿½  (2) : eth_type(0x0800),ipv4(proto=47,frag=no)

Hmm, I'm guess I'm not sure how this would happen and I can't
reproduce it (and I really don't understand why it would be different
between flow-based and port-based tunnels since there shouldn't be any
difference at this level). Does this happen consistently for you? What
about different types of tunnels or any other clues you can spot?

From blp at nicira.com  Thu Jun 25 16:32:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 25 Jun 2015 16:32:28 -0700
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
In-Reply-To: <CAEP_g=8Cbxv7Pe=s5yavV-gJBxh==8DO1u5acV9toeq9ikZudg@mail.gmail.com>
References: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>
 <8300925C4469CC4D9B142B85733CCF37737B3EE7@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=8Cbxv7Pe=s5yavV-gJBxh==8DO1u5acV9toeq9ikZudg@mail.gmail.com>
Message-ID: <20150625233228.GK9294@nicira.com>

On Thu, Jun 25, 2015 at 04:29:19PM -0700, Jesse Gross wrote:
> On Thu, Jun 25, 2015 at 7:01 AM, David Griswold
> <David.Griswold at overturenetworks.com> wrote:
> > The patch works. Thanks for that.
> >
> > One other anomaly I noticed when displaying tunnel ports:
> >
> > ## port-mode tunnel port, looks good.
> > ##
> > ovs-appctl tnl/ports/show
> > Listening ports:
> > gre_sys (2) : eth_type(0x0800),ipv4(proto=47,frag=no)
> >
> > ## flow-mode tunnel port, port type is garbled
> > ##
> > ovs-appctl tnl/ports/show
> > Listening ports:
> > ï¿½ï¿½ï¿½  (2) : eth_type(0x0800),ipv4(proto=47,frag=no)
> 
> Hmm, I'm guess I'm not sure how this would happen and I can't
> reproduce it (and I really don't understand why it would be different
> between flow-based and port-based tunnels since there shouldn't be any
> difference at this level). Does this happen consistently for you? What
> about different types of tunnels or any other clues you can spot?

When I see stuff like this, I try "valgrind".

From stefano.salsano at uniroma2.it  Thu Jun 25 18:02:03 2015
From: stefano.salsano at uniroma2.it (Stefano Salsano)
Date: Fri, 26 Jun 2015 03:02:03 +0200
Subject: [ovs-discuss] OVS bug on Ubuntu 14.04
Message-ID: <558CA48B.4050605@uniroma2.it>

Hi,

we are not able to push MPLS labels (even a single one) in Ubuntu 
14.04.1 LTS, with kernel 3.13.0-34 using open vswitch 2.390 (master branch)

previously it was working, for example we have no problem with kernel 
3.8.0-35 (in which we were also able to push multiple MPLS label)

as a simple test scenario, we use a mininet topology with 2 hosts and 
one ovs-kernel switch

H1 ----> SW -----> H2

SW is supposed to take ingress traffic from H1, push one MPLS label and 
forward to H2

the rules are installed in OVS and visible with ofctl, but when a packet 
enters the switch from H1, the packet is not forwarded (while the 
statistics are increased) and the following error is logged in 
ovs-vswitchd log:

2015-06-16T11:38:08.448Z|00179|dpif(handler9)|WARN|system at ovs-system: 
failed to put[create]
(Invalid argument) ufid:a89d1ff5-a023-42e2-ac9b-ba9c2ce87b06 
skb_priority(0/0), 
in_port(2),skb_mark(0/0),eth(src=a6:5d:18:53:e0:2e/00:00:00:00:00:00, 
dst=fa:d7:84:15:da:ff/00:00:00:00:00:00), eth_type(0x0800), 
ipv4(src=10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0xfc, 
ttl=64,frag=no), icmp(type=8/0,code=0/0), 
actions:push_mpls(label=524296, tc=0, ttl=64, bos=1, eth_type=0x8847),1

2015-06-16T11:38:08.448Z|00180|dpif(handler9)|WARN|system at ovs-system: 
execute push_mpls(label=524296,tc=0,ttl=64,bos=1,eth_type=0x8847), 1 
failed (Invalid argument) on packet icmp, vlan_tci=0x0000, 
dl_src=a6:5d:18:53:e0:2e, dl_dst=fa:d7:84:15:da:ff, nw_src=10.0.0.1, 
nw_dst=10.0.0.2, nw_tos=0, nw_ecn=0, nw_ttl=64, icmp_type=8,i cmp_code=0 
icmp_csum:a411

the mininet script we use to reproduce the problem is attached below

thank you for your support

ciao
Stefano e Pier Luigi


-- 
*******************************************************************
Stefano Salsano
Professore Associato
Dipartimento Ingegneria Elettronica
Universita' di Roma Tor Vergata
Via del Politecnico, 1 - 00133 Roma - ITALY

http://netgroup.uniroma2.it/Stefano_Salsano/

E-mail  : stefano.salsano at uniroma2.it
Cell.   : +39 320 4307310
Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
*******************************************************************

-------------- next part --------------
#!/usr/bin/python

import subprocess

from mininet.net import Mininet
from mininet.node import Host, OVSKernelSwitch, Node
from mininet.cli import CLI
from mininet.log import lg, info

def setup():

        lg.setLogLevel('info')

        net = Mininet(switch=OVSKernelSwitch, build=False, autoStaticArp=True )

        host1 = net.addHost("h1")
        host2 = net.addHost("h2")

        peo1 = net.addSwitch("peo1")

        net.addLink(host1, peo1)# N/A | 1
        net.addLink(host2, peo1)# N/A | 2

        net.start()

        #PEO1 Configuration
        root = Node( 'root', inNamespace=False )
        root.cmd('ovs-vsctl --no-wait set bridge %s protocols=OpenFlow13' %(peo1.name))
        root.cmd('ovs-ofctl -O OpenFlow13 add-flow %s "table=0,hard_timeout=0,priority=32768,in_port=1,eth_type=0x800,actions=push_mpls:0x8847,set_field:524296->mpls_lab$
        root.cmd('ovs-ofctl -O OpenFlow13 add-flow %s "table=1,hard_timeout=0,priority=32768,in_port=1,eth_type=0x8847,mpls_label=524296,action=output:2"' %(peo1.name))

        CLI(net)
        net.stop()
        subprocess.call(["sudo", "mn", "-c"], stdout=None, stderr=None)


if __name__ == '__main__':
        setup()



From lucabianchi91 at hotmail.it  Thu Jun 25 15:59:10 2015
From: lucabianchi91 at hotmail.it (Luca Bianchi)
Date: Fri, 26 Jun 2015 00:59:10 +0200
Subject: [ovs-discuss] prio scheduler
In-Reply-To: <20150611222155.GC23632@nicira.com>
References: <DUB127-W2D0E12EA66EF3BAE259D4C6B20@phx.gbl>,
 <20150611175359.GH32341@nicira.com>,
 <DUB127-W5889817252F854F461E17C6BC0@phx.gbl>,
 <20150611222155.GC23632@nicira.com>
Message-ID: <DUB127-W7356D3235566B8BED569F3C6AE0@phx.gbl>

Hi,

(sorry for dropping the mailing list, I had troubles with a new mail client)


I think that the problem is in the translation of queue names between OF, ovs and linux. 


I explain briefly:


I have 3 iperf client, an ovs switch and an iperf server (linked to switch's eth4) 





h1---link 10M---|-s1:eth1---queue1 or 123---\


h2---link 10M---|-s1:eth2---queue2 or 234---|-qdisc---s1:eth4-|---link 10M---h4


h3---link 10M---|-s1:eth3---queue3 or 345---/





I direct the traffic of each client on a separate queue to see how 
bandwidth sharing reflects scheduler's setting (observed from h4)





---------HTB-------------


In both htb cases, the controller install rules that direct flows to queues 123, 234, 345.


---case1, ovs commands, working---


With ovs commands I create queue 123, 234, 345 (that in exa correspond to 7b, ea, 159).


When I check with tc commands, I notice that Linux kernel automatically 
creates an htb qdisc 1:, to which is attached class 1:ffe,to which are 
attached classes 1:7c, 1:eb, 1:15a (notice that it increments the number
 of 1). Everything works.


---case2, tc commands, working---


I can also execute directly tc commands (creating classes ffe,7c,eb,15a)
 and obtain the same htb scheduler, and everything works.


 


(bandwidth is divided as expected, wheter I configure with ovs commands or tc commands)





---------PRIO-------------------------


When I use the command "tc qdisc add dev s1-eth4 root handle 1: prio"


linux kernel creates the qdisc prio 1:, to which are attached classes 1:1, 1:2, 1:3.


Using the same logic of htb (linux increments queue id of 1) I thought 
that the openflow rules should use queues 0,1,2. But every flows get 
simultaneously the whole link capacity.


(I tried also with 1,2,3)





I don't know how to catch the queues' name used by Openflow, since if 
classes are created with tc commands (in both cases, htb and prio) 
"ovs-vsctl list qos" and "ovs-vsctl list queue" gives no answer.





Thank you very much



Luca Bianchi

> Date: Thu, 11 Jun 2015 15:21:55 -0700
> From: blp at nicira.com
> To: lucabianchi91 at hotmail.it
> CC: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] prio scheduler
> 
> Please don't drop the mailing list.
> 
> Are you sure Mininet isn't interfering?  It also sets up QoS.
> 
> Are you directing packets to queues?
> 
> ### Q: I configured Quality of Service (QoS) in my OpenFlow network by
>    adding records to the QoS and Queue table, but the results aren't
>    what I expect.
> 
> A: Did you install OpenFlow flows that use your queues?  This is the
>    primary way to tell Open vSwitch which queues you want to use.  If
>    you don't do this, then the default queue will be used, which will
>    probably not have the effect you want.
> 
>    Refer to the previous question for an example.
> 
> On Thu, Jun 11, 2015 at 08:17:09PM +0200, Luca Bianchi wrote:
> > Hi,I am trying to configure a prio qdisc on an OVS switch (all the network is emulated on Mininet).Since officially OVS does not support this type of qdisc, I used directly tc commands to configure it.Then, when making packets pass through the interface with prio qdisc,I noticed this strange behaviour, and I think it's an interaction problem between OVS and prio.Can you please help me to do this configuration?Thank youBest Regards
> > Luca Bianchi
> > 
> > > Date: Thu, 11 Jun 2015 10:53:59 -0700
> > > From: blp at nicira.com
> > > To: lucabianchi91 at hotmail.it
> > > CC: bugs at openvswitch.org
> > > Subject: Re: [ovs-discuss] prio scheduler
> > > 
> > > On Fri, Jun 05, 2015 at 07:19:14PM +0200, Luca Bianchi wrote:
> > > > I am trying to configure QoS on OVS, running on mininet network.
> > > > 
> > > > I install a PRIO qdisc on an interface with the command
> > > > 
> > > > tc qdisc add dev s1-eth4 root handle 1: prio
> > > > 
> > > > and then the classes 1:1, 1:2, 1:3 are automatically created.
> > > > 
> > > > The problem is that every user flow passing from that interface now has the whole interface capacity.
> > > > 
> > > > E.g. 3 user TCP flows pass from this interface (link of capacity 10Mbps), everyone
> > > > is served with 10Mbps...that is impossible. With htb qdisc (also if configured with tc commands)
> > > > there are no problems.
> > > 
> > > Are you just reporting how the prio qdisc works, or are you talking
> > > about some interaction between OVS and the prio qdisc?
> >  		 	   		  
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150626/de15e03d/attachment-0001.html>

From abhinavnzl at gmail.com  Thu Jun 25 16:21:23 2015
From: abhinavnzl at gmail.com (Abhinav)
Date: Fri, 26 Jun 2015 04:51:23 +0530
Subject: [ovs-discuss] open Vswitch
Message-ID: <CABiFN_9BFRKrTPgZTM_yJ93+-jm3zgPJsSRXF3HY92b+CeXOug@mail.gmail.com>

Hi ,

Could you please tell me what is the difference betwwen ovs-dpctl and
ovs-appctl.
Also let me know what is the difference between ovs and linux bridge ?

Regards
Abhinav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150626/d8f105a0/attachment.html>

From vrapelly at sonusnet.com  Thu Jun 25 23:15:20 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Fri, 26 Jun 2015 06:15:20 +0000
Subject: [ovs-discuss] No Ethernet devices found with I350
In-Reply-To: <D1B1D0A1.3980%diproiettod@vmware.com>
References: <BLUPR03MB26438D2783EDEEE23C6C491B7A00@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1AF4783.3520%diproiettod@vmware.com>
 <BLUPR03MB2646958FCFFD7F53D6C1BADB7AF0@BLUPR03MB264.namprd03.prod.outlook.com>
 <BC0FEEC7D7650749874CEC11314A88F74517790A@IRSMSX104.ger.corp.intel.com>
 <BLUPR03MB2647BA753B9FB7FBCF884A2B7AE0@BLUPR03MB264.namprd03.prod.outlook.com>
 <D1B1D0A1.3980%diproiettod@vmware.com>
Message-ID: <BLUPR03MB264B9A1E4212CB2220BF5CEB7AD0@BLUPR03MB264.namprd03.prod.outlook.com>

Hi Daniele,

After applying your patch, I'm able to build.

Thanks.

-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Thursday, June 25, 2015 8:20 PM
To: Rapelly, Varun
Cc: bugs at openvswitch.org; Traynor, Kevin
Subject: Re: [ovs-discuss] No Ethernet devices found with I350

Would you check config.log? It usually explains what went wrong.

I suspect that the problem you're experiencing might be related to not having libfuse-dev installed on your system.

Anyway, OVS should depend on libfuse only if DPDK has vhost-cuse support.  We updated the documentation, but we forgot to update the build system.

I just sent a patch for that:

http://openvswitch.org/pipermail/dev/2015-June/056853.html

Would you mind checking if it solves your problem?

Thanks,

Daniele

On 25/06/2015 10:47, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:

>Hi Kevin,
>
>
>
>I'm using branch 2.4 with DPDK2.0.
>
>But facing cannot link with dpdk while configuring ovs.
>
>
>
>[root at artha ovs-branch-2.4]# grep CONFIG_RTE_LIBRTE_VHOST 
>~/dpdk-2.0.0/config/common_linuxapp
>
>CONFIG_RTE_LIBRTE_VHOST=y
>
>CONFIG_RTE_LIBRTE_VHOST_USER=y
>
>CONFIG_RTE_LIBRTE_VHOST_DEBUG=n
>
>[root at artha ovs-branch-2.4]# grep CONFIG_RTE_BUILD 
>~/dpdk-2.0.0/config/common_linuxapp
>
>CONFIG_RTE_BUILD_SHARED_LIB=n
>
>CONFIG_RTE_BUILD_COMBINE_LIBS=y
>
> [root at artha ovs-branch-2.4]# ./configure --with-dpdk=$DPDK_BUILD"
>
>
>
>checking for working posix_memalign... yes
>
>checking whether the preprocessor supports include_next... yes
>
>checking whether system header files limit the line length... no
>
>checking for stdio.h... yes
>
>checking for string.h... (cached) yes
>
>checking whether gcc -std=gnu99 accepts -Werror... yes
>
>checking whether gcc -std=gnu99 accepts -Wall... yes
>
>checking whether gcc -std=gnu99 accepts -Wextra... yes
>
>checking whether gcc -std=gnu99 accepts -Wno-sign-compare... yes
>
>checking whether gcc -std=gnu99 accepts -Wpointer-arith... yes
>
>checking whether gcc -std=gnu99 accepts -Wformat-security... no
>
>checking whether gcc -std=gnu99 accepts -Wswitch-enum... yes
>
>checking whether gcc -std=gnu99 accepts -Wunused-parameter... yes
>
>checking whether gcc -std=gnu99 accepts -Wbad-function-cast... yes
>
>checking whether gcc -std=gnu99 accepts -Wcast-align... yes
>
>checking whether gcc -std=gnu99 accepts -Wstrict-prototypes... no
>
>checking whether gcc -std=gnu99 accepts -Wold-style-definition... no
>
>checking whether gcc -std=gnu99 accepts -Wmissing-prototypes... yes
>
>checking whether gcc -std=gnu99 accepts -Wmissing-field-initializers...
>yes
>
>checking whether gcc -std=gnu99 accepts -Wthread-safety... no
>
>checking whether gcc -std=gnu99 accepts -fno-strict-aliasing... yes
>
>checking whether gcc -std=gnu99 accepts -Qunused-arguments... no
>
>checking whether gcc -std=gnu99 accepts -Wno-unused... yes
>
>checking whether gcc -std=gnu99 accepts -Wno-unused-parameter... yes
>
>checking target hint for cgcc... x86_64
>
>checking whether make has GNU make $(if) extension... yes
>
>configure: error: cannot link with dpdk
>
>
>
>Is this a known issue or what?
>
>
>
>-----Original Message-----
>
>From: Traynor, Kevin [mailto:kevin.traynor at intel.com]
>
>Sent: Thursday, June 25, 2015 3:07 PM
>
>To: Rapelly, Varun; Daniele Di Proietto
>
>Cc: bugs at openvswitch.org
>
>Subject: RE: [ovs-discuss] No Ethernet devices found with I350
>
>
>
>
>
>> -----Original Message-----
>
>> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
>
>> Rapelly, Varun
>
>> Sent: Wednesday, June 24, 2015 11:43 AM
>
>> To: Daniele Di Proietto
>
>> Cc: bugs at openvswitch.org
>
>> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> Hi Daniel,
>
>> 
>
>> One more thing about the following command after creating the bridge
>>br0:
>
>> 
>
>> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk.
>
>> 
>
>> If I try to execute the above cmd, it says dpdk0 no such device. And
>
>> if I give specific interface like ens3f0, even that also does not work.
>
>
>
>dpdk0 is the correct syntax and should work - using ens3f0 is incorrect 
>and will not work.
>
>
>
>I think you have a version mismatch between OVS and DPDK. I don't 
>necessarily think that is the root cause of the problem you are seeing 
>but best to eliminate and work from a more stable point. How about 
>moving to the OVS 2.4 branch and using DPDK 2.0?
>
>
>
>> 
>
>> What exactly I should use in this case?
>
>> 
>
>> Regards,
>
>> Varun
>
>> 
>
>> -----Original Message-----
>
>> From: Rapelly, Varun
>
>> Sent: Wednesday, June 24, 2015 10:07 AM
>
>> To: 'Daniele Di Proietto'
>
>> Cc: bugs at openvswitch.org
>
>> Subject: RE: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> Hi Daniele,
>
>> 
>
>> Thanks for your reply :)
>
>> 
>
>> I'm using openvswitch-2.3.1 and compiled using below set of commands.
>
>> 
>
>> export DPDK_DIR=/root/dpdk-1.7.1
>
>> cd /root/dpdk-1.7.1
>
>> make install T=x86_64-native-linuxapp-gcc cd /root/openvswitch-2.3.1
>
>> export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
>
>> ./boot.sh
>
>> ./configure --with-dpdk=$DPDK_BUILD
>
>> make
>
>> 
>
>> I would like to create a OVS bridge by adding ens3f0 & ens3f1 ports 
>>to that.
>
>> 
>
>> [root at artha ~]# /root/dpdk-1.7.1/tools/dpdk_nic_bind.py --status
>
>> Network devices using DPDK-compatible driver
>
>> ============================================
>
>> <none>
>
>> Network devices using kernel driver
>
>> ===================================
>
>> 0000:0a:00.0 'I350 Gigabit Network Connection' if=ens3f0 drv=igb
>
>> unused=
>
>> 0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
>
>> unused=
>
>> 
>
>>  [root at artha ~]# ifconfig -a|grep flags
>
>> ens3f0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>
>> ens3f1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>
>> 
>
>> PFA setup.sh script, for all the cmd which I used to run ovs.
>
>> 
>
>> 1. I added "default_hugepagesz=1GB hugepagesz=1G hugepages=1" to the
>
>> boot line and 1 GB huge page created 2. When I bind igb_uio driver 
>> [to
>
>> 0000:0a:00.0  & 0000:0a:00.1 ] and then if I run vswitch daemon
>
>> [--with dpdk], Ideally it should detect binded PCI device. Am I right?
>
>> 
>
>> Please let me know if I'm missing something or something is incorrect
>
>> 
>
>> Thanks & Regards,
>
>> Varun
>
>> -----Original Message-----
>
>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>
>> Sent: Tuesday, June 23, 2015 10:16 PM
>
>> To: Rapelly, Varun
>
>> Cc: bugs at openvswitch.org
>
>> Subject: Re: [ovs-discuss] No Ethernet devices found with I350
>
>> 
>
>> The commands you're typing seem correct.
>
>> 
>
>> Which version of OVS are you using? How are you compiling it?
>
>> 
>
>> On 23/06/2015 08:23, "Rapelly, Varun" <vrapelly at sonusnet.com> wrote:
>
>> 
>
>> >Hi All,
>
>> >
>
>> >IÂ¹m a newbie to openvswitch and I followed the below link to install
>
>> >ovs with DPDK on RHEL7 machine.
>
>> >
>
>> >[root at artha ~]# uname -a
>
>> >Linux BL4 3.10.0-123.el7.x86_64 #1 SMP Mon May 5 11:16:57 EDT 2014
>
>> >x86_64
>
>> >x86_64 x86_64 GNU/Linux
>
>> >
>
>> 
>>>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openv
>>>swi 
>>>tch_ovs_blob_master_INSTALL.DPDK.md&d=BQIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiD
>>>JAX
>>>VeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=R_
>>>Ue3 
>>>0CzlqHA05bc5wDd_3-gLaJ9AFXE0N4_C6eg4oc&s=H7oKBrmHam88FMfuimEctZkchrnA
>>>3ti
>>>0F5h3s6zRCvM&e=
>
>> ><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_ope
>> >n
>
>> >vs
>
>> >wit
>
>> >ch_ovs_blob_master_INSTALL.DPDK.md&d=BQMFAg&c=Sqcl0Ez6M0X8aeM67LKIiD
>> >J
>
>> >AX
>
>> >VeA
>
>> >w-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=BELv
>> >X
>
>> >wU
>
>> >3yO
>
>> >I7c4Fnird6AUH868juo1h2R4VdS2w87ps&s=d8CFnv-IsbTKEf_5cvZ6JCE-HwaX1qSr
>> >-
>
>> >uR
>
>> >NfI
>
>> >C0hWg&e=>
>
>> >
>
>> >When I ran vswitch daemon, it reports following error [I binded
>
>> >igb_uio to the i350 NIC].
>
>> >
>
>> >2015-06-22T18:04:38Z|00003|dpdk|ERR|No Ethernet devices found. Try
>
>> >assigning ports to UIO.
>
>> >2015-06-22T18:04:38Z|00004|dpdk|INFO|Ethernet Device Count: 0
>
>> >
>
>> >Following PCI bind status.
>
>> >
>
>> >[root at artha ~]# ./dpdk-1.7.1/tools/dpdk_nic_bind.py --status
>
>> >
>
>> >Network devices using DPDK-compatible driver
>
>> >============================================
>
>> >0000:0a:00.0 'I350 Gigabit Network Connection' drv=igb_uio unused=
>
>> >
>
>> >Network devices using kernel driver
>
>> >===================================
>
>> >0000:03:00.0 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno1
>
>> >drv=tg3 unused=
>
>> >0000:03:00.1 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno2
>
>> >drv=tg3 unused=
>
>> >0000:03:00.2 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno3
>
>> >drv=tg3 unused=
>
>> >0000:03:00.3 'NetXtreme BCM5719 Gigabit Ethernet PCIe' if=eno4
>
>> >drv=tg3 unused=
>
>> >0000:0a:00.1 'I350 Gigabit Network Connection' if=ens3f1 drv=igb
>
>> >unused=
>
>> >
>
>> >Other network devices
>
>> >=====================
>
>> ><none>
>
>> >
>
>> >Then I created I ovs bridge using below cmd:
>
>> >./ovs-vsctl --no-wait add-br ovs -- set Bridge ovs
>
>> >datapath_type=netdev
>
>> >
>
>> >
>
>> >./ovs-vsctl add-port ovs dpdk0 -- set Interface dpdk0 type=dpdk
>
>> >
>
>> >When I add dpdk port it reports, Â³could not open network device 
>> >dpdk0
>
>> >(Unknown error -19)Â²
>
>> >
>
>> >Please let me know
>
>> >1.
>
>> >What could be possible reason for not detecting the interface which
>
>> >is binded to igb_uio?
>
>> >2.
>
>> >How to add the port which is binded to igb_uio here?
>
>> >
>
>> >
>
>> >Thanks in advance.
>
>> >
>
>> >Regards,
>
>> >Varun
>
>> >
>
>> >
>
>> 
>
>> _______________________________________________
>
>> discuss mailing list
>
>> discuss at openvswitch.org
>
>> 
>>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_ma
>>ilm 
>>an_listinfo_discuss&d=BQIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt
>>-uE
>>s&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=R_Ue30CzlqHA05bc5wDd
>>_3- 
>>gLaJ9AFXE0N4_C6eg4oc&s=gXljBuGE9ayrKr5ND4F_MUuQHbWQTzy6rw7PRD5aVJ4&e=
>


From jpettit at nicira.com  Fri Jun 26 00:12:56 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 26 Jun 2015 09:12:56 +0200
Subject: [ovs-discuss] open Vswitch
In-Reply-To: <CABiFN_9BFRKrTPgZTM_yJ93+-jm3zgPJsSRXF3HY92b+CeXOug@mail.gmail.com>
References: <CABiFN_9BFRKrTPgZTM_yJ93+-jm3zgPJsSRXF3HY92b+CeXOug@mail.gmail.com>
Message-ID: <F8C134A7-B8EB-4EE7-A02F-C91AB8A269DF@nicira.com>


> On Jun 26, 2015, at 1:21 AM, Abhinav <abhinavnzl at gmail.com> wrote:
> 
> Could you please tell me what is the difference betwwen ovs-dpctl and ovs-appctl.

ovs-dpctl talks to the (often kernel) datapath.  ovs-appctl talks to the various userspace daemons.  I'd recommend looking at the man pages, which should describe them.

> Also let me know what is the difference between ovs and linux bridge ?

OVS provides quite a few more features and remote controllability.

You might find this presentation from a couple of years ago applicable:

	http://openvswitch.org/slides/OpenStack-131107.pdf

--Justin



From kevin.traynor at intel.com  Fri Jun 26 05:00:37 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Fri, 26 Jun 2015 12:00:37 +0000
Subject: [ovs-discuss] OVS Performance
In-Reply-To: <CAEgdzZLkzoCv6yLv1B0HEjW8t09jwsGg6_qZNib+x+nsj0gpRw@mail.gmail.com>
References: <360797519.929566.1435199772089.JavaMail.yahoo@mail.yahoo.com>
 <CAEgdzZLkzoCv6yLv1B0HEjW8t09jwsGg6_qZNib+x+nsj0gpRw@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74517B2D1@IRSMSX104.ger.corp.intel.com>

> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Ngo Doan
> Lap
> Sent: Thursday, June 25, 2015 5:51 PM
> To: Ravi Ramaswamy
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] OVS Performance
> 
> Hi,
> Just for 1), please refer to test case 3,7,8,9
> here https://01.org/sites/default/files/page/intel_onp_server_release_1.3.1_b
> enchmark_test_report.pdf

There is some information that is a bit more up to date wrt OVS with DPDK if you
look through this thread http://openvswitch.org/pipermail/dev/2015-May/055509.html

> 
> 
> On Thu, Jun 25, 2015 at 9:36 AM, Ravi Ramaswamy <rsr624 at yahoo.com> wrote:
> Hello - Apologies.  Newbie to OVS and this is my first posting.  I am trying
> to get a high level understanding of the following.  Any pointers is greatly
> appreciated
> 
> * IP forwarding performance and dependence on packet size, flow distribution,
> etc
> * MPLS support on OVS
> * Multi-tenant support (I am thinking VRFs / MPLS/VPNs)
> 
> Thanks
> 
> Ravi
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> 
> 
> 
> --
> Thanks and Best Regards,
> Ngo Doan Lap
> Mobile: 0977.833.757

From rsr624 at yahoo.com  Fri Jun 26 07:26:16 2015
From: rsr624 at yahoo.com (Ravi Ramaswamy)
Date: Fri, 26 Jun 2015 14:26:16 +0000 (UTC)
Subject: [ovs-discuss] OVS Performance
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74517B2D1@IRSMSX104.ger.corp.intel.com>
References: <BC0FEEC7D7650749874CEC11314A88F74517B2D1@IRSMSX104.ger.corp.intel.com>
Message-ID: <1076350871.388292.1435328776559.JavaMail.yahoo@mail.yahoo.com>

Thanks, Guys...
In the Intel paper, if I am not mistaken, the performance is benchmarked with 2 flows. Â Wonder what the performance would be like with 100s or 1000s of flows. Â Seems more realistic in an SP environment
Ravi 


     On Friday, June 26, 2015 8:03 AM, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
   

 > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Ngo Doan
> Lap
> Sent: Thursday, June 25, 2015 5:51 PM
> To: Ravi Ramaswamy
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] OVS Performance
> 
> Hi,
> Just for 1), please refer to test case 3,7,8,9
> here https://01.org/sites/default/files/page/intel_onp_server_release_1.3.1_b
> enchmark_test_report.pdf

There is some information that is a bit more up to date wrt OVS with DPDK if you
look through this thread http://openvswitch.org/pipermail/dev/2015-May/055509.html

> 
> 
> On Thu, Jun 25, 2015 at 9:36 AM, Ravi Ramaswamy <rsr624 at yahoo.com> wrote:
> Hello - Apologies.Â  Newbie to OVS and this is my first posting.Â  I am trying
> to get a high level understanding of the following.Â  Any pointers is greatly
> appreciated
> 
> * IP forwarding performance and dependence on packet size, flow distribution,
> etc
> * MPLS support on OVS
> * Multi-tenant support (I am thinking VRFs / MPLS/VPNs)
> 
> Thanks
> 
> Ravi
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> 
> 
> 
> --
> Thanks and Best Regards,
> Ngo Doan Lap
> Mobile: 0977.833.757


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150626/dbc5658a/attachment.html>

From David.Griswold at overturenetworks.com  Fri Jun 26 08:45:27 2015
From: David.Griswold at overturenetworks.com (David Griswold)
Date: Fri, 26 Jun 2015 15:45:27 +0000
Subject: [ovs-discuss] Flow-Mode Userspace GRE Tunneling
In-Reply-To: <CAEP_g=8Cbxv7Pe=s5yavV-gJBxh==8DO1u5acV9toeq9ikZudg@mail.gmail.com>
References: <8300925C4469CC4D9B142B85733CCF37737B3A5F@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=_Sa21goGxLSfr8d4OAh3oFN0O8wBDPV4NPf_Ozgmwkhw@mail.gmail.com>
 <8300925C4469CC4D9B142B85733CCF37737B3EE7@mbx024-e1-nj-2.exch024.domain.local>
 <CAEP_g=8Cbxv7Pe=s5yavV-gJBxh==8DO1u5acV9toeq9ikZudg@mail.gmail.com>
Message-ID: <8300925C4469CC4D9B142B85733CCF37737B47F9@mbx024-e1-nj-2.exch024.domain.local>

Tunnel port display works fine on 2.4.90 build. I was running 2.3.90.
Thanks for your help.
Regards,
David

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com]
Sent: Thursday, June 25, 2015 7:29 PM
To: David Griswold
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Flow-Mode Userspace GRE Tunneling

On Thu, Jun 25, 2015 at 7:01 AM, David Griswold <David.Griswold at overturenetworks.com> wrote:
> The patch works. Thanks for that.
>
> One other anomaly I noticed when displaying tunnel ports:
>
> ## port-mode tunnel port, looks good.
> ##
> ovs-appctl tnl/ports/show
> Listening ports:
> gre_sys (2) : eth_type(0x0800),ipv4(proto=47,frag=no)
>
> ## flow-mode tunnel port, port type is garbled ## ovs-appctl
> tnl/ports/show Listening ports:
>      (2) : eth_type(0x0800),ipv4(proto=47,frag=no)

Hmm, I'm guess I'm not sure how this would happen and I can't reproduce it (and I really don't understand why it would be different between flow-based and port-based tunnels since there shouldn't be any difference at this level). Does this happen consistently for you? What about different types of tunnels or any other clues you can spot?


This email and attachments may contain privileged or confidential information intended only for the addressee(s) indicated. The sender does not waive any of its rights, privileges or protections respecting this information. If you are not the named addressee, an employee, or agent responsible for sending this message to the named addressee (or this message was received by mistake), you are not authorized to read, print, retain, copy or disseminate this message or any part of it. If received in error, please notify us immediately by e-mail, discard any paper copies and delete all electronic files of the email.

Computer viruses can be transmitted via email. The recipient should check this email and any attachments for viruses. Email transmission cannot be guaranteed to be secured or error-free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete, or contain viruses. The sender accepts no liability for any damage caused by any transmitted viruses or errors or omissions in the contents of this message.

Overture Networks, Inc. 637 Davis Drive, Morrisville, NC USA 27560 www.overturenetworks.com

From alexw at nicira.com  Fri Jun 26 10:37:59 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 26 Jun 2015 10:37:59 -0700
Subject: [ovs-discuss] Openvswitch network disconnect
In-Reply-To: <02cc01d0ae31$1fdd9430$5f98bc90$@progbau.de>
References: <000001d09e8e$09921e60$1cb65b20$@progbau.de>
 <CAArS4XUnPjSVYCqn74g80E23FKcqUXDo-HOkg=4zz5sUMK1VkA@mail.gmail.com>
 <062201d09e93$16df04c0$449d0e40$@progbau.de>
 <CAArS4XXLwUMJdipDCxzYnyozu3Hn+5YSEcPCsTJ6WQATzfuhrA@mail.gmail.com>
 <02cc01d0ae31$1fdd9430$5f98bc90$@progbau.de>
Message-ID: <CAArS4XVxsqd46npiyFNvuW_O=NNdChqkZoqvJQ81PpDP3ncqQg@mail.gmail.com>

Hey Chris,

Sorry for this very delayed reply,

Just checked the core file, very useful,

seems like there is a long running thread holding the
'pthread_rwlock_rdlock'
(possible thread 6?) and starving other threads (including main 'ovs-
vswitchd' thread, which may explain why your ovs-appctl cmd hang)...  To
further investigate, we need the debug info pkg installed, like warned in
the
gdb trace:
"""
Missing separate debuginfos, use: debuginfo-install
openvswitch-2.3.0-1.x86_64
"""

I tried to checkout ovs v2.3.0, compile on my local machine, gdb into it
and run 'info symbol <address in the gdb backtrace>'...  it points me to
totally unrelated function...  so we need to have the debug info pkg from
the
same build...

So, is the ovs pkg you used publicly downloadable?  if so, could you point
me to that, so that I can investigate myself?  if not, could you try
translate
this trace for me? using `info symbol <address>`
"""

Thread 6 (Thread 0x7f76affff700 (LWP 2226)):
#0  0x00007f76d201505e in __lll_lock_wait_private () from /lib64/libc.so.6
#1  0x00007f76d1f9a16b in _L_lock_9503 () from /lib64/libc.so.6
#2  0x00007f76d1f976a6 in malloc () from /lib64/libc.so.6
#3  0x00000000004b07a5 in ?? ()
#4  0x00000000004b18b1 in ?? ()
#5  0x0000000000431235 in ?? ()
#6  0x0000000000432195 in ?? ()
#7  0x0000000000433be0 in ?? ()
#8  0x00000000004340fe in ?? ()
#9  0x000000000042c6fa in ?? ()
#10 0x000000000042e9be in ?? ()
#11 0x000000000042ecba in ?? ()
#12 0x0000000000494661 in ?? ()
#13 0x00007f76d1d079d1 in start_thread () from /lib64/libpthread.so.0
#14 0x00007f76d20058fd in clone () from /lib64/libc.so.6

"""


Also, could you grep the /var/log/openvswitch/ovs-vswitchd.log* for the
following string:
"""
Unreasonably long
"""
And post the output, if a thread holding the rwlock for very long time,
there will be such log in ovs-vswitchd.log

Thanks,
Alex Wang,

On Tue, Jun 23, 2015 at 8:51 PM, Chris <contact at progbau.de> wrote:

> Hello Alex,
>
>
>
> It happened again and I got some gdp traces, please see the output in the
> attachment.
>
> During the gdb session the openvswitch started working again, so Iâ€™m not
> sure if I got the right point.
>
>
>
> Please have a look and let me know if you need additional information.
>
> Thanks in advance!
>
>
>
> Cheers
>
> Chris
>
>
>
> *From:* Alex Wang [mailto:alexw at nicira.com]
> *Sent:* Thursday, June 04, 2015 14:00
>
> *To:* Chris
> *Cc:* discuss at openvswitch.org; openstack at lists.openstack.org; Soputhi Sea
> *Subject:* Re: [ovs-discuss] Openvswitch network disconnect
>
>
>
> Thx for the info, I'll try reproduce it on my local setup using
> active-backup
>
> bond.  And use it as managment interface,
>
>
>
> Will update if I run into the same issue~
>
>
>
> Thanks,
>
> Alex Wang,
>
>
>
> On Wed, Jun 3, 2015 at 11:52 PM, Chris <contact at progbau.de> wrote:
>
> Hello Alex,
>
>
>
> I will do the gdb debug when it happens again.
>
>
>
> Here the output, in this case there are 4 VMs running on the host. The
> physical interfaces eth2 & eth3 are in active-passive mode bonded to bond0.
> mgmt0 is used for the management of the host system. Anything else is
> created by OpenStack.
>
> The failure happens independent from the number of VMs running on the
> host:
>
>
>
> *ovs-vsctl show*
>
> fbbaf640-ed82-4735-99d2-fbe09f4041f1
>
>     Bridge "br-bond0"
>
>         Port "mgmt0"
>
>             Interface "mgmt0"
>
>                 type: internal
>
>         Port "br-bond0"
>
>             Interface "br-bond0"
>
>                 type: internal
>
>         Port "phy-br-bond0"
>
>             Interface "phy-br-bond0"
>
>         Port "bond0"
>
>             Interface "eth2"
>
>             Interface "eth3"
>
>     Bridge br-int
>
>         fail_mode: secure
>
>         Port br-int
>
>             Interface br-int
>
>                 type: internal
>
>         Port "qvo4166dc0a-69"
>
>             tag: 1
>
>             Interface "qvo4166dc0a-69"
>
>         Port "qvo6d8b70de-9c"
>
>             tag: 1
>
>             Interface "qvo6d8b70de-9c"
>
>         Port "qvoe75237cc-7f"
>
>             tag: 1
>
>             Interface "qvoe75237cc-7f"
>
>         Port "qvoe3b9e1fc-a5"
>
>             tag: 1
>
>             Interface "qvoe3b9e1fc-a5"
>
>         Port "int-br-bond0"
>
>             Interface "int-br-bond0"
>
>     ovs_version: "2.3.0"
>
>
>
> *ip a*
>
> 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
>
>     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
>
>     inet 127.0.0.1/8 scope host lo
>
> 2: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000
>
>     link/ether 9c:b6:54:b3:67:34 brd ff:ff:ff:ff:ff:ff
>
> 3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 1000
>
>     link/ether 9c:b6:54:b3:67:35 brd ff:ff:ff:ff:ff:ff
>
> 4: eth2: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen
> 1000
>
>     link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff
>
> 5: eth3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen
> 1000
>
>     link/ether 64:51:06:f0:85:9c brd ff:ff:ff:ff:ff:ff
>
> 6: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether de:76:ca:6d:57:48 brd ff:ff:ff:ff:ff:ff
>
> 7: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether ee:f8:2f:ef:94:42 brd ff:ff:ff:ff:ff:ff
>
> 8: br-bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether 64:51:06:f0:85:98 brd ff:ff:ff:ff:ff:ff
>
> 15: mgmt0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state
> UNKNOWN
>
>     link/ether fa:e1:51:33:5d:dc brd ff:ff:ff:ff:ff:ff
>
>     inet 10.201.195.75/24 brd 10.201.195.255 scope global mgmt0
>
> 16: qbr4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff
>
> 17: qvo4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether ae:27:12:55:09:0c brd ff:ff:ff:ff:ff:ff
>
> 18: qvb4166dc0a-69: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether be:9a:00:23:b1:f3 brd ff:ff:ff:ff:ff:ff
>
> 19: tap4166dc0a-69: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:d6:34:82 brd ff:ff:ff:ff:ff:ff
>
> 20: qbre75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff
>
> 21: qvoe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether 1e:7f:f4:57:aa:82 brd ff:ff:ff:ff:ff:ff
>
> 22: qvbe75237cc-7f: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c2:f2:1a:30:a2:84 brd ff:ff:ff:ff:ff:ff
>
> 23: tape75237cc-7f: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:02:a4:d7 brd ff:ff:ff:ff:ff:ff
>
> 24: qbre3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff
>
> 25: qvoe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c6:5f:19:25:7c:be brd ff:ff:ff:ff:ff:ff
>
> 26: qvbe3b9e1fc-a5: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether ce:c7:ec:59:fd:1a brd ff:ff:ff:ff:ff:ff
>
> 27: tape3b9e1fc-a5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:bb:a7:19 brd ff:ff:ff:ff:ff:ff
>
> 28: qbr6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> noqueue state UNKNOWN
>
>     link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff
>
> 29: qvo6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether 46:23:9e:4b:2a:fd brd ff:ff:ff:ff:ff:ff
>
> 30: qvb6d8b70de-9c: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500
> qdisc pfifo_fast state UP qlen 1000
>
>     link/ether c2:45:27:31:f8:d1 brd ff:ff:ff:ff:ff:ff
>
> 31: tap6d8b70de-9c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UNKNOWN qlen 500
>
>     link/ether fe:16:3e:40:9e:44 brd ff:ff:ff:ff:ff:ff
>
> 32: bond0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
>
>     link/ether f6:83:30:bc:4c:7c brd ff:ff:ff:ff:ff:ff
>
> 35: phy-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UP qlen 1000
>
>     link/ether 76:51:9d:bd:24:83 brd ff:ff:ff:ff:ff:ff
>
> 36: int-br-bond0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
> pfifo_fast state UP qlen 1000
>
>     link/ether 5e:fa:05:2a:1a:ef brd ff:ff:ff:ff:ff:ff
>
>
>
>
>
> Cheers,
>
> Chris
>
>
>
>
>
> *From:* Alex Wang [mailto:alexw at nicira.com]
> *Sent:* Thursday, June 04, 2015 13:29
> *To:* Chris
> *Cc:* discuss at openvswitch.org; openstack at lists.openstack.org; Soputhi Sea
> *Subject:* Re: [ovs-discuss] Openvswitch network disconnect
>
>
>
>
>
>
>
> On Wed, Jun 3, 2015 at 11:16 PM, Chris <contact at progbau.de> wrote:
>
> Hello,
>
> We are using Openvswitch in our Openstack setup.
>
> ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.0
> Compiled Oct 28 2014 17:48:05
> OpenFlow versions 0x1:0x1
>
> We experience openvswitch failures from time to time. It seems to happen
> random, no network traffic spikes for example.
> The VM ports and the openvswitch port for the host management just stop
> working.  But the openvswitch services (ovsdb-server/ ovs-vswitchd) are
> still running
>
> For debug purpose the following commands has been executed:
>
> - "ovs-vsctl show" the interfaces are still listed
> The ones below didn't show any result and just hang after the execution:
> - ovs-appctl bond/show bond0
> - ovs-appctl vlog/list
> - ovs-ofctl dump-flows br-bond0
>
>
>
>
>
> This seems to indicate that the ovs-vswitchd process is dead locked...
>
> I could not find comment in branch-2.3 that relates to dead lock.  It
> would be
>
> helpful if you can gdb into the running ovs-vswitchd process and provide
>
> the backtraces when there is a failure.
>
>
>
> Or could I know what your setup looks like (ovs-vsctl show output)?
>
>
>
> Thanks,
>
> Alex Wang,
>
>
>
>
>
>
>
> A "service openvswitch restart" fix it, the connection from the VMs and the
> host are back immediately.
>
> Any help appreciated!
>
> Cheers,
> Chris
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150626/c7724d25/attachment-0001.html>

From jesse at nicira.com  Sat Jun 27 08:11:57 2015
From: jesse at nicira.com (Jesse Gross)
Date: Sat, 27 Jun 2015 08:11:57 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <019501d0b06d$f20b6020$d6222060$@snoopy.ORG>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
 <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
 <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>
 <004d01d0aeef$d5989db0$80c9d910$@snoopy.ORG>
 <CAEP_g=_GSTKN1WnDnrQ5WS0tZGjHzjrBuu=QKeyCMdVKPQF3cg@mail.gmail.com>
 <019501d0b06d$f20b6020$d6222060$@snoopy.ORG>
Message-ID: <CAEP_g=9nRhKTnwF8BgSDLBD6sNRcEJPbbK0RK++N1k3Z+tjdag@mail.gmail.com>

Thanks for the confirmation. I wonder what Debian 8 is doing to screw
things up?

On Friday, June 26, 2015, Johnson L. Wu <johnson at snoopy.org> wrote:

> Not OVS for sure!!
>
> I tried a control experiment:  Debian  7.8, OVS 2.3.3
>
> # cat /etc/debian_version
> 7.8
> root at labeled3sb1:/home/data/pcap/20150626# ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.3.3
> Compiled Jun 26 2015 16:52:46
> DB Schema 7.6.2
> root at labeled3sb1:/home/data/pcap/20150626# uname -r
> 3.2.0-4-amd64
> root at labeled3sb1:/home/data/pcap/20150626#
>
> ifconfig | grep MTU shows all 1500
> No errors in dmesg at all.
>
> The VM behind the OVS is happy as a clam, no timeouts no need for MTU
> adjustments.
>
> Sorry for the trouble and thanks for all the help Jesse.
>
> Emil I think it may be prudent to reinstall on a 7.8 and not let apt-get
> upgrade or update get in the way and see.
>
> Cheers,
>
> -Johnson
>
> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com <javascript:;>]
> Sent: Thursday, June 25, 2015 4:18 PM
> To: Johnson L. Wu
> Cc: Emil Flink; discuss at openvswitch.org <javascript:;>
> Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)
>
> On Wed, Jun 24, 2015 at 7:37 PM, Johnson L. Wu <johnson at snoopy.org
> <javascript:;>> wrote:
> > Tried configuring 2.4 by hand
> >
> > root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# ovs-vsctl
> > --version ovs-vsctl (Open vSwitch) 2.4.90 Compiled Jun 24 2015
> > 19:16:45 DB Schema 7.12.1
> > root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# uname -r
> > 3.16.0-4-amd64
> > root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps#
> >
> >
> > ./configure --prefix=/usr --localstatedir=/var
> > --with-linux=/lib/modules/`uname -r`/build  make; make install;  make
> > modules_install; sudo depmod -a
> >
> > and its still the same, 2 bytes off.
> >
> > Will update if I see anything else.  Thanks!
>
> OK, thanks. I guess it seems somewhat unlikely to be related to OVS at
> this point, although I don't have a good theory as to what would cause
> this. Let us know if you find anything more.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150627/af7a5d49/attachment.html>

From ahp.caringo at gmail.com  Fri Jun 26 12:36:43 2015
From: ahp.caringo at gmail.com (Aaron Pierce)
Date: Fri, 26 Jun 2015 14:36:43 -0500
Subject: [ovs-discuss] Multicast over GRE Tunnels
Message-ID: <CAAcraLrBaw_ssKA9iLU7+d8JBYF39ADY9QVR77y8onKFcK=PrQ@mail.gmail.com>

I would like to use OVS/GRE to tunnel multicast between nodes.  I've set up
a test environment, and am unable to get multicast working between GRE
connected nodes(UDP and TCP work fine).

I also found a 5 year old thread suggesting that multicast over GRE isn't
implemented:

http://openvswitch.org/pipermail/discuss/2010-September/004454.html

> This configuration would normally work.  However, multicast isn't
> currently implemented in the Open vSwitch GRE stack.  It's planned and
> it shouldn't be too much work but it hasn't been done yet.


Should multicast over a GRE tunnel work?


What I've tried(Ubuntu 14.04 w/OVS v2.3.1):

$> ovs-vsctl add-br br1
$> ovs-vsctl set bridge br1 stp_enable=true
$> ip addr add 10.1.2.11/24 dev br1
$> ovs-vsctl add-port br1 gre1 -- set interface gre1 type=gre
options:remote_ip=<remote ip>

When both nodes are configured, I can ping and use iperf for TCP and
UDP test, but attempting a multicast test fails.

- Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150626/482c621c/attachment.html>

From johnson at snoopy.ORG  Fri Jun 26 17:12:23 2015
From: johnson at snoopy.ORG (Johnson L. Wu)
Date: Fri, 26 Jun 2015 17:12:23 -0700
Subject: [ovs-discuss] Running into MTU problem (2 extra bytes)
In-Reply-To: <CAEP_g=_GSTKN1WnDnrQ5WS0tZGjHzjrBuu=QKeyCMdVKPQF3cg@mail.gmail.com>
References: <01e601d0aad1$ce6ef790$6b4ce6b0$@snoopy.ORG>
 <CAEP_g=-HZEwEf2zXvdaHCDuuasnozEA5Z8WPDTJiup3YOCQ14Q@mail.gmail.com>
 <003301d0aea4$15294480$3f7bcd80$@snoopy.ORG>
 <CAEP_g=8hTr81jB-Et67B-+GP+hdhf-R-3S4ZL12rDVKc5GpGyA@mail.gmail.com>
 <00d401d0aec6$d39fb080$7adf1180$@snoopy.ORG>
 <CAEP_g=-aFh-yrisgF0XKmRzSe00G156172iGbt4Kp4MY3KkH2w@mail.gmail.com>
 <019101d0aee4$9c1ce420$d456ac60$@snoopy.ORG>
 <CAEP_g=9XKVwfFiPh4hLF=wvap1HXSMEMvuQ0M=pvqQgJxFupfA@mail.gmail.com>
 <004d01d0aeef$d5989db0$80c9d910$@snoopy.ORG>
 <CAEP_g=_GSTKN1WnDnrQ5WS0tZGjHzjrBuu=QKeyCMdVKPQF3cg@mail.gmail.com>
Message-ID: <019501d0b06d$f20b6020$d6222060$@snoopy.ORG>

Not OVS for sure!! 

I tried a control experiment:  Debian  7.8, OVS 2.3.3

# cat /etc/debian_version 
7.8
root at labeled3sb1:/home/data/pcap/20150626# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.3
Compiled Jun 26 2015 16:52:46
DB Schema 7.6.2
root at labeled3sb1:/home/data/pcap/20150626# uname -r
3.2.0-4-amd64
root at labeled3sb1:/home/data/pcap/20150626#

ifconfig | grep MTU shows all 1500
No errors in dmesg at all.

The VM behind the OVS is happy as a clam, no timeouts no need for MTU adjustments.

Sorry for the trouble and thanks for all the help Jesse.

Emil I think it may be prudent to reinstall on a 7.8 and not let apt-get upgrade or update get in the way and see.

Cheers,

-Johnson

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Thursday, June 25, 2015 4:18 PM
To: Johnson L. Wu
Cc: Emil Flink; discuss at openvswitch.org
Subject: Re: [ovs-discuss] Running into MTU problem (2 extra bytes)

On Wed, Jun 24, 2015 at 7:37 PM, Johnson L. Wu <johnson at snoopy.org> wrote:
> Tried configuring 2.4 by hand
>
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# ovs-vsctl 
> --version ovs-vsctl (Open vSwitch) 2.4.90 Compiled Jun 24 2015 
> 19:16:45 DB Schema 7.12.1 
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps# uname -r
> 3.16.0-4-amd64
> root at jwu-lenovo:/usr/local/src/trunk/ShadowBox/Deploy/apps#
>
>
> ./configure --prefix=/usr --localstatedir=/var 
> --with-linux=/lib/modules/`uname -r`/build  make; make install;  make 
> modules_install; sudo depmod -a
>
> and its still the same, 2 bytes off.
>
> Will update if I see anything else.  Thanks!

OK, thanks. I guess it seems somewhat unlikely to be related to OVS at this point, although I don't have a good theory as to what would cause this. Let us know if you find anything more.


From zhangcy at cn.fujitsu.com  Sun Jun 28 20:55:22 2015
From: zhangcy at cn.fujitsu.com (Zhang, Chunyu)
Date: Mon, 29 Jun 2015 03:55:22 +0000
Subject: [ovs-discuss] how to use ovs-conntrack
References: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>, 
 <FBC0CB48-3723-4DC4-94F1-4D3E0A439CBE@nicira.com>,
 <A43879EB4A7F5F449E2CA8148EA79E518A50BA@G08CNEXMBPEKD01.g08.fujitsu.local>,
 <8A95693A-E886-405D-8BE6-19AA8DB41FBB@nicira.com>
Message-ID: <A43879EB4A7F5F449E2CA8148EA79E518B2087@G08CNEXMBPEKD01.g08.fujitsu.local>

hi justin

>> 3. ovs-ofctl command
>> in our project , we use nf_conntrack extension :
>>
>> static struct nf_ct_ext_type nf_ct_colo_extend __read_mostly = {
>>      .len        = sizeof(struct nf_conn_colo),
>>      .move       = nf_ct_colo_extend_move,
>>      .destroy    = nf_ct_colo_extend_destroy,
>>      .align      = __alignof__(struct nf_conn_colo),
>>      .id              = NF_CT_EXT_COLO,
>> };
>>
>> if i want to nf_conntrack extension work.
>> ovs-ofctl command is ?
>> please give me some example and advise
>
>If you use the OVS repo, the man pages for ovs-ofctl were updated.  Look for the new "ct" action and "conn_state" match.

I use this:
ovs-ofctl add-flow ovsbr0   "in_port=1,conn_state=+trk+new,tcp,action=ct(commit),1"
ovs-ofctl add-flow ovsbr0   "in_port=2,conn_state=+trk+new,tcp,action=ct(commit),1"
ovs-ofctl add-flow ovsbr0   "in_port=3,conn_state=+trk+new,tcp,action=ct(commit),1"

and ssh can work now.
thanks.

but i have another questions:

1. why tcp can work
i think tcp also use nf_conntrack.
so i think,  without you patch , tcp can not work.

but the result is :
without you patch, ssh(tcp) can work.
but  nf_conntrack extension can not work.
why ?

2. scp can not work
I use nf_conntrack extension .
I use you patch  && ovs-ofctl  command
ovs-ofctl add-flow ovsbr0   "in_port=1,conn_state=+trk+new,tcp,action=ct(commit),1"
ovs-ofctl add-flow ovsbr0   "in_port=2,conn_state=+trk+new,tcp,action=ct(commit),1"
ovs-ofctl add-flow ovsbr0   "in_port=3,conn_state=+trk+new,tcp,action=ct(commit),1"

I find ssh can work
scp can not work.
why?



>
>> On Jun 24, 2015, at 4:13 AM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
>> 
>> hi Justin
>>> 
>>>> On Jun 23, 2015, at 12:37 PM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
>>>> 
>>>> i want to use ovs-conntrack.
>>>> i know ovs is in : https://github.com/justinpettit/ovs/tree/conntrack
>>>> i know kernel module should change : https://lkml.org/lkml/2015/3/2/835
>>> 
>>> As I mentioned, I'd recommend using the OVS repo, which has all the parts you need.  It should be rebased against OVS master in the next couple of days.  I imagine an updated kernel portion will be sent out to netdev in the next few weeks.
>> I found 2 ovs repo in Kernel.org git repositories
>> 1. https://git.kernel.org/cgit/linux/kernel/git/pshelar/openvswitch.git/?h=net_next_ovs
>> 2. https://git.kernel.org/cgit/linux/kernel/git/jesse/openvswitch.git/
>> which one you will push ?
>> I git clone net_next_ovs, but not find any kernel patch for ovs-conntrack
>
>I thought I was using the terminology as you originally used.  The code you should be using is here:
>
>	https://github.com/justinpettit/ovs/tree/conntrack
>
>--Justin
>
>

From abhadra at broadcom.com  Mon Jun 29 02:59:14 2015
From: abhadra at broadcom.com (Abhijit Bhadra)
Date: Mon, 29 Jun 2015 09:59:14 +0000
Subject: [ovs-discuss] OF 1.3 question
Message-ID: <7E446A6128134441B5FE3C3D368FE101351235EB@SJEXCHMB10.corp.ad.broadcom.com>

Hi,
I am using ovs-ofctl to test addition/modification/deletion of OF 1.3 flows. I was using the following command to do the actions=mod_nw_tos for OF 1.0,
ovs-ofctl add-flow tcp:10.130.177.160 dl_vlan=128,in_port=12,table=60,priority=100,actions=mod_nw_tos:4,output:24

Now I am using ovs-ofctl -O openflow13 add-flow tcp:10.130.177.160 dl_vlan=128,in_port=12,table=60,priority=100,actions=mod_nw_tos:4,output:24. But I get the following error:
"ovs-ofctl: none of the usable flow formats (OpenFlow10+table_id,NXM+table_id) is among the allowed flow formats (OXM-OpenFlow13)".
How do I achieve the same actions=mod_nw_tos for OF 1.3 using ovs-ofctl?
Regards,
Abhijit

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150629/26257b48/attachment.html>

From saj3saj at gmail.com  Mon Jun 29 09:56:09 2015
From: saj3saj at gmail.com (Sea aj)
Date: Mon, 29 Jun 2015 12:56:09 -0400
Subject: [ovs-discuss] OVS VXlan between two host!
Message-ID: <CAF3Zw3Ta35eyr6NFV7UwMnSxG5B=cRtMsJdKBwc3RgChS3x6sg@mail.gmail.com>

Hi everybody,

I've successfully tested the GRE tunneling between two docker containers in
different hosts which is explained in this
<http://fbevmware.blogspot.ca/2013/12/coupling-docker-and-open-vswitch.html>
post.

but when I tried to change the connection to VXlan it does not work. I've
coppied two OVS configurations below. Is there a way to test if the VXlan
connection exists?

I will be grateful for any help you can provide.

First Host:
3e6c266b-a90d-4f37-a308-dbf7244bc288
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "tep0"
            Interface "tep0"
                type: internal
    Bridge "br2"
        Port "vethl11425"
            tag: 20
            Interface "vethl11425"
        Port "vethl11373"
            tag: 10
            Interface "vethl11373"
        Port "vx1"
            Interface "vx1"
                type: vxlan
                options: {key=flow, remote_ip="10.12.1.3"}
        Port "br2"
            Interface "br2"
                type: internal
    ovs_version: "1.4.6"

Second Switch:
8582aa0f-f927-4ef8-98ce-f6e487425788
    Bridge "br2"
        Port "br2"
            Interface "br2"
                type: internal
        Port "vethl20585"
            tag: 10
            Interface "vethl20585"
        Port "vethl20701"
            tag: 20
            Interface "vethl20701"
        Port "vethl20645"
            tag: 20
            Interface "vethl20645"
        Port "vx1"
            Interface "vx1"
                type: vxlan
                options: {key=flow, remote_ip="10.12.1.24"}
    Bridge "br0"
        Port "tep0"
            Interface "tep0"
                type: internal
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "1.4.6"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150629/091aa984/attachment.html>

From shettyg at nicira.com  Mon Jun 29 11:37:13 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 29 Jun 2015 11:37:13 -0700
Subject: [ovs-discuss] OVS VXlan between two host!
In-Reply-To: <CAF3Zw3Ta35eyr6NFV7UwMnSxG5B=cRtMsJdKBwc3RgChS3x6sg@mail.gmail.com>
References: <CAF3Zw3Ta35eyr6NFV7UwMnSxG5B=cRtMsJdKBwc3RgChS3x6sg@mail.gmail.com>
Message-ID: <CAHbON5rKfZqyUmcSuPY96dL7uDtopTr8yoa3AjXyF0d+Db0FCA@mail.gmail.com>

OVS 1.4.6 does not support VXLAN. Please upgrade to OVS 2.3

On Mon, Jun 29, 2015 at 9:56 AM, Sea aj <saj3saj at gmail.com> wrote:
> Hi everybody,
>
> I've successfully tested the GRE tunneling between two docker containers in
> different hosts which is explained in this post.
>
> but when I tried to change the connection to VXlan it does not work. I've
> coppied two OVS configurations below. Is there a way to test if the VXlan
> connection exists?
>
> I will be grateful for any help you can provide.
>
> First Host:
> 3e6c266b-a90d-4f37-a308-dbf7244bc288
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "tep0"
>             Interface "tep0"
>                 type: internal
>     Bridge "br2"
>         Port "vethl11425"
>             tag: 20
>             Interface "vethl11425"
>         Port "vethl11373"
>             tag: 10
>             Interface "vethl11373"
>         Port "vx1"
>             Interface "vx1"
>                 type: vxlan
>                 options: {key=flow, remote_ip="10.12.1.3"}
>         Port "br2"
>             Interface "br2"
>                 type: internal
>     ovs_version: "1.4.6"
>
> Second Switch:
> 8582aa0f-f927-4ef8-98ce-f6e487425788
>     Bridge "br2"
>         Port "br2"
>             Interface "br2"
>                 type: internal
>         Port "vethl20585"
>             tag: 10
>             Interface "vethl20585"
>         Port "vethl20701"
>             tag: 20
>             Interface "vethl20701"
>         Port "vethl20645"
>             tag: 20
>             Interface "vethl20645"
>         Port "vx1"
>             Interface "vx1"
>                 type: vxlan
>                 options: {key=flow, remote_ip="10.12.1.24"}
>     Bridge "br0"
>         Port "tep0"
>             Interface "tep0"
>                 type: internal
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "1.4.6"
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From jesse at nicira.com  Mon Jun 29 14:09:27 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 29 Jun 2015 14:09:27 -0700
Subject: [ovs-discuss] Multicast over GRE Tunnels
In-Reply-To: <CAAcraLrBaw_ssKA9iLU7+d8JBYF39ADY9QVR77y8onKFcK=PrQ@mail.gmail.com>
References: <CAAcraLrBaw_ssKA9iLU7+d8JBYF39ADY9QVR77y8onKFcK=PrQ@mail.gmail.com>
Message-ID: <CAEP_g=8Q0DbHt7grYHS33_BNYvpppk803V+qs_ocKhCgB5+79w@mail.gmail.com>

On Fri, Jun 26, 2015 at 12:36 PM, Aaron Pierce <ahp.caringo at gmail.com> wrote:
> I would like to use OVS/GRE to tunnel multicast between nodes.  I've set up
> a test environment, and am unable to get multicast working between GRE
> connected nodes(UDP and TCP work fine).
>
> I also found a 5 year old thread suggesting that multicast over GRE isn't
> implemented:
>
> http://openvswitch.org/pipermail/discuss/2010-September/004454.html
>
>> This configuration would normally work.  However, multicast isn't
>> currently implemented in the Open vSwitch GRE stack.  It's planned and
>> it shouldn't be too much work but it hasn't been done yet.
>
>
> Should multicast over a GRE tunnel work?

Nothing was ever implemented on this front, so it hasn't changed. It
should be possible to run multicast traffic over a unicast tunnel
(since the tunnel itself doesn't care about IP layer) but there's no
support for the tunnels themselves being multicast.

From jpettit at nicira.com  Mon Jun 29 18:00:05 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 29 Jun 2015 18:00:05 -0700
Subject: [ovs-discuss] how to use ovs-conntrack
In-Reply-To: <A43879EB4A7F5F449E2CA8148EA79E518B2087@G08CNEXMBPEKD01.g08.fujitsu.local>
References: <A43879EB4A7F5F449E2CA8148EA79E518A17F3@G08CNEXMBPEKD01.g08.fujitsu.local>
 <FBC0CB48-3723-4DC4-94F1-4D3E0A439CBE@nicira.com>
 <A43879EB4A7F5F449E2CA8148EA79E518A50BA@G08CNEXMBPEKD01.g08.fujitsu.local>
 <8A95693A-E886-405D-8BE6-19AA8DB41FBB@nicira.com>
 <A43879EB4A7F5F449E2CA8148EA79E518B2087@G08CNEXMBPEKD01.g08.fujitsu.local>
Message-ID: <C22D4100-EE7E-4D76-9A3F-4CDFA8ACC842@nicira.com>


> On Jun 28, 2015, at 8:55 PM, Zhang, Chunyu <zhangcy at cn.fujitsu.com> wrote:
> 
> hi justin
> 
>>> 3. ovs-ofctl command
>>> in our project , we use nf_conntrack extension :
>>> 
>>> static struct nf_ct_ext_type nf_ct_colo_extend __read_mostly = {
>>>     .len        = sizeof(struct nf_conn_colo),
>>>     .move       = nf_ct_colo_extend_move,
>>>     .destroy    = nf_ct_colo_extend_destroy,
>>>     .align      = __alignof__(struct nf_conn_colo),
>>>     .id              = NF_CT_EXT_COLO,
>>> };
>>> 
>>> if i want to nf_conntrack extension work.
>>> ovs-ofctl command is ?
>>> please give me some example and advise
>> 
>> If you use the OVS repo, the man pages for ovs-ofctl were updated.  Look for the new "ct" action and "conn_state" match.
> 
> I use this:
> ovs-ofctl add-flow ovsbr0   "in_port=1,conn_state=+trk+new,tcp,action=ct(commit),1"
> ovs-ofctl add-flow ovsbr0   "in_port=2,conn_state=+trk+new,tcp,action=ct(commit),1"
> ovs-ofctl add-flow ovsbr0   "in_port=3,conn_state=+trk+new,tcp,action=ct(commit),1"

I don't understand these flows.  You can't match on "conn_state" until after your call to ct().  This is documented in the ovs-ofctl man page:

       conn_state=[+flag...][-flag...]
              Bitwise  match  on  connection  state flags.  The flags are only
              available after a call to the ct action with the  "recirc"  flag
              set.

Further, you're sending all of your packets to port 1, which I can't imagine is what you want.

One of the commit messages provides some example flows:

	https://github.com/justinpettit/ovs/commit/be947f2

--Justin



From guojiannan1101 at gmail.com  Mon Jun 29 19:57:28 2015
From: guojiannan1101 at gmail.com (guojiannan)
Date: Tue, 30 Jun 2015 10:57:28 +0800
Subject: [ovs-discuss] QoS/traffic-limit on internal ports
Message-ID: <55920598.8070609@gmail.com>

Hi,

I am currently trying to put traffic control on our OpenStack cloud and 
my questions in one sentence would be: *is it possible at all to 
rate-limit particular port with type internal?*

The whole story is as following:
We are running OpenStack Neutron network over OpenVSwitch. Datapath can 
be found here:

https://pinrojas.files.wordpress.com/2014/07/neutron-openstack-openvswitch-router-dnsmasq-gre-kionetworks-plug-in-tap-devices-instances-nova-compute-software-defined-networks-sdn-cloud-layer-1.jpg

Hence, to limit upload/download bandwidth of a particular sub-network, 
the most intuitive approach is to put QoS rules on L3 router agents, 
namely port qr-XXXXXX-XX and qg-XXXXX-XX in Neutron nodes. Both of them 
are *internal type* in OVS-system and I have tried following commands:

1. # ovs-vsctl set interface qr-XXXXXX-XX ingress_policing_rate=2000000
    # ovs-vsctl set interface qr-XXXXXX-XX ingress_policing_rate=2000

2. # ovs-vsctl -- set Port qr-XXXXXX-XX qos=@newqos \
      -- --id=@newqos create QoS type=linux-htb 
other-config:max-rate=2000000 queues=0=@q0 \
      -- --id=@q0 create Queue other-config:min-rate=2000000

Although neither of them seem to be effective when I try iperf within in 
VMs.

Meanwhile, I do achieve rate limit when apply exactly same commands on 
qvoXXXXXX-XX, which is connected to each VM. I've noticed that they are 
normal types.

Therefore, I suspect that rate limit does not support internal port, 
which connects two network namespaces in linux.

Thanks for your valuable time and I truly appreciate your help!

Best Regards,
/J

From billy.o.mahony at intel.com  Tue Jun 30 07:46:59 2015
From: billy.o.mahony at intel.com (O Mahony, Billy)
Date: Tue, 30 Jun 2015 14:46:59 +0000
Subject: [ovs-discuss] surprising effects with exit v's drop
Message-ID: <03135AEA779D444E90975C2703F148DC15A300CF@IRSMSX107.ger.corp.intel.com>

Hi All,

I am getting very surprising (to me at least) effects with the following
flows installed.

I am seeing packets forwarded when I expect them to be dropped and dropped 
when I expect them to be forwarded.

Here is my flow table:

[14:22 ]$ ovs-ofctl -O OpenFlow13 dump-flows br0
OFPST_FLOW reply (OF1.3) (xid=0x2):
 cookie=0x0, duration=2.860s, table=0, n_packets=0, n_bytes=0, priority=1 actions=goto_table:1
 cookie=0x0, duration=2.845s, table=1, n_packets=0, n_bytes=0, priority=1,in_port=1 actions=write_actions(output:2),write_metadata:0x2,goto_table:2
 cookie=0x0, duration=2.834s, table=1, n_packets=0, n_bytes=0, priority=1,in_port=2 actions=write_actions(output:1),write_metadata:0x1,goto_table:2
 cookie=0x0, duration=2.815s, table=2, n_packets=0, n_bytes=0, priority=1 actions=exit

For a packet ingressing on port1 I'm expecting it to be egressed on port2.
This does not happen however (using a hardware traffic generator) and the 
packet is dropped. ofproto/trace seems to expect this to happen as it says 
"Datapath actions: drop" at the end of its output:

[14:22 ]$ ovs-appctl  -t /usr/local/var/run/openvswitch/ovs-vswitchd.61474.ctl ofproto/trace br0  in_port=1
Bridge: br0
Flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

Rule: table=0 cookie=0 priority=1
OpenFlow actions=goto_table:1

        Resubmitted flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
        Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0 reg5=0x0 reg6=0x0 reg7=0x0
        Resubmitted  odp: drop
        Resubmitted megaflow: recirc_id=0,in_port=1,dl_type=0x0000
        Rule: table=1 cookie=0 priority=1,in_port=1
        OpenFlow actions=write_actions(output:2),write_metadata:0x2,goto_table:2

                Resubmitted flow: metadata=0x2,in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
                Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0 reg5=0x0 reg6=0x0 reg7=0x0
                Resubmitted  odp: drop
                Resubmitted megaflow: recirc_id=0,in_port=1,dl_type=0x0000
                Rule: table=2 cookie=0 priority=1
                OpenFlow actions=exit

Final flow: metadata=0x2,in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
Datapath actions: drop      <<<< SURPRISE!

If I then replace the action in table 2 to 'exit', packets from port1 are indeed
egressed on port2 (again verified by hardware packet generator) and apparently
as predicted by ofproto/trace.

[14:22 ]$ ovs-ofctl -O OpenFlow13  add-flow br0 "table=2,priority=1 actions=drop"
[14:25 ]$ ovs-appctl  -t /usr/local/var/run/openvswitch/ovs-vswitchd.61474.ctl ofproto/trace br0  in_port=1
Bridge: br0
Flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

Rule: table=0 cookie=0 priority=1
OpenFlow actions=goto_table:1

        Resubmitted flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
        Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0 reg5=0x0 reg6=0x0 reg7=0x0
        Resubmitted  odp: drop
        Resubmitted megaflow: recirc_id=0,in_port=1,dl_type=0x0000
        Rule: table=1 cookie=0 priority=1,in_port=1
        OpenFlow actions=write_actions(output:2),write_metadata:0x2,goto_table:2

                Resubmitted flow: metadata=0x2,in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
                Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0 reg5=0x0 reg6=0x0 reg7=0x0
                Resubmitted  odp: drop
                Resubmitted megaflow: recirc_id=0,in_port=1,dl_type=0x0000
                Rule: table=2 cookie=0 priority=1
                OpenFlow actions=drop

Final flow: metadata=0x2,in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
Datapath actions: 3


This is all pretty surprising to me though obviously there could be some
subtleties I am missing. I'd appreciate and thoughts or tips from the
community.

Finally, I am using dpdk enabled NICs.

[14:25 ]$ ovs-ofctl show br0
OFPT_FEATURES_REPLY (xid=0x2): dpid:000090e2ba69d620
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(dpdk0): addr:90:e2:ba:69:d6:20
     config:     0
     state:      0
     current:    10GB-FD
     supported:  1GB-HD 1GB-FD 10GB-FD COPPER FIBER AUTO_PAUSE
     speed: 10000 Mbps now, 10000 Mbps max
 2(dpdk1): addr:90:e2:ba:69:d6:21
     config:     0
     state:      0
     current:    10GB-FD
     supported:  1GB-HD 1GB-FD 10GB-FD COPPER FIBER AUTO_PAUSE
     speed: 10000 Mbps now, 10000 Mbps max
 LOCAL(br0): addr:90:e2:ba:69:d6:20
     config:     PORT_DOWN
     state:      LINK_DOWN
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
[14:38 ]$ ovs-vsctl show
290a84b5-431a-4f1f-ac17-df82abd72bba
    Bridge "br0"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "br0"
            Interface "br0"
                type: internal
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
[14:38 ]$                                                                                                                  


Thanks,
Billy O'Mahony.

From gowrishankar.m at linux.vnet.ibm.com  Tue Jun 30 08:01:40 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Tue, 30 Jun 2015 20:31:40 +0530
Subject: [ovs-discuss] [dpdk-ovs]VXLAN encapsulation exceeds the MTU of
 dpdk port .
In-Reply-To: <558BB553.2020403@dtdream.com>
References: <558BB553.2020403@dtdream.com>
Message-ID: <5592AF54.10803@linux.vnet.ibm.com>

On Thursday 25 June 2015 01:31 PM, Dongjun wrote:
> As following topology, two VMs communicate via VXLAN tunnel.
> TCP pkts may be droped for exceeding the MTU of host DPDK port in br2.
> Now I can change the VMs' MTU from default to smaller to accommodate 
> the traffics, it works well.
>
> The way I have not find to change mtu of DPDK phy port, is there a 
> blueprint for supporting this by ovs, like "ovs-appctl 
> netdev-dpdk/set-xxx" or another way?
>
>         Host1                  |                     Host2
>                     (l-ip)-   L3    -(r-ip)
> -----   -----        -----     |     -----       -----  ----- -----
> |VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
> -----   -----        -----     |     -----       -----  ----- -----

There are two br2 bridge on Host2. It is intentional ?

Btw, I am trying on same page but could not simplify the vm-vxlan-dpdk 
working within "single" bridge case,
may be that I am yet to find right flow rules to handle vhost-user, 
vxlan and dpdk ports.
I hope you are using patch port between two bridges. Would you really 
need it ?


Regards,
Gowri Shankar
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss



From ahp.caringo at gmail.com  Mon Jun 29 15:26:12 2015
From: ahp.caringo at gmail.com (Aaron Pierce)
Date: Mon, 29 Jun 2015 17:26:12 -0500
Subject: [ovs-discuss] Multicast over GRE Tunnels
In-Reply-To: <CAEP_g=8Q0DbHt7grYHS33_BNYvpppk803V+qs_ocKhCgB5+79w@mail.gmail.com>
References: <CAAcraLrBaw_ssKA9iLU7+d8JBYF39ADY9QVR77y8onKFcK=PrQ@mail.gmail.com>
 <CAEP_g=8Q0DbHt7grYHS33_BNYvpppk803V+qs_ocKhCgB5+79w@mail.gmail.com>
Message-ID: <CAAcraLo2T_Q-Np+fVg3cbgQH2UXeX_p47k=8r0+iz8MXDx2v6Q@mail.gmail.com>

Thank you for the clarification.

I was able to get multicast traffic over the tunnel after adding a routing
rule for the multicast IP address.  Once I figured that out, I was able to
finish my proof-of-concept successfully.

I look forward to using Open vSwitch in my project.

- Aaron

On Mon, Jun 29, 2015 at 4:09 PM, Jesse Gross <jesse at nicira.com> wrote:

> On Fri, Jun 26, 2015 at 12:36 PM, Aaron Pierce <ahp.caringo at gmail.com>
> wrote:
> > I would like to use OVS/GRE to tunnel multicast between nodes.  I've set
> up
> > a test environment, and am unable to get multicast working between GRE
> > connected nodes(UDP and TCP work fine).
> >
> > I also found a 5 year old thread suggesting that multicast over GRE isn't
> > implemented:
> >
> > http://openvswitch.org/pipermail/discuss/2010-September/004454.html
> >
> >> This configuration would normally work.  However, multicast isn't
> >> currently implemented in the Open vSwitch GRE stack.  It's planned and
> >> it shouldn't be too much work but it hasn't been done yet.
> >
> >
> > Should multicast over a GRE tunnel work?
>
> Nothing was ever implemented on this front, so it hasn't changed. It
> should be possible to run multicast traffic over a unicast tunnel
> (since the tunnel itself doesn't care about IP layer) but there's no
> support for the tunnels themselves being multicast.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150629/0e6ace31/attachment-0001.html>

From sundar_ramki at yahoo.com  Mon Jun 29 16:08:23 2015
From: sundar_ramki at yahoo.com (Sundar Ramakrishnan)
Date: Mon, 29 Jun 2015 23:08:23 +0000 (UTC)
Subject: [ovs-discuss] Openvswitch with DPDK issue
In-Reply-To: <D1AF45AE.3513%diproiettod@vmware.com>
References: <D1AF45AE.3513%diproiettod@vmware.com>
Message-ID: <856464988.1284599.1435619303789.JavaMail.yahoo@mail.yahoo.com>

Thanks to Daniele, I have openvswitch compiled with dpdk. The way I installed is postedÂ sundar-ramki/ovs-dpdk.
| Â  |
| Â  |  | Â  | Â  | Â  | Â  | Â  |
| sundar-ramki/ovs-dpdkovs-dpdk - Openvswitch with DPDK |
|  |
| View on github.com | Preview by Yahoo |
|  |
| Â  |



I have the following questions -Â 
1. How do I figure out if my VM is really using Openvswitch with DPDK?
2. Are there any counters for packets entering and leaving the switch and/or dpdk?
3. Also, I am unable to use the ofctl commands. Following is what I get -Â 
[root at test1 ~]# ovs-ofctl show br23ovs-ofctl: br23 is not a bridge or a socket[root at test1 ~]# ovs-vsctl showd8cfc890-a4fc-4398-869c-59c5412a3e79Â  Â  Bridge "br23"Â  Â  Â  Â  Port "eth3"Â  Â  Â  Â  Â  Â  Interface "eth3"Â  Â  Â  Â  Port "br23"Â  Â  Â  Â  Â  Â  Interface "br23"Â  Â  Â  Â  Â  Â  Â  Â  type: internalÂ  Â  Â  Â  Port "eth2"Â  Â  Â  Â  Â  Â  Interface "eth2"
Any input will be appreciated.
Thank youSRK
 


     On Tuesday, June 23, 2015 12:25 PM, Daniele Di Proietto <diproiettod at vmware.com> wrote:
   

 Hi,

OVS 2.3.2 supports DPDK 1.6, as stated in INSTALL.DPDK.
Many APIs have changed in DPDK in a backward incompatible
way.

Also, DPDK support in OVS 2.3.2 is experimental.Â  It would be
better to use the code from branch-2.4 (with DPDK 2.0)

Daniele


On 22/06/2015 23:30, "Sundar Ramakrishnan" <sundar_ramki at yahoo.com> wrote:

>
>Hello,
>
>
>I am a newbie to this environment and I am unable to find which release
>of DPDK works fine with Openvswitch. I hope you could enlighten me with
>some docs or references with which I could build a working setup -
>
>
>RHEL 6.6
>DPDK - 1.7.1
>OVS - 2.3.1
>
>
>Following are some steps I figured out from the web & my experiments -
>
>
>Error:
>
>
>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h: In
>function Ã¢rte_is_alignedÃ¢:
>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h:176:
>warning: cast from function call of type Ã¢uintptr_tÃ¢ to non-matching type
>Ã¢void *Ã¢
>lib/netdev-dpdk.c: In function Ã¢dpdk_class_initÃ¢:
>lib/netdev-dpdk.c:1081: warning: implicit declaration of function
>Ã¢rte_pmd_init_allÃ¢
>lib/netdev-dpdk.c: In function Ã¢dpdk_initÃ¢:
>lib/netdev-dpdk.c:1189: error: too few arguments to function
>Ã¢rte_memzone_dumpÃ¢
>make[2]: *** [lib/netdev-dpdk.lo] Error 1
>make[2]: Leaving directory `/usr/src/openvswitch-2.3.1'
>make[1]: *** [all-recursive] Error 1
>make[1]: Leaving directory `/usr/src/openvswitch-2.3.1'
>make: *** [all] Error 2
>
>
>
>
>DPDK Open vSwitch Notes RHEL6.6:
>------------------------
>
>
>Additions to kernel cmdline:
>iommu=pt intel_iommu=on default_hugepagesz=1G hugepagesz=1G
>transparent_hugepage=never hugepages=32
>
>
>BUILD DPDK:
>cd /usr/src/dpdk-1.6.0r2 <--- 1st working version
>cd /usr/src/dpdk-1.7.1 <--- Only works with 82599
>cd /usr/src/dpdk-1.8.0 <--- x540s are recognized ovs doesn't build with
>it tho
>export DPDK=$(pwd)
>export TGT=x86_64-native-linuxapp-gcc
>make CONFIG_RTE_BUILD_COMBINE_LIBS=y CONFIG_RTE_BUILD_SHARED_LIB=n
>CONFIG_RTE_LIBRTE_IXGBE_PMD=y CONFIG_RTE_LIBRTE_IGB_PMD=y install T=$TGT
>
>
>
>BUILD OpenvSwitch:
>cd /usr/src/openvswitch-2.3.1
>export OVS=$(pwd)
>./boot.sh
>./configure --disable-ssl --with-dpdk=$DPDK/$TGT LIBS=-ldl
>make
>make install
>ln -sf /usr/local/bin/ovs-vsctl /usr/bin/ovs-vsctl <--- libvirt requires
>ovs-vsctl to be here
>
>
>
>
>Please let me know if you find something wrong in what I am doing.
>
>
>Thanking you
>
>
>Sundar
>
>
>


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150629/41de5b79/attachment-0001.html>

From vrapelly at sonusnet.com  Tue Jun 30 03:39:36 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Tue, 30 Jun 2015 10:39:36 +0000
Subject: [ovs-discuss] Packet drop on OVS-DPDK bridges
Message-ID: <BL2PR03MB26034F17E780ECFAAEA91F3B7A90@BL2PR03MB260.namprd03.prod.outlook.com>

Hi Team,

I created OVS bridges [on RHEL 7]using the attached Init.sh script [Using ovs-branch 2.4 and DPDK-2.0. Not using 1GB huge pages].

Then I created a KVM instance  and used mactap devices [created by ovs bridge] in that VM instance. I had installed my application on new VM instance and I was able to do the things[calls] successfully. But when I started pumping load, observed good number of call failures.

Then I checked the stats on the OVS bridges and found good number drop count.

[root at artha utilities]# ./ovs-vsctl get Interface pktovs statistics
{collisions=0, rx_bytes=3020971673, rx_crc_err=0, rx_dropped=59038515, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=13956397, tx_bytes=27949373215, tx_dropped=340854, tx_errors=0, tx_packets=130762243}

Please clarify:
1. What this drop count implies? If it is a problem, then how to overcome this problem?[ by increasing any ring or mbuf sizes??]
2. Do we need to change any buffer ring/size based on traffic on OVS bridges?

Regards,
Varun

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Init.sh
Type: application/octet-stream
Size: 1946 bytes
Desc: Init.sh
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150630/e58a183d/attachment.obj>

From lxuemei3000 at gmail.com  Tue Jun 30 09:48:12 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Tue, 30 Jun 2015 09:48:12 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
Message-ID: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>

Hi,

I want to generate forwarding rules for ovs, and need to get the port id
(0, 1, ...) at the ovs from the port name (eth0, ...).  I tried ovs-vsctl
show, ovs-dpctl show, but they don't show the port id. Could anyone tell me
the commands to implement this task?

Thanks,
Xuemei Liu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150630/f108ddfc/attachment.html>

From alexw at nicira.com  Tue Jun 30 09:50:42 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 30 Jun 2015 09:50:42 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
Message-ID: <CAArS4XWt0VG1q-tiNpx9T2kivf=oKmvMe==V5MsL0Ubcr9MVVA@mail.gmail.com>

On Tue, Jun 30, 2015 at 9:48 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:

> Hi,
>
> I want to generate forwarding rules for ovs, and need to get the port id
> (0, 1, ...) at the
>


Assume you are talking about OpenFlow flows, then please use 'ovs-ofctl
show <bridge-name>'



> ovs from the port name (eth0, ...).  I tried ovs-vsctl show, ovs-dpctl
> show, but they don't show the port id. Could anyone tell me the commands to
> implement this task?
>
> Thanks,
> Xuemei Liu
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150630/dc8a5cae/attachment.html>

From jpettit at nicira.com  Tue Jun 30 09:53:45 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 30 Jun 2015 09:53:45 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
Message-ID: <13CBE31C-5230-43FA-B39C-6884E74292BA@nicira.com>

It's in quite a few places.  The way people usually get it is from the "ofport" column of the Interface table in the database.  You can see it by running "ovs-vsctl list interface".  You can also run "ovs-appctl dpif/show" which will show you both the OpenFlow port number as well as the datapath one.  Another option is with "ovs-ofctl dump-ports br-int".

--Justin


> On Jun 30, 2015, at 9:48 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> 
> Hi, 
> 
> I want to generate forwarding rules for ovs, and need to get the port id (0, 1, ...) at the ovs from the port name (eth0, ...).  I tried ovs-vsctl show, ovs-dpctl show, but they don't show the port id. Could anyone tell me the commands to implement this task?
> 
> Thanks,
> Xuemei Liu
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From lxuemei3000 at gmail.com  Tue Jun 30 11:18:40 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Tue, 30 Jun 2015 11:18:40 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <CAArS4XWt0VG1q-tiNpx9T2kivf=oKmvMe==V5MsL0Ubcr9MVVA@mail.gmail.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
 <CAArS4XWt0VG1q-tiNpx9T2kivf=oKmvMe==V5MsL0Ubcr9MVVA@mail.gmail.com>
Message-ID: <CA+oJsLP3s6cMUZRCL3PSM=zWURb0Ye5CrN6-sVShbut-o-86Gw@mail.gmail.com>

Hi, Alex,

Thanks for response. I tried that command before, no port number is shown.

On Tue, Jun 30, 2015 at 9:50 AM, Alex Wang <alexw at nicira.com> wrote:

>
>
> On Tue, Jun 30, 2015 at 9:48 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
>
>> Hi,
>>
>> I want to generate forwarding rules for ovs, and need to get the port id
>> (0, 1, ...) at the
>>
>
>
> Assume you are talking about OpenFlow flows, then please use 'ovs-ofctl
> show <bridge-name>'
>
>
>
>> ovs from the port name (eth0, ...).  I tried ovs-vsctl show, ovs-dpctl
>> show, but they don't show the port id. Could anyone tell me the commands to
>> implement this task?
>>
>> Thanks,
>> Xuemei Liu
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150630/eb5d3e08/attachment-0001.html>

From lxuemei3000 at gmail.com  Tue Jun 30 11:22:18 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Tue, 30 Jun 2015 11:22:18 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <13CBE31C-5230-43FA-B39C-6884E74292BA@nicira.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
 <13CBE31C-5230-43FA-B39C-6884E74292BA@nicira.com>
Message-ID: <CA+oJsLPj6XbxR7oGNk2kXZNW_onggc34A-pfwzCeny5AWLWQ_g@mail.gmail.com>

Hi, Justin,

Thanks for providing these commands, and "ovs-appctl dpif/show" works
perfect for me. However, I cannot find that command on
http://openvswitch.org/support/dist-docs/ovs-appctl.8.txt or
http://manpages.ubuntu.com/manpages/precise/man8/ovs-appctl.8.html. Thus,
how do you know the command? any manual?

Thanks,
Xuemei

On Tue, Jun 30, 2015 at 9:53 AM, Justin Pettit <jpettit at nicira.com> wrote:

> It's in quite a few places.  The way people usually get it is from the
> "ofport" column of the Interface table in the database.  You can see it by
> running "ovs-vsctl list interface".  You can also run "ovs-appctl
> dpif/show" which will show you both the OpenFlow port number as well as the
> datapath one.  Another option is with "ovs-ofctl dump-ports br-int".
>
> --Justin
>
>
> > On Jun 30, 2015, at 9:48 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> >
> > Hi,
> >
> > I want to generate forwarding rules for ovs, and need to get the port id
> (0, 1, ...) at the ovs from the port name (eth0, ...).  I tried ovs-vsctl
> show, ovs-dpctl show, but they don't show the port id. Could anyone tell me
> the commands to implement this task?
> >
> > Thanks,
> > Xuemei Liu
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150630/bbe6970b/attachment.html>

From jpettit at nicira.com  Tue Jun 30 15:18:22 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 30 Jun 2015 15:18:22 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <CA+oJsLPj6XbxR7oGNk2kXZNW_onggc34A-pfwzCeny5AWLWQ_g@mail.gmail.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
 <13CBE31C-5230-43FA-B39C-6884E74292BA@nicira.com>
 <CA+oJsLPj6XbxR7oGNk2kXZNW_onggc34A-pfwzCeny5AWLWQ_g@mail.gmail.com>
Message-ID: <7FAFD7DD-3A30-4715-8720-3F42CF0C7BA1@nicira.com>

As mentioned in the ovs-appctl man page, you have to look at the man page for the daemon:

       Open  vSwitch  daemons  accept  certain  commands at runtime to control
       their behavior and query their settings.  Every daemon accepts a common
       set  of  commands documented under COMMON COMMANDS below.  Some daemons
       support  additional  commands  documented  in   their   own   manpages.
       ovs-vswitchd in particular accepts a number of additional commands docâ€
       umented in ovs-vswitchd(8).

Here's the relevant section from the ovs-vswitchd man page:

       dpif/show
              Prints  a  summary of configured datapaths, including statistics
              and a list of connected ports.  The  port  information  includes
              the  OpenFlow  port  number, datapath port number, and the type.
              (The local port is identified as OpenFlow port 65534.)

--Justin


> On Jun 30, 2015, at 11:22 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> 
> Hi, Justin,
> 
> Thanks for providing these commands, and "ovs-appctl dpif/show" works perfect for me. However, I cannot find that command on http://openvswitch.org/support/dist-docs/ovs-appctl.8.txt or http://manpages.ubuntu.com/manpages/precise/man8/ovs-appctl.8.html. Thus, how do you know the command? any manual?
> 
> Thanks,
> Xuemei
> 
> On Tue, Jun 30, 2015 at 9:53 AM, Justin Pettit <jpettit at nicira.com> wrote:
> It's in quite a few places.  The way people usually get it is from the "ofport" column of the Interface table in the database.  You can see it by running "ovs-vsctl list interface".  You can also run "ovs-appctl dpif/show" which will show you both the OpenFlow port number as well as the datapath one.  Another option is with "ovs-ofctl dump-ports br-int".
> 
> --Justin
> 
> 
> > On Jun 30, 2015, at 9:48 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> >
> > Hi,
> >
> > I want to generate forwarding rules for ovs, and need to get the port id (0, 1, ...) at the ovs from the port name (eth0, ...).  I tried ovs-vsctl show, ovs-dpctl show, but they don't show the port id. Could anyone tell me the commands to implement this task?
> >
> > Thanks,
> > Xuemei Liu
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> 
> 


From dongj at dtdream.com  Tue Jun 30 19:31:36 2015
From: dongj at dtdream.com (Dongjun)
Date: Wed, 01 Jul 2015 10:31:36 +0800
Subject: [ovs-discuss] [dpdk-ovs]VXLAN encapsulation exceeds the MTU of
 dpdk port .
In-Reply-To: <5592AF54.10803@linux.vnet.ibm.com>
References: <558BB553.2020403@dtdream.com> <5592AF54.10803@linux.vnet.ibm.com>
Message-ID: <55935108.7050505@dtdream.com>



On 2015/6/30 23:01, gowrishankar wrote:
> On Thursday 25 June 2015 01:31 PM, Dongjun wrote:
>> As following topology, two VMs communicate via VXLAN tunnel.
>> TCP pkts may be droped for exceeding the MTU of host DPDK port in br2.
>> Now I can change the VMs' MTU from default to smaller to accommodate 
>> the traffics, it works well.
>>
>> The way I have not find to change mtu of DPDK phy port, is there a 
>> blueprint for supporting this by ovs, like "ovs-appctl 
>> netdev-dpdk/set-xxx" or another way?
>>
>>         Host1                  |                     Host2
>>                     (l-ip)-   L3    -(r-ip)
>> -----   -----        -----     |     -----       -----  ----- -----
>> |VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
>> -----   -----        -----     |     -----       -----  ----- -----
>
> There are two br2 bridge on Host2. It is intentional ?
>
> Btw, I am trying on same page but could not simplify the vm-vxlan-dpdk 
> working within "single" bridge case,
> may be that I am yet to find right flow rules to handle vhost-user, 
> vxlan and dpdk ports.
> I hope you are using patch port between two bridges. Would you really 
> need it ?
>
>
> Regards,
> Gowri Shankar
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
Thanks.
There is a redundant br2. I fix topology, add IPs and configuration, 
would you please see it again.

               Host1            |            Host2
6.0.0.1              7.0.0.1-  L3   -7.0.0.2             6.0.0.2
-----   -----        -----     |     -----       -----  -----
|VM1| --|br0|Vxlan --|br1|DPDK---DPDK|br1|--Vxlan|br0|--|VM2|
-----   -----        -----     |     -----       -----  -----

Host1:
#Bridges and Ports:
ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 vhost-user-1 -- set interface vhost-user-1 
type=dpdkvhostuser ofport_request=1
ovs-vsctl add-port br0 vxlan-1 -- set interface vxlan-1 type=vxlan 
ofport_request=100 options:remote_ip=7.0.0.2

ovs-vsctl del-br br1
ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk0 -- set interface dpdk0 type=dpdk 
ofport_request=1

ifconfig br1 7.0.0.1/24

#Flows:
ovs-ofctl add-flow br0 priority=5,ip,nw_dst=6.0.0.1,action=output:1
ovs-ofctl add-flow br0 priority=5,ip,nw_dst=6.0.0.2,action=output:100
ovs-ofctl add-flow br0 priority=0,action=NORMAL

ovs-ofctl add-flow br1 priority=5,ip,in_port=LOCAL,action=output:1
ovs-ofctl add-flow br1 priority=5,ip,in_port=1,action=output:LOCAL
ovs-ofctl add-flow br1 priority=0,action=NORMAL


Host2:
#Bridges and Ports:
ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 vhost-user-1 -- set interface vhost-user-1 
type=dpdkvhostuser ofport_request=1
ovs-vsctl add-port br0 vxlan-1 -- set interface vxlan-1 type=vxlan 
ofport_request=100 options:remote_ip=7.0.0.1

ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk0 -- set interface dpdk0 type=dpdk 
ofport_request=1

ifconfig br1 7.0.0.2/24

#Flows:
ovs-ofctl add-flow br0 priority=5,ip,nw_dst=6.0.0.2,action=output:1
ovs-ofctl add-flow br0 priority=5,ip,nw_dst=6.0.0.1,action=output:100
ovs-ofctl add-flow br0 priority=0,action=NORMAL

ovs-ofctl add-flow br1 priority=5,ip,in_port=LOCAL,action=output:1
ovs-ofctl add-flow br1 priority=5,ip,in_port=1,action=output:LOCAL
ovs-ofctl add-flow br1 priority=0,action=NORMAL


From masri.sahri at gmail.com  Tue Jun 30 20:35:19 2015
From: masri.sahri at gmail.com (nor masri sahri)
Date: Wed, 1 Jul 2015 12:35:19 +0900
Subject: [ovs-discuss] flow table priority
Message-ID: <CAFzAnhgAXzgUQFk=0s1HLQRbkBV0sG7Rt7XQCEYymqUYN8HBAw@mail.gmail.com>

hi all, in ovs, the process to have multiple flow entries for single match
can be differentiate by the priority field. Flow entries with higher number
of priority will be match first.
If there is a way or even supported in OVS that multiple flow table has
priority also like the flow entries.
 For example, first action for specific flow entries is in flow table 0
(match is purposedly configured to not match the packet sent via packet-in
before) and second action (match packet sent via packet-in before) is in
flow table 1 (pre-installed).Then it will force packet-in to sent in again
to controller. This second time, i wanted to redirect the packet to the
preinstalled match and action in flow table 1.
Appreciate if anyone can help shed the light for me. thanks


-- 
Regards,

masri.sahri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150701/c313e60a/attachment.html>

